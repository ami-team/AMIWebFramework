<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>Template</title>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/ami.es6.js"></script>

    <script type="text/javascript">

	amiWebApp.onReady = function()
	{
		return amiWebApp.loadSubAppByURL('document');
	};

	amiWebApp.onRefresh = function(isAuth)
	{
		/*---------------------------------------------------------*/

		var menu =
			'<li class="nav-item dropdown">' +
			'  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">' +
			'    Search' +
			'  </a>' +
			'  <div class="dropdown-menu">' +
			'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=searchEngine">Search Engine</a>' +
			'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=simpleSearchEngine">Simple Search Engine</a>' +
			'    <div class="dropdown-divider"></div>' +
			'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=schemaViewer">Schema Viewer</a>' +
			'  </div>' +
			'</li>' +
			'<li class="nav-item dropdown">' +
			'  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">' +
			'    Tools' +
			'  </a>' +
			'  <div class="dropdown-menu">' +
			'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=command">Command</a>' +
			'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=emergency">Emergency</a>' +
			'  </div>' +
			'</li>'
		;

		/*---------------------------------------------------------*/

		var adminMenu;

		if(amiLogin.hasRole('AMI_ADMIN'))
		{
			adminMenu =
				'<li class="nav-item dropdown">' +
				'  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">' +
				'    <i class="fa fa-key"></i> Admin' +
				'  </a>' +
				'  <div class="dropdown-menu">' +
				'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=monitoring">AMI Monitoring</a>' +
				'    <div class="dropdown-divider"></div>' +
				'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=document&userdata=api.html">AMI Web Framework API</a>' +
				'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=document&userdata=info.html">AMI Web Framework Info</a>' +
				'  </div>' +
				'</li>'
			;
		}
		else
		{
			adminMenu = '';
		}

		/*---------------------------------------------------------*/

		if(isAuth)
		{
			amiCommand.execute('ListHashes').done(function(data) {

				var rows = amiWebApp.jspath('..row', data) || [];

				menu +=
					'<li class="nav-item dropdown">' +
					'  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">' +
					'    Bookmarks' +
					'  </a>' +
					'  <div class="dropdown-menu">' +
					'    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=???"><i class="fa fa-pencil"></i> Manage...</a>' +
					'    <div class="dropdown-divider"></div>'
				;

				rows.forEach(function(row) {

					var hash = amiWebApp.jspath('.field{.@name==="hash"}.$', row)[0] || '';
					var name = amiWebApp.jspath('.field{.@name==="name"}.$', row)[0] || '';

					menu += '    <a class="dropdown-item" href="' + amiWebApp.webAppURL + '?v=' + hash + '">' + amiWebApp.textToHtml(name) + '</a>';
				});

				menu +=
					'  </div>' +
					'</li>'
				;

				$('#ami_menu_content').html(menu + adminMenu);

			}).fail(function() {

				$('#ami_menu_content').html(menu + adminMenu);
			});
		}
		else
		{
			$('#ami_menu_content').html(menu + adminMenu);
		}

		/*---------------------------------------------------------*/
	};

    </script>
  </head>
  <body>

    <script type="text/javascript">

	var endpoint_url;

	if(amiWebApp.isLocal())
	{
		endpoint_url = 'https://localhost:8443/AMI/FrontEnd';
//		endpoint_url = 'https://ami.in2p3.fr/AMI/servlet/net.hep.atlas.Database.Bookkeeping.AMI.Servlet.FrontEnd';
	}
	else
	{
		endpoint_url = '/AMI/servlet/net.hep.atlas.Database.Bookkeeping.AMI.Servlet.FrontEnd';
	}

	amiWebApp.start({
		home_url: 'template2.html',
		theme_url: 'twig/AMI/Theme/blue.twig',
		endpoint_url: endpoint_url,
	});

    </script>

  </body>
</html>