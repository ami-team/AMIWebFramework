<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<title>AMI</title>

		<script type="text/javascript" src="js/jquery.min.js"></script>

		<script type="text/javascript" src="js/ami.es6.js?embedded"></script>

		<script type="text/javascript">

			var myTab1;
			var myTab2;
			var myTable;
			var mySchema;
			var mySimpleSearch;
			var mySearch;

			amiWebApp.onRefresh = function(isAuth) {

				if(isAuth)
				{
					myTab1.render('#myTab1');

					myTab1.appendTab('tab1').done(function(sel) {

						myTable.render(sel, 'SearchQuery -catalog="self" -entity="router_command" -mql="SELECT id, id+1 AS idp1, command, class, 1 AS an_integer"', {showDetails: true, canEdit: true, catalog: 'self', entity: 'router_command'});
					});

					myTab1.appendTab('tab2').done(function(sel) {

						$(sel).height(325);

						mySchema.render(sel, 'self');
					});

					/*----*/

					myTab2.render('#myTab2', {card: true});

					myTab2.appendTab('Search').done(function(sel) {

						mySimpleSearch.render(sel, {command: 'GetUserInfo', param: 'amiLogin', canEdit: false, catalog: 'self', entity: 'user', rowset: 'user'});
					});

					myTab2.appendTab('Search').done(function(sel) {

						mySearch.render(sel, {});
					});
				}
				else
				{
					$('#myTab1').empty();
					$('#myTab2').empty();
				}
			};

			amiWebApp.onReady = function() {

				return amiWebApp.loadResources(['ctrl:tab', 'ctrl:table', 'ctrl:schema', 'ctrl:simpleSearch', 'ctrl:search']).done(function(controls) {

					myTab1 = new controls[0];
					myTab2 = new controls[0];

					myTable = new controls[1](myTab1);
					mySchema = new controls[2](myTab1);
					mySimpleSearch = new controls[3](myTab2);
					mySearch = new controls[4](myTab2);
				});
			};

			amiWebApp.start({
				endpoint_url: 'https://localhost:8443/AMI/FrontEnd'
			});

		</script>
	</head>
	<body>

		<nav class="navbar navbar-expand-lg navbar-light bg-light">

			<ul class="navbar-nav ml-auto" id="ami_login_content"></ul>

		</nav>

		<div id="ami_alert_content"></div>

		<br />

		<div id="myTab2" style="margin: auto; width: 95%;"></div>

		<br />

		<div id="myTab1" style="margin: auto; width: 95%;"></div>

		<br />
		<br />
		<br />
		<br />

	</body>
</html>
