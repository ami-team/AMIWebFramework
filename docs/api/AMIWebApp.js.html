<link rel="stylesheet" type="text/css" href="docs/api/css/AMI-template.css"></link>

<div class="row">

  <nav class="col-md-3">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">AMI Web framework API</h3>
      </div>
      <div class="panel-body jsdoc-menu">
        <h4><a href="index.html">Home</a></h4><h4>Classes</h4><ul><li><a href="?subapp=amiDocument&userdata=api/AMITwigExprCompiler.html">AMITwigExprCompiler</a></li></ul><h4>Events</h4><ul><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html#event:onStart">onStart</a></li><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html#event:onToolbarUpdateNeeded">onToolbarUpdateNeeded</a></li></ul><h4>Namespaces</h4><ul><li><a href="?subapp=amiDocument&userdata=api/amiCommand.html">amiCommand</a></li><li><a href="?subapp=amiDocument&userdata=api/amiLogin.html">amiLogin</a></li><li><a href="?subapp=amiDocument&userdata=api/amiTokenizer.html">amiTokenizer</a></li><li><a href="?subapp=amiDocument&userdata=api/amiTwigExprInterpreter.html">amiTwigExprInterpreter</a></li><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html">amiWebApp</a></li></ul><h4>Interfaces</h4><ul><li><a href="?subapp=amiDocument&userdata=api/AMISubApp.html">AMISubApp</a></li></ul><h4>Global</h4><ul><li><a href="?subapp=amiDocument&userdata=api/global.html#amiRegisterSubApp">amiRegisterSubApp</a></li></ul>
      </div>
    </div>
  </nav>

  <div class="col-md-9 jsdoc-content">
    <h1>Source: AMIWebApp.js</h1>
    



    
<section>
  <article>
    <pre class="ami-code"><code><i class="line-number"></i>/*!
<i class="line-number"></i> * AMI Web Framework
<i class="line-number"></i> *
<i class="line-number"></i> * Copyright (c) 2014-2015 The AMI Team
<i class="line-number"></i> * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
<i class="line-number"></i> *
<i class="line-number"></i> */
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* INTERNAL VARIABLES                                                      */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>var _ami_internal_nonce = jQuery.now();
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>var _ami_internal_subAppDict = {};
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>var _ami_internal_scripts = [];
<i class="line-number"></i>var _ami_internal_sheets = [];
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* INTERNAL FUNCTIONS                                                      */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>function _ami_internal_always(deferred, func)
<i class="line-number"></i>{
<i class="line-number"></i>	if(deferred &amp;&amp; deferred.always)
<i class="line-number"></i>	{
<i class="line-number"></i>		deferred.always(function() {
<i class="line-number"></i>
<i class="line-number"></i>			func();
<i class="line-number"></i>		});
<i class="line-number"></i>	}
<i class="line-number"></i>	else
<i class="line-number"></i>	{
<i class="line-number"></i>		func();
<i class="line-number"></i>	}
<i class="line-number"></i>}
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* GLOBAL FUNCTIONS                                                        */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>/**
<i class="line-number"></i>  * Register a sub-application
<i class="line-number"></i>  * @param {String} subAppName the sub-application name
<i class="line-number"></i>  * @param {?} subAppInstance the sub-application instance
<i class="line-number"></i>  */
<i class="line-number"></i>
<i class="line-number"></i>function amiRegisterSubApp(subAppName, subAppInstance)
<i class="line-number"></i>{
<i class="line-number"></i>	_ami_internal_subAppDict[subAppName.toLowerCase()] = subAppInstance;
<i class="line-number"></i>}
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* amiWebApp                                                               */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>/**
<i class="line-number"></i> * The AMI webapp subsystem
<i class="line-number"></i> * @namespace amiWebApp
<i class="line-number"></i> */
<i class="line-number"></i>
<i class="line-number"></i>var amiWebApp = {
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* CONSTRUCTOR                                                     */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	init: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* DEFAULT SHEETS                                          */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		this.loadSheets([
<i class="line-number"></i>			/* Third-party */
<i class="line-number"></i>			'css/bootstrap.min.css',
<i class="line-number"></i>			'css/bootstrap.vertical-tabs.min.css',
<i class="line-number"></i>			'css/font-awesome.min.css',
<i class="line-number"></i>			/* AMI */
<i class="line-number"></i>			'css/AMI/AMIWebApp.min.css',
<i class="line-number"></i>		]).fail(function(data) {
<i class="line-number"></i>
<i class="line-number"></i>			alert('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>
<i class="line-number"></i>			console.error(data);
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* DEFAULT SCRIPTS                                         */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		this.loadScripts([
<i class="line-number"></i>			/* Third-party */
<i class="line-number"></i>			'js/jspath.min.js',
<i class="line-number"></i>			'js/bootstrap.min.js',
<i class="line-number"></i>			/* AMI */
<i class="line-number"></i>			'js/AMI/AMIObjects.min.js',
<i class="line-number"></i>			'js/AMI/AMICommand.min.js',
<i class="line-number"></i>			'js/AMI/AMILogin.min.js',
<i class="line-number"></i>			'js/AMI/AMITokenizer.min.js',
<i class="line-number"></i>			'js/AMI/AMITwigExprCompiler.min.js',
<i class="line-number"></i>			'js/AMI/AMITwigExprInterpreter.min.js',
<i class="line-number"></i>			'js/AMI/AMITwig.min.js',
<i class="line-number"></i>		]).fail(function(data) {
<i class="line-number"></i>
<i class="line-number"></i>			alert('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>
<i class="line-number"></i>			console.error(data);
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* DEFAULT FRAGMENTS                                       */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		this.loadHTMLs([
<i class="line-number"></i>			'html/AMI/Fragment/alert_success.html',
<i class="line-number"></i>			'html/AMI/Fragment/alert_info.html',
<i class="line-number"></i>			'html/AMI/Fragment/alert_warning.html',
<i class="line-number"></i>			'html/AMI/Fragment/alert_error.html',
<i class="line-number"></i>		], {context: this}).done(function(data) {
<i class="line-number"></i>			this.fragmentSuccess = data[0];
<i class="line-number"></i>			this.fragmentInfo = data[1];
<i class="line-number"></i>			this.fragmentWarning = data[2];
<i class="line-number"></i>			this.fragmentError = data[3];
<i class="line-number"></i>		}).fail(function(data) {
<i class="line-number"></i>
<i class="line-number"></i>			alert('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>
<i class="line-number"></i>			console.error(data);
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* AVAILABILITY                                            */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		setTimeout(function() {
<i class="line-number"></i>
<i class="line-number"></i>			if($('#ami_main_content').is(':empty'))
<i class="line-number"></i>			{
<i class="line-number"></i>				$('#ami_main_content').html('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>		}, 8000);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* URLs                                                    */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var url = document.location.href;
<i class="line-number"></i>
<i class="line-number"></i>		var index1 = url./**/indexOf('?');
<i class="line-number"></i>		if(index1 >= 0) url = url.substring(0, index1);
<i class="line-number"></i>		var index2 = url.lastIndexOf('/');
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		/**
<i class="line-number"></i>		  * {String} WebApp URL
<i class="line-number"></i>		  * @type {String}
<i class="line-number"></i>		  */
<i class="line-number"></i>
<i class="line-number"></i>		this.webAppURL = url;
<i class="line-number"></i>
<i class="line-number"></i>		while(this.webAppURL[this.webAppURL.length - 1] === '/')
<i class="line-number"></i>		{
<i class="line-number"></i>			this.webAppURL = this.webAppURL.substring(0, this.webAppURL.length - 1);
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		/**
<i class="line-number"></i>		  * Origin URL
<i class="line-number"></i>		  * @type {String}
<i class="line-number"></i>		  */
<i class="line-number"></i>
<i class="line-number"></i>		this.originURL = url.substring(0, index2);
<i class="line-number"></i>
<i class="line-number"></i>		while(this.originURL[this.originURL.length - 1] === '/')
<i class="line-number"></i>		{
<i class="line-number"></i>			this.originURL = this.originURL.substring(0, this.originURL.length - 1);
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* ARGs                                                    */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		/**
<i class="line-number"></i>		  * URL arguments
<i class="line-number"></i>		  * @type {Array&lt;String>}
<i class="line-number"></i>		  */
<i class="line-number"></i>
<i class="line-number"></i>		this.args = {};
<i class="line-number"></i>
<i class="line-number"></i>		if(window.location.search)
<i class="line-number"></i>		{
<i class="line-number"></i>			var prarams = window.location.search.substring(1).split('&amp;');
<i class="line-number"></i>
<i class="line-number"></i>			for(var i in prarams)
<i class="line-number"></i>			{
<i class="line-number"></i>				var pair = prarams[i].split('=');
<i class="line-number"></i>
<i class="line-number"></i>				this.args[pair[0]] = decodeURIComponent(pair[1]);
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* TOOLS                                                           */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Check whether the WebApp is executed locally (file://, localhost or 127.0.0.1) or not
<i class="line-number"></i>	  * @returns {Boolean} True or False
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	isLocal: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		return document.location.protocol === (('file:'))
<i class="line-number"></i>		       ||
<i class="line-number"></i>		       document.location.hostname === 'localhost'
<i class="line-number"></i>		       ||
<i class="line-number"></i>		       document.location.hostname === '127.0.0.1'
<i class="line-number"></i>		;
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Escapes the given string from text to HTML
<i class="line-number"></i>	  * @param {String} string the unescaped string
<i class="line-number"></i>	  * @returns {String} The escaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	textToHtml: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/"/g, '&amp;quot;').replace(/&lt;/g, '&amp;lt;').replace(/>/g, '&amp;gt;');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Unescapes the given string from HTML to text
<i class="line-number"></i>	  * @param {String} string the escaped string
<i class="line-number"></i>	  * @returns {String} The unescaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	htmlToText: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/&amp;gt;/g, '>').replace(/&amp;lt;/g, '&lt;').replace(/&amp;quot;/g, '"');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Escapes the given string from text to JavaScript string
<i class="line-number"></i>	  * @param {String} string the unescaped string
<i class="line-number"></i>	  * @returns {String} The escaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	textToString: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/\\/g, '\\\\').replace(/"/g, '\\\"').replace(/'/g, '\\\'');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Unescapes the given string from JavaScript string to text
<i class="line-number"></i>	  * @param {String} string the escaped string
<i class="line-number"></i>	  * @returns {String} The unescaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	stringToText: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/\\'/g, '\'').replace(/\\"/g, '\"').replace(/\\\\/g, '\\');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Escapes the given string from HTML to JavaScript string
<i class="line-number"></i>	  * @param {String} string the unescaped string
<i class="line-number"></i>	  * @returns {String} The escaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	htmlToString: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/\\/g, '\\\\').replace(/&amp;quot;/g, '\\&amp;quot;').replace(/'/g, '\\\'');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Unescapes the given string from JavaScript string to HTML
<i class="line-number"></i>	  * @param {String} string the escaped string
<i class="line-number"></i>	  * @returns {String} The unescaped string
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	stringToHtml: function(s)
<i class="line-number"></i>	{
<i class="line-number"></i>		return s.replace(/\\'/g, '\'').replace(/\\&amp;quot;/g, '&amp;quot;').replace(/\\\\/g, '\\');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* DYNAMIC SHEET LOADING                                           */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Loads CSS sheets asynchronously
<i class="line-number"></i>	  * @param {(Array|String)} sheets the array of sheets
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	loadSheets: function(sheets, settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			context = settings['context'];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		if(!(sheets instanceof Array))
<i class="line-number"></i>		{
<i class="line-number"></i>			sheets = [sheets];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var html = '';
<i class="line-number"></i>
<i class="line-number"></i>		for(var i in sheets)
<i class="line-number"></i>		{
<i class="line-number"></i>			if(_ami_internal_sheets.indexOf(sheets[i]) &lt; 0)
<i class="line-number"></i>			{
<i class="line-number"></i>				_ami_internal_sheets.push(sheets[i]);
<i class="line-number"></i>
<i class="line-number"></i>				html += '&lt;link rel="stylesheet" type="text/css" href="' + sheets[i] + '?_=' + _ami_internal_nonce++ + '">&lt;/link>';
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		$('head').append(html).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				result.resolveWith(context);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				result.resolve();
<i class="line-number"></i>			}
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* DYNAMIC SCRIPT LOADING                                          */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Loads JavaScript scripts asynchronously
<i class="line-number"></i>	  * @param {(Array|String)} scripts the array of scripts
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	loadScripts: function(scripts, settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			context = settings['context'];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		if(!(scripts instanceof Array))
<i class="line-number"></i>		{
<i class="line-number"></i>			scripts = [scripts];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var html = '';
<i class="line-number"></i>
<i class="line-number"></i>		for(var i in scripts)
<i class="line-number"></i>		{
<i class="line-number"></i>			if(_ami_internal_scripts.indexOf(scripts[i]) &lt; 0)
<i class="line-number"></i>			{
<i class="line-number"></i>				_ami_internal_scripts.push(scripts[i]);
<i class="line-number"></i>
<i class="line-number"></i>				html += '&lt;script type="text/javascript" src="' + scripts[i] + '?_=' + _ami_internal_nonce++ + '">&lt;/script>';
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		$('head').append(html).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				result.resolveWith(context);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				result.resolve();
<i class="line-number"></i>			}
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* DYNAMIC HTML LOADING                                            */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	_loadHTMLs: function(deferred, array, fragments, context)
<i class="line-number"></i>	{
<i class="line-number"></i>		if(fragments.length > 0)
<i class="line-number"></i>		{
<i class="line-number"></i>			var url = fragments.shift();
<i class="line-number"></i>
<i class="line-number"></i>			$.ajax({
<i class="line-number"></i>				url: url,
<i class="line-number"></i>				cache: false,
<i class="line-number"></i>				dataType: 'html',
<i class="line-number"></i>				context: this,
<i class="line-number"></i>			}).done(function(data) {
<i class="line-number"></i>
<i class="line-number"></i>				array.push(data);
<i class="line-number"></i>
<i class="line-number"></i>				this._loadHTMLs(deferred, array, fragments, context);
<i class="line-number"></i>
<i class="line-number"></i>			}).fail(function() {
<i class="line-number"></i>
<i class="line-number"></i>				if(context) {
<i class="line-number"></i>					deferred.rejectWith(context, ['could not load `' + url + '`']);
<i class="line-number"></i>				} else {
<i class="line-number"></i>					deferred.reject('could not load `' + url + '`');
<i class="line-number"></i>				}
<i class="line-number"></i>			});
<i class="line-number"></i>		}
<i class="line-number"></i>		else
<i class="line-number"></i>		{
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				deferred.resolveWith(context, [array]);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				deferred.resolve(array);
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Loads HTML fragments asynchronously
<i class="line-number"></i>	  * @param {(Array|String)} fragments the array of fragments
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	loadHTMLs: function(fragments, settings) {
<i class="line-number"></i>
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			context = settings['context'];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		if(!(fragments instanceof Array))
<i class="line-number"></i>		{
<i class="line-number"></i>			fragments = [fragments];
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		this._loadHTMLs(result, [], fragments, context);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* HTML CONTENT                                                    */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	webappRegExp: /%%\s*WEBAPP_URL\s*%%/g,
<i class="line-number"></i>	originRegExp: /%%\s*ORIGIN_URL\s*%%/g,
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Replace the HTML content of the given target
<i class="line-number"></i>	  * @param {String} path the target path
<i class="line-number"></i>	  * @param {String} html the HTML fragment
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context, dict)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	replaceHTML: function(selector, html, settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		html = html.replace(this.webappRegExp, this.webAppURL);
<i class="line-number"></i>		html = html.replace(this.originRegExp, this.originURL);
<i class="line-number"></i>
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>		var dict = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			if('context' in settings) {
<i class="line-number"></i>				context = settings['context'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('dict' in settings) {
<i class="line-number"></i>				dict = settings['dict'];
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		html = this.formatHTML(html, dict);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var target = $(selector);
<i class="line-number"></i>
<i class="line-number"></i>		target.html(html).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.amitt').tooltip({delay: {show: 500, hide: 100}});
<i class="line-number"></i>			target.find('.amipo[tabindex="0"]').popover({html: true, trigger: 'focus'});
<i class="line-number"></i>			target.find('.amipo[tabindex!="0"]').popover({html: true, trigger: 'click'});
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.ami-select').each(function() {
<i class="line-number"></i>				$(this).wrap('&lt;div class="ami-select-wrapper">&lt;/div>');
<i class="line-number"></i>			});
<i class="line-number"></i>
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				result.resolveWith(context);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				result.resolve();
<i class="line-number"></i>			}
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Prepends a HTML fragment to the given target content
<i class="line-number"></i>	  * @param {String} path the target path
<i class="line-number"></i>	  * @param {String} html the HTML fragment
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context, dict)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	prependHTML: function(selector, html, settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		html = html.replace(this.webappRegExp, this.webAppURL);
<i class="line-number"></i>		html = html.replace(this.originRegExp, this.originURL);
<i class="line-number"></i>
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>		var dict = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			if('context' in settings) {
<i class="line-number"></i>				context = settings['context'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('dict' in settings) {
<i class="line-number"></i>				dict = settings['dict'];
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		html = this.formatHTML(html, dict);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var target = $(selector);
<i class="line-number"></i>
<i class="line-number"></i>		target.prepend(html).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.amitt').tooltip({delay: {show: 500, hide: 100}});
<i class="line-number"></i>			target.find('.amipo[tabindex="0"]').popover({html: true, trigger: 'focus'});
<i class="line-number"></i>			target.find('.amipo[tabindex!="0"]').popover({html: true, trigger: 'click'});
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.ami-select').each(function() {
<i class="line-number"></i>				$(this).wrap('&lt;div class="ami-select-wrapper">&lt;/div>');
<i class="line-number"></i>			});
<i class="line-number"></i>
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				result.resolveWith(context);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				result.resolve();
<i class="line-number"></i>			}
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Appends a HTML fragment to the given target content
<i class="line-number"></i>	  * @param {String} path the target path
<i class="line-number"></i>	  * @param {String} html the HTML fragment
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (context, dict)
<i class="line-number"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	appendHTML: function(selector, html, settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		html = html.replace(this.webappRegExp, this.webAppURL);
<i class="line-number"></i>		html = html.replace(this.originRegExp, this.originURL);
<i class="line-number"></i>
<i class="line-number"></i>		var context = null;
<i class="line-number"></i>		var dict = null;
<i class="line-number"></i>
<i class="line-number"></i>		if(settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			if('context' in settings) {
<i class="line-number"></i>				context = settings['context'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('dict' in settings) {
<i class="line-number"></i>				dict = settings['dict'];
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		html = this.formatHTML(html, dict);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var result = $.Deferred();
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var target = $(selector);
<i class="line-number"></i>
<i class="line-number"></i>		target.append(html).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.amitt').tooltip({delay: {show: 500, hide: 100}});
<i class="line-number"></i>			target.find('.amipo[tabindex="0"]').popover({html: true, trigger: 'focus'});
<i class="line-number"></i>			target.find('.amipo[tabindex!="0"]').popover({html: true, trigger: 'click'});
<i class="line-number"></i>
<i class="line-number"></i>			target.find('.ami-select').each(function() {
<i class="line-number"></i>				$(this).wrap('&lt;div class="ami-select-wrapper">&lt;/div>');
<i class="line-number"></i>			});
<i class="line-number"></i>
<i class="line-number"></i>			if(context) {
<i class="line-number"></i>				result.resolveWith(context);
<i class="line-number"></i>			} else {
<i class="line-number"></i>				result.resolve();
<i class="line-number"></i>			}
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		return result.promise();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Format the given HTML fragment using TWIG, see: {@link http://twig.sensiolabs.org/documentation}
<i class="line-number"></i>	  * @param {String} html the HTML fragment
<i class="line-number"></i>	  * @param {Object} [dict] the dictionary
<i class="line-number"></i>	  * @returns {String} The formated HTML fragment
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	formatHTML: function(html, dict)
<i class="line-number"></i>	{
<i class="line-number"></i>		if(dict instanceof Array)
<i class="line-number"></i>		{
<i class="line-number"></i>			var result = '';
<i class="line-number"></i>
<i class="line-number"></i>			for(var i in dict)
<i class="line-number"></i>			{
<i class="line-number"></i>				result += amiTwig.render(html, dict[i]);
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			return result;
<i class="line-number"></i>		}
<i class="line-number"></i>		else
<i class="line-number"></i>		{
<i class="line-number"></i>			return amiTwig.render(html, dict);
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* JSPATH                                                          */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Finds data within the given JSON, see: {@link https://github.com/dfilatov/jspath}
<i class="line-number"></i>	  * @param {String} path the path
<i class="line-number"></i>	  * @param {Object} json the JSON
<i class="line-number"></i>	  * @returns {Array} The resulting array
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	jspath: function(path, json)
<i class="line-number"></i>	{
<i class="line-number"></i>		return JSPath.apply(path, json);
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* LOCK                                                            */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Locks the web application
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	lock: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		$('#ami_locker').css('display', 'block');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Unlocks the web application
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	unlock: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		$('#ami_locker').css('display', 'none');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* MESSAGES                                                        */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Show a 'success' message
<i class="line-number"></i>	  * @param {String} message the message
<i class="line-number"></i>	  * @param {Boolean} [fadeOut=false] if True, the message disappears after 60s
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	success: function(message, fadeOut)
<i class="line-number"></i>	{
<i class="line-number"></i>		this.replaceHTML('#ami_status_content', this.fragmentSuccess, {dict: {MESSAGE: message}});
<i class="line-number"></i>		this.unlock();
<i class="line-number"></i>
<i class="line-number"></i>		$(document).scrollTop(0);
<i class="line-number"></i>
<i class="line-number"></i>		if(fadeOut)
<i class="line-number"></i>		{
<i class="line-number"></i>			$('#ami_status_content .alert').fadeOut(60000);
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Show an 'info' message
<i class="line-number"></i>	  * @param {String} message the message
<i class="line-number"></i>	  * @param {Boolean} [fadeOut=false] if True, the message disappears after 60s
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	info: function(message, fadeOut)
<i class="line-number"></i>	{
<i class="line-number"></i>		this.replaceHTML('#ami_status_content', this.fragmentInfo, {dict: {MESSAGE: message}});
<i class="line-number"></i>		this.unlock();
<i class="line-number"></i>
<i class="line-number"></i>		$(document).scrollTop(0);
<i class="line-number"></i>
<i class="line-number"></i>		if(fadeOut)
<i class="line-number"></i>		{
<i class="line-number"></i>			$('#ami_status_content .alert').fadeOut(60000);
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Show a 'warning' message
<i class="line-number"></i>	  * @param {String} message the message
<i class="line-number"></i>	  * @param {Boolean} [fadeOut=false] if True, the message disappears after 60s
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	warning: function(message, fadeOut)
<i class="line-number"></i>	{
<i class="line-number"></i>		this.replaceHTML('#ami_status_content', this.fragmentWarning, {dict: {MESSAGE: message}});
<i class="line-number"></i>		this.unlock();
<i class="line-number"></i>
<i class="line-number"></i>		$(document).scrollTop(0);
<i class="line-number"></i>
<i class="line-number"></i>		if(fadeOut)
<i class="line-number"></i>		{
<i class="line-number"></i>			$('#ami_status_content .alert').fadeOut(60000);
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Show an 'error' message
<i class="line-number"></i>	  * @param {String} message the message
<i class="line-number"></i>	  * @param {Boolean} [fadeOut=false] if True, the message disappears after 60s
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	error: function(message, fadeOut)
<i class="line-number"></i>	{
<i class="line-number"></i>		this.replaceHTML('#ami_status_content', this.fragmentError, {dict: {MESSAGE: message}});
<i class="line-number"></i>		this.unlock();
<i class="line-number"></i>
<i class="line-number"></i>		$(document).scrollTop(0);
<i class="line-number"></i>
<i class="line-number"></i>		if(fadeOut)
<i class="line-number"></i>		{
<i class="line-number"></i>			$('#ami_status_content .alert').fadeOut(60000);
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Flush messages
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	flush: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		$('#ami_status_content').empty();
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* WEB APPLICATION                                                 */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * This method must be overloaded and is called when the web application starts
<i class="line-number"></i>	  * @event amiWebApp#onStart
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onStart: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		alert('error: `this.onStart()` must be overloaded!');
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * This method must be overloaded and is called when the toolbar needs to be updated
<i class="line-number"></i>	  * @event amiWebApp#onToolbarUpdateNeeded
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onToolbarUpdateNeeded: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		alert('error: `this.onToolbarUpdateNeeded()` must be overloaded!');
<i class="line-number"></i> 	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Starts the web application
<i class="line-number"></i>	  * @param {Object} [settings] dictionary of settings (logo_url, home_url, contact_email, template_filename, locker_filename)
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	start: function(settings)
<i class="line-number"></i>	{
<i class="line-number"></i>		var logo_url = 'images/logo.png';
<i class="line-number"></i>		var home_url = 'http://ami.in2p3.fr';
<i class="line-number"></i>		var contact_email = 'ami@lpsc.in2p3.fr';
<i class="line-number"></i>		var template_filename = 'html/AMI/AMIWebApp_default.html';
<i class="line-number"></i>		var locker_filename = 'html/AMI/Fragment/locker.html';
<i class="line-number"></i>
<i class="line-number"></i>		if(settings)
<i class="line-number"></i>		{
<i class="line-number"></i>			if('logo_url' in settings) {
<i class="line-number"></i>				logo_url = settings['logo_url'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('home_url' in settings) {
<i class="line-number"></i>				home_url = settings['home_url'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('contact_email' in settings) {
<i class="line-number"></i>				contact_email = settings['contact_email'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('template_filename' in settings) {
<i class="line-number"></i>				template_filename = settings['template_filename'];
<i class="line-number"></i>			}
<i class="line-number"></i>
<i class="line-number"></i>			if('locker_filename' in settings) {
<i class="line-number"></i>				locker_filename = settings['locker_filename'];
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		var dict = {
<i class="line-number"></i>			LOGO_URL: logo_url,
<i class="line-number"></i>			HOME_URL: home_url,
<i class="line-number"></i>			CONTACT_EMAIL: contact_email,
<i class="line-number"></i>		};
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		$.ajax({url: template_filename, cache: false, dataType: 'html'}).done(function(data1) {
<i class="line-number"></i>
<i class="line-number"></i>			$.ajax({url: locker_filename, cache: false, dataType: 'html'}).done(function(data2) {
<i class="line-number"></i>
<i class="line-number"></i>				$('body').append(amiWebApp.formatHTML(data1, dict) + data2).promise().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>					amiLogin._init().done(function() {
<i class="line-number"></i>
<i class="line-number"></i>						amiWebApp.onStart();
<i class="line-number"></i>					});
<i class="line-number"></i>				});
<i class="line-number"></i>
<i class="line-number"></i>			}).fail(function() {
<i class="line-number"></i>
<i class="line-number"></i>				alert('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>
<i class="line-number"></i>				console.error('could not load `' + locker_filename + '`');
<i class="line-number"></i>			});
<i class="line-number"></i>		}).fail(function() {
<i class="line-number"></i>
<i class="line-number"></i>			alert('Service temporarily unavailable, please try reloading the page...');
<i class="line-number"></i>
<i class="line-number"></i>			console.error('could not load `' + template_filename + '`');
<i class="line-number"></i>		});
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>	/* SUB-APPLICATIONS                                                */
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	onReady: function(userdata)
<i class="line-number"></i>	{
<i class="line-number"></i>		return this._currentSubAppInstance.onReady(userdata);
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	onExit: function(userdata)
<i class="line-number"></i>	{
<i class="line-number"></i>		return this._currentSubAppInstance.onExit(userdata);
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	onLogin: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		var result = this._currentSubAppInstance.onLogin();
<i class="line-number"></i>		this.onToolbarUpdateNeeded();
<i class="line-number"></i>		return result;
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	onLogout: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		var result = this._currentSubAppInstance.onLogout();
<i class="line-number"></i>		this.onToolbarUpdateNeeded();
<i class="line-number"></i>		return result;
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Get the current sub-application instance
<i class="line-number"></i>	  * @return {?} The current sub-application instance
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	getCurrentSubAppInstance: function()
<i class="line-number"></i>	{
<i class="line-number"></i>		return this._currentSubAppInstance;
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Set the current sub-application instance
<i class="line-number"></i>	  * @param {?} subAppInstance the application instance
<i class="line-number"></i>	  * @param {?} [userdata] userdata
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	setCurrentSubAppInstance: function(subAppInstance, userdata)
<i class="line-number"></i>	{
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* CHECK SUB-APPLICATION                                   */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		if(!subAppInstance.onReady) {
<i class="line-number"></i>			alert('error: `&lt;subapp>.onReady()` must be implemented!');
<i class="line-number"></i>			return;
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		if(!subAppInstance.onExit) {
<i class="line-number"></i>			alert('error: `&lt;subapp>.onExit()` must be implemented!');
<i class="line-number"></i>			return;
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		if(!subAppInstance.onLogin) {
<i class="line-number"></i>			alert('error: `&lt;subapp>.onLogin()` must be implemented!');
<i class="line-number"></i>			return;
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		if(!subAppInstance.onLogout) {
<i class="line-number"></i>			alert('error: `&lt;subapp>.onLogout()` must be implemented!');
<i class="line-number"></i>			return;
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>		/* SWITCH SUB-APPLICATION                                  */
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		if(this._currentSubAppInstance.onExit() === false)
<i class="line-number"></i>		{
<i class="line-number"></i>			return;
<i class="line-number"></i>		}
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		this._currentSubAppInstance = subAppInstance;
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>		amiWebApp.lock();
<i class="line-number"></i>
<i class="line-number"></i>		_ami_internal_always(
<i class="line-number"></i>			amiWebApp.onReady(userdata),
<i class="line-number"></i>			function() {
<i class="line-number"></i>				_ami_internal_always(
<i class="line-number"></i>					amiWebApp.onLogin(),
<i class="line-number"></i>					function() {
<i class="line-number"></i>						amiWebApp.unlock();
<i class="line-number"></i>					}
<i class="line-number"></i>				);
<i class="line-number"></i>			}
<i class="line-number"></i>		);
<i class="line-number"></i>
<i class="line-number"></i>		/*---------------------------------------------------------*/
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Runs a sub-application according to the URL (parameters 'subapp' and 'userdata')
<i class="line-number"></i>	  * @param {String} home the name of the home sub-application
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	autoRunSubApp: function(home)
<i class="line-number"></i>	{
<i class="line-number"></i>		var subapp = this.args['subapp'] || home;
<i class="line-number"></i>		var userdata = this.args['userdata'] || null;
<i class="line-number"></i>
<i class="line-number"></i>		if(subapp)
<i class="line-number"></i>		{
<i class="line-number"></i>			subapp = subapp.toLowerCase();
<i class="line-number"></i>
<i class="line-number"></i>			if(subapp in _ami_internal_subAppDict)
<i class="line-number"></i>			{
<i class="line-number"></i>				this.setCurrentSubAppInstance(_ami_internal_subAppDict[subapp], userdata);
<i class="line-number"></i>			}
<i class="line-number"></i>		}
<i class="line-number"></i>	},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>};
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* CONSTRUCTOR                                                             */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>amiWebApp.init();
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* AMISubApp                                                               */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>/**
<i class="line-number"></i> * The AMI sub-application interface
<i class="line-number"></i> * @interface AMISubApp
<i class="line-number"></i> */
<i class="line-number"></i>
<i class="line-number"></i>$AMIInterface('AMISubApp', /** @lends AMISubApp# */ {
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Called when the sub-application is ready to run
<i class="line-number"></i>	  * @param {?} userdata userdata
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onReady: function(userdata) {},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Called when the sub-application is about to exit
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onExit: function() {},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Called when log in
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onLogin: function() {},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>	/**
<i class="line-number"></i>	  * Called when log out
<i class="line-number"></i>	  */
<i class="line-number"></i>
<i class="line-number"></i>	onLogout: function() {},
<i class="line-number"></i>
<i class="line-number"></i>	/*-----------------------------------------------------------------*/
<i class="line-number"></i>});
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* AMIFooApp                                                               */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>$AMIClass('AMIFooApp', {
<i class="line-number"></i>	$implements: [AMISubApp],
<i class="line-number"></i>	onReady: function() {},
<i class="line-number"></i>	onExit: function() {},
<i class="line-number"></i>	onLogin: function() {},
<i class="line-number"></i>	onLogout: function() {},
<i class="line-number"></i>});
<i class="line-number"></i>
<i class="line-number"></i>amiWebApp._currentSubAppInstance = new AMIFooApp();
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>/* JQUERY EXTENSION                                                        */
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i>
<i class="line-number"></i>jQuery.foreach = function(elements, callback, context)
<i class="line-number"></i>{
<i class="line-number"></i>	if(context)
<i class="line-number"></i>	{
<i class="line-number"></i>		jQuery.each(elements, function(index, element) {
<i class="line-number"></i>
<i class="line-number"></i>			callback.apply(context, [index, element]);
<i class="line-number"></i>		});
<i class="line-number"></i>	}
<i class="line-number"></i>	else
<i class="line-number"></i>	{
<i class="line-number"></i>		jQuery.each(elements, function(index, element) {
<i class="line-number"></i>
<i class="line-number"></i>			callback.apply(element, [index, element]);
<i class="line-number"></i>		});
<i class="line-number"></i>	}
<i class="line-number"></i>
<i class="line-number"></i>	return elements;
<i class="line-number"></i>};
<i class="line-number"></i>
<i class="line-number"></i>/*-------------------------------------------------------------------------*/
<i class="line-number"></i></code></pre>
  </article>
</section>




  </div>

</div>