<link rel="stylesheet" type="text/css" href="docs/api/css/AMI-template.css"></link>

<div class="row">

  <nav class="col-md-3">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">AMI Web framework API</h3>
      </div>
      <div class="panel-body jsdoc-menu">
        <h5><a href="?subapp=amiDocument&userdata=api/index.html"><i class="fa fa-home"></i> Home</a></h5><h5><a href="#ami_doc_memu_Global" data-toggle="collapse"><i class="fa fa-book"></i> Global</a></h5><ul class="collapse" id="ami_doc_memu_Global"><li><a href="?subapp=amiDocument&userdata=api/global.html#amiRegisterSubApp">amiRegisterSubApp</a></li></ul><h5><a href="#ami_doc_memu_Namespaces" data-toggle="collapse"><i class="fa fa-book"></i> Namespaces</a></h5><ul class="collapse" id="ami_doc_memu_Namespaces"><li><a href="?subapp=amiDocument&userdata=api/amiCommand.html">amiCommand</a></li><li><a href="?subapp=amiDocument&userdata=api/amiLogin.html">amiLogin</a></li><li><a href="?subapp=amiDocument&userdata=api/amiTokenizer.html">amiTokenizer</a></li><li><a href="?subapp=amiDocument&userdata=api/amiTwigExprInterpreter.html">amiTwigExprInterpreter</a></li><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html">amiWebApp</a></li></ul><h5><a href="#ami_doc_memu_Interfaces" data-toggle="collapse"><i class="fa fa-book"></i> Interfaces</a></h5><ul class="collapse" id="ami_doc_memu_Interfaces"><li><a href="?subapp=amiDocument&userdata=api/AMISubApp.html">AMISubApp</a></li></ul><h5><a href="#ami_doc_memu_Classes" data-toggle="collapse"><i class="fa fa-book"></i> Classes</a></h5><ul class="collapse" id="ami_doc_memu_Classes"><li><a href="?subapp=amiDocument&userdata=api/AMITwigExprCompiler.html">AMITwigExprCompiler</a></li></ul><h5><a href="#ami_doc_memu_Events" data-toggle="collapse"><i class="fa fa-book"></i> Events</a></h5><ul class="collapse" id="ami_doc_memu_Events"><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html#event:onStart">onStart</a></li><li><a href="?subapp=amiDocument&userdata=api/amiWebApp.html#event:onToolbarUpdateNeeded">onToolbarUpdateNeeded</a></li></ul>
      </div>
    </div>
  </nav>

  <div class="col-md-9 jsdoc-content">
    <h1>Source: AMICommand.js</h1>
    



    
<section>
  <article>
    <pre class="ami-code"><code><i class="line-number" id="line1"></i>/*!
<i class="line-number" id="line2"></i> * AMI Web Framework
<i class="line-number" id="line3"></i> *
<i class="line-number" id="line4"></i> * Copyright (c) 2014-2015 The AMI Team
<i class="line-number" id="line5"></i> * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
<i class="line-number" id="line6"></i> *
<i class="line-number" id="line7"></i> */
<i class="line-number" id="line8"></i>
<i class="line-number" id="line9"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line10"></i>/* INTERNAL VARIABLES                                                      */
<i class="line-number" id="line11"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line12"></i>
<i class="line-number" id="line13"></i>var _ami_internal_base64KeyStr =
<i class="line-number" id="line14"></i>	'ABCDEFGHIJKLMNOP' +
<i class="line-number" id="line15"></i>	'QRSTUVWXYZabcdef' +
<i class="line-number" id="line16"></i>	'ghijklmnopqrstuv' +
<i class="line-number" id="line17"></i>	'wxyz0123456789+/' +
<i class="line-number" id="line18"></i>	'='
<i class="line-number" id="line19"></i>;
<i class="line-number" id="line20"></i>
<i class="line-number" id="line21"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line22"></i>/* INTERNAL FUNCTIONS                                                      */
<i class="line-number" id="line23"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line24"></i>
<i class="line-number" id="line25"></i>function _ami_internal_textToString(s)
<i class="line-number" id="line26"></i>{
<i class="line-number" id="line27"></i>	return s.replace(/[\\'"]/g, function(x) {
<i class="line-number" id="line28"></i>
<i class="line-number" id="line29"></i>		return '\\' + x;
<i class="line-number" id="line30"></i>	});
<i class="line-number" id="line31"></i>}
<i class="line-number" id="line32"></i>
<i class="line-number" id="line33"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line34"></i>/* amiCommand                                                              */
<i class="line-number" id="line35"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line36"></i>
<i class="line-number" id="line37"></i>/**
<i class="line-number" id="line38"></i> * The AMI command subsystem
<i class="line-number" id="line39"></i> * @namespace amiCommand
<i class="line-number" id="line40"></i> */
<i class="line-number" id="line41"></i>
<i class="line-number" id="line42"></i>$AMINamespace('amiCommand', /** @lends amiCommand */ {
<i class="line-number" id="line43"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line44"></i>
<i class="line-number" id="line45"></i>	/**
<i class="line-number" id="line46"></i>	  * Decode a base64 string
<i class="line-number" id="line47"></i>	  * @param {String} string the encoded string
<i class="line-number" id="line48"></i>	  * @returns {String} The decoded string
<i class="line-number" id="line49"></i>	  */
<i class="line-number" id="line50"></i>
<i class="line-number" id="line51"></i>	amiBase64Decode: function(s)
<i class="line-number" id="line52"></i>	{
<i class="line-number" id="line53"></i>		var i = 0;
<i class="line-number" id="line54"></i>		var result = '';
<i class="line-number" id="line55"></i>		var chr1, chr2, chr3 = '';
<i class="line-number" id="line56"></i>		var enc1, enc2, enc3, enc4 = '';
<i class="line-number" id="line57"></i>
<i class="line-number" id="line58"></i>		s = s.replace(/[^A-Za-z0-9\+\/\=]/g, '');
<i class="line-number" id="line59"></i>
<i class="line-number" id="line60"></i>		do {
<i class="line-number" id="line61"></i>			enc1 = _ami_internal_base64KeyStr.indexOf(s.charAt(i++));
<i class="line-number" id="line62"></i>			enc2 = _ami_internal_base64KeyStr.indexOf(s.charAt(i++));
<i class="line-number" id="line63"></i>			enc3 = _ami_internal_base64KeyStr.indexOf(s.charAt(i++));
<i class="line-number" id="line64"></i>			enc4 = _ami_internal_base64KeyStr.indexOf(s.charAt(i++));
<i class="line-number" id="line65"></i>
<i class="line-number" id="line66"></i>			chr1 = ((enc1 &amp; 255) &lt;&lt; 2) | (enc2 >> 4);
<i class="line-number" id="line67"></i>			chr2 = ((enc2 &amp;  15) &lt;&lt; 4) | (enc3 >> 2);
<i class="line-number" id="line68"></i>			chr3 = ((enc3 &amp;   3) &lt;&lt; 6) | (enc4 >> 0);
<i class="line-number" id="line69"></i>
<i class="line-number" id="line70"></i>			result = result + String.fromCharCode(chr1);
<i class="line-number" id="line71"></i>
<i class="line-number" id="line72"></i>			if(enc3 != 64) {
<i class="line-number" id="line73"></i>				result = result + String.fromCharCode(chr2);
<i class="line-number" id="line74"></i>			}
<i class="line-number" id="line75"></i>
<i class="line-number" id="line76"></i>			if(enc4 != 64) {
<i class="line-number" id="line77"></i>				result = result + String.fromCharCode(chr3);
<i class="line-number" id="line78"></i>			}
<i class="line-number" id="line79"></i>
<i class="line-number" id="line80"></i>			chr1 = chr2 = chr3 = '';
<i class="line-number" id="line81"></i>			enc1 = enc2 = enc3 = enc4 = '';
<i class="line-number" id="line82"></i>
<i class="line-number" id="line83"></i>		} while(i &lt; s.length);
<i class="line-number" id="line84"></i>
<i class="line-number" id="line85"></i>		return unescape(result);
<i class="line-number" id="line86"></i>	},
<i class="line-number" id="line87"></i>
<i class="line-number" id="line88"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line89"></i>
<i class="line-number" id="line90"></i>	endpoint: 'http://xxyy.zz',
<i class="line-number" id="line91"></i>	converter: 'AMIXmlToJson.xsl',
<i class="line-number" id="line92"></i>
<i class="line-number" id="line93"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line94"></i>
<i class="line-number" id="line95"></i>	/**
<i class="line-number" id="line96"></i>	  * Execute an AMI command
<i class="line-number" id="line97"></i>	  * @param {String} command the command
<i class="line-number" id="line98"></i>	  * @param {Object} [settings] dictionary of settings (context, endpoint, converter, extraParam, extraValue)
<i class="line-number" id="line99"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line100"></i>	  */
<i class="line-number" id="line101"></i>
<i class="line-number" id="line102"></i>	execute: function(command, settings)
<i class="line-number" id="line103"></i>	{
<i class="line-number" id="line104"></i>		var context = null;
<i class="line-number" id="line105"></i>		var endpoint = this.endpoint;
<i class="line-number" id="line106"></i>		var converter = this.converter;
<i class="line-number" id="line107"></i>		var extraParam = null;
<i class="line-number" id="line108"></i>		var extraValue = null;
<i class="line-number" id="line109"></i>
<i class="line-number" id="line110"></i>		if(settings)
<i class="line-number" id="line111"></i>		{
<i class="line-number" id="line112"></i>			if('context' in settings) {
<i class="line-number" id="line113"></i>				context = settings['context'];
<i class="line-number" id="line114"></i>			}
<i class="line-number" id="line115"></i>
<i class="line-number" id="line116"></i>			if('endpoint' in settings) {
<i class="line-number" id="line117"></i>				endpoint = settings['endpoint'];
<i class="line-number" id="line118"></i>			}
<i class="line-number" id="line119"></i>
<i class="line-number" id="line120"></i>			if('converter' in settings) {
<i class="line-number" id="line121"></i>				converter = settings['converter'];
<i class="line-number" id="line122"></i>			}
<i class="line-number" id="line123"></i>
<i class="line-number" id="line124"></i>			if('extraParam' in settings) {
<i class="line-number" id="line125"></i>				extraParam = settings['extraParam'];
<i class="line-number" id="line126"></i>			}
<i class="line-number" id="line127"></i>
<i class="line-number" id="line128"></i>			if('extraValue' in settings) {
<i class="line-number" id="line129"></i>				extraValue = settings['extraValue'];
<i class="line-number" id="line130"></i>			}
<i class="line-number" id="line131"></i>		}
<i class="line-number" id="line132"></i>
<i class="line-number" id="line133"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line134"></i>
<i class="line-number" id="line135"></i>		var URL = endpoint.trim();
<i class="line-number" id="line136"></i>		var COMMAND = command.trim();
<i class="line-number" id="line137"></i>		var CONVERTER = converter.trim();
<i class="line-number" id="line138"></i>
<i class="line-number" id="line139"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line140"></i>
<i class="line-number" id="line141"></i>		var data = {
<i class="line-number" id="line142"></i>			Command: COMMAND,
<i class="line-number" id="line143"></i>			Converter: CONVERTER,
<i class="line-number" id="line144"></i>		};
<i class="line-number" id="line145"></i>
<i class="line-number" id="line146"></i>		if(extraParam)
<i class="line-number" id="line147"></i>		{
<i class="line-number" id="line148"></i>			data[extraParam] = extraValue ? extraValue : null;
<i class="line-number" id="line149"></i>		}
<i class="line-number" id="line150"></i>
<i class="line-number" id="line151"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line152"></i>
<i class="line-number" id="line153"></i>		var urlWithParameters = URL + '?' + $.param(data);
<i class="line-number" id="line154"></i>
<i class="line-number" id="line155"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line156"></i>
<i class="line-number" id="line157"></i>		var result = $.Deferred();
<i class="line-number" id="line158"></i>
<i class="line-number" id="line159"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line160"></i>
<i class="line-number" id="line161"></i>		if(CONVERTER === 'AMIXmlToJson.xsl')
<i class="line-number" id="line162"></i>		{
<i class="line-number" id="line163"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line164"></i>			/* JSON FORMAT                                     */
<i class="line-number" id="line165"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line166"></i>
<i class="line-number" id="line167"></i>			$.ajax({
<i class="line-number" id="line168"></i>				url: URL,
<i class="line-number" id="line169"></i>				data: data,
<i class="line-number" id="line170"></i>				type: 'POST',
<i class="line-number" id="line171"></i>				dataType: 'json',
<i class="line-number" id="line172"></i>				xhrFields: {
<i class="line-number" id="line173"></i>					withCredentials: true
<i class="line-number" id="line174"></i>				},
<i class="line-number" id="line175"></i>				success: function(data) {
<i class="line-number" id="line176"></i>
<i class="line-number" id="line177"></i>					var error = JSPath.apply('.AMIMessage.error', data);
<i class="line-number" id="line178"></i>
<i class="line-number" id="line179"></i>					if(error.length === 0)
<i class="line-number" id="line180"></i>					{
<i class="line-number" id="line181"></i>						if(context) {
<i class="line-number" id="line182"></i>							result.resolveWith(context, [data, urlWithParameters]);
<i class="line-number" id="line183"></i>						} else {
<i class="line-number" id="line184"></i>							result.resolve(data, urlWithParameters);
<i class="line-number" id="line185"></i>						}
<i class="line-number" id="line186"></i>					}
<i class="line-number" id="line187"></i>					else
<i class="line-number" id="line188"></i>					{
<i class="line-number" id="line189"></i>						if(context) {
<i class="line-number" id="line190"></i>							result.rejectWith(context, [data, urlWithParameters]);
<i class="line-number" id="line191"></i>						} else {
<i class="line-number" id="line192"></i>							result.reject(data, urlWithParameters);
<i class="line-number" id="line193"></i>						}
<i class="line-number" id="line194"></i>					}
<i class="line-number" id="line195"></i>				},
<i class="line-number" id="line196"></i>				error: function(jqXHR, textStatus) {
<i class="line-number" id="line197"></i>
<i class="line-number" id="line198"></i>					if(textStatus === 'error')
<i class="line-number" id="line199"></i>					{
<i class="line-number" id="line200"></i>						textStatus = 'service temporarily unavailable';
<i class="line-number" id="line201"></i>					}
<i class="line-number" id="line202"></i>
<i class="line-number" id="line203"></i>					var data = {'AMIMessage': [{'error': [{'$': textStatus}]}]};
<i class="line-number" id="line204"></i>
<i class="line-number" id="line205"></i>					if(context) {
<i class="line-number" id="line206"></i>						result.rejectWith(context, [data, urlWithParameters]);
<i class="line-number" id="line207"></i>					} else {
<i class="line-number" id="line208"></i>						result.reject(data, urlWithParameters);
<i class="line-number" id="line209"></i>					}
<i class="line-number" id="line210"></i>				},
<i class="line-number" id="line211"></i>			});
<i class="line-number" id="line212"></i>
<i class="line-number" id="line213"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line214"></i>		} else {
<i class="line-number" id="line215"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line216"></i>			/* OTHER FORMATS                                   */
<i class="line-number" id="line217"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line218"></i>
<i class="line-number" id="line219"></i>			$.ajax({
<i class="line-number" id="line220"></i>				url: URL,
<i class="line-number" id="line221"></i>				data: data,
<i class="line-number" id="line222"></i>				type: 'POST',
<i class="line-number" id="line223"></i>				dataType: 'text',
<i class="line-number" id="line224"></i>				xhrFields: {
<i class="line-number" id="line225"></i>					withCredentials: true
<i class="line-number" id="line226"></i>				},
<i class="line-number" id="line227"></i>				success: function(data) {
<i class="line-number" id="line228"></i>
<i class="line-number" id="line229"></i>					if(context) {
<i class="line-number" id="line230"></i>						result.resolveWith(context, [data, urlWithParameters]);
<i class="line-number" id="line231"></i>					} else {
<i class="line-number" id="line232"></i>						result.resolve(data, urlWithParameters);
<i class="line-number" id="line233"></i>					}
<i class="line-number" id="line234"></i>				},
<i class="line-number" id="line235"></i>				error: function(jqXHR, textStatus) {
<i class="line-number" id="line236"></i>
<i class="line-number" id="line237"></i>					if(textStatus === 'error')
<i class="line-number" id="line238"></i>					{
<i class="line-number" id="line239"></i>						textStatus = 'service temporarily unavailable';
<i class="line-number" id="line240"></i>					}
<i class="line-number" id="line241"></i>
<i class="line-number" id="line242"></i>					if(context) {
<i class="line-number" id="line243"></i>						result.rejectWith(context, [textStatus, urlWithParameters]);
<i class="line-number" id="line244"></i>					} else {
<i class="line-number" id="line245"></i>						result.reject(textStatus, urlWithParameters);
<i class="line-number" id="line246"></i>					}
<i class="line-number" id="line247"></i>				},
<i class="line-number" id="line248"></i>			});
<i class="line-number" id="line249"></i>
<i class="line-number" id="line250"></i>			/*-------------------------------------------------*/
<i class="line-number" id="line251"></i>		}
<i class="line-number" id="line252"></i>
<i class="line-number" id="line253"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line254"></i>
<i class="line-number" id="line255"></i>		return result.promise();
<i class="line-number" id="line256"></i>	},
<i class="line-number" id="line257"></i>
<i class="line-number" id="line258"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line259"></i>
<i class="line-number" id="line260"></i>	/**
<i class="line-number" id="line261"></i>	  * Login by login/password
<i class="line-number" id="line262"></i>	  * @param {String} user the user
<i class="line-number" id="line263"></i>	  * @param {String} pass the password
<i class="line-number" id="line264"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line265"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line266"></i>	  */
<i class="line-number" id="line267"></i>
<i class="line-number" id="line268"></i>	passLogin: function(user, pass, settings)
<i class="line-number" id="line269"></i>	{
<i class="line-number" id="line270"></i>		var context = null;
<i class="line-number" id="line271"></i>
<i class="line-number" id="line272"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number" id="line273"></i>		{
<i class="line-number" id="line274"></i>			context = settings['context'];
<i class="line-number" id="line275"></i>		}
<i class="line-number" id="line276"></i>
<i class="line-number" id="line277"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line278"></i>
<i class="line-number" id="line279"></i>		var result = $.Deferred();
<i class="line-number" id="line280"></i>
<i class="line-number" id="line281"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line282"></i>
<i class="line-number" id="line283"></i>		this.execute('GetSessionInfo -AMIUser="' + _ami_internal_textToString(user) + '" -AMIPass="' + _ami_internal_textToString(pass) + '"', {extraParam: 'NoCert'}).done(function(data) {
<i class="line-number" id="line284"></i>
<i class="line-number" id="line285"></i>			var user = JSPath.apply('..field{.@name==="AMIUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line286"></i>			var guest = JSPath.apply('..field{.@name==="guestUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line287"></i>			var clientDNInSession = JSPath.apply('..field{.@name==="clientDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line288"></i>			var issuerDNInSession = JSPath.apply('..field{.@name==="issuerDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line289"></i>
<i class="line-number" id="line290"></i>			if(context) {
<i class="line-number" id="line291"></i>				result.resolveWith(context, [data, user, guest, clientDNInSession, issuerDNInSession]);
<i class="line-number" id="line292"></i>			} else {
<i class="line-number" id="line293"></i>				result.resolve(data, user, guest, clientDNInSession, issuerDNInSession);
<i class="line-number" id="line294"></i>			}
<i class="line-number" id="line295"></i>
<i class="line-number" id="line296"></i>		}).fail(function(data) {
<i class="line-number" id="line297"></i>
<i class="line-number" id="line298"></i>			if(context) {
<i class="line-number" id="line299"></i>				result.rejectWith(context, [data, 'guest', 'guest', '', '']);
<i class="line-number" id="line300"></i>			} else {
<i class="line-number" id="line301"></i>				result.reject(data, 'guest', 'guest', '', '');
<i class="line-number" id="line302"></i>			}
<i class="line-number" id="line303"></i>		});
<i class="line-number" id="line304"></i>
<i class="line-number" id="line305"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line306"></i>
<i class="line-number" id="line307"></i>		return result;
<i class="line-number" id="line308"></i>	},
<i class="line-number" id="line309"></i>
<i class="line-number" id="line310"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line311"></i>
<i class="line-number" id="line312"></i>	/**
<i class="line-number" id="line313"></i>	  * Login by certificate
<i class="line-number" id="line314"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line315"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line316"></i>	  */
<i class="line-number" id="line317"></i>
<i class="line-number" id="line318"></i>	certLogin: function(settings)
<i class="line-number" id="line319"></i>	{
<i class="line-number" id="line320"></i>		var context = null;
<i class="line-number" id="line321"></i>
<i class="line-number" id="line322"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number" id="line323"></i>		{
<i class="line-number" id="line324"></i>			context = settings['context'];
<i class="line-number" id="line325"></i>		}
<i class="line-number" id="line326"></i>
<i class="line-number" id="line327"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line328"></i>
<i class="line-number" id="line329"></i>		var result = $.Deferred();
<i class="line-number" id="line330"></i>
<i class="line-number" id="line331"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line332"></i>
<i class="line-number" id="line333"></i>		this.execute('GetSessionInfo').done(function(data) {
<i class="line-number" id="line334"></i>
<i class="line-number" id="line335"></i>			var user = JSPath.apply('..field{.@name==="AMIUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line336"></i>			var guest = JSPath.apply('..field{.@name==="guestUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line337"></i>			var clientDNInSession = JSPath.apply('..field{.@name==="clientDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line338"></i>			var issuerDNInSession = JSPath.apply('..field{.@name==="issuerDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line339"></i>
<i class="line-number" id="line340"></i>			if(context) {
<i class="line-number" id="line341"></i>				result.resolveWith(context, [data, user, guest, clientDNInSession, issuerDNInSession]);
<i class="line-number" id="line342"></i>			} else {
<i class="line-number" id="line343"></i>				result.resolve(data, user, guest, clientDNInSession, issuerDNInSession);
<i class="line-number" id="line344"></i>			}
<i class="line-number" id="line345"></i>
<i class="line-number" id="line346"></i>		}).fail(function(data) {
<i class="line-number" id="line347"></i>
<i class="line-number" id="line348"></i>			if(context) {
<i class="line-number" id="line349"></i>				result.rejectWith(context, [data, 'guest', 'guest', '', '']);
<i class="line-number" id="line350"></i>			} else {
<i class="line-number" id="line351"></i>				result.reject(data, 'guest', 'guest', '', '');
<i class="line-number" id="line352"></i>			}
<i class="line-number" id="line353"></i>		});
<i class="line-number" id="line354"></i>
<i class="line-number" id="line355"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line356"></i>
<i class="line-number" id="line357"></i>		return result;
<i class="line-number" id="line358"></i>	},
<i class="line-number" id="line359"></i>
<i class="line-number" id="line360"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line361"></i>
<i class="line-number" id="line362"></i>	/**
<i class="line-number" id="line363"></i>	  * Logout
<i class="line-number" id="line364"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line365"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line366"></i>	  */
<i class="line-number" id="line367"></i>
<i class="line-number" id="line368"></i>	logout: function(settings)
<i class="line-number" id="line369"></i>	{
<i class="line-number" id="line370"></i>		var context = null;
<i class="line-number" id="line371"></i>
<i class="line-number" id="line372"></i>		if(settings &amp;&amp; 'context' in settings)
<i class="line-number" id="line373"></i>		{
<i class="line-number" id="line374"></i>			context = settings['context'];
<i class="line-number" id="line375"></i>		}
<i class="line-number" id="line376"></i>
<i class="line-number" id="line377"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line378"></i>
<i class="line-number" id="line379"></i>		var result = $.Deferred();
<i class="line-number" id="line380"></i>
<i class="line-number" id="line381"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line382"></i>
<i class="line-number" id="line383"></i>		this.execute('GetSessionInfo -AMIUser="" -AMIPass=""', {extraParam: 'NoCert'}).done(function(data) {
<i class="line-number" id="line384"></i>
<i class="line-number" id="line385"></i>			var user = JSPath.apply('..field{.@name==="AMIUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line386"></i>			var guest = JSPath.apply('..field{.@name==="guestUser"}.$', data)[0] || 'guest';
<i class="line-number" id="line387"></i>			var clientDNInSession = JSPath.apply('..field{.@name==="clientDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line388"></i>			var issuerDNInSession = JSPath.apply('..field{.@name==="issuerDNInSession"}.$', data)[0] || '';
<i class="line-number" id="line389"></i>
<i class="line-number" id="line390"></i>			if(context) {
<i class="line-number" id="line391"></i>				result.resolveWith(context, [data, user, guest, clientDNInSession, issuerDNInSession]);
<i class="line-number" id="line392"></i>			} else {
<i class="line-number" id="line393"></i>				result.resolve(data, user, guest, clientDNInSession, issuerDNInSession);
<i class="line-number" id="line394"></i>			}
<i class="line-number" id="line395"></i>
<i class="line-number" id="line396"></i>		}).fail(function(data) {
<i class="line-number" id="line397"></i>
<i class="line-number" id="line398"></i>			if(context) {
<i class="line-number" id="line399"></i>				result.rejectWith(context, [data, 'guest', 'guest', '', '']);
<i class="line-number" id="line400"></i>			} else {
<i class="line-number" id="line401"></i>				result.reject(data, 'guest', 'guest', '', '');
<i class="line-number" id="line402"></i>			}
<i class="line-number" id="line403"></i>		});
<i class="line-number" id="line404"></i>
<i class="line-number" id="line405"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line406"></i>
<i class="line-number" id="line407"></i>		return result;
<i class="line-number" id="line408"></i>
<i class="line-number" id="line409"></i>		/*---------------------------------------------------------*/
<i class="line-number" id="line410"></i>	},
<i class="line-number" id="line411"></i>
<i class="line-number" id="line412"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line413"></i>
<i class="line-number" id="line414"></i>	/**
<i class="line-number" id="line415"></i>	  * Attach a certificate
<i class="line-number" id="line416"></i>	  * @param {String} user the user
<i class="line-number" id="line417"></i>	  * @param {String} pass the password
<i class="line-number" id="line418"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line419"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line420"></i>	  */
<i class="line-number" id="line421"></i>
<i class="line-number" id="line422"></i>	attachCert: function(user, pass, settings)
<i class="line-number" id="line423"></i>	{
<i class="line-number" id="line424"></i>		return this.execute('GetSessionInfo -attachCert -amiLogin="' + _ami_internal_textToString(user) + '" -amiPassword="' + _ami_internal_textToString(pass) + '"', settings);
<i class="line-number" id="line425"></i>	},
<i class="line-number" id="line426"></i>
<i class="line-number" id="line427"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line428"></i>
<i class="line-number" id="line429"></i>	/**
<i class="line-number" id="line430"></i>	  * Detach a certificate
<i class="line-number" id="line431"></i>	  * @param {String} user the user
<i class="line-number" id="line432"></i>	  * @param {String} pass the password
<i class="line-number" id="line433"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line434"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line435"></i>	  */
<i class="line-number" id="line436"></i>
<i class="line-number" id="line437"></i>	detachCert: function(user, pass, settings)
<i class="line-number" id="line438"></i>	{
<i class="line-number" id="line439"></i>		return this.execute('GetSessionInfo -detachCert -amiLogin="' + _ami_internal_textToString(user) + '" -amiPassword="' + _ami_internal_textToString(pass) + '"', settings);
<i class="line-number" id="line440"></i>	},
<i class="line-number" id="line441"></i>
<i class="line-number" id="line442"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line443"></i>
<i class="line-number" id="line444"></i>	/**
<i class="line-number" id="line445"></i>	  * Add a new user
<i class="line-number" id="line446"></i>	  * @param {String} user the user
<i class="line-number" id="line447"></i>	  * @param {String} pass the password
<i class="line-number" id="line448"></i>	  * @param {String} firstName the first name
<i class="line-number" id="line449"></i>	  * @param {String} lastName the last name
<i class="line-number" id="line450"></i>	  * @param {String} email the email
<i class="line-number" id="line451"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line452"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line453"></i>	  */
<i class="line-number" id="line454"></i>
<i class="line-number" id="line455"></i>	addUser: function(user, pass, firstName, lastName, email, settings)
<i class="line-number" id="line456"></i>	{
<i class="line-number" id="line457"></i>		return this.execute('AddUser -amiLogin="' + _ami_internal_textToString(user) + '" -amiPassword="' + _ami_internal_textToString(pass) + '" -firstName="' + _ami_internal_textToString(firstName) + '"-lastName="' + _ami_internal_textToString(lastName) + '" -email="' + _ami_internal_textToString(email) + '"', settings);
<i class="line-number" id="line458"></i>	},
<i class="line-number" id="line459"></i>
<i class="line-number" id="line460"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line461"></i>
<i class="line-number" id="line462"></i>	/**
<i class="line-number" id="line463"></i>	  * Change the account information
<i class="line-number" id="line464"></i>	  * @param {String} firstName the first name
<i class="line-number" id="line465"></i>	  * @param {String} lastName the last name
<i class="line-number" id="line466"></i>	  * @param {String} email the email
<i class="line-number" id="line467"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line468"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line469"></i>	  */
<i class="line-number" id="line470"></i>
<i class="line-number" id="line471"></i>	changeInfo: function(firstName, lastName, email, settings)
<i class="line-number" id="line472"></i>	{
<i class="line-number" id="line473"></i>		return this.execute('SetUserInfo -firstName="' + _ami_internal_textToString(firstName) + '" -lastName="' + _ami_internal_textToString(lastName) + '" -email="' + _ami_internal_textToString(email) + '"', settings);
<i class="line-number" id="line474"></i>	},
<i class="line-number" id="line475"></i>
<i class="line-number" id="line476"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line477"></i>
<i class="line-number" id="line478"></i>	/**
<i class="line-number" id="line479"></i>	  * Change the account password
<i class="line-number" id="line480"></i>	  * @param {String} oldPass the old password
<i class="line-number" id="line481"></i>	  * @param {String} newPass the new password
<i class="line-number" id="line482"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line483"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line484"></i>	  */
<i class="line-number" id="line485"></i>
<i class="line-number" id="line486"></i>	changePass: function(oldPass, newPass, settings)
<i class="line-number" id="line487"></i>	{
<i class="line-number" id="line488"></i>		return this.execute('ChangePassword -amiPasswordOld="' + _ami_internal_textToString(oldPass) + '" -amiPasswordNew="' + _ami_internal_textToString(newPass) + '"', settings);
<i class="line-number" id="line489"></i>	},
<i class="line-number" id="line490"></i>
<i class="line-number" id="line491"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line492"></i>
<i class="line-number" id="line493"></i>	/**
<i class="line-number" id="line494"></i>	  * Reset the account password
<i class="line-number" id="line495"></i>	  * @param {String} user the user
<i class="line-number" id="line496"></i>	  * @param {Object} [settings] dictionary of settings (context)
<i class="line-number" id="line497"></i>	  * @returns {$.Deferred} A JQuery deferred object
<i class="line-number" id="line498"></i>	  */
<i class="line-number" id="line499"></i>
<i class="line-number" id="line500"></i>	resetPass: function(user, settings)
<i class="line-number" id="line501"></i>	{
<i class="line-number" id="line502"></i>		return this.execute('ResetPassword -amiLogin="' + _ami_internal_textToString(user) + '"', settings);
<i class="line-number" id="line503"></i>	},
<i class="line-number" id="line504"></i>
<i class="line-number" id="line505"></i>	/*-----------------------------------------------------------------*/
<i class="line-number" id="line506"></i>});
<i class="line-number" id="line507"></i>
<i class="line-number" id="line508"></i>/*-------------------------------------------------------------------------*/
<i class="line-number" id="line509"></i></code></pre>
  </article>
</section>




  </div>

</div>