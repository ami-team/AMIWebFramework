/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / CNRS
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

/*-------------------------------------------------------------------------*/
$AMIClass('MediaViewerCtrl', {
  /*---------------------------------------------------------------------*/
  $extends: ami.Control,

  /*---------------------------------------------------------------------*/
  $init: function $init(parent, owner) {
    this.$super.$init(parent, owner);
  },

  /*---------------------------------------------------------------------*/
  onReady: function onReady() {
    var _this = this;

    return amiWebApp.loadResources([amiWebApp.originURL + '/controls/MediaViewer/twig/MediaViewerCtrl.twig']).done(function (data) {
      _this.fragmentMediaViewerCtrl = data[0];
    });
  },

  /*---------------------------------------------------------------------*/
  render: function render(selector, catalog, entity, primaryFieldName, primaryFieldValue, field, base64, mime, settings) {
    var result = $.Deferred();
    /*-----------------------------------------------------------------*/

    this.ctx = {
      catalog: catalog,
      entity: entity,
      primaryFieldName: primaryFieldName,
      primaryFieldValue: primaryFieldValue,
      field: field,
      base64: base64,
      mime: mime
    };

    var _amiWebApp$setup = amiWebApp.setup(['context', 'card'], [result, false], settings),
        context = _amiWebApp$setup[0],
        card = _amiWebApp$setup[1];

    this.ctx.card = card;
    /*-----------------------------------------------------------------*/

    this._render(result, selector);
    /*-----------------------------------------------------------------*/


    return result;
  },

  /*---------------------------------------------------------------------*/
  _render: function _render(result, selector) {
    var _this2 = this;

    if (this.getParent().$name !== 'TabCtrl') {
      var tab = new this.tabCtor(null, this);
      tab.render(selector, this.ctx).done(function () {
        tab.appendItem('<i class="fa fa-arrows-alt"></i> ' + _this2.ctx.entity, {
          closable: false
        }).done(function (selector) {
          _this2.setParent(tab);

          _this2.__render(result, selector);
        });
      });
    } else {
      this.__render(result, selector);
    }
  },

  /*---------------------------------------------------------------------*/
  __render: function __render(result, selector) {
    var _this3 = this;

    var dict = {
      field: this.ctx.field,
      mime: this.ctx.mime
    };
    this.replaceHTML(selector, this.fragmentMediaViewerCtrl, {
      dict: dict
    }).done(function () {
      _this3.refresh().done(function (data) {
        result.resolveWith(_this3.ctx.context, [data]);
      }).fail(function (message) {
        result.rejectWith(_this3.ctx.context, [message]);
      });
    });
  },

  /*---------------------------------------------------------------------*/
  refresh: function refresh(settings) {
    var _this4 = this;

    var result = $.Deferred();
    /*-----------------------------------------------------------------*/

    var _amiWebApp$setup2 = amiWebApp.setup(['context'], [result], settings),
        context = _amiWebApp$setup2[0];
    /*-----------------------------------------------------------------*/


    var command = 'SearchQuery -catalog="' + amiWebApp.textToString(this.ctx.catalog) + '" -entity="' + amiWebApp.textToString(this.ctx.entity) + '" -sql="SELECT `' + amiWebApp.textToString(this.ctx.field) + '` FROM `' + amiWebApp.textToString(this.ctx.entity) + '` WHERE `' + amiWebApp.textToString(this.ctx.primaryFieldName) + '` = \'' + amiWebApp.textToString(this.ctx.primaryFieldValue) + '\'"';
    /*-----------------------------------------------------------------*/

    amiCommand.execute(command).done(function (data) {
      /*-------------------------------------------------------------*/
      var text = amiWebApp.jspath('..field.$', data)[0] || '';
      /*-------------------------------------------------------------*/

      if (_this4.ctx.mime.startsWith('image/')) {
        /*---------------------------------------------------------*/
        $('<img />').attr({
          alt: _this4.ctx.field,
          src: 'data:' + _this4.ctx.mime + ';base64,' + text,
          height: 'auto',
          width: '800'
        }).appendTo(_this4.patchId('#D25C9390_A722_9C48_BC81_5C8875CAAC95'));
        /*---------------------------------------------------------*/
      } else {
        /*---------------------------------------------------------*/
        $('<object />').attr({
          type: _this4.ctx.mime,
          data: 'data:' + _this4.ctx.mime + ';base64,' + text,
          height: '600',
          width: '800'
        }).appendTo(_this4.patchId('#D25C9390_A722_9C48_BC81_5C8875CAAC95'));
        /*---------------------------------------------------------*/
      }
      /*-------------------------------------------------------------*/


      result.resolveWith(context, [data]);
      /*-------------------------------------------------------------*/
    }).fail(function (data, message) {
      result.rejectWith(context, [message]);
    });
    /*-----------------------------------------------------------------*/

    return result;
  }
  /*---------------------------------------------------------------------*/

});
/*-------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lZGlhVmlld2VyQ3RybC5lczYuanMiXSwibmFtZXMiOlsiJEFNSUNsYXNzIiwiJGV4dGVuZHMiLCJhbWkiLCJDb250cm9sIiwiJGluaXQiLCJwYXJlbnQiLCJvd25lciIsIiRzdXBlciIsIm9uUmVhZHkiLCJhbWlXZWJBcHAiLCJsb2FkUmVzb3VyY2VzIiwib3JpZ2luVVJMIiwiZG9uZSIsImRhdGEiLCJmcmFnbWVudE1lZGlhVmlld2VyQ3RybCIsInJlbmRlciIsInNlbGVjdG9yIiwiY2F0YWxvZyIsImVudGl0eSIsInByaW1hcnlGaWVsZE5hbWUiLCJwcmltYXJ5RmllbGRWYWx1ZSIsImZpZWxkIiwiYmFzZTY0IiwibWltZSIsInNldHRpbmdzIiwicmVzdWx0IiwiJCIsIkRlZmVycmVkIiwiY3R4Iiwic2V0dXAiLCJjb250ZXh0IiwiY2FyZCIsIl9yZW5kZXIiLCJnZXRQYXJlbnQiLCIkbmFtZSIsInRhYiIsInRhYkN0b3IiLCJhcHBlbmRJdGVtIiwiY2xvc2FibGUiLCJzZXRQYXJlbnQiLCJfX3JlbmRlciIsImRpY3QiLCJyZXBsYWNlSFRNTCIsInJlZnJlc2giLCJyZXNvbHZlV2l0aCIsImZhaWwiLCJtZXNzYWdlIiwicmVqZWN0V2l0aCIsImNvbW1hbmQiLCJ0ZXh0VG9TdHJpbmciLCJhbWlDb21tYW5kIiwiZXhlY3V0ZSIsInRleHQiLCJqc3BhdGgiLCJzdGFydHNXaXRoIiwiYXR0ciIsImFsdCIsInNyYyIsImhlaWdodCIsIndpZHRoIiwiYXBwZW5kVG8iLCJwYXRjaElkIiwidHlwZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7O0FBV0E7QUFFQUEsU0FBUyxDQUFDLGlCQUFELEVBQW9CO0FBQzVCO0FBRUFDLEVBQUFBLFFBQVEsRUFBRUMsR0FBRyxDQUFDQyxPQUhjOztBQUs1QjtBQUVBQyxFQUFBQSxLQUFLLEVBQUUsZUFBU0MsTUFBVCxFQUFpQkMsS0FBakIsRUFDUDtBQUNDLFNBQUtDLE1BQUwsQ0FBWUgsS0FBWixDQUFrQkMsTUFB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QTFCLEdBQXVDNkIsSUFKekI7QUFNcEJNLFVBQUFBLE1BQU0sRUFBRSxLQU5ZO0FBT3BCQyxVQUFBQSxLQUFLLEVBQUU7QUFQYSxTQUFyQixFQVNHQyxRQVRILENBU1ksTUFBSSxDQUFDQyxPQUFMLENBQWEsdUNBQWIsQ0FUWjtBQVdBO0FBQ0E7QUFFRDs7O0FBRUFwQyxNQUFBQSxNQUFNLENBQUNtQixXQUFQLENBQW1CZCxPQUFuQixFQUE0QixDQUFDakIsSUFBRCxDQUE1QjtBQUVBO0FBRUEsS0FqREQsRUFpREdnQyxJQWpESCxDQWlEUSxVQUFDaEMsSUFBRCxFQUFPaUMsT0FBUCxFQUFtQjtBQUUxQnJCLE1BQUFBLE1BQU0sQ0FBQ3NCLFVBQVAsQ0FBa0JqQixPQUFsQixFQUEyQixDQUFDZ0IsT0FBRCxDQUEzQjtBQUNBLEtBcEREO0FBc0RBOztBQUVBLFdBQU9yQixNQUFQO0FBQ0E7QUFFRDs7QUE3TDRCLENBQXBCLENBQVQ7QUFnTUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFNSSBXZWIgRnJhbWV3b3JrXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LVhYWFggVGhlIEFNSSBUZWFtIC8gTFBTQyAvIENOUlNcbiAqXG4gKiBUaGlzIGZpbGUgbXVzdCBiZSB1c2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgQ2VDSUxMLUM6XG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZW4uaHRtbFxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWZyLmh0bWxcbiAqXG4gKi9cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuJEFNSUNsYXNzKCdNZWRpYVZpZXdlckN0cmwnLCB7XG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkZXh0ZW5kczogYW1pLkNvbnRyb2wsXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRpbml0OiBmdW5jdGlvbihwYXJlbnQsIG93bmVyKVxuXHR7XG5cdFx0dGhpcy4kc3VwZXIuJGluaXQocGFyZW50LCBvd25lcik7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdG9uUmVhZHk6IGZ1bmN0aW9uKClcblx0e1xuXHRcdHJldHVybiBhbWlXZWJBcHAubG9hZFJlc291cmNlcyhbXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jb250cm9scy9NZWRpYVZpZXdlci90d2lnL01lZGlhVmlld2VyQ3RybC50d2lnJyxcblx0XHRdKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdHRoaXMuZnJhZ21lbnRNZWRpYVZpZXdlckN0cmwgPSBkYXRhWzBdO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZW5kZXI6IGZ1bmN0aW9uKHNlbGVjdG9yLCBjYXRhbG9nLCBlbnRpdHksIHByaW1hcnlGaWVsZE5hbWUsIHByaW1hcnlGaWVsZFZhbHVlLCBmaWVsZCwgYmFzZTY0LCBtaW1lLCBzZXR0aW5ncylcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0dGhpcy5jdHggPSB7XG5cdFx0XHRjYXRhbG9nOiBjYXRhbG9nLFxuXHRcdFx0ZW50aXR5OiBlbnRpdHksXG5cdFx0XHRwcmltYXJ5RmllbGROYW1lOiBwcmltYXJ5RmllbGROYW1lLFxuXHRcdFx0cHJpbWFyeUZpZWxkVmFsdWU6IHByaW1hcnlGaWVsZFZhbHVlLFxuXHRcdFx0ZmllbGQ6IGZpZWxkLFxuXHRcdFx0YmFzZTY0OiBiYXNlNjQsXG5cdFx0XHRtaW1lOiBtaW1lLFxuXHRcdH07XG5cblx0XHRjb25zdCBbXG5cdFx0XHRjb250ZXh0LFxuXHRcdFx0Y2FyZFxuXHRcdF0gPSBhbWlXZWJBcHAuc2V0dXAoXG5cdFx0XHRbXG5cdFx0XHRcdCdjb250ZXh0Jyxcblx0XHRcdFx0J2NhcmQnLFxuXHRcdFx0XSxcblx0XHRcdFtcblx0XHRcdFx0cmVzdWx0LFxuXHRcdFx0XHRmYWxzZSxcblx0XHRcdF0sXG5cdFx0XHRzZXR0aW5nc1xuXHRcdCk7XG5cblx0XHR0aGlzLmN0eC5jYXJkID0gY2FyZDtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0dGhpcy5fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfcmVuZGVyOiBmdW5jdGlvbihyZXN1bHQsIHNlbGVjdG9yKVxuXHR7XG5cdFx0aWYodGhpcy5nZXRQYXJlbnQoKS4kbmFtZSAhPT0gJ1RhYkN0cmwnKVxuXHRcdHtcblx0XHRcdGNvbnN0IHRhYiA9IG5ldyB0aGlzLnRhYkN0b3IobnVsbCwgdGhpcyk7XG5cblx0XHRcdHRhYi5yZW5kZXIoc2VsZWN0b3IsIHRoaXMuY3R4KS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHR0YWIuYXBwZW5kSXRlbSgnPGkgY2xhc3M9XCJmYSBmYS1hcnJvd3MtYWx0XCI+PC9pPiAnICsgdGhpcy5jdHguZW50aXR5LCB7Y2xvc2FibGU6IGZhbHNlfSkuZG9uZSgoc2VsZWN0b3IpID0+IHtcblxuXHRcdFx0XHRcdHRoaXMuc2V0UGFyZW50KHRhYik7XG5cblx0XHRcdFx0XHR0aGlzLl9fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy5fX3JlbmRlcihyZXN1bHQsIHNlbGVjdG9yKTtcblx0XHR9XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdF9fcmVuZGVyOiBmdW5jdGlvbihyZXN1bHQsIHNlbGVjdG9yKVxuXHR7XG5cdFx0Y29uc3QgZGljdCA9IHtcblx0XHRcdGZpZWxkOiB0aGlzLmN0eC5maWVsZCxcblx0XHRcdG1pbWU6IHRoaXMuY3R4Lm1pbWUsXG5cdFx0fTtcblxuXHRcdHRoaXMucmVwbGFjZUhUTUwoc2VsZWN0b3IsIHRoaXMuZnJhZ21lbnRNZWRpYVZpZXdlckN0cmwsIHtkaWN0OiBkaWN0fSkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdHRoaXMucmVmcmVzaCgpLmRvbmUoKGRhdGEpID0+IHtcblxuXHRcdFx0XHRyZXN1bHQucmVzb2x2ZVdpdGgodGhpcy5jdHguY29udGV4dCwgW2RhdGFdKTtcblxuXHRcdFx0fSkuZmFpbCgobWVzc2FnZSkgPT4ge1xuXG5cdFx0XHRcdHJlc3VsdC5yZWplY3RXaXRoKHRoaXMuY3R4LmNvbnRleHQsIFttZXNzYWdlXSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVmcmVzaDogZnVuY3Rpb24oc2V0dGluZ3MpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IFtjb250ZXh0XSA9IGFtaVdlYkFwcC5zZXR1cChbJ2NvbnRleHQnXSwgW3Jlc3VsdF0sIHNldHRpbmdzKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3QgY29tbWFuZCA9ICdTZWFyY2hRdWVyeSAtY2F0YWxvZz1cIicgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKHRoaXMuY3R4LmNhdGFsb2cpICsgJ1wiIC1lbnRpdHk9XCInICsgYW1pV2ViQXBwLnRleHRUb1N0cmluZyh0aGlzLmN0eC5lbnRpdHkpICsgJ1wiIC1zcWw9XCJTRUxFQ1QgYCcgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKHRoaXMuY3R4LmZpZWxkKSArICdgIEZST00gYCcgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKHRoaXMuY3R4LmVudGl0eSkgKyAnYCBXSEVSRSBgJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcodGhpcy5jdHgucHJpbWFyeUZpZWxkTmFtZSkgKyAnYCA9IFxcJycgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKHRoaXMuY3R4LnByaW1hcnlGaWVsZFZhbHVlKSArICdcXCdcIic7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGFtaUNvbW1hbmQuZXhlY3V0ZShjb21tYW5kKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdGNvbnN0IHRleHQgPSBhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkLiQnLCBkYXRhKVswXSB8fCAnJztcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0aWYodGhpcy5jdHgubWltZS5zdGFydHNXaXRoKCdpbWFnZS8nKSlcblx0XHRcdHtcblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdCQoJzxpbWcgLz4nKS5hdHRyKHtcblxuXHRcdFx0XHRcdGFsdDogdGhpcy5jdHguZmllbGQsXG5cblx0XHRcdFx0XHRzcmM6ICdkYXRhOicgKyB0aGlzLmN0eC5taW1lICsgJztiYXNlNjQsJyArIHRleHQsXG5cblx0XHRcdFx0XHRoZWlnaHQ6ICdhdXRvJyxcblx0XHRcdFx0XHR3aWR0aDogJzgwMCcsXG5cblx0XHRcdFx0fSkuYXBwZW5kVG8odGhpcy5wYXRjaElkKCcjRDI1QzkzOTBfQTcyMl85QzQ4X0JDODFfNUM4ODc1Q0FBQzk1JykpO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdCQoJzxvYmplY3QgLz4nKS5hdHRyKHtcblxuXHRcdFx0XHRcdHR5cGU6IHRoaXMuY3R4Lm1pbWUsXG5cblx0XHRcdFx0XHRkYXRhOiAnZGF0YTonICsgdGhpcy5jdHgubWltZSArICc7YmFzZTY0LCcgKyB0ZXh0LFxuXG5cdFx0XHRcdFx0aGVpZ2h0OiAnNjAwJyxcblx0XHRcdFx0XHR3aWR0aDogJzgwMCcsXG5cblx0XHRcdFx0fSkuYXBwZW5kVG8odGhpcy5wYXRjaElkKCcjRDI1QzkzOTBfQTcyMl85QzQ4X0JDODFfNUM4ODc1Q0FBQzk1JykpO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH1cblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKGNvbnRleHQsIFtkYXRhXSk7XG5cblx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR9KS5mYWlsKChkYXRhLCBtZXNzYWdlKSA9PiB7XG5cblx0XHRcdHJlc3VsdC5yZWplY3RXaXRoKGNvbnRleHQsIFttZXNzYWdlXSk7XG5cdFx0fSk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4iXX0=
