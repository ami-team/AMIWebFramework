/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / CNRS
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */$AMIClass("MediaViewerCtrl",{$extends:ami.Control,$init:function $init(parent,owner){this.$super.$init(parent,owner)},onReady:function onReady(){var _this=this;return amiWebApp.loadResources([amiWebApp.originURL+"/controls/MediaViewer/twig/MediaViewerCtrl.twig"]).done(function(data){_this.fragmentMediaViewerCtrl=data[0]})},render:function render(selector,catalog,entity,primaryFieldName,primaryFieldValue,field,base64,mime,settings){var result=$.Deferred();this.ctx={catalog:catalog,entity:entity,primaryFieldName:primaryFieldName,primaryFieldValue:primaryFieldValue,field:field,base64:base64,mime:mime};var _amiWebApp$setup=amiWebApp.setup(["context","card"],[result,false],settings);this.ctx.context=_amiWebApp$setup[0];this.ctx.card=_amiWebApp$setup[1];this._render(result,selector);return result},_render:function _render(result,selector){var _this2=this;if(this.getParent().$name!=="TabCtrl"){var tab=new this.tabCtor(null,this);tab.render(selector,this.ctx).done(function(){tab.appendItem("<i class=\"fa fa-arrows-alt\"></i> "+_this2.ctx.entity,{closable:false}).done(function(selector){_this2.setParent(tab);_this2.__render(result,selector)})})}else{this.__render(result,selector)}},__render:function __render(result,selector){var _this3=this;var dict={field:this.ctx.field,mime:this.ctx.mime};this.replaceHTML(selector,this.fragmentMediaViewerCtrl,{dict:dict}).done(function(){_this3.refresh().done(function(data){result.resolveWith(_this3.ctx.context,[data])}).fail(function(message){result.rejectWith(_this3.ctx.context,[message])})})},refresh:function refresh(settings){var _this4=this;var result=$.Deferred();var _amiWebApp$setup2=amiWebApp.setup(["context"],[result],settings),context=_amiWebApp$setup2[0];var command="SearchQuery -catalog=\""+amiWebApp.textToString(this.ctx.catalog)+"\" -entity=\""+amiWebApp.textToString(this.ctx.entity)+"\" -sql=\"SELECT `"+amiWebApp.textToString(this.ctx.field)+"` FROM `"+amiWebApp.textToString(this.ctx.entity)+"` WHERE `"+amiWebApp.textToString(this.ctx.primaryFieldName)+"` = '"+amiWebApp.textToString(this.ctx.primaryFieldValue)+"'\"";amiCommand.execute(command).done(function(data){var text=amiWebApp.jspath("..field.$",data)[0]||"";if(_this4.ctx.mime.startsWith("image/")){$("<img />").attr({alt:_this4.ctx.field,src:"data:"+_this4.ctx.mime+";base64,"+text,height:"auto",width:"800"}).appendTo(_this4.patchId("#D25C9390_A722_9C48_BC81_5C8875CAAC95"))}else{$("<object />").attr({type:_this4.ctx.mime,data:"data:"+_this4.ctx.mime+";base64,"+text,height:"600",width:"800"}).appendTo(_this4.patchId("#D25C9390_A722_9C48_BC81_5C8875CAAC95"))}result.resolveWith(context,[data])}).fail(function(data,message){result.rejectWith(context,[message])});return result}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lZGlhVmlld2VyQ3RybC5lczYuanMiXSwibmFtZXMiOlsiJEFNSUNsYXNzIiwiJGV4dGVuZHMiLCJhbWkiLCJDb250cm9sIiwiJGluaXQiLCJwYXJlbnQiLCJvd25lciIsIiRzdXBlciIsIm9uUmVhZHkiLCJhbWlXZWJBcHAiLCJsb2FkUmVzb3VyY2VzIiwib3JpZ2luVVJMIiwiZG9uZSIsImRhdGEiLCJmcmFnbWVudE1lZGlhVmlld2VyQ3RybCIsInJlbmRlciIsInNlbGVjdG9yIiwiY2F0YWxvZyIsImVudGl0eSIsInByaW1hcnlGaWVsZE5hbWUiLCJwcmltYXJ5RmllbGRWYWx1ZSIsImZpZWxkIiwiYmFzZTY0IiwibWltZSIsInNldHRpbmdzIiwicmVzdWx0IiwiJCIsIkRlZmVycmVkIiwiY3R4Iiwic2V0dXAiLCJjb250ZXh0IiwiY2FyZCIsIl9yZW5kZXIiLCJnZXRQYXJlbnQiLCIkbmFtZSIsInRhYiIsInRhYkN0b3IiLCJhcHBlbmRJdGVtIiwiY2xvc2FibGUiLCJzZXRQYXJlbnQiLCJfX3JlbmRlciIsImRpY3QiLCJyZXBsYWNlSFRNTCIsInJlZnJlc2giLCJyZXNvbHZlV2l0aCIsImZhaWwiLCJtZXNzYWdlIiwicmVqZWN0V2l0aCIsImNvbW1hbmQiLCJ0ZXh0VG9TdHJpbmciLCJhbWlDb21tYW5kIiwiZXhlY3V0ZSIsInRleHQiLCJqc3BhdGgiLCJzdGFydHNXaXRoIiwiYXR0ciIsImFsdCIsInNyYyIsImhlaWdodCIsIndpZHRoIiwiYXBwZW5kVG8iLCJwYXRjaElkIiwidHlwZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7OztHQWFBQSxTQUFTLENBQUMsaUJBQUQsQ0FBb0IsQ0FHNUJDLFFBQVEsQ0FBRUMsR0FBRyxDQUFDQyxPQUhjLENBTzVCQyxLQUFLLENBQUUsZUFBU0MsTUFBVCxDQUFpQkMsS0FBakIsQ0FDUCxDQUNDLEtBQUtDLE1BQUwsQ0FBWUgsS0FBWixDQUFrQkMsTUFBbEIsQ0FBMEJDLEtBQTFCLENBQ0EsQ0FWMkIsQ0Fj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QixDQUFBQSxNQUNQLENBekwyQixDQUFwQixDQUFUIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBTUkgV2ViIEZyYW1ld29ya1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC1YWFhYIFRoZSBBTUkgVGVhbSAvIExQU0MgLyBDTlJTXG4gKlxuICogVGhpcyBmaWxlIG11c3QgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIENlQ0lMTC1DOlxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWVuLmh0bWxcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1mci5odG1sXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiRBTUlDbGFzcygnTWVkaWFWaWV3ZXJDdHJsJywge1xuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0JGV4dGVuZHM6IGFtaS5Db250cm9sLFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkaW5pdDogZnVuY3Rpb24ocGFyZW50LCBvd25lcilcblx0e1xuXHRcdHRoaXMuJHN1cGVyLiRpbml0KHBhcmVudCwgb3duZXIpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvblJlYWR5OiBmdW5jdGlvbigpXG5cdHtcblx0XHRyZXR1cm4gYW1pV2ViQXBwLmxvYWRSZXNvdXJjZXMoW1xuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY29udHJvbHMvTWVkaWFWaWV3ZXIvdHdpZy9NZWRpYVZpZXdlckN0cmwudHdpZycsXG5cdFx0XSkuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHR0aGlzLmZyYWdtZW50TWVkaWFWaWV3ZXJDdHJsID0gZGF0YVswXTtcblx0XHR9KTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVuZGVyOiBmdW5jdGlvbihzZWxlY3RvciwgY2F0YWxvZywgZW50aXR5LCBwcmltYXJ5RmllbGROYW1lLCBwcmltYXJ5RmllbGRWYWx1ZSwgZmllbGQsIGJhc2U2NCwgbWltZSwgc2V0dGluZ3MpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4ID0ge1xuXHRcdFx0Y2F0YWxvZzogY2F0YWxvZyxcblx0XHRcdGVudGl0eTogZW50aXR5LFxuXHRcdFx0cHJpbWFyeUZpZWxkTmFtZTogcHJpbWFyeUZpZWxkTmFtZSxcblx0XHRcdHByaW1hcnlGaWVsZFZhbHVlOiBwcmltYXJ5RmllbGRWYWx1ZSxcblx0XHRcdGZpZWxkOiBmaWVsZCxcblx0XHRcdGJhc2U2NDogYmFzZTY0LFxuXHRcdFx0bWltZTogbWltZSxcblx0XHR9O1xuXG5cdFx0W1xuXHRcdFx0dGhpcy5jdHguY29udGV4dCxcblx0XHRcdHRoaXMuY3R4LmNhcmRcblx0XHRdID0gYW1pV2ViQXBwLnNldHVwKFxuXHRcdFx0W1xuXHRcdFx0XHQnY29udGV4dCcsXG5cdFx0XHRcdCdjYXJkJyxcblx0XHRcdF0sXG5cdFx0XHRbXG5cdFx0XHRcdHJlc3VsdCxcblx0XHRcdFx0ZmFsc2UsXG5cdFx0XHRdLFxuXHRcdFx0c2V0dGluZ3Ncblx0XHQpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLl9yZW5kZXIocmVzdWx0LCBzZWxlY3Rvcik7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdF9yZW5kZXI6IGZ1bmN0aW9uKHJlc3VsdCwgc2VsZWN0b3IpXG5cdHtcblx0XHRpZih0aGlzLmdldFBhcmVudCgpLiRuYW1lICE9PSAnVGFiQ3RybCcpXG5cdFx0e1xuXHRcdFx0Y29uc3QgdGFiID0gbmV3IHRoaXMudGFiQ3RvcihudWxsLCB0aGlzKTtcblxuXHRcdFx0dGFiLnJlbmRlcihzZWxlY3RvciwgdGhpcy5jdHgpLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHRcdHRhYi5hcHBlbmRJdGVtKCc8aSBjbGFzcz1cImZhIGZhLWFycm93cy1hbHRcIj48L2k+ICcgKyB0aGlzLmN0eC5lbnRpdHksIHtjbG9zYWJsZTogZmFsc2V9KS5kb25lKChzZWxlY3RvcikgPT4ge1xuXG5cdFx0XHRcdFx0dGhpcy5zZXRQYXJlbnQodGFiKTtcblxuXHRcdFx0XHRcdHRoaXMuX19yZW5kZXIocmVzdWx0LCBzZWxlY3Rvcik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHR0aGlzLl9fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXHRcdH1cblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X19yZW5kZXI6IGZ1bmN0aW9uKHJlc3VsdCwgc2VsZWN0b3IpXG5cdHtcblx0XHRjb25zdCBkaWN0ID0ge1xuXHRcdFx0ZmllbGQ6IHRoaXMuY3R4LmZpZWxkLFxuXHRcdFx0bWltZTogdGhpcy5jdHgubWltZSxcblx0XHR9O1xuXG5cdFx0dGhpcy5yZXBsYWNlSFRNTChzZWxlY3RvciwgdGhpcy5mcmFnbWVudE1lZGlhVmlld2VyQ3RybCwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0dGhpcy5yZWZyZXNoKCkuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLmN0eC5jb250ZXh0LCBbZGF0YV0pO1xuXG5cdFx0XHR9KS5mYWlsKChtZXNzYWdlKSA9PiB7XG5cblx0XHRcdFx0cmVzdWx0LnJlamVjdFdpdGgodGhpcy5jdHguY29udGV4dCwgW21lc3NhZ2VdKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZWZyZXNoOiBmdW5jdGlvbihzZXR0aW5ncylcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3QgW2NvbnRleHRdID0gYW1pV2ViQXBwLnNldHVwKFsnY29udGV4dCddLCBbcmVzdWx0XSwgc2V0dGluZ3MpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBjb21tYW5kID0gJ1NlYXJjaFF1ZXJ5IC1jYXRhbG9nPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcodGhpcy5jdHguY2F0YWxvZykgKyAnXCIgLWVudGl0eT1cIicgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKHRoaXMuY3R4LmVudGl0eSkgKyAnXCIgLXNxbD1cIlNFTEVDVCBgJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcodGhpcy5jdHguZmllbGQpICsgJ2AgRlJPTSBgJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcodGhpcy5jdHguZW50aXR5KSArICdgIFdIRVJFIGAnICsgYW1pV2ViQXBwLnRleHRUb1N0cmluZyh0aGlzLmN0eC5wcmltYXJ5RmllbGROYW1lKSArICdgID0gXFwnJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcodGhpcy5jdHgucHJpbWFyeUZpZWxkVmFsdWUpICsgJ1xcJ1wiJztcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0YW1pQ29tbWFuZC5leGVjdXRlKGNvbW1hbmQpLmRvbmUoKGRhdGEpID0+IHtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0Y29uc3QgdGV4dCA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGQuJCcsIGRhdGEpWzBdIHx8ICcnO1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRpZih0aGlzLmN0eC5taW1lLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKVxuXHRcdFx0e1xuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0JCgnPGltZyAvPicpLmF0dHIoe1xuXG5cdFx0XHRcdFx0YWx0OiB0aGlzLmN0eC5maWVsZCxcblxuXHRcdFx0XHRcdHNyYzogJ2RhdGE6JyArIHRoaXMuY3R4Lm1pbWUgKyAnO2Jhc2U2NCwnICsgdGV4dCxcblxuXHRcdFx0XHRcdGhlaWdodDogJ2F1dG8nLFxuXHRcdFx0XHRcdHdpZHRoOiAnODAwJyxcblxuXHRcdFx0XHR9KS5hcHBlbmRUbyh0aGlzLnBhdGNoSWQoJyNEMjVDOTM5MF9BNzIyXzlDNDhfQkM4MV81Qzg4NzVDQUFDOTUnKSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0JCgnPG9iamVjdCAvPicpLmF0dHIoe1xuXG5cdFx0XHRcdFx0dHlwZTogdGhpcy5jdHgubWltZSxcblxuXHRcdFx0XHRcdGRhdGE6ICdkYXRhOicgKyB0aGlzLmN0eC5taW1lICsgJztiYXNlNjQsJyArIHRleHQsXG5cblx0XHRcdFx0XHRoZWlnaHQ6ICc2MDAnLFxuXHRcdFx0XHRcdHdpZHRoOiAnODAwJyxcblxuXHRcdFx0XHR9KS5hcHBlbmRUbyh0aGlzLnBhdGNoSWQoJyNEMjVDOTM5MF9BNzIyXzlDNDhfQkM4MV81Qzg4NzVDQUFDOTUnKSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHRcdFx0fVxuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRyZXN1bHQucmVzb2x2ZVdpdGgoY29udGV4dCwgW2RhdGFdKTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdH0pLmZhaWwoKGRhdGEsIG1lc3NhZ2UpID0+IHtcblxuXHRcdFx0cmVzdWx0LnJlamVjdFdpdGgoY29udGV4dCwgW21lc3NhZ2VdKTtcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG59KTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiJdfQ==
