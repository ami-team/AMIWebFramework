/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

/*-------------------------------------------------------------------------*/
$AMIClass('TabCtrl', {
  /*---------------------------------------------------------------------*/
  $extends: ami.Control,

  /*---------------------------------------------------------------------*/
  $init: function $init(parent, owner) {
    this.$super.$init(parent, owner);
    this._previousActiveTab = '';
    this._cnt = 0;
  },

  /*---------------------------------------------------------------------*/
  onReady: function onReady() {
    var _this = this;

    return amiWebApp.loadResources([amiWebApp.originURL + '/controls/Tab/twig/TabCtrl.twig', amiWebApp.originURL + '/controls/Tab/twig/nav_item.twig', amiWebApp.originURL + '/controls/Tab/twig/tab_pane.twig']).done(function (data) {
      _this.fragmentTabCtrl = data[0];
      _this.fragmentNavItem = data[1];
      _this.fragmentTabPane = data[2];
    });
  },

  /*---------------------------------------------------------------------*/
  render: function render(selector, settings) {
    var _this2 = this;

    var result = $.Deferred();
    this._context = result;
    this._card = true;
    this._closable = true;
    this._firstVisible = true;

    if (settings) {
      if ('context' in settings) {
        this._context = settings['context'];
      }

      if ('card' in settings) {
        this._card = settings['card'];
      }

      if ('closable' in settings) {
        this._closable = settings['closable'];
      }

      if ('firstVisible' in settings) {
        this._firstVisible = settings['firstVisible'];
      }
    }

    var dict = {
      'card': this._card
    };
    this.replaceHTML(this._selector = selector, this.fragmentTabCtrl, {
      dict: dict
    }).done(function () {
      result.resolveWith(_this2._context);
    });
    return result.promise();
  },

  /*---------------------------------------------------------------------*/
  _getTabEl: function _getTabEl(tabId) {
    return $(this._selector + ' .nav-link[href="#' + tabId + '"]:parent');
  },

  /*---------------------------------------------------------------------*/
  _getLinkEl: function _getLinkEl(tabId) {
    return $(this._selector + ' .nav-link[href="#' + tabId + '"]');
  },

  /*---------------------------------------------------------------------*/
  _getPaneEl: function _getPaneEl(tabId) {
    return $(this._selector + ' #' + tabId);
  },

  /*---------------------------------------------------------------------*/
  prependItem: function prependItem(title, settings) {
    var _this3 = this;

    var result = $.Deferred();
    var context = result;
    var height = 'auto';
    var active = true;
    var closable = this._closable;
    var firstVisible = this._firstVisible;

    if (settings) {
      if ('context' in settings) {
        context = settings['context'];
      }

      if ('height' in settings) {
        height = settings['height'];
      }

      if ('active' in settings) {
        active = settings['active'];
      }

      if ('closable' in settings) {
        closable = settings['closable'];
      }

      if ('firstVisible' in settings) {
        firstVisible = settings['firstVisible'];
      }
    }
    /*-----------------------------------------------------------------*/


    var tabId = this.patchId('F3EF6D3D_723B_F5FB_F299_E0AA9CA0914D') + '_' + this._cnt;

    var dict = {
      id: tabId,
      title: title,
      height: height,
      closable: closable
    };
    /*-----------------------------------------------------------------*/

    var tabSelector = this._card ? '.card > .card-header > .nav-tabs' : '.nav-tabs';
    var contentSelector = this._card ? '.card > .card-body > .tab-content' : '.tab-content';
    this.prependHTML(this._selector + ' > ' + tabSelector, this.fragmentNavItem, {
      dict: dict
    }).done(function () {
      _this3.prependHTML(_this3._selector + ' > ' + contentSelector, _this3.fragmentTabPane, {
        dict: dict
      }).done(function () {
        /*---------------------------------------------------------*/
        _this3._getTabEl(tabId).find('.fa-times').click(function (e) {
          _this3.removeTab(tabId);

          e.preventDefault();
        });
        /*---------------------------------------------------------*/


        _this3._getLinkEl(tabId).on('show.bs.tab', function (e) {
          _this3._previousActiveTab = e.relatedTarget ? $(e.relatedTarget).attr('href').substring(1) : '';
        });
        /*---------------------------------------------------------*/


        if (_this3._cnt++ === 0 || active) {
          _this3._getLinkEl(tabId).tab('show');
        }
        /*---------------------------------------------------------*/


        var els = $(_this3._selector + ' > ' + tabSelector);

        if (els.length === 1 && firstVisible === false) {
          els.hide();
        } else {
          els.show();
        }
        /*---------------------------------------------------------*/


        result.resolveWith(context, ['#' + tabId]);
        /*---------------------------------------------------------*/
      });
    });
    /*-----------------------------------------------------------------*/

    return result.promise();
  },

  /*---------------------------------------------------------------------*/
  appendItem: function appendItem(title, settings) {
    var _this4 = this;

    var result = $.Deferred();
    var context = result;
    var height = 'auto';
    var active = true;
    var closable = this._closable;
    var firstVisible = this._firstVisible;

    if (settings) {
      if ('context' in settings) {
        context = settings['context'];
      }

      if ('height' in settings) {
        height = settings['height'];
      }

      if ('active' in settings) {
        active = settings['active'];
      }

      if ('closable' in settings) {
        closable = settings['closable'];
      }

      if ('firstVisible' in settings) {
        firstVisible = settings['firstVisible'];
      }
    }
    /*-----------------------------------------------------------------*/


    var tabId = this.patchId('F3EF6D3D_723B_F5FB_F299_E0AA9CA0914D') + '_' + this._cnt;

    var dict = {
      id: tabId,
      title: title,
      height: height,
      closable: closable
    };
    /*-----------------------------------------------------------------*/

    var tabSelector = this._card ? '.card > .card-header > .nav-tabs' : '.nav-tabs';
    var contentSelector = this._card ? '.card > .card-body > .tab-content' : '.tab-content';
    this.appendHTML(this._selector + ' > ' + tabSelector, this.fragmentNavItem, {
      dict: dict
    }).done(function () {
      _this4.appendHTML(_this4._selector + ' > ' + contentSelector, _this4.fragmentTabPane, {
        dict: dict
      }).done(function () {
        /*---------------------------------------------------------*/
        _this4._getTabEl(tabId).find('.fa-times').click(function (e) {
          _this4.removeTab(tabId);

          e.preventDefault();
        });
        /*---------------------------------------------------------*/


        _this4._getLinkEl(tabId).on('show.bs.tab', function (e) {
          _this4._previousActiveTab = e.relatedTarget ? $(e.relatedTarget).attr('href').substring(1) : '';
        });
        /*---------------------------------------------------------*/


        if (_this4._cnt++ === 0 || active) {
          _this4._getLinkEl(tabId).tab('show');
        }
        /*---------------------------------------------------------*/


        var els = $(_this4._selector + ' > ' + tabSelector);

        if (els.length === 1 && firstVisible === false) {
          els.hide();
        } else {
          els.show();
        }
        /*---------------------------------------------------------*/


        result.resolveWith(context, ['#' + tabId]);
        /*---------------------------------------------------------*/
      });
    });
    /*-----------------------------------------------------------------*/

    return result.promise();
  },

  /*---------------------------------------------------------------------*/
  removeTab: function removeTab(tabId) {
    this._getTabEl(tabId).remove();

    this._getPaneEl(tabId).remove();

    if (this._previousActiveTab) {
      this._getLinkEl(this._previousActiveTab).tab('show');
    } else {
      $(this._selector + ' .nav-link:first').tab('show');
    }
  },

  /*---------------------------------------------------------------------*/
  removeTabs: function removeTabs() {
    $(this._selector + ' .nav-tabs').empty();
    $(this._selector + ' .tab-content').empty();
  },

  /*---------------------------------------------------------------------*/
  isEmpty: function isEmpty() {
    return $(this._selector + ' .nav-tabs').is(':empty') || $(this._selector + ' .nav-content').is(':empty');
  }
  /*---------------------------------------------------------------------*/

});
/*-------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRhYkN0cmwuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiQ29udHJvbCIsIiRpbml0IiwicGFyZW50Iiwib3duZXIiLCIkc3VwZXIiLCJfcHJldmlvdXNBY3RpdmVUYWIiLCJfY250Iiwib25SZWFkeSIsImFtaVdlYkFwcCIsImxvYWRSZXNvdXJjZXMiLCJvcmlnaW5VUkwiLCJkb25lIiwiZGF0YSIsImZyYWdtZW50VGFiQ3RybCIsImZyYWdtZW50TmF2SXRlbSIsImZyYWdtZW50VGFiUGFuZSIsInJlbmRlciIsInNlbGVjdG9yIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJfY29udGV4dCIsIl9jYXJkIiwiX2Nsb3NhYmxlIiwiX2ZpcnN0VmlzaWJsZSIsImRpY3QiLCJyZXBsYWNlSFRNTCIsIl9zZWxlY3RvciIsInJlc29sdmVXaXRoIiwicHJvbWlzZSIsIl9nZXRUYWJFbCIsInRhYklkIiwiX2dldExpbmtFbCIsIl9nZXRQYW5lRWwiLCJwcmVwZW5kSXRlbSIsInRpdGxlIiwiY29udGV4dCIsImhlaWdodCIsImFjdGl2ZSIsImNsb3NhYmxlIiwiZmlyc3RWaXNpYmxlIiwicGF0Y2hJZCIsImlkIiwidGFiU2VsZWN0b3IiLCJjb250ZW50U2VsZWN0b3IiLCJwcmVwZW5kSFRNTCIsImZpbmQiLCJjbGljayIsImUiLCJyZW1vdmVUYWIiLCJwcmV2ZW50RGVmYXVsdCIsIm9uIiwicmVsYXRlZFRhcmdldCIsImF0dHIiLCJzdWJzdHJpbmciLCJ0YWIiLCJlbHMiLCJsZW5ndGgiLCJoaWRlIiwic2hvdyIsImFwcGVuZEl0ZW0iLCJhcHBlbmRIVE1MIiwicmVtb3ZlIiwicmVtb3ZlVGFicyIsImVtcHR5IiwiaXNFbXB0eSIsImlzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUFXQTtBQUVBQSxTQUFTLENBQUMsU0FBRCxFQUFZO0FBQ3BCO0FBRUFDLEVBQUFBLFFBQVEsRUFBRUMsR0FBRyxD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InNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQU1JIFdlYiBGcmFtZXdvcmtcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtWFhYWCBUaGUgQU1JIFRlYW0gLyBMUFNDIC8gSU4yUDNcbiAqXG4gKiBUaGlzIGZpbGUgbXVzdCBiZSB1c2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgQ2VDSUxMLUM6XG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZW4uaHRtbFxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWZyLmh0bWxcbiAqXG4gKi9cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuJEFNSUNsYXNzKCdUYWJDdHJsJywge1xuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0JGV4dGVuZHM6IGFtaS5Db250cm9sLFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkaW5pdDogZnVuY3Rpb24ocGFyZW50LCBvd25lcilcblx0e1xuXHRcdHRoaXMuJHN1cGVyLiRpbml0KHBhcmVudCwgb3duZXIpO1xuXG5cdFx0dGhpcy5fcHJldmlvdXNBY3RpdmVUYWIgPSAnJztcblxuXHRcdHRoaXMuX2NudCA9IDA7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdG9uUmVhZHk6IGZ1bmN0aW9uKClcblx0e1xuXHRcdHJldHVybiBhbWlXZWJBcHAubG9hZFJlc291cmNlcyhbXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jb250cm9scy9UYWIvdHdpZy9UYWJDdHJsLnR3aWcnLFxuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY29udHJvbHMvVGFiL3R3aWcvbmF2X2l0ZW0udHdpZycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jb250cm9scy9UYWIvdHdpZy90YWJfcGFuZS50d2lnJyxcblx0XHRdKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdHRoaXMuZnJhZ21lbnRUYWJDdHJsID0gZGF0YVswXTtcblx0XHRcdHRoaXMuZnJhZ21lbnROYXZJdGVtID0gZGF0YVsxXTtcblx0XHRcdHRoaXMuZnJhZ21lbnRUYWJQYW5lID0gZGF0YVsyXTtcblx0XHR9KTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVuZGVyOiBmdW5jdGlvbihzZWxlY3Rvciwgc2V0dGluZ3MpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHR0aGlzLl9jb250ZXh0ID0gcmVzdWx0O1xuXHRcdHRoaXMuX2NhcmQgPSB0cnVlO1xuXHRcdHRoaXMuX2Nsb3NhYmxlID0gdHJ1ZTtcblx0XHR0aGlzLl9maXJzdFZpc2libGUgPSB0cnVlO1xuXG5cdFx0aWYoc2V0dGluZ3MpXG5cdFx0e1xuXHRcdFx0aWYoJ2NvbnRleHQnIGluIHNldHRpbmdzKSB7XG5cdFx0XHRcdHRoaXMuX2NvbnRleHQgPSBzZXR0aW5nc1snY29udGV4dCddO1xuXHRcdFx0fVxuXG5cdFx0XHRpZignY2FyZCcgaW4gc2V0dGluZ3MpIHtcblx0XHRcdFx0dGhpcy5fY2FyZCA9IHNldHRpbmdzWydjYXJkJ107XG5cdFx0XHR9XG5cblx0XHRcdGlmKCdjbG9zYWJsZScgaW4gc2V0dGluZ3MpIHtcblx0XHRcdFx0dGhpcy5fY2xvc2FibGUgPSBzZXR0aW5nc1snY2xvc2FibGUnXTtcblx0XHRcdH1cblxuXHRcdFx0aWYoJ2ZpcnN0VmlzaWJsZScgaW4gc2V0dGluZ3MpIHtcblx0XHRcdFx0dGhpcy5fZmlyc3RWaXNpYmxlID0gc2V0dGluZ3NbJ2ZpcnN0VmlzaWJsZSddO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGNvbnN0IGRpY3QgPSB7XG5cdFx0XHQnY2FyZCc6IHRoaXMuX2NhcmRcblx0XHR9O1xuXG5cdFx0dGhpcy5yZXBsYWNlSFRNTCh0aGlzLl9zZWxlY3RvciA9IHNlbGVjdG9yLCB0aGlzLmZyYWdtZW50VGFiQ3RybCwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKHRoaXMuX2NvbnRleHQpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJlc3VsdC5wcm9taXNlKCk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdF9nZXRUYWJFbDogZnVuY3Rpb24odGFiSWQpXG5cdHtcblx0XHRyZXR1cm4gJCh0aGlzLl9zZWxlY3RvciArICcgLm5hdi1saW5rW2hyZWY9XCIjJyArIHRhYklkICsgJ1wiXTpwYXJlbnQnKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X2dldExpbmtFbDogZnVuY3Rpb24odGFiSWQpXG5cdHtcblx0XHRyZXR1cm4gJCh0aGlzLl9zZWxlY3RvciArICcgLm5hdi1saW5rW2hyZWY9XCIjJyArIHRhYklkICsgJ1wiXScpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfZ2V0UGFuZUVsOiBmdW5jdGlvbih0YWJJZClcblx0e1xuXHRcdHJldHVybiAkKHRoaXMuX3NlbGVjdG9yICsgJyAjJyArIHRhYklkKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cHJlcGVuZEl0ZW06IGZ1bmN0aW9uKHRpdGxlLCBzZXR0aW5ncylcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdGxldCBjb250ZXh0ID0gcmVzdWx0O1xuXHRcdGxldCBoZWlnaHQgPSAnYXV0byc7XG5cdFx0bGV0IGFjdGl2ZSA9IHRydWU7XG5cdFx0bGV0IGNsb3NhYmxlID0gdGhpcy5fY2xvc2FibGU7XG5cdFx0bGV0IGZpcnN0VmlzaWJsZSA9IHRoaXMuX2ZpcnN0VmlzaWJsZTtcblxuXHRcdGlmKHNldHRpbmdzKVxuXHRcdHtcblx0XHRcdGlmKCdjb250ZXh0JyBpbiBzZXR0aW5ncykge1xuXHQgIFx0XHRcdGNvbnRleHQgPSBzZXR0aW5nc1snY29udGV4dCddO1xuXHRcdFx0fVxuXG5cdFx0XHRpZignaGVpZ2h0JyBpbiBzZXR0aW5ncykge1xuXHRcdFx0XHRoZWlnaHQgPSBzZXR0aW5nc1snaGVpZ2h0J107XG5cdFx0XHR9XG5cblx0XHRcdGlmKCdhY3RpdmUnIGluIHNldHRpbmdzKSB7XG5cdFx0XHRcdGFjdGl2ZSA9IHNldHRpbmdzWydhY3RpdmUnXTtcblx0XHRcdH1cblxuXHRcdFx0aWYoJ2Nsb3NhYmxlJyBpbiBzZXR0aW5ncykge1xuXHRcdFx0XHRjbG9zYWJsZSA9IHNldHRpbmdzWydjbG9zYWJsZSddO1xuXHRcdFx0fVxuXG5cdFx0XHRpZignZmlyc3RWaXNpYmxlJyBpbiBzZXR0aW5ncykge1xuXHRcdFx0XHRmaXJzdFZpc2libGUgPSBzZXR0aW5nc1snZmlyc3RWaXNpYmxlJ107XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCB0YWJJZCA9IHRoaXMucGF0Y2hJZCgnRjNFRjZEM0RfNzIzQl9GNUZCX0YyOTlfRTBBQTlDQTA5MTREJykgKyAnXycgKyB0aGlzLl9jbnQ7XG5cblx0XHRjb25zdCBkaWN0ID0ge1xuXHRcdFx0aWQ6IHRhYklkLFxuXHRcdFx0dGl0bGU6IHRpdGxlLFxuXHRcdFx0aGVpZ2h0OiBoZWlnaHQsXG5cdFx0XHRjbG9zYWJsZTogY2xvc2FibGUsXG5cdFx0fTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3QgdGFiU2VsZWN0b3IgPSB0aGlzLl9jYXJkID8gJy5jYXJkID4gLmNhcmQtaGVhZGVyID4gLm5hdi10YWJzJyA6ICcubmF2LXRhYnMnO1xuXHRcdGNvbnN0IGNvbnRlbnRTZWxlY3RvciA9IHRoaXMuX2NhcmQgPyAnLmNhcmQgPiAuY2FyZC1ib2R5ID4gLnRhYi1jb250ZW50JyA6ICcudGFiLWNvbnRlbnQnO1xuXG5cdFx0dGhpcy5wcmVwZW5kSFRNTCh0aGlzLl9zZWxlY3RvciArICcgPiAnICsgdGFiU2VsZWN0b3IsIHRoaXMuZnJhZ21lbnROYXZJdGVtLCB7ZGljdDogZGljdH0pLmRvbmUoKCkgPT4ge1xuXHRcdFx0dGhpcy5wcmVwZW5kSFRNTCh0aGlzLl9zZWxlY3RvciArICcgPiAnICsgY29udGVudFNlbGVjdG9yLCB0aGlzLmZyYWdtZW50VGFiUGFuZSwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0dGhpcy5fZ2V0VGFiRWwodGFiSWQpLmZpbmQoJy5mYS10aW1lcycpLmNsaWNrKChlKSA9PiB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbW92ZVRhYih0YWJJZCk7XG5cblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHR0aGlzLl9nZXRMaW5rRWwodGFiSWQpLm9uKCdzaG93LmJzLnRhYicsIChlKSA9PiB7XG5cblx0XHRcdFx0XHR0aGlzLl9wcmV2aW91c0FjdGl2ZVRhYiA9IGUucmVsYXRlZFRhcmdldCA/ICQoZS5yZWxhdGVkVGFyZ2V0KS5hdHRyKCdocmVmJykuc3Vic3RyaW5nKDEpIDogJyc7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHRpZih0aGlzLl9jbnQrKyA9PT0gMCB8fCBhY3RpdmUpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0aGlzLl9nZXRMaW5rRWwodGFiSWQpLnRhYignc2hvdycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdGNvbnN0IGVscyA9ICQodGhpcy5fc2VsZWN0b3IgKyAnID4gJyArIHRhYlNlbGVjdG9yKTtcblxuXHRcdFx0XHRpZihlbHMubGVuZ3RoID09PSAxICYmIGZpcnN0VmlzaWJsZSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRlbHMuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdGVscy5zaG93KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKGNvbnRleHQsIFsnIycgKyB0YWJJZF0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0LnByb21pc2UoKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0YXBwZW5kSXRlbTogZnVuY3Rpb24odGl0bGUsIHNldHRpbmdzKVxuXHR7XG5cdFx0Y29uc3QgcmVzdWx0ID0gJC5EZWZlcnJlZCgpO1xuXG5cdFx0bGV0IGNvbnRleHQgPSByZXN1bHQ7XG5cdFx0bGV0IGhlaWdodCA9ICdhdXRvJztcblx0XHRsZXQgYWN0aXZlID0gdHJ1ZTtcblx0XHRsZXQgY2xvc2FibGUgPSB0aGlzLl9jbG9zYWJsZTtcblx0XHRsZXQgZmlyc3RWaXNpYmxlID0gdGhpcy5fZmlyc3RWaXNpYmxlO1xuXG5cdFx0aWYoc2V0dGluZ3MpXG5cdFx0e1xuXHRcdFx0aWYoJ2NvbnRleHQnIGluIHNldHRpbmdzKSB7XG5cdCAgXHRcdFx0Y29udGV4dCA9IHNldHRpbmdzWydjb250ZXh0J107XG5cdFx0XHR9XG5cblx0XHRcdGlmKCdoZWlnaHQnIGluIHNldHRpbmdzKSB7XG5cdFx0XHRcdGhlaWdodCA9IHNldHRpbmdzWydoZWlnaHQnXTtcblx0XHRcdH1cblxuXHRcdFx0aWYoJ2FjdGl2ZScgaW4gc2V0dGluZ3MpIHtcblx0XHRcdFx0YWN0aXZlID0gc2V0dGluZ3NbJ2FjdGl2ZSddO1xuXHRcdFx0fVxuXG5cdFx0XHRpZignY2xvc2FibGUnIGluIHNldHRpbmdzKSB7XG5cdFx0XHRcdGNsb3NhYmxlID0gc2V0dGluZ3NbJ2Nsb3NhYmxlJ107XG5cdFx0XHR9XG5cblx0XHRcdGlmKCdmaXJzdFZpc2libGUnIGluIHNldHRpbmdzKSB7XG5cdFx0XHRcdGZpcnN0VmlzaWJsZSA9IHNldHRpbmdzWydmaXJzdFZpc2libGUnXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IHRhYklkID0gdGhpcy5wYXRjaElkKCdGM0VGNkQzRF83MjNCX0Y1RkJfRjI5OV9FMEFBOUNBMDkxNEQnKSArICdfJyArIHRoaXMuX2NudDtcblxuXHRcdGNvbnN0IGRpY3QgPSB7XG5cdFx0XHRpZDogdGFiSWQsXG5cdFx0XHR0aXRsZTogdGl0bGUsXG5cdFx0XHRoZWlnaHQ6IGhlaWdodCxcblx0XHRcdGNsb3NhYmxlOiBjbG9zYWJsZSxcblx0XHR9O1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCB0YWJTZWxlY3RvciA9IHRoaXMuX2NhcmQgPyAnLmNhcmQgPiAuY2FyZC1oZWFkZXIgPiAubmF2LXRhYnMnIDogJy5uYXYtdGFicyc7XG5cdFx0Y29uc3QgY29udGVudFNlbGVjdG9yID0gdGhpcy5fY2FyZCA/ICcuY2FyZCA+IC5jYXJkLWJvZHkgPiAudGFiLWNvbnRlbnQnIDogJy50YWItY29udGVudCc7XG5cblx0XHR0aGlzLmFwcGVuZEhUTUwodGhpcy5fc2VsZWN0b3IgKyAnID4gJyArIHRhYlNlbGVjdG9yLCB0aGlzLmZyYWdtZW50TmF2SXRlbSwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblx0XHRcdHRoaXMuYXBwZW5kSFRNTCh0aGlzLl9zZWxlY3RvciArICcgPiAnICsgY29udGVudFNlbGVjdG9yLCB0aGlzLmZyYWdtZW50VGFiUGFuZSwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0dGhpcy5fZ2V0VGFiRWwodGFiSWQpLmZpbmQoJy5mYS10aW1lcycpLmNsaWNrKChlKSA9PiB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbW92ZVRhYih0YWJJZCk7XG5cblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHR0aGlzLl9nZXRMaW5rRWwodGFiSWQpLm9uKCdzaG93LmJzLnRhYicsIChlKSA9PiB7XG5cblx0XHRcdFx0XHR0aGlzLl9wcmV2aW91c0FjdGl2ZVRhYiA9IGUucmVsYXRlZFRhcmdldCA/ICQoZS5yZWxhdGVkVGFyZ2V0KS5hdHRyKCdocmVmJykuc3Vic3RyaW5nKDEpIDogJyc7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHRpZih0aGlzLl9jbnQrKyA9PT0gMCB8fCBhY3RpdmUpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0aGlzLl9nZXRMaW5rRWwodGFiSWQpLnRhYignc2hvdycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdGNvbnN0IGVscyA9ICQodGhpcy5fc2VsZWN0b3IgKyAnID4gJyArIHRhYlNlbGVjdG9yKTtcblxuXHRcdFx0XHRpZihlbHMubGVuZ3RoID09PSAxICYmIGZpcnN0VmlzaWJsZSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRlbHMuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdGVscy5zaG93KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKGNvbnRleHQsIFsnIycgKyB0YWJJZF0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0LnByb21pc2UoKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVtb3ZlVGFiOiBmdW5jdGlvbih0YWJJZClcblx0e1xuXHRcdHRoaXMuX2dldFRhYkVsKHRhYklkKS5yZW1vdmUoKTtcblxuXHRcdHRoaXMuX2dldFBhbmVFbCh0YWJJZCkucmVtb3ZlKCk7XG5cblx0XHRpZih0aGlzLl9wcmV2aW91c0FjdGl2ZVRhYilcblx0XHR7XG5cdFx0XHR0aGlzLl9nZXRMaW5rRWwodGhpcy5fcHJldmlvdXNBY3RpdmVUYWIpLnRhYignc2hvdycpO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0JCh0aGlzLl9zZWxlY3RvciArICcgLm5hdi1saW5rOmZpcnN0JykudGFiKCdzaG93Jyk7XG5cdFx0fVxuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZW1vdmVUYWJzOiBmdW5jdGlvbigpXG5cdHtcblx0XHQkKHRoaXMuX3NlbGVjdG9yICsgJyAubmF2LXRhYnMnKS5lbXB0eSgpO1xuXG5cdFx0JCh0aGlzLl9zZWxlY3RvciArICcgLnRhYi1jb250ZW50JykuZW1wdHkoKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0aXNFbXB0eTogZnVuY3Rpb24oKVxuXHR7XG5cdFx0cmV0dXJuICQodGhpcy5fc2VsZWN0b3IgKyAnIC5uYXYtdGFicycpLmlzKCc6ZW1wdHknKVxuXHRcdCAgICAgICB8fFxuXHRcdCAgICAgICAkKHRoaXMuX3NlbGVjdG9yICsgJyAubmF2LWNvbnRlbnQnKS5pcygnOmVtcHR5Jylcblx0XHQ7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4iXX0=
