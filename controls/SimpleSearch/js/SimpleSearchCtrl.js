/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */$AMIClass("SimpleSearchCtrl",{$extends:ami.Control,$init:function $init(parent,owner){this.$super.$init(parent,owner)},onReady:function onReady(){return amiWebApp.loadResources([amiWebApp.originURL+"/controls/SimpleSearch/twig/SimpleSearchCtrl.twig","ctrl:tab"],{context:this}).done(function(data){this.fragmentSimpleSearch=data[0];this.tabCtrl=data[1]})},render:function render(selector,settings){var result=$.Deferred();var fn=function fn(catalog,entity,fields,value){var select=fields.length===0?["0 = 1"]:value.indexOf("%")<0?fields.map(function(field){return field+" = '"+amiWebApp.textToSQL(value)+"'"}):fields.map(function(field){return field+" LIKE '"+amiWebApp.textToSQL(value)+"'"});return"BrowseQuery"+" -catalog=\""+amiWebApp.textToString(catalog)+"\" -entity=\""+amiWebApp.textToString(entity)+"\" -mql=\"SELECT * WHERE "+select.join(" OR ")+"\""};var _amiWebApp$setup=amiWebApp.setup(["context","placeholder","catalog","defaultCatalog","entity","defaultEntity","fields","criteria","searchCommandFunc","card"],[result,"% for wildcarding","","","","",[],[],fn,false],settings),context=_amiWebApp$setup[0],placeholder=_amiWebApp$setup[1],catalog=_amiWebApp$setup[2],defaultCatalog=_amiWebApp$setup[3],entity=_amiWebApp$setup[4],defaultEntity=_amiWebApp$setup[5],fields=_amiWebApp$setup[6],criteria=_amiWebApp$setup[7],searchCommandFunc=_amiWebApp$setup[8],card=_amiWebApp$setup[9];this.ctx={};for(var key in settings){this.ctx[key]=settings[key]}this.ctx.isEmbedded=amiWebApp.isEmbedded();this.ctx.endpoint=amiCommand.endpoint;this.ctx.context=context;this.ctx.placeholder=placeholder;this.ctx.catalog=defaultCatalog?defaultCatalog:catalog;this.ctx.entity=defaultEntity?defaultEntity:entity;this.ctx.fields=criteria.length>0?criteria.filter(function(criterion){return criterion.more.simple_search}).map(function(criterion){return"`"+criterion.catalog+"`.`"+criterion.entity+"`.`"+criterion.field+"`"}):fields;this.ctx.searchCommandFunc=searchCommandFunc;this.ctx.card=card;this._render(result,selector);return result},_render:function _render(result,selector){var _this=this;if(this.getParent().$name!=="TabCtrl"){var tab=new this.tabCtrl(null,this);tab.render(selector,this.ctx).done(function(){tab.appendItem("<i class=\"fa fa-search\"></i> "+_this.ctx.entity,{closable:false,firstVisible:false}).done(function(selector){_this.setParent(tab);_this.__render(result,selector)})})}else{this.__render(result,selector)}},__render:function __render(result,selector){var _this2=this;this.replaceHTML(selector,this.fragmentSimpleSearch,{dict:this.ctx}).done(function(){$(_this2.patchId("#E8F152B0_66C6_132C_0155_955D36654C13")).submit(function(e){e.preventDefault();var value=$(_this2.patchId("#F8D8C2FB_81D9_F7A0_121B_6FB2949F8DB6")).val().trim();if(value){_this2.search(value)}});result.resolveWith(_this2.ctx.context)})},search:function search(value){return amiWebApp.createControlInContainer(this.getParent(),this,"table",[this.ctx.searchCommandFunc(this.ctx.catalog,this.ctx.entity,this.ctx.fields,value)],{},this.ctx,"table",this.ctx.entity)}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpbXBsZVNlYXJjaEN0cmwuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiQ29udHJvbCIsIiRpbml0IiwicGFyZW50Iiwib3duZXIiLCIkc3VwZXIiLCJvblJlYWR5IiwiYW1pV2ViQXBwIiwibG9hZFJlc291cmNlcyIsIm9yaWdpblVSTCIsImNvbnRleHQiLCJkb25lIiwiZGF0YSIsImZyYWdtZW50U2ltcGxlU2VhcmNoIiwidGFiQ3RybCIsInJlbmRlciIsInNlbGVjdG9yIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJmbiIsImNhdGFsb2ciLCJlbnRpdHkiLCJmaWVsZHMiLCJ2YWx1ZSIsInNlbGVjdCIsImxlbmd0aCIsImluZGV4T2YiLCJtYXAiLCJmaWVsZCIsInRleHRUb1NRTCIsInRleHRUb1N0cmluZyIsImpvaW4iLCJzZXR1cCIsInBsYWNlaG9sZGVyIiwiZGVmYXVsdENhdGFsb2ciLCJkZWZhdWx0RW50aXR5IiwiY3JpdGVyaWEiLCJzZWFyY2hDb21tYW5kRnVuYyIsImNhcmQiLCJjdHgiLCJrZXkiLCJpc0VtYmVkZGVkIiwiZW5kcG9pbnQiLCJhbWlDb21tYW5kIiwiZmlsdGVyIiwiY3JpdGVyaW9uIiwibW9yZSIsInNpbXBsZV9zZWFyY2giLCJfcmVuZGVyIiwiZ2V0UGFyZW50IiwiJG5hbWUiLCJ0YWIiLCJhcHBlbmRJdGVtIiwiY2xvc2FibGUiLCJmaXJzdFZpc2libGUiLCJzZXRQYXJlbnQiLCJfX3JlbmRlciIsInJlcGxhY2VIVE1MIiwiZGljdCIsInBhdGNoSWQiLCJzdWJtaXQiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWwiLCJ0cmltIiwic2VhcmNoIiwicmVzb2x2ZVdpdGgiLCJjcmVhdGVDb250cm9sSW5Db250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7R0FhQUEsU0FBUyxDQUFDLGtCQUFELENBQXFCLENBSTdCQyxRQUFRLENBQUVDLEdBQUcsQ0FB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UCxDQUFtQixNQUFJLENBQUMzQixHQUFMLENBQVMvQixPQUE1QixDQUdBLENBckJELENBc0JBLENBdks0QixDQTJLN0J5RCxNQUFNLENBQUUsZ0JBQVMxQyxLQUFULENBQ1IsQ0FDQyxNQUFPbEIsQ0FBQUEsU0FBUyxDQUFDOEQsd0JBQVYsQ0FBbUMsS0FBS2xCLFNBQUwsRUFBbkMsQ0FBcUQsSUFBckQsQ0FBMkQsT0FBM0QsQ0FBb0UsQ0FBQyxLQUFLVixHQUFMLENBQVNGLGlCQUFULENBQTJCLEtBQUtFLEdBQUwsQ0FBU25CLE9BQXBDLENBQTZDLEtBQUttQixHQUFMLENBQVNsQixNQUF0RCxDQUE4RCxLQUFLa0IsR0FBTCxDQUFTakIsTUFBdkUsQ0FBK0VDLEtBQS9FLENBQUQsQ0FBcEUsQ0FBNkosRUFBN0osQ0FBaUssS0FBS2dCLEdBQXRLLENBQTJLLE9BQTNLLENBQW9MLEtBQUtBLEdBQUwsQ0FBU2xCLE1BQTdMLENBQ1AsQ0E5SzRCLENBQXJCLENBQVQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFNSSBXZWIgRnJhbWV3b3JrXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LVhYWFggVGhlIEFNSSBUZWFtIC8gTFBTQyAvIElOMlAzXG4gKlxuICogVGhpcyBmaWxlIG11c3QgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIENlQ0lMTC1DOlxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWVuLmh0bWxcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1mci5odG1sXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4kQU1JQ2xhc3MoJ1NpbXBsZVNlYXJjaEN0cmwnLCB7XG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkZXh0ZW5kczogYW1pLkNvbnRyb2wsXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkaW5pdDogZnVuY3Rpb24ocGFyZW50LCBvd25lcilcblx0e1xuXHRcdHRoaXMuJHN1cGVyLiRpbml0KHBhcmVudCwgb3duZXIpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0b25SZWFkeTogZnVuY3Rpb24oKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5sb2FkUmVzb3VyY2VzKFtcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2NvbnRyb2xzL1NpbXBsZVNlYXJjaC90d2lnL1NpbXBsZVNlYXJjaEN0cmwudHdpZycsXG5cdFx0XHQnY3RybDp0YWInLFxuXHRcdF0sIHtjb250ZXh0OiB0aGlzfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7XG5cblx0XHRcdHRoaXMuZnJhZ21lbnRTaW1wbGVTZWFyY2ggPSBkYXRhWzBdO1xuXG5cdFx0XHR0aGlzLnRhYkN0cmwgPSBkYXRhWzFdO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVuZGVyOiBmdW5jdGlvbihzZWxlY3Rvciwgc2V0dGluZ3MpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBmbiA9IChjYXRhbG9nLCBlbnRpdHksIGZpZWxkcywgdmFsdWUpID0+IHtcblxuXHRcdFx0Y29uc3Qgc2VsZWN0ID0gZmllbGRzLmxlbmd0aCA9PT0gMCA/IFsnMCA9IDEnXVxuXHRcdFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICh2YWx1ZS5pbmRleE9mKCclJykgPCAwKSA/IGZpZWxkcy5tYXAoZmllbGQgPT4gZmllbGQgKyAnID0gXFwnJyArIGFtaVdlYkFwcC50ZXh0VG9TUUwodmFsdWUpICsgJ1xcJycpXG5cdFx0XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogZmllbGRzLm1hcChmaWVsZCA9PiBmaWVsZCArICcgTElLRSBcXCcnICsgYW1pV2ViQXBwLnRleHRUb1NRTCh2YWx1ZSkgKyAnXFwnJylcblx0XHRcdDtcblxuXHRcdFx0cmV0dXJuICdCcm93c2VRdWVyeScgKyAnIC1jYXRhbG9nPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcoY2F0YWxvZykgKyAnXCIgLWVudGl0eT1cIicgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKGVudGl0eSkgKyAnXCIgLW1xbD1cIlNFTEVDVCAqIFdIRVJFICcgKyBzZWxlY3Quam9pbignIE9SICcpICsgJ1wiJztcblx0XHR9O1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3QgW1xuXHRcdFx0Y29udGV4dCxcblx0XHRcdHBsYWNlaG9sZGVyLFxuXHRcdFx0Y2F0YWxvZywgZGVmYXVsdENhdGFsb2csXG5cdFx0XHRlbnRpdHksIGRlZmF1bHRFbnRpdHksXG5cdFx0XHRmaWVsZHMsIGNyaXRlcmlhLFxuXHRcdFx0c2VhcmNoQ29tbWFuZEZ1bmMsXG5cdFx0XHRjYXJkXG5cdFx0XSA9IGFtaVdlYkFwcC5zZXR1cChcblx0XHRcdFtcblx0XHRcdFx0J2NvbnRleHQnLFxuXHRcdFx0XHQncGxhY2Vob2xkZXInLFxuXHRcdFx0XHQnY2F0YWxvZycsICdkZWZhdWx0Q2F0YWxvZycsXG5cdFx0XHRcdCdlbnRpdHknLCAnZGVmYXVsdEVudGl0eScsXG5cdFx0XHRcdCdmaWVsZHMnLCAnY3JpdGVyaWEnLFxuXHRcdFx0XHQnc2VhcmNoQ29tbWFuZEZ1bmMnLFxuXHRcdFx0XHQnY2FyZCcsXG5cdFx0XHRdLFxuXHRcdFx0W1xuXHRcdFx0XHRyZXN1bHQsXG5cdFx0XHRcdCclIGZvciB3aWxkY2FyZGluZycsXG5cdFx0XHRcdCcnLCAnJyxcblx0XHRcdFx0JycsICcnLFxuXHRcdFx0XHRbXSwgW10sXG5cdFx0XHRcdGZuLFxuXHRcdFx0XHRmYWxzZSxcblx0XHRcdF0sXG5cdFx0XHRzZXR0aW5nc1xuXHRcdCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLmN0eCA9IHt9O1xuXG5cdFx0Zm9yKGNvbnN0IGtleSBpbiBzZXR0aW5ncylcblx0XHR7XG5cdFx0ICAgIHRoaXMuY3R4W2tleV0gPSBzZXR0aW5nc1trZXldO1xuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4LmlzRW1iZWRkZWQgPSBhbWlXZWJBcHAuaXNFbWJlZGRlZCgpO1xuXG5cdFx0dGhpcy5jdHguZW5kcG9pbnQgPSBhbWlDb21tYW5kLmVuZHBvaW50O1xuXG5cdFx0dGhpcy5jdHguY29udGV4dCA9IGNvbnRleHQ7XG5cblx0XHR0aGlzLmN0eC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xuXG5cdFx0dGhpcy5jdHguY2F0YWxvZyA9IGRlZmF1bHRDYXRhbG9nID8gZGVmYXVsdENhdGFsb2cgOiBjYXRhbG9nO1xuXHRcdHRoaXMuY3R4LmVudGl0eSA9IGRlZmF1bHRFbnRpdHkgPyBkZWZhdWx0RW50aXR5IDogZW50aXR5O1xuXG5cdFx0dGhpcy5jdHguZmllbGRzID0gY3JpdGVyaWEubGVuZ3RoID4gMCA/IGNyaXRlcmlhLmZpbHRlcihjcml0ZXJpb24gPT4gY3JpdGVyaW9uLm1vcmUuc2ltcGxlX3NlYXJjaCkubWFwKGNyaXRlcmlvbiA9PiAnYCcgKyBjcml0ZXJpb24uY2F0YWxvZyArICdgLmAnICsgY3JpdGVyaW9uLmVudGl0eSArICdgLmAnICsgY3JpdGVyaW9uLmZpZWxkICsgJ2AnKVxuXHRcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmaWVsZHNcblx0XHQ7XG5cblx0XHR0aGlzLmN0eC5zZWFyY2hDb21tYW5kRnVuYyA9IHNlYXJjaENvbW1hbmRGdW5jO1xuXG5cdFx0dGhpcy5jdHguY2FyZCA9IGNhcmQ7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLl9yZW5kZXIocmVzdWx0LCBzZWxlY3Rvcik7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdGlmKHRoaXMuZ2V0UGFyZW50KCkuJG5hbWUgIT09ICdUYWJDdHJsJylcblx0XHR7XG5cdFx0XHRjb25zdCB0YWIgPSBuZXcgdGhpcy50YWJDdHJsKG51bGwsIHRoaXMpO1xuXG5cdFx0XHR0YWIucmVuZGVyKHNlbGVjdG9yLCB0aGlzLmN0eCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0dGFiLmFwcGVuZEl0ZW0oJzxpIGNsYXNzPVwiZmEgZmEtc2VhcmNoXCI+PC9pPiAnICsgdGhpcy5jdHguZW50aXR5LCB7Y2xvc2FibGU6IGZhbHNlLCBmaXJzdFZpc2libGU6IGZhbHNlfSkuZG9uZSgoc2VsZWN0b3IpID0+IHtcblxuXHRcdFx0XHRcdHRoaXMuc2V0UGFyZW50KHRhYik7XG5cblx0XHRcdFx0XHR0aGlzLl9fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy5fX3JlbmRlcihyZXN1bHQsIHNlbGVjdG9yKTtcblx0XHR9XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfX3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdHRoaXMucmVwbGFjZUhUTUwoc2VsZWN0b3IsIHRoaXMuZnJhZ21lbnRTaW1wbGVTZWFyY2gsIHtkaWN0OiB0aGlzLmN0eH0pLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNFOEYxNTJCMF82NkM2XzEzMkNfMDE1NV85NTVEMzY2NTRDMTMnKSkuc3VibWl0KChlKSA9PiB7XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gJCh0aGlzLnBhdGNoSWQoJyNGOEQ4QzJGQl84MUQ5X0Y3QTBfMTIxQl82RkIyOTQ5RjhEQjYnKSkudmFsKCkudHJpbSgpO1xuXG5cdFx0XHRcdGlmKHZhbHVlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGhpcy5zZWFyY2godmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLmN0eC5jb250ZXh0KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRzZWFyY2g6IGZ1bmN0aW9uKHZhbHVlKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5jcmVhdGVDb250cm9sSW5Db250YWluZXIodGhpcy5nZXRQYXJlbnQoKSwgdGhpcywgJ3RhYmxlJywgW3RoaXMuY3R4LnNlYXJjaENvbW1hbmRGdW5jKHRoaXMuY3R4LmNhdGFsb2csIHRoaXMuY3R4LmVudGl0eSwgdGhpcy5jdHguZmllbGRzLCB2YWx1ZSldLCB7fSwgdGhpcy5jdHgsICd0YWJsZScsIHRoaXMuY3R4LmVudGl0eSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiJdfQ==
