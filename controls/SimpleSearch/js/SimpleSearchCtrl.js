/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

/*--------------------------------------------------------------------------------------------------------------------*/
$AMIClass('SimpleSearchCtrl', {
  /*----------------------------------------------------------------------------------------------------------------*/
  $extends: ami.Control,

  /*----------------------------------------------------------------------------------------------------------------*/
  $init: function $init(parent, owner) {
    this.$super.$init(parent, owner);
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  onReady: function onReady() {
    return amiWebApp.loadResources([amiWebApp.originURL + '/controls/SimpleSearch/twig/SimpleSearchCtrl.twig', 'ctrl:tab'], {
      context: this
    }).done(function (data) {
      this.fragmentSimpleSearch = data[0];
      this.tabCtrl = data[1];
    });
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  render: function render(selector, settings) {
    var result = $.Deferred();
    /*------------------------------------------------------------------------------------------------------------*/

    var fn = function fn(catalog, entity, fields, value) {
      var select = fields.length === 0 ? ['0 = 1'] : value.indexOf('%') < 0 ? fields.map(function (field) {
        return field + ' = \'' + amiWebApp.textToSQL(value) + '\'';
      }) : fields.map(function (field) {
        return field + ' LIKE \'' + amiWebApp.textToSQL(value) + '\'';
      });
      return 'BrowseQuery' + ' -catalog="' + amiWebApp.textToString(catalog) + '" -entity="' + amiWebApp.textToString(entity) + '" -mql="SELECT * WHERE ' + select.join(' OR ') + '"';
    };
    /*------------------------------------------------------------------------------------------------------------*/


    var _amiWebApp$setup = amiWebApp.setup(['context', 'placeholder', 'catalog', 'defaultCatalog', 'entity', 'defaultEntity', 'fields', 'criterias', 'searchCommandFunc', 'card'], [result, '% for wildcarding', '', '', '', '', [], [], fn, false], settings),
        context = _amiWebApp$setup[0],
        placeholder = _amiWebApp$setup[1],
        catalog = _amiWebApp$setup[2],
        defaultCatalog = _amiWebApp$setup[3],
        entity = _amiWebApp$setup[4],
        defaultEntity = _amiWebApp$setup[5],
        fields = _amiWebApp$setup[6],
        criterias = _amiWebApp$setup[7],
        searchCommandFunc = _amiWebApp$setup[8],
        card = _amiWebApp$setup[9];
    /*------------------------------------------------------------------------------------------------------------*/


    this.ctx = {};

    for (var key in settings) {
      this.ctx[key] = settings[key];
    }
    /*------------------------------------------------------------------------------------------------------------*/


    this.ctx.isEmbedded = amiWebApp.isEmbedded();
    this.ctx.endpoint = amiCommand.endpoint;
    this.ctx.context = context;
    this.ctx.placeholder = placeholder;
    this.ctx.catalog = defaultCatalog ? defaultCatalog : catalog;
    this.ctx.entity = defaultEntity ? defaultEntity : entity;
    this.ctx.fields = criterias.length > 0 ? criterias.filter(function (criteria) {
      return criteria.more.simple_search;
    }).map(function (criteria) {
      return '`' + criteria.catalog + '`.`' + criteria.entity + '`.`' + criteria.field + '`';
    }) : fields;
    this.ctx.searchCommandFunc = searchCommandFunc;
    this.ctx.card = card;
    /*------------------------------------------------------------------------------------------------------------*/

    this._render(result, selector);
    /*------------------------------------------------------------------------------------------------------------*/


    return result;
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  _render: function _render(result, selector) {
    var _this = this;

    if (this.getParent().$name !== 'TabCtrl') {
      var tab = new this.tabCtrl(null, this);
      tab.render(selector, this.ctx).done(function () {
        tab.appendItem('<i class="fa fa-search"></i> ' + _this.ctx.entity, {
          closable: false,
          firstVisible: false
        }).done(function (selector) {
          _this.setParent(tab);

          _this.__render(result, selector);
        });
      });
    } else {
      this.__render(result, selector);
    }
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  __render: function __render(result, selector) {
    var _this2 = this;

    this.replaceHTML(selector, this.fragmentSimpleSearch, {
      dict: this.ctx
    }).done(function () {
      /*--------------------------------------------------------------------------------------------------------*/
      $(_this2.patchId('#E8F152B0_66C6_132C_0155_955D36654C13')).submit(function (e) {
        e.preventDefault();
        var value = $(_this2.patchId('#F8D8C2FB_81D9_F7A0_121B_6FB2949F8DB6')).val().trim();

        if (value) {
          _this2.search(value);
        }
      });
      /*--------------------------------------------------------------------------------------------------------*/

      result.resolveWith(_this2.ctx.context);
      /*--------------------------------------------------------------------------------------------------------*/
    });
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  search: function search(value) {
    return amiWebApp.createControlInContainer(this.getParent(), this, 'table', [this.ctx.searchCommandFunc(this.ctx.catalog, this.ctx.entity, this.ctx.fields, value)], {}, this.ctx, 'table', this.ctx.entity);
  }
  /*----------------------------------------------------------------------------------------------------------------*/

});
/*--------------------------------------------------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpbXBsZVNlYXJjaEN0cmwuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiQ29udHJvbCIsIiRpbml0IiwicGFyZW50Iiwib3duZXIiLCIkc3VwZXIiLCJvblJlYWR5IiwiYW1pV2ViQXBwIiwibG9hZFJlc291cmNlcyIsIm9yaWdpblVSTCIsImNvbnRleHQiLCJkb25lIiwiZGF0YSIsImZyYWdtZW50U2ltcGxlU2VhcmNoIiwidGFiQ3RybCIsInJlbmRlciIsInNlbGVjdG9yIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJmbiIsImNhdGFsb2ciLCJlbnRpdHkiLCJmaWVsZHMiLCJ2YWx1ZSIsInNlbGVjdCIsImxlbmd0aCIsImluZGV4T2YiLCJtYXAiLCJmaWVsZCIsInRleHRUb1NRTCIsInRleHRUb1N0cmluZyIsImpvaW4iLCJzZXR1cCIsInBsYWNlaG9sZGVyIiwiZGVmYXVsdENhdGFsb2ciLCJkZWZhdWx0RW50aXR5IiwiY3JpdGVyaWFzIiwic2VhcmNoQ29tbWFuZEZ1bmMiLCJjYXJkIiwiY3R4Iiwia2V5IiwiaXNFbWJlZGRlZCIsImVuZHBvaW50IiwiYW1pQ29tbWFuZCIsImZpbHRlciIsImNyaXRlcmlhIiwibW9yZSIsInNpbXBsZV9zZWFyY2giLCJfcmVuZGVyIiwiZ2V0UGFyZW50IiwiJG5hbWUiLCJ0YWIiLCJhcHBlbmRJdGVtIiwiY2xvc2FibGUiLCJmaXJzdFZpc2libGUiLCJzZXRQYXJlbnQiLCJfX3JlbmRlciIsInJlcGxhY2VIVE1MIiwiZGljdCIsInBhdGNoSWQiLCJzdWJtaXQiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWwiLCJ0cmltIiwic2VhcmNoIiwicmVzb2x2ZVdpdGgiLCJjcmVhdGVDb250cm9sSW5Db250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztBQVdBO0FBRUFBLFNBQVMsQ0FBQyxrQkFBRCxFQUFxQjtBQUU3QjtBQUVBQyxFQUFBQSxR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QSxRQUFBQSxDQUFDLENBQUNDLGNBQUY7QUFFQSxZQUFNdkMsS0FBSyxHQUFHTixDQUFDLENBQUMsTUFBSSxDQUFDMEMsT0FBTCxDQUFhLHVDQUFiLENBQUQsQ0FBRCxDQUF5REksR0FBekQsR0FBK0RDLElBQS9ELEVBQWQ7O0FBRUEsWUFBR3pDLEtBQUgsRUFDQTtBQUNDLFVBQUEsTUFBSSxDQUFDMEMsTUFBTCxDQUFZMUMsS0FBWjtBQUNBO0FBQ0QsT0FWRDtBQVlBOztBQUVBUCxNQUFBQSxNQUFNLENBQUNrRCxXQUFQLENBQW1CLE1BQUksQ0FBQzNCLEdBQUwsQ0FBUy9CLE9BQTVCO0FBRUE7QUFDQSxLQXJCRDtBQXNCQSxHQXZLNEI7O0FBeUs3QjtBQUVBeUQsRUFBQUEsTUFBTSxFQUFFLGdCQUFTMUMsS0FBVCxFQUNSO0FBQ0MsV0FBT2xCLFNBQVMsQ0FBQzhELHdCQUFWLENBQW1DLEtBQUtsQixTQUFMLEVBQW5DLEVBQXFELElBQXJELEVBQTJELE9BQTNELEVBQW9FLENBQUMsS0FBS1YsR0FBTCxDQUFTRixpQkFBVCxDQUEyQixLQUFLRSxHQUFMLENBQVNuQixPQUFwQyxFQUE2QyxLQUFLbUIsR0FBTCxDQUFTbEIsTUFBdEQsRUFBOEQsS0FBS2tCLEdBQUwsQ0FBU2pCLE1BQXZFLEVBQStFQyxLQUEvRSxDQUFELENBQXBFLEVBQTZKLEVBQTdKLEVBQWlLLEtBQUtnQixHQUF0SyxFQUEySyxPQUEzSyxFQUFvTCxLQUFLQSxHQUFMLENBQVNsQixNQUE3TCxDQUFQO0FBQ0E7QUFFRDs7QUFoTDZCLENBQXJCLENBQVQ7QUFtTEEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFNSSBXZWIgRnJhbWV3b3JrXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LVhYWFggVGhlIEFNSSBUZWFtIC8gTFBTQyAvIElOMlAzXG4gKlxuICogVGhpcyBmaWxlIG11c3QgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIENlQ0lMTC1DOlxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWVuLmh0bWxcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1mci5odG1sXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4kQU1JQ2xhc3MoJ1NpbXBsZVNlYXJjaEN0cmwnLCB7XG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkZXh0ZW5kczogYW1pLkNvbnRyb2wsXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkaW5pdDogZnVuY3Rpb24ocGFyZW50LCBvd25lcilcblx0e1xuXHRcdHRoaXMuJHN1cGVyLiRpbml0KHBhcmVudCwgb3duZXIpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0b25SZWFkeTogZnVuY3Rpb24oKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5sb2FkUmVzb3VyY2VzKFtcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2NvbnRyb2xzL1NpbXBsZVNlYXJjaC90d2lnL1NpbXBsZVNlYXJjaEN0cmwudHdpZycsXG5cdFx0XHQnY3RybDp0YWInLFxuXHRcdF0sIHtjb250ZXh0OiB0aGlzfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7XG5cblx0XHRcdHRoaXMuZnJhZ21lbnRTaW1wbGVTZWFyY2ggPSBkYXRhWzBdO1xuXG5cdFx0XHR0aGlzLnRhYkN0cmwgPSBkYXRhWzFdO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVuZGVyOiBmdW5jdGlvbihzZWxlY3Rvciwgc2V0dGluZ3MpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBmbiA9IChjYXRhbG9nLCBlbnRpdHksIGZpZWxkcywgdmFsdWUpID0+IHtcblxuXHRcdFx0Y29uc3Qgc2VsZWN0ID0gZmllbGRzLmxlbmd0aCA9PT0gMCA/IFsnMCA9IDEnXVxuXHRcdFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICh2YWx1ZS5pbmRleE9mKCclJykgPCAwKSA/IGZpZWxkcy5tYXAoZmllbGQgPT4gZmllbGQgKyAnID0gXFwnJyArIGFtaVdlYkFwcC50ZXh0VG9TUUwodmFsdWUpICsgJ1xcJycpXG5cdFx0XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogZmllbGRzLm1hcChmaWVsZCA9PiBmaWVsZCArICcgTElLRSBcXCcnICsgYW1pV2ViQXBwLnRleHRUb1NRTCh2YWx1ZSkgKyAnXFwnJylcblx0XHRcdDtcblxuXHRcdFx0cmV0dXJuICdCcm93c2VRdWVyeScgKyAnIC1jYXRhbG9nPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcoY2F0YWxvZykgKyAnXCIgLWVudGl0eT1cIicgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKGVudGl0eSkgKyAnXCIgLW1xbD1cIlNFTEVDVCAqIFdIRVJFICcgKyBzZWxlY3Quam9pbignIE9SICcpICsgJ1wiJztcblx0XHR9O1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3QgW1xuXHRcdFx0Y29udGV4dCxcblx0XHRcdHBsYWNlaG9sZGVyLFxuXHRcdFx0Y2F0YWxvZywgZGVmYXVsdENhdGFsb2csXG5cdFx0XHRlbnRpdHksIGRlZmF1bHRFbnRpdHksXG5cdFx0XHRmaWVsZHMsIGNyaXRlcmlhcyxcblx0XHRcdHNlYXJjaENvbW1hbmRGdW5jLFxuXHRcdFx0Y2FyZFxuXHRcdF0gPSBhbWlXZWJBcHAuc2V0dXAoXG5cdFx0XHRbXG5cdFx0XHRcdCdjb250ZXh0Jyxcblx0XHRcdFx0J3BsYWNlaG9sZGVyJyxcblx0XHRcdFx0J2NhdGFsb2cnLCAnZGVmYXVsdENhdGFsb2cnLFxuXHRcdFx0XHQnZW50aXR5JywgJ2RlZmF1bHRFbnRpdHknLFxuXHRcdFx0XHQnZmllbGRzJywgJ2NyaXRlcmlhcycsXG5cdFx0XHRcdCdzZWFyY2hDb21tYW5kRnVuYycsXG5cdFx0XHRcdCdjYXJkJyxcblx0XHRcdF0sXG5cdFx0XHRbXG5cdFx0XHRcdHJlc3VsdCxcblx0XHRcdFx0JyUgZm9yIHdpbGRjYXJkaW5nJyxcblx0XHRcdFx0JycsICcnLFxuXHRcdFx0XHQnJywgJycsXG5cdFx0XHRcdFtdLCBbXSxcblx0XHRcdFx0Zm4sXG5cdFx0XHRcdGZhbHNlLFxuXHRcdFx0XSxcblx0XHRcdHNldHRpbmdzXG5cdFx0KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4ID0ge307XG5cblx0XHRmb3IobGV0IGtleSBpbiBzZXR0aW5ncylcblx0XHR7XG5cdFx0ICAgIHRoaXMuY3R4W2tleV0gPSBzZXR0aW5nc1trZXldO1xuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4LmlzRW1iZWRkZWQgPSBhbWlXZWJBcHAuaXNFbWJlZGRlZCgpO1xuXG5cdFx0dGhpcy5jdHguZW5kcG9pbnQgPSBhbWlDb21tYW5kLmVuZHBvaW50O1xuXG5cdFx0dGhpcy5jdHguY29udGV4dCA9IGNvbnRleHQ7XG5cblx0XHR0aGlzLmN0eC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xuXG5cdFx0dGhpcy5jdHguY2F0YWxvZyA9IGRlZmF1bHRDYXRhbG9nID8gZGVmYXVsdENhdGFsb2cgOiBjYXRhbG9nO1xuXHRcdHRoaXMuY3R4LmVudGl0eSA9IGRlZmF1bHRFbnRpdHkgPyBkZWZhdWx0RW50aXR5IDogZW50aXR5O1xuXG5cdFx0dGhpcy5jdHguZmllbGRzID0gY3JpdGVyaWFzLmxlbmd0aCA+IDAgPyBjcml0ZXJpYXMuZmlsdGVyKGNyaXRlcmlhID0+IGNyaXRlcmlhLm1vcmUuc2ltcGxlX3NlYXJjaCkubWFwKGNyaXRlcmlhID0+ICdgJyArIGNyaXRlcmlhLmNhdGFsb2cgKyAnYC5gJyArIGNyaXRlcmlhLmVudGl0eSArICdgLmAnICsgY3JpdGVyaWEuZmllbGQgKyAnYCcpXG5cdFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmaWVsZHNcblx0XHQ7XG5cblx0XHR0aGlzLmN0eC5zZWFyY2hDb21tYW5kRnVuYyA9IHNlYXJjaENvbW1hbmRGdW5jO1xuXG5cdFx0dGhpcy5jdHguY2FyZCA9IGNhcmQ7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLl9yZW5kZXIocmVzdWx0LCBzZWxlY3Rvcik7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdGlmKHRoaXMuZ2V0UGFyZW50KCkuJG5hbWUgIT09ICdUYWJDdHJsJylcblx0XHR7XG5cdFx0XHRjb25zdCB0YWIgPSBuZXcgdGhpcy50YWJDdHJsKG51bGwsIHRoaXMpO1xuXG5cdFx0XHR0YWIucmVuZGVyKHNlbGVjdG9yLCB0aGlzLmN0eCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0dGFiLmFwcGVuZEl0ZW0oJzxpIGNsYXNzPVwiZmEgZmEtc2VhcmNoXCI+PC9pPiAnICsgdGhpcy5jdHguZW50aXR5LCB7Y2xvc2FibGU6IGZhbHNlLCBmaXJzdFZpc2libGU6IGZhbHNlfSkuZG9uZSgoc2VsZWN0b3IpID0+IHtcblxuXHRcdFx0XHRcdHRoaXMuc2V0UGFyZW50KHRhYik7XG5cblx0XHRcdFx0XHR0aGlzLl9fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy5fX3JlbmRlcihyZXN1bHQsIHNlbGVjdG9yKTtcblx0XHR9XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfX3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdHRoaXMucmVwbGFjZUhUTUwoc2VsZWN0b3IsIHRoaXMuZnJhZ21lbnRTaW1wbGVTZWFyY2gsIHtkaWN0OiB0aGlzLmN0eH0pLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNFOEYxNTJCMF82NkM2XzEzMkNfMDE1NV85NTVEMzY2NTRDMTMnKSkuc3VibWl0KChlKSA9PiB7XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gJCh0aGlzLnBhdGNoSWQoJyNGOEQ4QzJGQl84MUQ5X0Y3QTBfMTIxQl82RkIyOTQ5RjhEQjYnKSkudmFsKCkudHJpbSgpO1xuXG5cdFx0XHRcdGlmKHZhbHVlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGhpcy5zZWFyY2godmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLmN0eC5jb250ZXh0KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRzZWFyY2g6IGZ1bmN0aW9uKHZhbHVlKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5jcmVhdGVDb250cm9sSW5Db250YWluZXIodGhpcy5nZXRQYXJlbnQoKSwgdGhpcywgJ3RhYmxlJywgW3RoaXMuY3R4LnNlYXJjaENvbW1hbmRGdW5jKHRoaXMuY3R4LmNhdGFsb2csIHRoaXMuY3R4LmVudGl0eSwgdGhpcy5jdHguZmllbGRzLCB2YWx1ZSldLCB7fSwgdGhpcy5jdHgsICd0YWJsZScsIHRoaXMuY3R4LmVudGl0eSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiJdfQ==
