/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

/*--------------------------------------------------------------------------------------------------------------------*/
$AMIClass('SimpleSearchCtrl', {
  /*----------------------------------------------------------------------------------------------------------------*/
  $extends: ami.Control,

  /*----------------------------------------------------------------------------------------------------------------*/
  $init: function $init(parent, owner) {
    this.$super.$init(parent, owner);
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  onReady: function onReady() {
    return amiWebApp.loadResources([amiWebApp.originURL + '/controls/SimpleSearch/twig/SimpleSearchCtrl.twig', 'ctrl:tab'], {
      context: this
    }).done(function (data) {
      this.fragmentSimpleSearch = data[0];
      this.tabCtrl = data[1];
    });
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  render: function render(selector, settings) {
    var result = $.Deferred();
    /*------------------------------------------------------------------------------------------------------------*/

    var fn = function fn(catalog, entity, fields, value) {
      var select = fields.length === 0 ? ['0 = 1'] : value.indexOf('%') < 0 ? fields.map(function (field) {
        return field + ' = \'' + amiWebApp.textToSQL(value) + '\'';
      }) : fields.map(function (field) {
        return field + ' LIKE \'' + amiWebApp.textToSQL(value) + '\'';
      });
      return 'BrowseQuery' + ' -catalog="' + amiWebApp.textToString(catalog) + '" -entity="' + amiWebApp.textToString(entity) + '" -mql="SELECT * WHERE ' + select.join(' OR ') + '"';
    };
    /*------------------------------------------------------------------------------------------------------------*/


    var _amiWebApp$setup = amiWebApp.setup(['context', 'placeholder', 'catalog', 'defaultCatalog', 'entity', 'defaultEntity', 'fields', 'criterias', 'searchCommandFunc', 'card'], [result, '', '', '', '', '', [], [], fn, false], settings),
        context = _amiWebApp$setup[0],
        placeholder = _amiWebApp$setup[1],
        catalog = _amiWebApp$setup[2],
        defaultCatalog = _amiWebApp$setup[3],
        entity = _amiWebApp$setup[4],
        defaultEntity = _amiWebApp$setup[5],
        fields = _amiWebApp$setup[6],
        criterias = _amiWebApp$setup[7],
        searchCommandFunc = _amiWebApp$setup[8],
        card = _amiWebApp$setup[9];
    /*------------------------------------------------------------------------------------------------------------*/


    this.ctx = {};

    for (var key in settings) {
      this.ctx[key] = settings[key];
    }
    /*------------------------------------------------------------------------------------------------------------*/


    this.ctx.isEmbedded = amiWebApp.isEmbedded();
    this.ctx.endpoint = amiCommand.endpoint;
    this.ctx.context = context;
    this.ctx.placeholder = placeholder;
    this.ctx.catalog = defaultCatalog ? defaultCatalog : catalog;
    this.ctx.entity = defaultEntity ? defaultEntity : entity;
    this.ctx.fields = criterias.length > 0 ? criterias.filter(function (criteria) {
      return criteria.more.simple_search;
    }).map(function (criteria) {
      return '`' + criteria.catalog + '`.`' + criteria.entity + '`.`' + criteria.field + '`';
    }) : fields;
    this.ctx.searchCommandFunc = searchCommandFunc;
    this.ctx.card = card;
    /*------------------------------------------------------------------------------------------------------------*/

    this._render(result, selector);
    /*------------------------------------------------------------------------------------------------------------*/


    return result;
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  _render: function _render(result, selector) {
    var _this = this;

    if (this.getParent().$name !== 'TabCtrl') {
      var tab = new this.tabCtrl(null, this);
      tab.render(selector, this.ctx).done(function () {
        tab.appendItem('<i class="fa fa-search"></i> ' + _this.ctx.entity, {
          closable: false,
          firstVisible: false
        }).done(function (selector) {
          _this.setParent(tab);

          _this.__render(result, selector);
        });
      });
    } else {
      this.__render(result, selector);
    }
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  __render: function __render(result, selector) {
    var _this2 = this;

    this.replaceHTML(selector, this.fragmentSimpleSearch, {
      dict: this.ctx
    }).done(function () {
      /*--------------------------------------------------------------------------------------------------------*/
      $(_this2.patchId('#E8F152B0_66C6_132C_0155_955D36654C13')).submit(function (e) {
        e.preventDefault();
        var value = $(_this2.patchId('#F8D8C2FB_81D9_F7A0_121B_6FB2949F8DB6')).val().trim();

        if (value) {
          _this2.search(value);
        }
      });
      /*--------------------------------------------------------------------------------------------------------*/

      result.resolveWith(_this2.ctx.context);
      /*--------------------------------------------------------------------------------------------------------*/
    });
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  search: function search(value) {
    return amiWebApp.createControlInContainer(this.getParent(), this, 'table', [this.ctx.searchCommandFunc(this.ctx.catalog, this.ctx.entity, this.ctx.fields, value)], {}, this.ctx, 'table', this.ctx.entity);
  }
  /*----------------------------------------------------------------------------------------------------------------*/

});
/*--------------------------------------------------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpbXBsZVNlYXJjaEN0cmwuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiQ29udHJvbCIsIiRpbml0IiwicGFyZW50Iiwib3duZXIiLCIkc3VwZXIiLCJvblJlYWR5IiwiYW1pV2ViQXBwIiwibG9hZFJlc291cmNlcyIsIm9yaWdpblVSTCIsImNvbnRleHQiLCJkb25lIiwiZGF0YSIsImZyYWdtZW50U2ltcGxlU2VhcmNoIiwidGFiQ3RybCIsInJlbmRlciIsInNlbGVjdG9yIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJmbiIsImNhdGFsb2ciLCJlbnRpdHkiLCJmaWVsZHMiLCJ2YWx1ZSIsInNlbGVjdCIsImxlbmd0aCIsImluZGV4T2YiLCJtYXAiLCJmaWVsZCIsInRleHRUb1NRTCIsInRleHRUb1N0cmluZyIsImpvaW4iLCJzZXR1cCIsInBsYWNlaG9sZGVyIiwiZGVmYXVsdENhdGFsb2ciLCJkZWZhdWx0RW50aXR5IiwiY3JpdGVyaWFzIiwic2VhcmNoQ29tbWFuZEZ1bmMiLCJjYXJkIiwiY3R4Iiwia2V5IiwiaXNFbWJlZGRlZCIsImVuZHBvaW50IiwiYW1pQ29tbWFuZCIsImZpbHRlciIsImNyaXRlcmlhIiwibW9yZSIsInNpbXBsZV9zZWFyY2giLCJfcmVuZGVyIiwiZ2V0UGFyZW50IiwiJG5hbWUiLCJ0YWIiLCJhcHBlbmRJdGVtIiwiY2xvc2FibGUiLCJmaXJzdFZpc2libGUiLCJzZXRQYXJlbnQiLCJfX3JlbmRlciIsInJlcGxhY2VIVE1MIiwiZGljdCIsInBhdGNoSWQiLCJzdWJtaXQiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWwiLCJ0cmltIiwic2VhcmNoIiwicmVzb2x2ZVdpdGgiLCJjcmVhdGVDb250cm9sSW5Db250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztBQVdBO0FBRUFBLFNBQVMsQ0FBQyxrQkFBRCxFQUFxQjtBQUU3QjtBQUVBQyxFQUFBQSxRQUFRLEVBQUVDLEdBQUcsQ0FBQ0MsT0FKZTs7QUFNN0I7QUFFQUMsRUFBQUEsS0FBSyxFQUFFLGVBQVNDLE1BQVQsRUFBaUJDLEtBQWpCLEVBQ1A7QUFDQyxTQUFLQyxNQUFMLENBQVlILEtBQVosQ0FBa0JDLE1BQWxCLEVBQTBCQyxLQUExQjtBQUNBLEdBWDRCOztBQWE3QjtBQUVBRSxFQUFBQSxPQUFPLEVBQUUsbUJBQ1Q7QUFDQyxXQUFPQyxTQUFTLENBQUNDLGFBQVYsQ0FBd0IsQ0FDOUJELFNBQVMsQ0FBQ0UsU0FBVixHQUFzQixtREFEUSxFQUU5QixVQUY4QixDQUF4QixFQUdKO0FBQUNDLE1BQUFBLE9BQU8sRUFBRTtBQUFWLEtBSEksRUFHYUMsSUFIYixDQUdrQixVQUFTQyxJQUFULEVBQWU7QUFFdkMsV0FBS0Msb0JBQUwsR0FBNEJELElBQUksQ0FBQyxDQUFELENBQWhDO0FBRUEsV0FBS0UsT0FBTCxHQUFlRixJQUFJLENBQUMsQ0FBRCxDQUFuQjtBQUNBLEtBUk0sQ0FBUDtBQVNBLEdBMUI0Qjs7QUE0QjdCO0FBRUFHLEVBQUFBLE1BQU0sRUFBRSxnQkFBU0MsUUFBVCxFQUFtQkMsUUFBbkIsRUFDUjtBQUNDLFFBQU1DLE1BQU0sR0FBR0MsQ0FBQyxDQUFDQyxRQUFGLEVBQWY7QUFFQTs7QUFFQSxRQUFNQyxFQUFFLEdBQUcsU0FBTEEsRUFBSyxDQUFDQyxPQUFELEVBQVVDLE1BQVYsRUFBa0JDLE1BQWxCLEVBQTBCQyxLQUExQixFQUFvQztBQUU5QyxVQUFNQyxNQUFNLEdBQUdGLE1BQU0sQ0FBQ0csTUFBUCxLQUFrQixDQUFsQixHQUFzQixDQUFDLE9BQUQsQ0FBdEIsR0FDdUJGLEtBQUssQ0FBQ0csT0FBTixDQUFjLEdBQWQsSUFBcUIsQ0FBdEIsR0FBMkJKLE1BQU0sQ0FBQ0ssR0FBUCxDQUFXLFVBQUFDLEtBQUs7QUFBQSxlQUFJQSxLQUFLLEdBQUcsT0FBUixHQUFrQnZCLFNBQVMsQ0FBQ3dCLFNBQVYsQ0FBb0JOLEtBQXBCLENBQWxCLEdBQStDLElBQW5EO0FBQUEsT0FBaEIsQ0FBM0IsR0FDMkJELE1BQU0sQ0FBQ0ssR0FBUCxDQUFXLFVBQUFDLEtBQUs7QUFBQSxlQUFJQSxLQUFLLEdBQUcsVUFBUixHQUFxQnZCLFNBQVMsQ0FBQ3dCLFNBQVYsQ0FBb0JOLEtBQXBCLENBQXJCLEdBQWtELElBQXREO0FBQUEsT0FBaEIsQ0FGaEU7QUFLQSxhQUFPLGdCQUFnQixhQUFoQixHQUFnQ2xCLFNBQVMsQ0FBQ3lCLFlBQVYsQ0FBdUJWLE9BQXZCLENBQWhDLEdBQWtFLGFBQWxFLEdBQWtGZixTQUFTLENBQUN5QixZQUFWLENBQXVCVCxNQUF2QixDQUFsRixHQUFtSCx5QkFBbkgsR0FBK0lHLE1BQU0sQ0FBQ08sSUFBUCxDQUFZLE1BQVosQ0FBL0ksR0FBcUssR0FBNUs7QUFDQSxLQVJEO0FBVUE7OztBQWZELDJCQXlCSzFCLFNBQVMsQ0FBQzJCLEtBQVYsQ0FDSCxDQUNDLFNBREQsRUFFQyxhQUZELEVBR0MsU0FIRCxFQUdZLGdCQUhaLEVBSUMsUUFKRCxFQUlXLGVBSlgsRUFLQyxRQUxELEVBS1csV0FMWCxFQU1DLG1CQU5ELEVBT0MsTUFQRCxDQURHLEVBVUgsQ0FDQ2hCLE1BREQsRUFFQyxFQUZELEVBR0MsRUFIRCxFQUdLLEVBSEwsRUFJQyxFQUpELEVBSUssRUFKTCxFQUtDLEVBTEQsRUFLSyxFQUxMLEVBTUNHLEVBTkQsRUFPQyxLQVBELENBVkcsRUFtQkhKLFFBbkJHLENBekJMO0FBQUEsUUFrQkVQLE9BbEJGO0FBQUEsUUFtQkV5QixXQW5CRjtBQUFBLFFBb0JFYixPQXBCRjtBQUFBLFFBb0JXYyxjQXBCWDtBQUFBLFFBcUJFYixNQXJCRjtBQUFBLFFBcUJVYyxhQXJCVjtBQUFBLFFBc0JFYixNQXRCRjtBQUFBLFFBc0JVYyxTQXRCVjtBQUFBLFFBdUJFQyxpQkF2QkY7QUFBQSxRQXdCRUMsSUF4QkY7QUErQ0M7OztBQUVBLFNBQUtDLEdBQUwsR0FBVyxFQUFYOztBQUVBLFNBQUksSUFBSUMsR0FBUixJQUFlekIsUUFBZixFQUNBO0FBQ0ksV0FBS3dCLEdBQUwsQ0FBU0MsR0FBVCxJQUFnQnpCLFFBQVEsQ0FBQ3lCLEdBQUQsQ0FBeEI7QUFDSDtBQUVEOzs7QUFFQSxTQUFLRCxHQUFMLENBQVNFLFVBQVQsR0FBc0JwQyxTQUFTLENBQUNvQyxVQUFWLEVBQXRCO0FBRUEsU0FBS0YsR0FBTCxDQUFTRyxRQUFULEdBQW9CQyxVQUFVLENBQUNELFFBQS9CO0FBRUEsU0FBS0gsR0FBTCxDQUFTL0IsT0FBVCxHQUFtQkEsT0FBbkI7QUFFQSxTQUFLK0IsR0FBTCxDQUFTTixXQUFULEdBQXVCQSxXQUF2QjtBQUVBLFNBQUtNLEdBQUwsQ0FBU25CLE9BQVQsR0FBbUJjLGNBQWMsR0FBR0EsY0FBSCxHQUFvQmQsT0FBckQ7QUFDQSxTQUFLbUIsR0FBTCxDQUFTbEIsTUFBVCxHQUFrQmMsYUFBYSxHQUFHQSxhQUFILEdBQW1CZCxNQUFsRDtBQUVBLFNBQUtrQixHQUFMLENBQVNqQixNQUFULEdBQWtCYyxTQUFTLENBQUNYLE1BQVYsR0FBbUIsQ0FBbkIsR0FBdUJXLFNBQVMsQ0FBQ1EsTUFBVixDQUFpQixVQUFBQyxRQUFRO0FBQUEsYUFBSUEsUUFBUSxDQUFDQyxJQUFULENBQWNDLGFBQWxCO0FBQUEsS0FBekIsRUFBMERwQixHQUExRCxDQUE4RCxVQUFBa0IsUUFBUTtBQUFBLGFBQUksTUFBTUEsUUFBUSxDQUFDekIsT0FBZixHQUF5QixLQUF6QixHQUFpQ3lCLFFBQVEsQ0FBQ3hCLE1BQTFDLEdBQW1ELEtBQW5ELEdBQTJEd0IsUUFBUSxDQUFDakIsS0FBcEUsR0FBNEUsR0FBaEY7QUFBQSxLQUF0RSxDQUF2QixHQUN1Qk4sTUFEekM7QUFJQSxTQUFLaUIsR0FBTCxDQUFTRixpQkFBVCxHQUE2QkEsaUJBQTdCO0FBRUEsU0FBS0UsR0FBTCxDQUFTRCxJQUFULEdBQWdCQSxJQUFoQjtBQUVBOztBQUVBLFNBQUtVLE9BQUwsQ0FBYWhDLE1BQWIsRUFBcUJGLFFBQXJCO0FBRUE7OztBQUVBLFdBQU9FLE1BQVA7QUFDQSxHQW5INEI7O0FBcUg3QjtBQUVBZ0MsRUFBQUEsT0FBTyxFQUFFLGlCQUFTaEMsTUFBVCxFQUFpQkYsUUFBakIsRUFDVDtBQUFBOztBQUNDLFFBQUcsS0FBS21DLFNBQUwsR0FBaUJDLEtBQWpCLEtBQTJCLFNBQTlCLEVBQ0E7QUFDQyxVQUFNQyxHQUFHLEdBQUcsSUFBSSxLQUFLdkMsT0FBVCxDQUFpQixJQUFqQixFQUF1QixJQUF2QixDQUFaO0FBRUF1QyxNQUFBQSxHQUFHLENBQUN0QyxNQUFKLENBQVdDLFFBQVgsRUFBcUIsS0FBS3lCLEdBQTFCLEVBQStCOUIsSUFBL0IsQ0FBb0MsWUFBTTtBQUV6QzBDLFFBQUFBLEdBQUcsQ0FBQ0MsVUFBSixDQUFlLGtDQUFrQyxLQUFJLENBQUNiLEdBQUwsQ0FBU2xCLE1BQTFELEVBQWtFO0FBQUNnQyxVQUFBQSxRQUFRLEVBQUUsS0FBWDtBQUFrQkMsVUFBQUEsWUFBWSxFQUFFO0FBQWhDLFNBQWxFLEVBQTBHN0MsSUFBMUcsQ0FBK0csVUFBQ0ssUUFBRCxFQUFjO0FBRTVILFVBQUEsS0FBSSxDQUFDeUMsU0FBTCxDQUFlSixHQUFmOztBQUVBLFVBQUEsS0FBSSxDQUFDSyxRQUFMLENBQWN4QyxNQUFkLEVBQXNCRixRQUF0QjtBQUNBLFNBTEQ7QUFNQSxPQVJEO0FBU0EsS0FiRCxNQWVBO0FBQ0MsV0FBSzBDLFFBQUwsQ0FBY3hDLE1BQWQsRUFBc0JGLFFBQXRCO0FBQ0E7QUFDRCxHQTNJNEI7O0FBNkk3QjtBQUVBMEMsRUFBQUEsUUFBUSxFQUFFLGtCQUFTeEMsTUFBVCxFQUFpQkYsUUFBakIsRUFDVjtBQUFBOztBQUNDLFNBQUsyQyxXQUFMLENBQWlCM0MsUUFBakIsRUFBMkIsS0FBS0gsb0JBQWhDLEVBQXNEO0FBQUMrQyxNQUFBQSxJQUFJLEVBQUUsS0FBS25CO0FBQVosS0FBdEQsRUFBd0U5QixJQUF4RSxDQUE2RSxZQUFNO0FBRWxGO0FBRUFRLE1BQUFBLENBQUMsQ0FBQyxNQUFJLENBQUMwQyxPQUFMLENBQWEsdUNBQWIsQ0FBRCxDQUFELENBQXlEQyxNQUF6RCxDQUFnRSxVQUFDQyxDQUFELEVBQU87QUFFdEVBLFFBQUFBLENBQUMsQ0FBQ0MsY0FBRjtBQUVBLFlBQU12QyxLQUFLLEdBQUdOLENBQUMsQ0FBQyxNQUFJLENBQUMwQyxPQUFMLENBQWEsdUNBQWIsQ0FBRCxDQUFELENBQXlESSxHQUF6RCxHQUErREMsSUFBL0QsRUFBZDs7QUFFQSxZQUFHekMsS0FBSCxFQUNBO0FBQ0MsVUFBQSxNQUFJLENBQUMwQyxNQUFMLENBQVkxQyxLQUFaO0FBQ0E7QUFDRCxPQVZEO0FBWUE7O0FBRUFQLE1BQUFBLE1BQU0sQ0FBQ2tELFdBQVAsQ0FBbUIsTUFBSSxDQUFDM0IsR0FBTCxDQUFTL0IsT0FBNUI7QUFFQTtBQUNBLEtBckJEO0FBc0JBLEdBdks0Qjs7QUF5SzdCO0FBRUF5RCxFQUFBQSxNQUFNLEVBQUUsZ0JBQVMxQyxLQUFULEVBQ1I7QUFDQyxXQUFPbEIsU0FBUyxDQUFDOEQsd0JBQVYsQ0FBbUMsS0FBS2xCLFNBQUwsRUFBbkMsRUFBcUQsSUFBckQsRUFBMkQsT0FBM0QsRUFBb0UsQ0FBQyxLQUFLVixHQUFMLENBQVNGLGlCQUFULENBQTJCLEtBQUtFLEdBQUwsQ0FBU25CLE9BQXBDLEVBQTZDLEtBQUttQixHQUFMLENBQVNsQixNQUF0RCxFQUE4RCxLQUFLa0IsR0FBTCxDQUFTakIsTUFBdkUsRUFBK0VDLEtBQS9FLENBQUQsQ0FBcEUsRUFBNkosRUFBN0osRUFBaUssS0FBS2dCLEdBQXRLLEVBQTJLLE9BQTNLLEVBQW9MLEtBQUtBLEdBQUwsQ0FBU2xCLE1BQTdMLENBQVA7QUFDQTtBQUVEOztBQWhMNkIsQ0FBckIsQ0FBVDtBQW1MQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQU1JIFdlYiBGcmFtZXdvcmtcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtWFhYWCBUaGUgQU1JIFRlYW0gLyBMUFNDIC8gSU4yUDNcbiAqXG4gKiBUaGlzIGZpbGUgbXVzdCBiZSB1c2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgQ2VDSUxMLUM6XG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZW4uaHRtbFxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWZyLmh0bWxcbiAqXG4gKi9cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiRBTUlDbGFzcygnU2ltcGxlU2VhcmNoQ3RybCcsIHtcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRleHRlbmRzOiBhbWkuQ29udHJvbCxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRpbml0OiBmdW5jdGlvbihwYXJlbnQsIG93bmVyKVxuXHR7XG5cdFx0dGhpcy4kc3VwZXIuJGluaXQocGFyZW50LCBvd25lcik7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvblJlYWR5OiBmdW5jdGlvbigpXG5cdHtcblx0XHRyZXR1cm4gYW1pV2ViQXBwLmxvYWRSZXNvdXJjZXMoW1xuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY29udHJvbHMvU2ltcGxlU2VhcmNoL3R3aWcvU2ltcGxlU2VhcmNoQ3RybC50d2lnJyxcblx0XHRcdCdjdHJsOnRhYicsXG5cdFx0XSwge2NvbnRleHQ6IHRoaXN9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcblxuXHRcdFx0dGhpcy5mcmFnbWVudFNpbXBsZVNlYXJjaCA9IGRhdGFbMF07XG5cblx0XHRcdHRoaXMudGFiQ3RybCA9IGRhdGFbMV07XG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZW5kZXI6IGZ1bmN0aW9uKHNlbGVjdG9yLCBzZXR0aW5ncylcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IGZuID0gKGNhdGFsb2csIGVudGl0eSwgZmllbGRzLCB2YWx1ZSkgPT4ge1xuXG5cdFx0XHRjb25zdCBzZWxlY3QgPSBmaWVsZHMubGVuZ3RoID09PSAwID8gWycwID0gMSddXG5cdFx0XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogKHZhbHVlLmluZGV4T2YoJyUnKSA8IDApID8gZmllbGRzLm1hcChmaWVsZCA9PiBmaWVsZCArICcgPSBcXCcnICsgYW1pV2ViQXBwLnRleHRUb1NRTCh2YWx1ZSkgKyAnXFwnJylcblx0XHRcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmaWVsZHMubWFwKGZpZWxkID0+IGZpZWxkICsgJyBMSUtFIFxcJycgKyBhbWlXZWJBcHAudGV4dFRvU1FMKHZhbHVlKSArICdcXCcnKVxuXHRcdFx0O1xuXG5cdFx0XHRyZXR1cm4gJ0Jyb3dzZVF1ZXJ5JyArICcgLWNhdGFsb2c9XCInICsgYW1pV2ViQXBwLnRleHRUb1N0cmluZyhjYXRhbG9nKSArICdcIiAtZW50aXR5PVwiJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcoZW50aXR5KSArICdcIiAtbXFsPVwiU0VMRUNUICogV0hFUkUgJyArIHNlbGVjdC5qb2luKCcgT1IgJykgKyAnXCInO1xuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBbXG5cdFx0XHRjb250ZXh0LFxuXHRcdFx0cGxhY2Vob2xkZXIsXG5cdFx0XHRjYXRhbG9nLCBkZWZhdWx0Q2F0YWxvZyxcblx0XHRcdGVudGl0eSwgZGVmYXVsdEVudGl0eSxcblx0XHRcdGZpZWxkcywgY3JpdGVyaWFzLFxuXHRcdFx0c2VhcmNoQ29tbWFuZEZ1bmMsXG5cdFx0XHRjYXJkXG5cdFx0XSA9IGFtaVdlYkFwcC5zZXR1cChcblx0XHRcdFtcblx0XHRcdFx0J2NvbnRleHQnLFxuXHRcdFx0XHQncGxhY2Vob2xkZXInLFxuXHRcdFx0XHQnY2F0YWxvZycsICdkZWZhdWx0Q2F0YWxvZycsXG5cdFx0XHRcdCdlbnRpdHknLCAnZGVmYXVsdEVudGl0eScsXG5cdFx0XHRcdCdmaWVsZHMnLCAnY3JpdGVyaWFzJyxcblx0XHRcdFx0J3NlYXJjaENvbW1hbmRGdW5jJyxcblx0XHRcdFx0J2NhcmQnLFxuXHRcdFx0XSxcblx0XHRcdFtcblx0XHRcdFx0cmVzdWx0LFxuXHRcdFx0XHQnJyxcblx0XHRcdFx0JycsICcnLFxuXHRcdFx0XHQnJywgJycsXG5cdFx0XHRcdFtdLCBbXSxcblx0XHRcdFx0Zm4sXG5cdFx0XHRcdGZhbHNlLFxuXHRcdFx0XSxcblx0XHRcdHNldHRpbmdzXG5cdFx0KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4ID0ge307XG5cblx0XHRmb3IobGV0IGtleSBpbiBzZXR0aW5ncylcblx0XHR7XG5cdFx0ICAgIHRoaXMuY3R4W2tleV0gPSBzZXR0aW5nc1trZXldO1xuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuY3R4LmlzRW1iZWRkZWQgPSBhbWlXZWJBcHAuaXNFbWJlZGRlZCgpO1xuXG5cdFx0dGhpcy5jdHguZW5kcG9pbnQgPSBhbWlDb21tYW5kLmVuZHBvaW50O1xuXG5cdFx0dGhpcy5jdHguY29udGV4dCA9IGNvbnRleHQ7XG5cblx0XHR0aGlzLmN0eC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xuXG5cdFx0dGhpcy5jdHguY2F0YWxvZyA9IGRlZmF1bHRDYXRhbG9nID8gZGVmYXVsdENhdGFsb2cgOiBjYXRhbG9nO1xuXHRcdHRoaXMuY3R4LmVudGl0eSA9IGRlZmF1bHRFbnRpdHkgPyBkZWZhdWx0RW50aXR5IDogZW50aXR5O1xuXG5cdFx0dGhpcy5jdHguZmllbGRzID0gY3JpdGVyaWFzLmxlbmd0aCA+IDAgPyBjcml0ZXJpYXMuZmlsdGVyKGNyaXRlcmlhID0+IGNyaXRlcmlhLm1vcmUuc2ltcGxlX3NlYXJjaCkubWFwKGNyaXRlcmlhID0+ICdgJyArIGNyaXRlcmlhLmNhdGFsb2cgKyAnYC5gJyArIGNyaXRlcmlhLmVudGl0eSArICdgLmAnICsgY3JpdGVyaWEuZmllbGQgKyAnYCcpXG5cdFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmaWVsZHNcblx0XHQ7XG5cblx0XHR0aGlzLmN0eC5zZWFyY2hDb21tYW5kRnVuYyA9IHNlYXJjaENvbW1hbmRGdW5jO1xuXG5cdFx0dGhpcy5jdHguY2FyZCA9IGNhcmQ7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLl9yZW5kZXIocmVzdWx0LCBzZWxlY3Rvcik7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdGlmKHRoaXMuZ2V0UGFyZW50KCkuJG5hbWUgIT09ICdUYWJDdHJsJylcblx0XHR7XG5cdFx0XHRjb25zdCB0YWIgPSBuZXcgdGhpcy50YWJDdHJsKG51bGwsIHRoaXMpO1xuXG5cdFx0XHR0YWIucmVuZGVyKHNlbGVjdG9yLCB0aGlzLmN0eCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0dGFiLmFwcGVuZEl0ZW0oJzxpIGNsYXNzPVwiZmEgZmEtc2VhcmNoXCI+PC9pPiAnICsgdGhpcy5jdHguZW50aXR5LCB7Y2xvc2FibGU6IGZhbHNlLCBmaXJzdFZpc2libGU6IGZhbHNlfSkuZG9uZSgoc2VsZWN0b3IpID0+IHtcblxuXHRcdFx0XHRcdHRoaXMuc2V0UGFyZW50KHRhYik7XG5cblx0XHRcdFx0XHR0aGlzLl9fcmVuZGVyKHJlc3VsdCwgc2VsZWN0b3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy5fX3JlbmRlcihyZXN1bHQsIHNlbGVjdG9yKTtcblx0XHR9XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfX3JlbmRlcjogZnVuY3Rpb24ocmVzdWx0LCBzZWxlY3Rvcilcblx0e1xuXHRcdHRoaXMucmVwbGFjZUhUTUwoc2VsZWN0b3IsIHRoaXMuZnJhZ21lbnRTaW1wbGVTZWFyY2gsIHtkaWN0OiB0aGlzLmN0eH0pLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNFOEYxNTJCMF82NkM2XzEzMkNfMDE1NV85NTVEMzY2NTRDMTMnKSkuc3VibWl0KChlKSA9PiB7XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gJCh0aGlzLnBhdGNoSWQoJyNGOEQ4QzJGQl84MUQ5X0Y3QTBfMTIxQl82RkIyOTQ5RjhEQjYnKSkudmFsKCkudHJpbSgpO1xuXG5cdFx0XHRcdGlmKHZhbHVlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGhpcy5zZWFyY2godmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLmN0eC5jb250ZXh0KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRzZWFyY2g6IGZ1bmN0aW9uKHZhbHVlKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5jcmVhdGVDb250cm9sSW5Db250YWluZXIodGhpcy5nZXRQYXJlbnQoKSwgdGhpcywgJ3RhYmxlJywgW3RoaXMuY3R4LnNlYXJjaENvbW1hbmRGdW5jKHRoaXMuY3R4LmNhdGFsb2csIHRoaXMuY3R4LmVudGl0eSwgdGhpcy5jdHguZmllbGRzLCB2YWx1ZSldLCB7fSwgdGhpcy5jdHgsICd0YWJsZScsIHRoaXMuY3R4LmVudGl0eSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiJdfQ==
