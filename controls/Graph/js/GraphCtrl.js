/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 *
 * @global Viz, saveAs
 *
 */$AMIClass("GraphCtrl",{$extends:ami.Control,$init:function $init(parent,owner){this.$super.$init(parent,owner)},onReady:function onReady(){var _this=this;return amiWebApp.loadResources([amiWebApp.originURL+"/controls/Graph/twig/GraphCtrl.twig",amiWebApp.originURL+"/controls/Graph/twig/graph.twig",amiWebApp.originURL+"/js/3rd-party/viz.min.js",amiWebApp.originURL+"/css/ami.min.css",amiWebApp.originURL+"/css/font-awesome.min.css"],{context:this}).done(function(data){_this.fragmentGraphCtrl=data[0];_this.fragmentGraph=data[1]})},render:function render(selector,command,settings){var _this2=this;var result=$.Deferred();var _amiWebApp$setup=amiWebApp.setup(["context","mode"],[result,"dot"],settings);context=_amiWebApp$setup[0];this.mode=_amiWebApp$setup[1];amiCommand.execute(command).done(function(data){if(_this2.mode==="dot"){_this2.dotString=amiWebApp.jspath("..rowset{.@type===\"graph\"}.row.field{.@name===\"dot\"}.$",data)[0]||""}else{_this2.dotString=_this2.jsonToDot(data)}_this2.replaceHTML(selector,_this2.fragmentGraphCtrl).done(function(){$(_this2.patchId("#A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15")).change(function(e){e.preventDefault();_this2.switchDirection()});$(_this2.patchId("#E90168C4_E4BD_ACC8_085F_9953D6CF789F")).click(function(e){e.preventDefault();_this2.exportSVG()});$(_this2.patchId("#D68E49F9_A0C7_C15D_8323_8BA215856428")).click(function(e){e.preventDefault();_this2.exportPNG()});_this2.display().done(function(){result.resolveWith(context,[data])})})}).fail(function(data){result.rejectWith(context,[data])});return result.promise()},display:function display(){var _this3=this;amiWebApp.lock();var result=$.Deferred();this.graph=typeof Viz!=="undefined"?Viz(this.dotString,"svg"):"";this.graph=this.graph.replace(/xlink:href="([^"]*)"/g,function(x,json){var jsonbObj=JSON.parse(amiWebApp.htmlToText(json));var attrs=["data-ctrl=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl"])+"\"","data-ctrl-location=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl-location"])+"\"","data-params=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-params"]))+"\"","data-settings=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-settings"]))+"\"","data-icon=\""+amiWebApp.textToHtml(jsonbObj["data-icon"])+"\"","data-title=\""+amiWebApp.textToHtml(jsonbObj["data-title"])+"\"","data-title-icon=\""+amiWebApp.textToHtml(jsonbObj["data-title-icon"])+"\""];return"xlink:href=\"#\" "+attrs.join(" ")});var doc=new DOMParser().parseFromString(this.graph,"image/svg+xml");var svg=$(doc.documentElement);svg.find("a[data-title-icon]").each(function(i,el){$("<tspan font-family=\"FontAwesome\">"+String.fromCharCode("0x"+$(el).attr("data-title-icon"))+"</tspan><tspan> </tspan>").prependTo($(el).find("text"))});this.graph=doc.documentElement.outerHTML;var dict={graph:this.graph};this.replaceHTML(this.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487"),this.fragmentGraph,{dict:dict}).done(function(){$(_this3.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487")+" a[data-ctrl]").click(function(e){e.preventDefault();_this3.createControlFromWebLink(_this3.getParent(),e.currentTarget,_this3.ctx)});amiWebApp.unlock();result.resolveWith(_this3,[result])});return result.promise()},switchDirection:function switchDirection(){var regex=new RegExp("(.*s*rankdirs*=s*\")([L][R]|[T][B])(\"s*.*)");var direction=this.dotString.match(regex)[2];if(direction==="LR"){this.dotString=this.dotString.replace(regex,"$1TB$3")}else if(direction==="TB"){this.dotString=this.dotString.replace(regex,"$1LR$3")}this.display()},exportSVG:function exportSVG(){var blob=new Blob([this.graph],{type:"image/svg+xml",endings:"native"});saveAs(blob,"graph.svg")},exportPNG:function exportPNG(){Viz.svgXmlToPngBase64(this.graph,1,this._exportPNG)},_exportPNG:function _exportPNG(err,data){var binary_string=window.atob(data);var len=binary_string.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary_string.charCodeAt(i)}var blob=new Blob([bytes.buffer],{type:"image/png",endings:"native"});saveAs(blob,"graph.png")},jsonToDot:function jsonToDot(json){var dot;var nodes=amiWebApp.jspath("..rowset{.@type===\"nodes\"}.row",json)[0]||"";var edges=amiWebApp.jspath("..rowset{.@type===\"edge\"}.row",json)[0]||"";dot+="digraph \"provenance\" {graph [rankdir=\"LR\", ranksep=\"0.20\"]; node [width=\"7.5em\",height=\"0.3em\", fontcolor=\"#004bffff\", fontname=\"Arial\", fontsize=\"10.0\"];";[].concat(nodes).forEach(function(node,idx){dot+="\""+(amiWebApp.jspath("..field{.@name===\"LABEL\"}.$",row)[0]||"")+"\" "+"[ "+"color=\""+(amiWebApp.jspath("..field{.@name===\"COLOUR\"}.$",row)[0]||"")+"\", "+"label=\""+(amiWebApp.jspath("..field{.@name===\"LABEL\"}.$",row)[0]||"")+"\" ";if((amiWebApp.jspath("..field{.@name===\"URL\"}.$",row)[0]||"")!==""){dot+=", URL=\""+getURL(node)+"\" "}dot+="]"});[].concat(edges).forEach(function(edge,idx){dot+="\""+(amiWebApp.jspath("..field{.@name===\"SOURCE\"}.$",row)[0]||"")+"\" "+"-> "+"\""+(amiWebApp.jspath("..field{.@name===\"DESTINATION\"}.$",row)[0]||"")+"\" "});return dot}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdyYXBoQ3RybC5lczYuanMiXSwibmFtZXMiOlsiJEFNSUNsYXNzIiwiJGV4dGVuZHMiLCJhbWkiLCJDb250cm9sIiwiJGluaXQiLCJwYXJlbnQiLCJvd25lciIsIiRzdXBlciIsIm9uUmVhZHkiLCJhbWlXZWJBcHAiLCJsb2FkUmVzb3VyY2VzIiwib3JpZ2luVVJMIiwiY29udGV4dCIsImRvbmUiLCJkYXRhIiwiZnJhZ21lbnRHcmFwaEN0cmwiLCJmcmFnbWVudEdyYXBoIiwicmVuZGVyIiwic2VsZWN0b3IiLCJjb21tYW5kIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJzZXR1cCIsIm1vZGUiLCJhbWlDb21tYW5kIiwiZXhlY3V0ZSIsImRvdFN0cmluZyIsImpzcGF0aCIsImpzb25Ub0RvdCIsInJlcGxhY2VIVE1MIiwicGF0Y2hJZCIsImNoYW5nZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInN3aXRjaERpcmVjdGlvbiIsImNsaWNrIiwiZXhwb3J0U1ZHIiwiZXhwb3J0UE5HIiwiZGlzcGxheSIsInJlc29sdmVXaXRoIiwiZmFpbCIsInJlamVjdFdpdGgiLCJwcm9taXNlIiwibG9jayIsImdyYXBoIiwiVml6IiwicmVwbGFjZSIsIngiLCJqc29uIiwianNvbmJPYmoiLCJKU09OIiwicGFyc2UiLCJodG1sVG9UZXh0IiwiYXR0cnMiLCJ0ZXh0VG9IdG1sIiwic3RyaW5naWZ5Iiwiam9pbiIsImRvYyIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInN2ZyIsImRvY3VtZW50RWxlbWVudCIsImZpbmQiLCJlYWNoIiwiaSIsImVsIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiYXR0ciIsInByZXBlbmRUbyIsIm91dGVySFRNTCIsImRpY3QiLCJjcmVhdGVDb250cm9sRnJvbVdlYkxpbmsiLCJnZXRQYXJlbnQiLCJjdXJyZW50VGFyZ2V0IiwiY3R4IiwidW5sb2NrIiwicmVnZXgiLCJSZWdFeHAiLCJkaXJlY3Rpb24iLCJtYXRjaCIsImJsb2IiLCJCbG9iIiwidHlwZSIsImVuZGluZ3MiLCJzYXZlQXMiLCJzdmdYbWxUb1BuZ0Jhc2U2NCIsIl9leHBvcnRQTkciLCJlcnIiLCJiaW5hcnlfc3RyaW5nIiwid2luZG93IiwiYXRvYiIsImxlbiIsImxlbmd0aCIsImJ5dGVzIiwiVWludDhBcnJheSIsImNoYXJDb2RlQXQiLCJidWZmZXIiLCJkb3QiLCJub2RlcyIsImVkZ2VzIiwiZm9yRWFjaCIsIm5vZGUiLCJpZHgiLCJyb3ciLCJnZXRVUkwiLCJlZGdlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0dBZ0JBQSxTQUFTLENBQUMsV0FBRCxDQUFjLENBR3RCQyxRQUFRLENBQUVDLEdBQUcsQ0FBQ0MsT0FIUSxDQU90QkMsS0FBSyxDQUFFLGVBQVNDLE1BQVQsQ0FBaUJDLEtBQWpCLENBQ1AsQ0FDQyxLQUFLQyxNQUFMLENBQVlILEtBQVosQ0FBa0JDLE1BQWxCLENBQTBCQyxLQUExQixDQUNBLENBVnFCLENBY3RCRSxPQUFPLENBQUUsa0JBQ1QsZ0JBQ0MsTUFBT0MsQ0FBQUEsU0FBUyxDQUFDQyxhQUFWLENBQXdCLENBQzlCRCxTQUFTLENBQUNFLFNBQVYsQ0FBc0IscUNBRFEsQ0FFOUJGLFNBQVMsQ0FBQ0UsU0FBVixDQUFzQixpQ0FGUSxDQUc5QkYsU0FBUyxDQUFDRSxTQUFWLENBQXNCLDBCQUhRLENBSTlCRixTQUFTLENBQUNFLFNBQVYsQ0FBc0Isa0JBSlEsQ0FLOUJGLFNBQVMsQ0FBQ0UsU0FBVixDQUFzQiwyQkFMUSxDQUF4QixDQU1KLENBQUNDLE9BQU8sQ0FBRSxJQUFWLENBTkksRUFNYUMsSUFOYixDQU1rQixTQUFDQyxJQUFELENBQVUsQ0FFbEMsS0FBSSxDQUFDQyxpQkFBTCxDQUF5QkQsSUFBSSxDQUFDLENBQUQsQ0FBN0IsQ0FDQSxLQUFJLENBQUNFLGFBQUwsQ0FBcUJGLElBQUksQ0FBQyxDQUFELENBQ3pCLENBVk0sQ0FXUCxDQTNCcUIsQ0ErQm5CRyxNQUFNLENBQUUsZ0JBQVNDLFFBQVQsQ0FBbUJD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b0IsTUFBVixDQUFpQiw2QkFBakIsQ0FBOEM2RSxHQUE5QyxFQUFtRCxDQUFuRCxHQUF5RCxFQUExRCxJQUFrRSxFQUFyRSxDQUNBLENBQ0NOLEdBQUcsRUFBSSxXQUFZTyxNQUFNLENBQUNILElBQUQsQ0FBbEIsQ0FBMkIsS0FDbEMsQ0FDRkosR0FBRyxFQUFJLEdBQ1AsQ0FYSixFQWVHLFVBQUlFLEtBQUosRUFBV0MsT0FBWCxDQUFtQixTQUFDSyxJQUFELENBQU1ILEdBQU4sQ0FBYyxDQUNuQ0wsR0FBRyxFQUFJLE1BQU8zRixTQUFTLENBQUNvQixNQUFWLENBQWlCLGdDQUFqQixDQUFpRDZFLEdBQWpELEVBQXNELENBQXRELEdBQTRELEVBQW5FLEVBQXlFLEtBQXpFLENBQ0gsS0FERyxDQUVILElBRkcsRUFFSWpHLFNBQVMsQ0FBQ29CLE1BQVYsQ0FBaUIscUNBQWpCLENBQXNENkUsR0FBdEQsRUFBMkQsQ0FBM0QsR0FBaUUsRUFGckUsRUFFMkUsS0FDbEYsQ0FKRSxFQVFBLE1BQU9OLENBQUFBLEdBQ1AsQ0EzUmtCLENBQWQsQ0FBVCIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQU1JIFdlYiBGcmFtZXdvcmtcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtWFhYWCBUaGUgQU1JIFRlYW0gLyBMUFNDIC8gSU4yUDNcbiAqXG4gKiBUaGlzIGZpbGUgbXVzdCBiZSB1c2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgQ2VDSUxMLUM6XG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZW4uaHRtbFxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWZyLmh0bWxcbiAqXG4gKlxuICogQGdsb2JhbCBWaXosIHNhdmVBc1xuICpcbiAqL1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuJEFNSUNsYXNzKCdHcmFwaEN0cmwnLCB7XG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0JGV4dGVuZHM6IGFtaS5Db250cm9sLFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0JGluaXQ6IGZ1bmN0aW9uKHBhcmVudCwgb3duZXIpXG5cdHtcblx0XHR0aGlzLiRzdXBlci4kaW5pdChwYXJlbnQsIG93bmVyKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdG9uUmVhZHk6IGZ1bmN0aW9uKClcblx0e1xuXHRcdHJldHVybiBhbWlXZWJBcHAubG9hZFJlc291cmNlcyhbXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jb250cm9scy9HcmFwaC90d2lnL0dyYXBoQ3RybC50d2lnJyxcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2NvbnRyb2xzL0dyYXBoL3R3aWcvZ3JhcGgudHdpZycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9qcy8zcmQtcGFydHkvdml6Lm1pbi5qcycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jc3MvYW1pLm1pbi5jc3MnLFxuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY3NzL2ZvbnQtYXdlc29tZS5taW4uY3NzJyxcblx0XHRdLCB7Y29udGV4dDogdGhpc30pLmRvbmUoKGRhdGEpID0+IHtcblxuXHRcdFx0dGhpcy5mcmFnbWVudEdyYXBoQ3RybCA9IGRhdGFbMF07XG5cdFx0XHR0aGlzLmZyYWdtZW50R3JhcGggPSBkYXRhWzFdO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uKHNlbGVjdG9yLCBjb21tYW5kLCBzZXR0aW5ncylcbiAgICB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gJC5EZWZlcnJlZCgpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0W2NvbnRleHQsIHRoaXMubW9kZV0gPSBhbWlXZWJBcHAuc2V0dXAoWydjb250ZXh0JywgJ21vZGUnXSwgW3Jlc3VsdCwgJ2RvdCddLCBzZXR0aW5ncyk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRhbWlDb21tYW5kLmV4ZWN1dGUoY29tbWFuZCkuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0aWYodGhpcy5tb2RlID09PSAnZG90Jylcblx0XHRcdHtcblx0XHRcdFx0dGhpcy5kb3RTdHJpbmcgPSBhbWlXZWJBcHAuanNwYXRoKCcuLnJvd3NldHsuQHR5cGU9PT1cImdyYXBoXCJ9LnJvdy5maWVsZHsuQG5hbWU9PT1cImRvdFwifS4kJywgZGF0YSlbMF0gfHwgJyc7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdHRoaXMuZG90U3RyaW5nID0gdGhpcy5qc29uVG9Eb3QoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHR0aGlzLnJlcGxhY2VIVE1MKHNlbGVjdG9yLCB0aGlzLmZyYWdtZW50R3JhcGhDdHJsKS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdCQodGhpcy5wYXRjaElkKCcjQThFN0M4OERfN0I3OF9CMjIxXzBCQ0JfNkVGMUY5Q0MzQzE1JykpLmNoYW5nZSgoZSkgPT4ge1xuXG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0dGhpcy5zd2l0Y2hEaXJlY3Rpb24oKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHQkKHRoaXMucGF0Y2hJZCgnI0U5MDE2OEM0X0U0QkRfQUNDOF8wODVGXzk5NTNENkNGNzg5RicpKS5jbGljaygoZSkgPT4ge1xuXG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0dGhpcy5leHBvcnRTVkcoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNENjhFNDlGOV9BMEM3X0MxNURfODMyM184QkEyMTU4NTY0MjgnKSkuY2xpY2soKGUpID0+IHtcblxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdHRoaXMuZXhwb3J0UE5HKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0dGhpcy5kaXNwbGF5KCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0XHRyZXN1bHQucmVzb2x2ZVdpdGgoY29udGV4dCwgW2RhdGFdKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH0pO1xuXG5cdFx0fSkuZmFpbCgoZGF0YSkgPT4ge1xuXG5cdFx0XHRyZXN1bHQucmVqZWN0V2l0aChjb250ZXh0LCBbZGF0YV0pO1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0cmV0dXJuIHJlc3VsdC5wcm9taXNlKCk7XG5cbiAgICB9LFxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgZGlzcGxheTogZnVuY3Rpb24oKVxuICAgIHtcblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRhbWlXZWJBcHAubG9jaygpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAgICAgdGhpcy5ncmFwaCA9IHR5cGVvZiBWaXogIT09ICd1bmRlZmluZWQnID8gVml6KHRoaXMuZG90U3RyaW5nLCAnc3ZnJykgOiAnJztcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHQvKiBHUkFQSCBQT1NUIFRSRUFUTUVOVCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0dGhpcy5ncmFwaCA9IHRoaXMuZ3JhcGgucmVwbGFjZSgveGxpbms6aHJlZj1cIihbXlwiXSopXCIvZywgKHgsIGpzb24pID0+IHtcblxuXHRcdFx0Y29uc3QganNvbmJPYmogPSBKU09OLnBhcnNlKGFtaVdlYkFwcC5odG1sVG9UZXh0KGpzb24pKTtcblxuXHRcdFx0Y29uc3QgYXR0cnMgPSBbXG5cdFx0XHRcdCdkYXRhLWN0cmw9XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoanNvbmJPYmpbJ2RhdGEtY3RybCddKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLWN0cmwtbG9jYXRpb249XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoanNvbmJPYmpbJ2RhdGEtY3RybC1sb2NhdGlvbiddKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLXBhcmFtcz1cIicgKyBhbWlXZWJBcHAudGV4dFRvSHRtbChKU09OLnN0cmluZ2lmeShqc29uYk9ialsnZGF0YS1wYXJhbXMnXSkpICsgJ1wiJyxcblx0XHRcdFx0J2RhdGEtc2V0dGluZ3M9XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoSlNPTi5zdHJpbmdpZnkoanNvbmJPYmpbJ2RhdGEtc2V0dGluZ3MnXSkpICsgJ1wiJyxcblx0XHRcdFx0J2RhdGEtaWNvbj1cIicgKyBhbWlXZWJBcHAudGV4dFRvSHRtbChqc29uYk9ialsnZGF0YS1pY29uJ10pICsgJ1wiJyxcblx0XHRcdFx0J2RhdGEtdGl0bGU9XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoanNvbmJPYmpbJ2RhdGEtdGl0bGUnXSkgKyAnXCInLFxuXHRcdFx0XHQnZGF0YS10aXRsZS1pY29uPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLXRpdGxlLWljb24nXSkgKyAnXCInLFxuXHRcdFx0XTtcblxuXHRcdFx0cmV0dXJuICd4bGluazpocmVmPVwiI1wiICcgKyBhdHRycy5qb2luKCcgJyk7XG5cdFx0fSk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcodGhpcy5ncmFwaCwgJ2ltYWdlL3N2Zyt4bWwnKTtcblxuXHRcdGNvbnN0IHN2ZyA9ICQoZG9jLmRvY3VtZW50RWxlbWVudCk7XG5cblx0XHRzdmcuZmluZCgnYVtkYXRhLXRpdGxlLWljb25dJykuZWFjaCgoaSwgZWwpID0+IHtcblxuXHRcdFx0JCgnPHRzcGFuIGZvbnQtZmFtaWx5PVwiRm9udEF3ZXNvbWVcIj4nICsgU3RyaW5nLmZyb21DaGFyQ29kZSgnMHgnICsgJChlbCkuYXR0cignZGF0YS10aXRsZS1pY29uJykpICsgJzwvdHNwYW4+PHRzcGFuPiA8L3RzcGFuPicpLnByZXBlbmRUbygkKGVsKS5maW5kKCd0ZXh0JykpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5ncmFwaCA9IGRvYy5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MO1xuXG4gICAgICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IGRpY3QgPSB7XG5cdFx0XHRncmFwaCA6IHRoaXMuZ3JhcGgsXG5cdFx0fTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0dGhpcy5yZXBsYWNlSFRNTCh0aGlzLnBhdGNoSWQoJyNBMEY2NzYzRl9ERTI5XzUxODVfMzVDMV9EQ0FBODFFOEM0ODcnKSwgdGhpcy5mcmFnbWVudEdyYXBoLCB7ZGljdDogZGljdH0pLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHQkKHRoaXMucGF0Y2hJZCgnI0EwRjY3NjNGX0RFMjlfNTE4NV8zNUMxX0RDQUE4MUU4QzQ4NycpICsgJyBhW2RhdGEtY3RybF0nKS5jbGljaygoZSkgPT4ge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHR0aGlzLmNyZWF0ZUNvbnRyb2xGcm9tV2ViTGluayh0aGlzLmdldFBhcmVudCgpLCBlLmN1cnJlbnRUYXJnZXQsIHRoaXMuY3R4KTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0YW1pV2ViQXBwLnVubG9jaygpO1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKHRoaXMsIFtyZXN1bHRdKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXN1bHQucHJvbWlzZSgpO1xuICAgIH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRzd2l0Y2hEaXJlY3Rpb246IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgIFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgIFx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCcoLipcXHMqcmFua2Rpclxccyo9XFxzKlwiKShbTF1bUl18W1RdW0JdKShcIlxccyouKiknKTtcblxuICAgICBcdGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZG90U3RyaW5nLm1hdGNoKHJlZ2V4KVsyXTtcblxuICAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgICBcdGlmKGRpcmVjdGlvbiA9PT0gJ0xSJyApXG4gICAgIFx0e1xuICAgICBcdFx0dGhpcy5kb3RTdHJpbmcgPSB0aGlzLmRvdFN0cmluZy5yZXBsYWNlKHJlZ2V4LCAnJDFUQiQzJyk7XG4gICAgIFx0fVxuICAgICBcdGVsc2UgaWYoZGlyZWN0aW9uID09PSAnVEInIClcbiAgICAgXHR7XG5cdFx0XHR0aGlzLmRvdFN0cmluZyA9IHRoaXMuZG90U3RyaW5nLnJlcGxhY2UocmVnZXgsICckMUxSJDMnKTtcbiAgICAgXHR9XG5cblx0XHR0aGlzLmRpc3BsYXkoKTtcbiAgICB9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0ZXhwb3J0U1ZHOiBmdW5jdGlvbigpXG5cdHtcblx0XHRjb25zdCBibG9iID0gbmV3IEJsb2IoW3RoaXMuZ3JhcGhdLCB7XG5cdFx0XHR0eXBlOiAnaW1hZ2Uvc3ZnK3htbCcsXG5cdFx0XHRlbmRpbmdzIDogJ25hdGl2ZScsXG5cdFx0fSk7XG5cblx0XHRzYXZlQXMoYmxvYiwgJ2dyYXBoLnN2ZycpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0ZXhwb3J0UE5HOiBmdW5jdGlvbigpXG5cdHtcblx0XHRWaXouc3ZnWG1sVG9QbmdCYXNlNjQodGhpcy5ncmFwaCwgMSwgdGhpcy5fZXhwb3J0UE5HKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdF9leHBvcnRQTkc6IGZ1bmN0aW9uKGVyciwgZGF0YSlcbiAgICB7XG5cdFx0bGV0IGJpbmFyeV9zdHJpbmcgPSB3aW5kb3cuYXRvYihkYXRhKTtcblx0XHRsZXQgbGVuID0gYmluYXJ5X3N0cmluZy5sZW5ndGg7XG5cdFx0bGV0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuKTtcblxuXHRcdGZvcihsZXQgaSA9IDA7IGkgPCBsZW47IGkrKylcblx0XHR7XG5cdFx0XHRieXRlc1tpXSA9IGJpbmFyeV9zdHJpbmcuY2hhckNvZGVBdChpKTtcblx0XHR9XG5cblx0XHRjb25zdCBibG9iID0gbmV3IEJsb2IoW2J5dGVzLmJ1ZmZlcl0sIHtcblx0XHRcdHR5cGU6ICdpbWFnZS9wbmcnLFxuXHRcdFx0ZW5kaW5ncyA6ICduYXRpdmUnLFxuXHRcdH0pO1xuXG5cdFx0c2F2ZUFzKGJsb2IsICdncmFwaC5wbmcnKTtcblx0fSxcblxuXHRqc29uVG9Eb3Q6IGZ1bmN0aW9uKGpzb24pXG4gICAge1xuICAgIFx0bGV0IGRvdDtcblxuXHRcdGxldCBub2RlcyA9IGFtaVdlYkFwcC5qc3BhdGgoJy4ucm93c2V0ey5AdHlwZT09PVwibm9kZXNcIn0ucm93JywganNvbilbMF0gfHwgJyc7XG5cdFx0bGV0IGVkZ2VzID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5yb3dzZXR7LkB0eXBlPT09XCJlZGdlXCJ9LnJvdycsIGpzb24pWzBdIHx8ICcnO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgXHRkb3QgKz0gJ2RpZ3JhcGggXCJwcm92ZW5hbmNlXCIge2dyYXBoIFtyYW5rZGlyPVwiTFJcIiwgcmFua3NlcD1cIjAuMjBcIl07IG5vZGUgW3dpZHRoPVwiNy41ZW1cIixoZWlnaHQ9XCIwLjNlbVwiLCBmb250Y29sb3I9XCIjMDA0YmZmZmZcIiwgZm9udG5hbWU9XCJBcmlhbFwiLCBmb250c2l6ZT1cIjEwLjBcIl07JztcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFsuLi5ub2Rlc10uZm9yRWFjaCgobm9kZSxpZHgpID0+IHtcbiAgICBcdFx0ZG90ICs9ICdcIicgKyAoYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cIkxBQkVMXCJ9LiQnLCByb3cpWzBdIHx8ICcnKSArICdcIiAnXG4gICAgXHRcdFx0KyAnWyAnXG4gICAgXHRcdFx0KyAnY29sb3I9XCInICsgKGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJDT0xPVVJcIn0uJCcsIHJvdylbMF0gfHwgJycpICsgJ1wiLCAnXG4gICAgXHRcdFx0KyAnbGFiZWw9XCInICsgKGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJMQUJFTFwifS4kJywgcm93KVswXSB8fCAnJykgKyAnXCIgJztcblxuICAgIFx0XHRcdGlmKChhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiVVJMXCJ9LiQnLCByb3cpWzBdIHx8ICcnKSAhPT0gJycpXG4gICAgXHRcdFx0e1xuICAgIFx0XHRcdFx0ZG90XHQrPSAnLCBVUkw9XCInICsgZ2V0VVJMKG5vZGUpICsgJ1wiICc7XG4gICAgXHRcdFx0fVxuICAgIFx0XHRkb3QgKz0gJ10nO1xuICAgIFx0fSk7XG5cbiAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIFx0Wy4uLmVkZ2VzXS5mb3JFYWNoKChlZGdlLGlkeCkgPT4ge1xuXHRcdFx0ZG90ICs9ICdcIicgKyAoYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cIlNPVVJDRVwifS4kJywgcm93KVswXSB8fCAnJykgKyAnXCIgJ1xuXHRcdFx0XHQgKyAnLT4gJ1xuXHRcdFx0XHQgKyAnXCInICsgKGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJERVNUSU5BVElPTlwifS4kJywgcm93KVswXSB8fCAnJykgKyAnXCIgJ1xuXHRcdH0pO1xuXG4gICAgXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICBcdHJldHVybiBkb3Q7XG4gICAgfSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLyJdfQ==
