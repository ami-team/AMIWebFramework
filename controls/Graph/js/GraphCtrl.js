/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 *
 * @global Viz, saveAs
 *
 */$AMIClass("GraphCtrl",{$extends:ami.Control,$init:function $init(parent,owner){this.$super.$init(parent,owner)},onReady:function onReady(){var _this=this;return amiWebApp.loadResources([amiWebApp.originURL+"/controls/Graph/twig/GraphCtrl.twig",amiWebApp.originURL+"/controls/Graph/twig/graph.twig",amiWebApp.originURL+"/js/3rd-party/viz.min.js",amiWebApp.originURL+"/css/ami.min.css",amiWebApp.originURL+"/css/font-awesome.min.css"],{context:this}).done(function(data){_this.fragmentGraphCtrl=data[0];_this.fragmentGraph=data[1]})},render:function render(selector,command,settings){var _this2=this;var result=$.Deferred();var _amiWebApp$setup=amiWebApp.setup(["context"],[result],settings),context=_amiWebApp$setup[0];amiCommand.execute(command).done(function(data){_this2.dotString=amiWebApp.jspath("..rowset{.@type===\"graph\"}.row.field{.@name===\"dot\"}.$",data)[0]||"";_this2.replaceHTML(selector,_this2.fragmentGraphCtrl).done(function(){$(_this2.patchId("#A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15")).change(function(e){e.preventDefault();_this2.switchDirection()});$(_this2.patchId("#E90168C4_E4BD_ACC8_085F_9953D6CF789F")).click(function(e){e.preventDefault();_this2.exportGraph()});_this2.display().done(function(){result.resolveWith(context,[data])})})}).fail(function(data){result.rejectWith(context,[data])});return result.promise()},display:function display(){var _this3=this;var result=$.Deferred();this.graph=typeof Viz!=="undefined"?Viz(this.dotString,"svg"):"";this.graph=this.graph.replace(/xlink:href="([^"]*)"/g,function(x,json){var jsonbObj=JSON.parse(amiWebApp.htmlToText(json));var attrs=["data-ctrl=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl"])+"\"","data-ctrl-location=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl-location"])+"\"","data-params=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-params"]))+"\"","data-settings=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-settings"]))+"\"","data-icon=\""+amiWebApp.textToHtml(jsonbObj["data-icon"])+"\"","data-title=\""+amiWebApp.textToHtml(jsonbObj["data-title"])+"\"","data-title-icon=\""+amiWebApp.textToHtml(jsonbObj["data-title-icon"])+"\""];return"xlink:href=\"#\" "+attrs.join(" ")});var doc=new DOMParser().parseFromString(this.graph,"image/svg+xml");var svg=$(doc.documentElement);svg.find("a[data-title-icon]").each(function(i,el){$("<tspan font-family=\"FontAwesome\">"+String.fromCharCode("0x"+$(el).attr("data-title-icon"))+"</tspan><tspan> </tspan>").prependTo($(el).find("text"))});this.graph=doc.documentElement.outerHTML;var dict={graph:this.graph};this.replaceHTML(this.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487"),this.fragmentGraph,{dict:dict}).done(function(){$(_this3.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487")+" a[data-ctrl]").click(function(e){e.preventDefault();_this3.createControlFromWebLink(_this3.getParent(),e.currentTarget,_this3.ctx)});result.resolveWith(_this3,[result])});return result.promise()},switchDirection:function switchDirection(){var _this4=this;var result=$.Deferred();var regex=new RegExp("(.*s*rankdirs*=s*\")([L][R]|[T][B])(\"s*.*)");var direction=this.dotString.match(regex)[2];if(direction==="LR"){this.dotString=this.dotString.replace(regex,"$1TB$3")}else if(direction==="TB"){this.dotString=this.dotString.replace(regex,"$1LR$3")}this.display().done(function(){result.resolveWith(_this4,[result])});return result.promise()},exportGraph:function exportGraph(){var blob=new Blob([this.graph],{type:"image/svg+xml",endings:"native"});saveAs(blob,"graph.svg")}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdyYXBoQ3RybC5lczYuanMiXSwibmFtZXMiOlsiJEFNSUNsYXNzIiwiJGV4dGVuZHMiLCJhbWkiLCJDb250cm9sIiwiJGluaXQiLCJwYXJlbnQiLCJvd25lciIsIiRzdXBlciIsIm9uUmVhZHkiLCJhbWlXZWJBcHAiLCJsb2FkUmVzb3VyY2VzIiwib3JpZ2luVVJMIiwiY29udGV4dCIsImRvbmUiLCJkYXRhIiwiZnJhZ21lbnRHcmFwaEN0cmwiLCJmcmFnbWVudEdyYXBoIiwicmVuZGVyIiwic2VsZWN0b3IiLCJjb21tYW5kIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJzZXR1cCIsImFtaUNvbW1hbmQiLCJleGVjdXRlIiwiZG90U3RyaW5nIiwianNwYXRoIiwicmVwbGFjZUhUTUwiLCJwYXRjaElkIiwiY2hhbmdlIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic3dpdGNoRGlyZWN0aW9uIiwiY2xpY2siLCJleHBvcnRHcmFwaCIsImRpc3BsYXkiLCJyZXNvbHZlV2l0aCIsImZhaWwiLCJyZWplY3RXaXRoIiwicHJvbWlzZSIsImdyYXBoIiwiVml6IiwicmVwbGFjZSIsIngiLCJqc29uIiwianNvbmJPYmoiLCJKU09OIiwicGFyc2UiLCJodG1sVG9UZXh0IiwiYXR0cnMiLCJ0ZXh0VG9IdG1sIiwic3RyaW5naWZ5Iiwiam9pbiIsImRvYyIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInN2ZyIsImRvY3VtZW50RWxlbWVudCIsImZpbmQiLCJlYWNoIiwiaSIsImVsIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiYXR0ciIsInByZXBlbmRUbyIsIm91dGVySFRNTCIsImRpY3QiLCJjcmVhdGVDb250cm9sRnJvbVdlYkxpbmsiLCJnZXRQYXJlbnQiLCJjdXJyZW50VGFyZ2V0IiwiY3R4IiwicmVnZXgiLCJSZWdFeHAiLCJkaXJlY3Rpb24iLCJtYXRjaCIsImJsb2IiLCJCbG9iIiwidHlwZSIsImVuZGluZ3MiLCJzYXZlQXMiXSwi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LENBQWIsQ0FLQUMsTUFBTSxDQUFDSixJQUFELENBQU8sV0FBUCxDQUNOLENBL0xxQixDQUFkLENBQVQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFNSSBXZWIgRnJhbWV3b3JrXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LVhYWFggVGhlIEFNSSBUZWFtIC8gTFBTQyAvIElOMlAzXG4gKlxuICogVGhpcyBmaWxlIG11c3QgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIENlQ0lMTC1DOlxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWVuLmh0bWxcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1mci5odG1sXG4gKlxuICpcbiAqIEBnbG9iYWwgVml6LCBzYXZlQXNcbiAqXG4gKi9cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiRBTUlDbGFzcygnR3JhcGhDdHJsJywge1xuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRleHRlbmRzOiBhbWkuQ29udHJvbCxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRpbml0OiBmdW5jdGlvbihwYXJlbnQsIG93bmVyKVxuXHR7XG5cdFx0dGhpcy4kc3VwZXIuJGluaXQocGFyZW50LCBvd25lcik7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvblJlYWR5OiBmdW5jdGlvbigpXG5cdHtcblx0XHRyZXR1cm4gYW1pV2ViQXBwLmxvYWRSZXNvdXJjZXMoW1xuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY29udHJvbHMvR3JhcGgvdHdpZy9HcmFwaEN0cmwudHdpZycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jb250cm9scy9HcmFwaC90d2lnL2dyYXBoLnR3aWcnLFxuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvanMvM3JkLXBhcnR5L3Zpei5taW4uanMnLFxuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY3NzL2FtaS5taW4uY3NzJyxcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2Nzcy9mb250LWF3ZXNvbWUubWluLmNzcycsXG5cdFx0XSwge2NvbnRleHQ6IHRoaXN9KS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdHRoaXMuZnJhZ21lbnRHcmFwaEN0cmwgPSBkYXRhWzBdO1xuXHRcdFx0dGhpcy5mcmFnbWVudEdyYXBoID0gZGF0YVsxXTtcblx0XHR9KTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgcmVuZGVyOiBmdW5jdGlvbihzZWxlY3RvciwgY29tbWFuZCwgc2V0dGluZ3MpXG4gICAge1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IFtjb250ZXh0XSA9IGFtaVdlYkFwcC5zZXR1cChbJ2NvbnRleHQnXSwgW3Jlc3VsdF0sIHNldHRpbmdzKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGFtaUNvbW1hbmQuZXhlY3V0ZShjb21tYW5kKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdHRoaXMuZG90U3RyaW5nID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5yb3dzZXR7LkB0eXBlPT09XCJncmFwaFwifS5yb3cuZmllbGR7LkBuYW1lPT09XCJkb3RcIn0uJCcsIGRhdGEpWzBdIHx8ICcnO1xuXG5cdFx0XHR0aGlzLnJlcGxhY2VIVE1MKHNlbGVjdG9yLCB0aGlzLmZyYWdtZW50R3JhcGhDdHJsKS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdCQodGhpcy5wYXRjaElkKCcjQThFN0M4OERfN0I3OF9CMjIxXzBCQ0JfNkVGMUY5Q0MzQzE1JykpLmNoYW5nZSgoZSkgPT4ge1xuXG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0dGhpcy5zd2l0Y2hEaXJlY3Rpb24oKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHQkKHRoaXMucGF0Y2hJZCgnI0U5MDE2OEM0X0U0QkRfQUNDOF8wODVGXzk5NTNENkNGNzg5RicpKS5jbGljaygoZSkgPT4ge1xuXG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0dGhpcy5leHBvcnRHcmFwaCgpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdHRoaXMuZGlzcGxheSgpLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKGNvbnRleHQsIFtkYXRhXSk7XG5cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHRcdH0pO1xuXG5cdFx0fSkuZmFpbCgoZGF0YSkgPT4ge1xuXG5cdFx0XHRyZXN1bHQucmVqZWN0V2l0aChjb250ZXh0LCBbZGF0YV0pO1xuXHRcdH0pO1xuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHJldHVybiByZXN1bHQucHJvbWlzZSgpO1xuXG4gICAgfSxcblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIGRpc3BsYXk6IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgIHRoaXMuZ3JhcGggPSB0eXBlb2YgVml6ICE9PSAndW5kZWZpbmVkJyA/IFZpeih0aGlzLmRvdFN0cmluZywgJ3N2ZycpIDogJyc7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0LyogR1JBUEggUE9TVCBUUkVBVE1FTlQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuZ3JhcGggPSB0aGlzLmdyYXBoLnJlcGxhY2UoL3hsaW5rOmhyZWY9XCIoW15cIl0qKVwiL2csICh4LCBqc29uKSA9PiB7XG5cblx0XHRcdGNvbnN0IGpzb25iT2JqID0gSlNPTi5wYXJzZShhbWlXZWJBcHAuaHRtbFRvVGV4dChqc29uKSk7XG5cblx0XHRcdGNvbnN0IGF0dHJzID0gW1xuXHRcdFx0XHQnZGF0YS1jdHJsPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLWN0cmwnXSkgKyAnXCInLFxuXHRcdFx0XHQnZGF0YS1jdHJsLWxvY2F0aW9uPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLWN0cmwtbG9jYXRpb24nXSkgKyAnXCInLFxuXHRcdFx0XHQnZGF0YS1wYXJhbXM9XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoSlNPTi5zdHJpbmdpZnkoanNvbmJPYmpbJ2RhdGEtcGFyYW1zJ10pKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLXNldHRpbmdzPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKEpTT04uc3RyaW5naWZ5KGpzb25iT2JqWydkYXRhLXNldHRpbmdzJ10pKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLWljb249XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoanNvbmJPYmpbJ2RhdGEtaWNvbiddKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLXRpdGxlPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLXRpdGxlJ10pICsgJ1wiJyxcblx0XHRcdFx0J2RhdGEtdGl0bGUtaWNvbj1cIicgKyBhbWlXZWJBcHAudGV4dFRvSHRtbChqc29uYk9ialsnZGF0YS10aXRsZS1pY29uJ10pICsgJ1wiJyxcblx0XHRcdF07XG5cblx0XHRcdHJldHVybiAneGxpbms6aHJlZj1cIiNcIiAnICsgYXR0cnMuam9pbignICcpO1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRoaXMuZ3JhcGgsICdpbWFnZS9zdmcreG1sJyk7XG5cblx0XHRjb25zdCBzdmcgPSAkKGRvYy5kb2N1bWVudEVsZW1lbnQpO1xuXG5cdFx0c3ZnLmZpbmQoJ2FbZGF0YS10aXRsZS1pY29uXScpLmVhY2goKGksIGVsKSA9PiB7XG5cblx0XHRcdCQoJzx0c3BhbiBmb250LWZhbWlseT1cIkZvbnRBd2Vzb21lXCI+JyArIFN0cmluZy5mcm9tQ2hhckNvZGUoJzB4JyArICQoZWwpLmF0dHIoJ2RhdGEtdGl0bGUtaWNvbicpKSArICc8L3RzcGFuPjx0c3Bhbj4gPC90c3Bhbj4nKS5wcmVwZW5kVG8oJChlbCkuZmluZCgndGV4dCcpKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuZ3JhcGggPSBkb2MuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDtcblxuICAgICAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBkaWN0ID0ge1xuXHRcdFx0Z3JhcGggOiB0aGlzLmdyYXBoLFxuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMucmVwbGFjZUhUTUwodGhpcy5wYXRjaElkKCcjQTBGNjc2M0ZfREUyOV81MTg1XzM1QzFfRENBQTgxRThDNDg3JyksIHRoaXMuZnJhZ21lbnRHcmFwaCwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNBMEY2NzYzRl9ERTI5XzUxODVfMzVDMV9EQ0FBODFFOEM0ODcnKSArICcgYVtkYXRhLWN0cmxdJykuY2xpY2soKGUpID0+IHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0dGhpcy5jcmVhdGVDb250cm9sRnJvbVdlYkxpbmsodGhpcy5nZXRQYXJlbnQoKSwgZS5jdXJyZW50VGFyZ2V0LCB0aGlzLmN0eCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKHRoaXMsIFtyZXN1bHRdKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXN1bHQucHJvbWlzZSgpO1xuICAgIH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRzd2l0Y2hEaXJlY3Rpb246IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgIFx0Y29uc3QgcmVzdWx0ID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgIFx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCcoLipcXHMqcmFua2Rpclxccyo9XFxzKlwiKShbTF1bUl18W1RdW0JdKShcIlxccyouKiknKTtcblxuICAgICBcdGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZG90U3RyaW5nLm1hdGNoKHJlZ2V4KVsyXTtcblxuICAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgICBcdGlmKGRpcmVjdGlvbiA9PT0gJ0xSJyApXG4gICAgIFx0e1xuICAgICBcdFx0dGhpcy5kb3RTdHJpbmcgPSB0aGlzLmRvdFN0cmluZy5yZXBsYWNlKHJlZ2V4LCAnJDFUQiQzJyk7XG4gICAgIFx0fVxuICAgICBcdGVsc2UgaWYoZGlyZWN0aW9uID09PSAnVEInIClcbiAgICAgXHR7XG5cdFx0XHR0aGlzLmRvdFN0cmluZyA9IHRoaXMuZG90U3RyaW5nLnJlcGxhY2UocmVnZXgsICckMUxSJDMnKTtcbiAgICAgXHR9XG5cblx0XHR0aGlzLmRpc3BsYXkoKS5kb25lKCgpID0+IHtcblx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLCBbcmVzdWx0XSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmVzdWx0LnByb21pc2UoKTtcbiAgICB9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0ZXhwb3J0R3JhcGg6IGZ1bmN0aW9uKClcblx0e1xuXHRcdGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbdGhpcy5ncmFwaF0sIHtcblx0XHRcdHR5cGU6ICdpbWFnZS9zdmcreG1sJyxcblx0XHRcdGVuZGluZ3MgOiAnbmF0aXZlJyxcblx0XHR9KTtcblxuXHRcdHNhdmVBcyhibG9iLCAnZ3JhcGguc3ZnJyk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8iXX0=
