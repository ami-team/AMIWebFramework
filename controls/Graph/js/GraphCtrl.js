/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 *
 * @global Viz, saveAs
 *
 */$AMIClass("GraphCtrl",{$extends:ami.Control,$init:function $init(parent,owner){this.$super.$init(parent,owner)},onReady:function onReady(){var _this=this;return amiWebApp.loadResources([amiWebApp.originURL+"/controls/Graph/twig/GraphCtrl.twig",amiWebApp.originURL+"/controls/Graph/twig/graph.twig",amiWebApp.originURL+"/js/3rd-party/viz.min.js",amiWebApp.originURL+"/css/ami.min.css",amiWebApp.originURL+"/css/font-awesome.min.css"],{context:this}).done(function(data){_this.fragmentGraphCtrl=data[0];_this.fragmentGraph=data[1]})},render:function render(selector,command,settings){var _this2=this;var result=$.Deferred();var _amiWebApp$setup=amiWebApp.setup(["context","mode"],[result,"dot"],settings);context=_amiWebApp$setup[0];this.mode=_amiWebApp$setup[1];amiCommand.execute(command).done(function(data){if(_this2.mode==="dot"){_this2.dotString=amiWebApp.jspath("..rowset{.@type===\"graph\"}.row.field{.@name===\"dot\"}.$",data)[0]||""}else{_this2.dotString=_this2.jsonToDot(data);console.log(_this2.dotString)}_this2.replaceHTML(selector,_this2.fragmentGraphCtrl).done(function(){$(_this2.patchId("#A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15")).change(function(e){e.preventDefault();_this2.switchDirection()});$(_this2.patchId("#E90168C4_E4BD_ACC8_085F_9953D6CF789F")).click(function(e){e.preventDefault();_this2.exportSVG()});$(_this2.patchId("#D68E49F9_A0C7_C15D_8323_8BA215856428")).click(function(e){e.preventDefault();_this2.exportPNG()});_this2.display().done(function(){result.resolveWith(context,[data])})})}).fail(function(data){result.rejectWith(context,[data])});return result.promise()},display:function display(){var _this3=this;amiWebApp.lock();var result=$.Deferred();this.graph=typeof Viz!=="undefined"?Viz(this.dotString,"svg"):"";this.graph=this.graph.replace(/xlink:href="([^"]*)"/g,function(x,json){var jsonbObj=JSON.parse(amiWebApp.htmlToText(json));var attrs=["data-ctrl=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl"])+"\"","data-ctrl-location=\""+amiWebApp.textToHtml(jsonbObj["data-ctrl-location"])+"\"","data-params=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-params"]))+"\"","data-settings=\""+amiWebApp.textToHtml(JSON.stringify(jsonbObj["data-settings"]))+"\"","data-icon=\""+amiWebApp.textToHtml(jsonbObj["data-icon"])+"\"","data-title=\""+amiWebApp.textToHtml(jsonbObj["data-title"])+"\"","data-title-icon=\""+amiWebApp.textToHtml(jsonbObj["data-title-icon"])+"\""];return"xlink:href=\"#\" "+attrs.join(" ")});var doc=new DOMParser().parseFromString(this.graph,"image/svg+xml");var svg=$(doc.documentElement);svg.find("a[data-title-icon]").each(function(i,el){$("<tspan font-family=\"FontAwesome\">"+String.fromCharCode("0x"+$(el).attr("data-title-icon"))+"</tspan><tspan> </tspan>").prependTo($(el).find("text"))});this.graph=doc.documentElement.outerHTML;var dict={graph:this.graph};this.replaceHTML(this.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487"),this.fragmentGraph,{dict:dict}).done(function(){$(_this3.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487")+" a[data-ctrl]").click(function(e){e.preventDefault();_this3.createControlFromWebLink(_this3.getParent(),e.currentTarget,_this3.ctx)});amiWebApp.unlock();result.resolveWith(_this3,[result])});return result.promise()},switchDirection:function switchDirection(){var regex=new RegExp("(.*s*rankdirs*=s*\")([L][R]|[T][B])(\"s*.*)");var direction=this.dotString.match(regex)[2];if(direction==="LR"){this.dotString=this.dotString.replace(regex,"$1TB$3")}else if(direction==="TB"){this.dotString=this.dotString.replace(regex,"$1LR$3")}this.display()},exportSVG:function exportSVG(){var blob=new Blob([this.graph],{type:"image/svg+xml",endings:"native"});saveAs(blob,"graph.svg")},exportPNG:function exportPNG(){Viz.svgXmlToPngBase64(this.graph,1,this._exportPNG)},_exportPNG:function _exportPNG(err,data){var binary_string=window.atob(data);var len=binary_string.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary_string.charCodeAt(i)}var blob=new Blob([bytes.buffer],{type:"image/png",endings:"native"});saveAs(blob,"graph.png")},jsonToDot:function jsonToDot(json){var nodes=amiWebApp.jspath("..rowset{.@type===\"node\"}.row",json)[0]||"";var edges=amiWebApp.jspath("..rowset{.@type===\"edge\"}.row",json)[0]||"";var dot="digraph \"provenance\" {graph [rankdir=\"LR\", ranksep=\"0.20\"]; node [width=\"7.5em\",height=\"0.3em\", fontcolor=\"#004bffff\", fontname=\"Arial\", fontsize=\"10.0\"];";[].concat(nodes).forEach(function(node,idx){console.debug(JSON.stringify(node));dot+="\""+(amiWebApp.jspath("..field{.@name===\"LABEL\"}.$",node)[0]||"")+"\" "+"[ "+"color=\""+(amiWebApp.jspath("..field{.@name===\"COLOUR\"}.$",node)[0]||"")+"\", "+"label=\""+(amiWebApp.jspath("..field{.@name===\"LABEL\"}.$",node)[0]||"")+"\" ";var url=amiWebApp.jspath("..field{.@name===\"URL\"}.$",node)[0]||"";if(url!==""){dot+=", URL=\""+url+"\" "}dot+="]"});[].concat(edges).forEach(function(edge,idx){dot+="\""+(amiWebApp.jspath("..field{.@name===\"SOURCE\"}.$",edge)[0]||"")+"\" "+"-> "+"\""+(amiWebApp.jspath("..field{.@name===\"DESTINATION\"}.$",edge)[0]||"")+"\" "});dot+="}";return dot}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdyYXBoQ3RybC5lczYuanMiXSwibmFtZXMiOlsiJEFNSUNsYXNzIiwiJGV4dGVuZHMiLCJhbWkiLCJDb250cm9sIiwiJGluaXQiLCJwYXJlbnQiLCJvd25lciIsIiRzdXBlciIsIm9uUmVhZHkiLCJhbWlXZWJBcHAiLCJsb2FkUmVzb3VyY2VzIiwib3JpZ2luVVJMIiwiY29udGV4dCIsImRvbmUiLCJkYXRhIiwiZnJhZ21lbnRHcmFwaEN0cmwiLCJmcmFnbWVudEdyYXBoIiwicmVuZGVyIiwic2VsZWN0b3IiLCJjb21tYW5kIiwic2V0dGluZ3MiLCJyZXN1bHQiLCIkIiwiRGVmZXJyZWQiLCJzZXR1cCIsIm1vZGUiLCJhbWlDb21tYW5kIiwiZXhlY3V0ZSIsImRvdFN0cmluZyIsImpzcGF0aCIsImpzb25Ub0RvdCIsImNvbnNvbGUiLCJsb2ciLCJyZXBsYWNlSFRNTCIsInBhdGNoSWQiLCJjaGFuZ2UiLCJlIiwicHJldmVudERlZmF1bHQiLCJzd2l0Y2hEaXJlY3Rpb24iLCJjbGljayIsImV4cG9ydFNWRyIsImV4cG9ydFBORyIsImRpc3BsYXkiLCJyZXNvbHZlV2l0aCIsImZhaWwiLCJyZWplY3RXaXRoIiwicHJvbWlzZSIsImxvY2siLCJncmFwaCIsIlZpeiIsInJlcGxhY2UiLCJ4IiwianNvbiIsImpzb25iT2JqIiwiSlNPTiIsInBhcnNlIiwiaHRtbFRvVGV4dCIsImF0dHJzIiwidGV4dFRvSHRtbCIsInN0cmluZ2lmeSIsImpvaW4iLCJkb2MiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJzdmciLCJkb2N1bWVudEVsZW1lbnQiLCJmaW5kIiwiZWFjaCIsImkiLCJlbCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImF0dHIiLCJwcmVwZW5kVG8iLCJvdXRlckhUTUwiLCJkaWN0IiwiY3JlYXRlQ29udHJvbEZyb21XZWJMaW5rIiwiZ2V0UGFyZW50IiwiY3VycmVudFRhcmdldCIsImN0eCIsInVubG9jayIsInJlZ2V4IiwiUmVnRXhwIiwiZGlyZWN0aW9uIiwibWF0Y2giLCJibG9iIiwiQmxvYiIsInR5cGUiLCJlbmRpbmdzIiwic2F2ZUFzIiwic3ZnWG1sVG9QbmdCYXNlNjQiLCJfZXhwb3J0UE5HIiwiZXJyIiwiYmluYXJ5X3N0cmluZyIsIndpbmRvdyIsImF0b2IiLCJsZW4iLCJsZW5ndGgiLCJieXRlcyIsIlVpbnQ4QXJyYXkiLCJjaGFyQ29kZUF0IiwiYnVmZmVyIiwibm9kZXMiLCJlZGdlcyIsImRvdCIsImZvckVhY2giLCJub2RlIiwiaWR4IiwiZGVidWciLCJ1cmwiLCJlZGdlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0dBZ0JBQSxTQUFTLENBQUMsV0FBRCxDQUFjLENBR3RCQyxRQUFRLENBQUVDLEdBQUcsQ0FBQ0MsT0FIUSxDQU90QkMsS0FBSyxDQUFFLGVBQVNDLE1BQVQsQ0FBaUJDLEtBQWpCLENBQ1AsQ0FDQyxLQUFLQyxNQUFMLENBQVlILEtBQVosQ0FBa0JDLE1BQWxCLENBQTBCQyxLQUExQixDQUNBLENBVnFCLENBY3RCRSxPQUFPLENBQUUsa0JBQ1QsZ0JBQ0MsTUFBT0MsQ0FBQUEsU0FBUyxDQUFDQyxhQUFWLENBQXdCLENBQzlCRCxTQUFTLENBQUNFLFNBQVYsQ0FBc0IscUNBRFEsQ0FFOUJGLFNBQVMsQ0FBQ0UsU0FBVixDQUFzQixpQ0FGUSxDQUc5QkYsU0FBUyxDQUFDRSxTQUFWLENBQXNCLDBCQUhRLENBSTlCRixTQUFTLENBQUNFLFNBQVYsQ0FBc0Isa0JBSlEsQ0FLOUJGLFNBQVMsQ0FBQ0UsU0FBVixDQUFzQiwyQkFMUSxDQUF4QixDQU1KLENBQUNDLE9BQU8sQ0FBRSxJQUFWLENBTkksRUFNYUMsSUFOYixDQU1rQixTQUFDQyxJQUFELENBQVUsQ0FFbEMsS0FBSSxDQUFDQyxpQkFBTCxDQUF5QkQsSUFBSSxDQUFDLENBQUQsQ0FBN0IsQ0FDQSxLQUFJLENBQUNFLGFBQUwsQ0FBcUJGLElBQUksQ0FBQyxDQUFELENBQ3pCLENBVk0sQ0FXUCxDQTNCcUIsQ0ErQm5CRyxNQUFNLENBQUUsZ0JB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VUFISSxFQUdTakcsU0FBUyxDQUFDb0IsTUFBVixDQUFpQiwrQkFBakIsQ0FBZ0Q2RSxJQUFoRCxFQUFzRCxDQUF0RCxHQUE0RCxFQUhyRSxFQUcyRSxLQUhsRixDQUtGLEdBQUlHLENBQUFBLEdBQUcsQ0FBR3BHLFNBQVMsQ0FBQ29CLE1BQVYsQ0FBaUIsNkJBQWpCLENBQThDNkUsSUFBOUMsRUFBb0QsQ0FBcEQsR0FBMEQsRUFBcEUsQ0FFRyxHQUFHRyxHQUFHLEdBQUssRUFBWCxDQUNBLENBQ0NMLEdBQUcsRUFBSSxXQUFZSyxHQUFaLENBQWtCLEtBQ3pCLENBQ0ZMLEdBQUcsRUFBSSxHQUNQLENBZEosRUFrQkcsVUFBSUQsS0FBSixFQUFXRSxPQUFYLENBQW1CLFNBQUNLLElBQUQsQ0FBTUgsR0FBTixDQUFjLENBQ25DSCxHQUFHLEVBQUksTUFBTy9GLFNBQVMsQ0FBQ29CLE1BQVYsQ0FBaUIsZ0NBQWpCLENBQWlEaUYsSUFBakQsRUFBdUQsQ0FBdkQsR0FBNkQsRUFBcEUsRUFBMEUsS0FBMUUsQ0FDSCxLQURHLENBRUgsSUFGRyxFQUVJckcsU0FBUyxDQUFDb0IsTUFBVixDQUFpQixxQ0FBakIsQ0FBc0RpRixJQUF0RCxFQUE0RCxDQUE1RCxHQUFrRSxFQUZ0RSxFQUU0RSxLQUNuRixDQUpFLEVBUUFOLEdBQUcsRUFBSSxHQUFQLENBSUEsTUFBT0EsQ0FBQUEsR0FDUCxDQWpTa0IsQ0FBZCxDQUFUIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBTUkgV2ViIEZyYW1ld29ya1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC1YWFhYIFRoZSBBTUkgVGVhbSAvIExQU0MgLyBJTjJQM1xuICpcbiAqIFRoaXMgZmlsZSBtdXN0IGJlIHVzZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBDZUNJTEwtQzpcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1lbi5odG1sXG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZnIuaHRtbFxuICpcbiAqXG4gKiBAZ2xvYmFsIFZpeiwgc2F2ZUFzXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4kQU1JQ2xhc3MoJ0dyYXBoQ3RybCcsIHtcblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkZXh0ZW5kczogYW1pLkNvbnRyb2wsXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQkaW5pdDogZnVuY3Rpb24ocGFyZW50LCBvd25lcilcblx0e1xuXHRcdHRoaXMuJHN1cGVyLiRpbml0KHBhcmVudCwgb3duZXIpO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0b25SZWFkeTogZnVuY3Rpb24oKVxuXHR7XG5cdFx0cmV0dXJuIGFtaVdlYkFwcC5sb2FkUmVzb3VyY2VzKFtcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2NvbnRyb2xzL0dyYXBoL3R3aWcvR3JhcGhDdHJsLnR3aWcnLFxuXHRcdFx0YW1pV2ViQXBwLm9yaWdpblVSTCArICcvY29udHJvbHMvR3JhcGgvdHdpZy9ncmFwaC50d2lnJyxcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2pzLzNyZC1wYXJ0eS92aXoubWluLmpzJyxcblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL2Nzcy9hbWkubWluLmNzcycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9jc3MvZm9udC1hd2Vzb21lLm1pbi5jc3MnLFxuXHRcdF0sIHtjb250ZXh0OiB0aGlzfSkuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHR0aGlzLmZyYWdtZW50R3JhcGhDdHJsID0gZGF0YVswXTtcblx0XHRcdHRoaXMuZnJhZ21lbnRHcmFwaCA9IGRhdGFbMV07XG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIHJlbmRlcjogZnVuY3Rpb24oc2VsZWN0b3IsIGNvbW1hbmQsIHNldHRpbmdzKVxuICAgIHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRbY29udGV4dCwgdGhpcy5tb2RlXSA9IGFtaVdlYkFwcC5zZXR1cChbJ2NvbnRleHQnLCAnbW9kZSddLCBbcmVzdWx0LCAnZG90J10sIHNldHRpbmdzKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGFtaUNvbW1hbmQuZXhlY3V0ZShjb21tYW5kKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRpZih0aGlzLm1vZGUgPT09ICdkb3QnKVxuXHRcdFx0e1xuXHRcdFx0XHR0aGlzLmRvdFN0cmluZyA9IGFtaVdlYkFwcC5qc3BhdGgoJy4ucm93c2V0ey5AdHlwZT09PVwiZ3JhcGhcIn0ucm93LmZpZWxkey5AbmFtZT09PVwiZG90XCJ9LiQnLCBkYXRhKVswXSB8fCAnJztcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0dGhpcy5kb3RTdHJpbmcgPSB0aGlzLmpzb25Ub0RvdChkYXRhKTtcblx0XHRcdFx0Y29uc29sZS5sb2codGhpcy5kb3RTdHJpbmcpO1xuXHRcdFx0fVxuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0dGhpcy5yZXBsYWNlSFRNTChzZWxlY3RvciwgdGhpcy5mcmFnbWVudEdyYXBoQ3RybCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHQkKHRoaXMucGF0Y2hJZCgnI0E4RTdDODhEXzdCNzhfQjIyMV8wQkNCXzZFRjFGOUNDM0MxNScpKS5jaGFuZ2UoKGUpID0+IHtcblxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdHRoaXMuc3dpdGNoRGlyZWN0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNFOTAxNjhDNF9FNEJEX0FDQzhfMDg1Rl85OTUzRDZDRjc4OUYnKSkuY2xpY2soKGUpID0+IHtcblxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdHRoaXMuZXhwb3J0U1ZHKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdCQodGhpcy5wYXRjaElkKCcjRDY4RTQ5RjlfQTBDN19DMTVEXzgzMjNfOEJBMjE1ODU2NDI4JykpLmNsaWNrKChlKSA9PiB7XG5cblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0XHR0aGlzLmV4cG9ydFBORygpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdHRoaXMuZGlzcGxheSgpLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHRcdFx0cmVzdWx0LnJlc29sdmVXaXRoKGNvbnRleHQsIFtkYXRhXSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0XHR9KTtcblxuXHRcdH0pLmZhaWwoKGRhdGEpID0+IHtcblxuXHRcdFx0cmVzdWx0LnJlamVjdFdpdGgoY29udGV4dCwgW2RhdGFdKTtcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHJldHVybiByZXN1bHQucHJvbWlzZSgpO1xuXG4gICAgfSxcblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIGRpc3BsYXk6IGZ1bmN0aW9uKClcbiAgICB7XG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0YW1pV2ViQXBwLmxvY2soKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgICAgICBjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cbiAgICAgICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgICAgIHRoaXMuZ3JhcGggPSB0eXBlb2YgVml6ICE9PSAndW5kZWZpbmVkJyA/IFZpeih0aGlzLmRvdFN0cmluZywgJ3N2ZycpIDogJyc7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0LyogR1JBUEggUE9TVCBUUkVBVE1FTlQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuZ3JhcGggPSB0aGlzLmdyYXBoLnJlcGxhY2UoL3hsaW5rOmhyZWY9XCIoW15cIl0qKVwiL2csICh4LCBqc29uKSA9PiB7XG5cblx0XHRcdGNvbnN0IGpzb25iT2JqID0gSlNPTi5wYXJzZShhbWlXZWJBcHAuaHRtbFRvVGV4dChqc29uKSk7XG5cblx0XHRcdGNvbnN0IGF0dHJzID0gW1xuXHRcdFx0XHQnZGF0YS1jdHJsPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLWN0cmwnXSkgKyAnXCInLFxuXHRcdFx0XHQnZGF0YS1jdHJsLWxvY2F0aW9uPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLWN0cmwtbG9jYXRpb24nXSkgKyAnXCInLFxuXHRcdFx0XHQnZGF0YS1wYXJhbXM9XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoSlNPTi5zdHJpbmdpZnkoanNvbmJPYmpbJ2RhdGEtcGFyYW1zJ10pKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLXNldHRpbmdzPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKEpTT04uc3RyaW5naWZ5KGpzb25iT2JqWydkYXRhLXNldHRpbmdzJ10pKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLWljb249XCInICsgYW1pV2ViQXBwLnRleHRUb0h0bWwoanNvbmJPYmpbJ2RhdGEtaWNvbiddKSArICdcIicsXG5cdFx0XHRcdCdkYXRhLXRpdGxlPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9IdG1sKGpzb25iT2JqWydkYXRhLXRpdGxlJ10pICsgJ1wiJyxcblx0XHRcdFx0J2RhdGEtdGl0bGUtaWNvbj1cIicgKyBhbWlXZWJBcHAudGV4dFRvSHRtbChqc29uYk9ialsnZGF0YS10aXRsZS1pY29uJ10pICsgJ1wiJyxcblx0XHRcdF07XG5cblx0XHRcdHJldHVybiAneGxpbms6aHJlZj1cIiNcIiAnICsgYXR0cnMuam9pbignICcpO1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRoaXMuZ3JhcGgsICdpbWFnZS9zdmcreG1sJyk7XG5cblx0XHRjb25zdCBzdmcgPSAkKGRvYy5kb2N1bWVudEVsZW1lbnQpO1xuXG5cdFx0c3ZnLmZpbmQoJ2FbZGF0YS10aXRsZS1pY29uXScpLmVhY2goKGksIGVsKSA9PiB7XG5cblx0XHRcdCQoJzx0c3BhbiBmb250LWZhbWlseT1cIkZvbnRBd2Vzb21lXCI+JyArIFN0cmluZy5mcm9tQ2hhckNvZGUoJzB4JyArICQoZWwpLmF0dHIoJ2RhdGEtdGl0bGUtaWNvbicpKSArICc8L3RzcGFuPjx0c3Bhbj4gPC90c3Bhbj4nKS5wcmVwZW5kVG8oJChlbCkuZmluZCgndGV4dCcpKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuZ3JhcGggPSBkb2MuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDtcblxuICAgICAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBkaWN0ID0ge1xuXHRcdFx0Z3JhcGggOiB0aGlzLmdyYXBoLFxuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMucmVwbGFjZUhUTUwodGhpcy5wYXRjaElkKCcjQTBGNjc2M0ZfREUyOV81MTg1XzM1QzFfRENBQTgxRThDNDg3JyksIHRoaXMuZnJhZ21lbnRHcmFwaCwge2RpY3Q6IGRpY3R9KS5kb25lKCgpID0+IHtcblxuXHRcdFx0JCh0aGlzLnBhdGNoSWQoJyNBMEY2NzYzRl9ERTI5XzUxODVfMzVDMV9EQ0FBODFFOEM0ODcnKSArICcgYVtkYXRhLWN0cmxdJykuY2xpY2soKGUpID0+IHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0dGhpcy5jcmVhdGVDb250cm9sRnJvbVdlYkxpbmsodGhpcy5nZXRQYXJlbnQoKSwgZS5jdXJyZW50VGFyZ2V0LCB0aGlzLmN0eCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdGFtaVdlYkFwcC51bmxvY2soKTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdHJlc3VsdC5yZXNvbHZlV2l0aCh0aGlzLCBbcmVzdWx0XSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmVzdWx0LnByb21pc2UoKTtcbiAgICB9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0c3dpdGNoRGlyZWN0aW9uOiBmdW5jdGlvbigpXG4gICAge1xuICAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgICBcdGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgnKC4qXFxzKnJhbmtkaXJcXHMqPVxccypcIikoW0xdW1JdfFtUXVtCXSkoXCJcXHMqLiopJyk7XG5cbiAgICAgXHRjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRvdFN0cmluZy5tYXRjaChyZWdleClbMl07XG5cbiAgICAgXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAgXHRpZihkaXJlY3Rpb24gPT09ICdMUicgKVxuICAgICBcdHtcbiAgICAgXHRcdHRoaXMuZG90U3RyaW5nID0gdGhpcy5kb3RTdHJpbmcucmVwbGFjZShyZWdleCwgJyQxVEIkMycpO1xuICAgICBcdH1cbiAgICAgXHRlbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ1RCJyApXG4gICAgIFx0e1xuXHRcdFx0dGhpcy5kb3RTdHJpbmcgPSB0aGlzLmRvdFN0cmluZy5yZXBsYWNlKHJlZ2V4LCAnJDFMUiQzJyk7XG4gICAgIFx0fVxuXG5cdFx0dGhpcy5kaXNwbGF5KCk7XG4gICAgfSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdGV4cG9ydFNWRzogZnVuY3Rpb24oKVxuXHR7XG5cdFx0Y29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0aGlzLmdyYXBoXSwge1xuXHRcdFx0dHlwZTogJ2ltYWdlL3N2Zyt4bWwnLFxuXHRcdFx0ZW5kaW5ncyA6ICduYXRpdmUnLFxuXHRcdH0pO1xuXG5cdFx0c2F2ZUFzKGJsb2IsICdncmFwaC5zdmcnKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdGV4cG9ydFBORzogZnVuY3Rpb24oKVxuXHR7XG5cdFx0Vml6LnN2Z1htbFRvUG5nQmFzZTY0KHRoaXMuZ3JhcGgsIDEsIHRoaXMuX2V4cG9ydFBORyk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRfZXhwb3J0UE5HOiBmdW5jdGlvbihlcnIsIGRhdGEpXG4gICAge1xuXHRcdGxldCBiaW5hcnlfc3RyaW5nID0gd2luZG93LmF0b2IoZGF0YSk7XG5cdFx0bGV0IGxlbiA9IGJpbmFyeV9zdHJpbmcubGVuZ3RoO1xuXHRcdGxldCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbik7XG5cblx0XHRmb3IobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspXG5cdFx0e1xuXHRcdFx0Ynl0ZXNbaV0gPSBiaW5hcnlfc3RyaW5nLmNoYXJDb2RlQXQoaSk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgYmxvYiA9IG5ldyBCbG9iKFtieXRlcy5idWZmZXJdLCB7XG5cdFx0XHR0eXBlOiAnaW1hZ2UvcG5nJyxcblx0XHRcdGVuZGluZ3MgOiAnbmF0aXZlJyxcblx0XHR9KTtcblxuXHRcdHNhdmVBcyhibG9iLCAnZ3JhcGgucG5nJyk7XG5cdH0sXG5cblx0anNvblRvRG90OiBmdW5jdGlvbihqc29uKVxuICAgIHtcblx0XHRsZXQgbm9kZXMgPSBhbWlXZWJBcHAuanNwYXRoKCcuLnJvd3NldHsuQHR5cGU9PT1cIm5vZGVcIn0ucm93JywganNvbilbMF0gfHwgJyc7XG5cdFx0bGV0IGVkZ2VzID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5yb3dzZXR7LkB0eXBlPT09XCJlZGdlXCJ9LnJvdycsIGpzb24pWzBdIHx8ICcnO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgXHRsZXQgZG90ID0gJ2RpZ3JhcGggXCJwcm92ZW5hbmNlXCIge2dyYXBoIFtyYW5rZGlyPVwiTFJcIiwgcmFua3NlcD1cIjAuMjBcIl07IG5vZGUgW3dpZHRoPVwiNy41ZW1cIixoZWlnaHQ9XCIwLjNlbVwiLCBmb250Y29sb3I9XCIjMDA0YmZmZmZcIiwgZm9udG5hbWU9XCJBcmlhbFwiLCBmb250c2l6ZT1cIjEwLjBcIl07JztcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFsuLi5ub2Rlc10uZm9yRWFjaCgobm9kZSxpZHgpID0+IHtcblx0XHRcdGNvbnNvbGUuZGVidWcoSlNPTi5zdHJpbmdpZnkobm9kZSkpO1xuICAgIFx0XHRkb3QgKz0gJ1wiJyArIChhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiTEFCRUxcIn0uJCcsIG5vZGUpWzBdIHx8ICcnKSArICdcIiAnXG4gICAgXHRcdFx0KyAnWyAnXG4gICAgXHRcdFx0KyAnY29sb3I9XCInICsgKGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJDT0xPVVJcIn0uJCcsIG5vZGUpWzBdIHx8ICcnKSArICdcIiwgJ1xuICAgIFx0XHRcdCsgJ2xhYmVsPVwiJyArIChhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiTEFCRUxcIn0uJCcsIG5vZGUpWzBdIHx8ICcnKSArICdcIiAnO1xuXG5cdFx0XHRcdGxldCB1cmwgPSBhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiVVJMXCJ9LiQnLCBub2RlKVswXSB8fCAnJztcblxuICAgIFx0XHRcdGlmKHVybCAhPT0gJycpXG4gICAgXHRcdFx0e1xuICAgIFx0XHRcdFx0ZG90XHQrPSAnLCBVUkw9XCInICsgdXJsICsgJ1wiICc7XG4gICAgXHRcdFx0fVxuICAgIFx0XHRkb3QgKz0gJ10nO1xuICAgIFx0fSk7XG5cbiAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIFx0Wy4uLmVkZ2VzXS5mb3JFYWNoKChlZGdlLGlkeCkgPT4ge1xuXHRcdFx0ZG90ICs9ICdcIicgKyAoYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cIlNPVVJDRVwifS4kJywgZWRnZSlbMF0gfHwgJycpICsgJ1wiICdcblx0XHRcdFx0ICsgJy0+ICdcblx0XHRcdFx0ICsgJ1wiJyArIChhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiREVTVElOQVRJT05cIn0uJCcsIGVkZ2UpWzBdIHx8ICcnKSArICdcIiAnXG5cdFx0fSk7XG5cbiAgICBcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIFx0ZG90ICs9ICd9J1xuXG4gICAgXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICBcdHJldHVybiBkb3Q7XG4gICAgfSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLyJdfQ==
