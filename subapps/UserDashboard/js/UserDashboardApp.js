/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / CNRS
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

/*-------------------------------------------------------------------------*/
$AMIClass('UserDashboardApp', {
  /*---------------------------------------------------------------------*/
  $extends: ami.SubApp,

  /*---------------------------------------------------------------------*/
  onReady: function onReady(userdata) {
    var _this = this;

    var result = $.Deferred();
    amiWebApp.loadResources(['subapps/UserDashboard/css/UserDashboardApp.css', 'subapps/UserDashboard/twig/UserDashboardApp.twig',
    /**/
    'subapps/UserDashboard/js/jquery-ui.min.js',
    /**/
    amiWebApp.originURL + '/subapps/UserDashboard/js/gridstack.min.css', amiWebApp.originURL + '/subapps/UserDashboard/js/gridstack.all.js']).done(function (data) {
      amiWebApp.replaceHTML('#ami_main_content', data[1]).done(function () {
        /*---------------------------------------------------------*/
        var el = $('#F251696F_D42E_F7FF_86F7_2E6B4F2E8F74');
        /*---------------------------------------------------------*/

        var settings = {
          float: true,
          cellHeight: 36,
          verticalMargin: 12,
          width: 12
        };
        _this.gridstack = el.gridstack(settings).data('gridstack');
        /*---------------------------------------------------------*/

        el.on('change', function (e, items) {
          if (items && !_this.lock) {
            items.forEach(function (item) {
              _this.updateWidget(item);
            });
          }
        });
        /*---------------------------------------------------------*/

        _this.lock = false;
        /*---------------------------------------------------------*/

        result.resolve();
      });
    }).fail(function (data) {
      result.reject(data);
    });
    return result;
  },

  /*---------------------------------------------------------------------*/
  onLogin: function onLogin() {
    var _this2 = this;

    /*-----------------------------------------------------------------*/
    $('#ami_user_menu_content').html('<div class="dropdown-divider"></div>' + '<a class="dropdown-item" href="javascript:userDashboardApp.reload2();">Reload Dashboard</a>' + '<a class="dropdown-item" href="javascript:userDashboardApp.refresh2();">Refresh Dashboard</a>' + '<a class="dropdown-item" href="' + amiWebApp.webAppURL + '?subapp=dashboardAdmin" target="_blank">Edit Dashboard</a>');
    /*-----------------------------------------------------------------*/

    return this.reload().done(function () {
      _this2.interval = setInterval(function () {
        _this2.refresh();
      }, 10000);
    });
    /*-----------------------------------------------------------------*/
  },

  /*---------------------------------------------------------------------*/
  onLogout: function onLogout() {
    $('#F251696F_D42E_F7FF_86F7_2E6B4F2E8F74').empty();
    clearInterval(this.interval);
    this.controls = [];
  },

  /*---------------------------------------------------------------------*/
  _reload: function _reload(result, rows, idx) {
    var _this3 = this;

    if (idx === rows.length) {
      return result.resolve();
    }
    /*-----------------------------------------------------------------*/


    var row = rows[idx];
    /*-----------------------------------------------------------------*/

    var id = amiWebApp.jspath('..field{.@name==="id"}.$', row)[0] || '';
    var control = amiWebApp.jspath('..field{.@name==="control"}.$', row)[0] || '';
    var params = amiWebApp.jspath('..field{.@name==="params"}.$', row)[0] || '[]';
    var settings = amiWebApp.jspath('..field{.@name==="settings"}.$', row)[0] || '{}';
    var autoRefresh = amiWebApp.jspath('..field{.@name==="autoRefresh"}.$', row)[0] || '1';
    var x = amiWebApp.jspath('..field{.@name==="x"}.$', row)[0] || '0';
    var y = amiWebApp.jspath('..field{.@name==="y"}.$', row)[0] || '0';
    var width = amiWebApp.jspath('..field{.@name==="width"}.$', row)[0] || '0';
    var height = amiWebApp.jspath('..field{.@name==="height"}.$', row)[0] || '0';
    /*-----------------------------------------------------------------*/

    this.gridstack.addWidget($('<div data-gs-id="' + id + '">' + '  <div class="grid-stack-item-content" id="EB4DF671_2C31_BED0_6BED_44790525F28F_' + idx + '"></div>' + '  <div class="grid-stack-item-close-handle" id="D08B4F35_49D8_4844_D9D2_FB951948AF17_' + idx + '"></div>' + '</div>'), x, y, width, height).promise().done(function () {
      /*-------------------------------------------------------------*/
      $('#D08B4F35_49D8_4844_D9D2_FB951948AF17_' + idx).click(function (e) {
        var el = $(e.currentTarget).parent();

        _this3.removeWidget(el.data('_gridstack_node')).done(function () {
          el.remove();
        });
      });
      /*-------------------------------------------------------------*/

      try {
        amiWebApp.createControl(_this3, _this3, control, ['#EB4DF671_2C31_BED0_6BED_44790525F28F_' + idx].concat(JSON.parse(params)), JSON.parse(settings)).done(function (control) {
          /*-----------------------------------------------------*/
          control.autoRefresh = parseInt(autoRefresh);

          _this3.controls.push(control);
          /*-----------------------------------------------------*/


          _this3._reload(result, rows, idx + 1);
          /*-----------------------------------------------------*/

        }).fail(function (message) {
          /*-----------------------------------------------------*/
          amiWebApp.error('For widget `' + id + '`: ' + message);
          /*-----------------------------------------------------*/

          _this3._reload(result, rows, idx + 1);
          /*-----------------------------------------------------*/

        });
      } catch (e) {
        /*---------------------------------------------------------*/
        amiWebApp.error('For widget `' + id + '`: ' + e.message);
        /*---------------------------------------------------------*/

        _this3._reload(result, rows, idx + 1);
        /*---------------------------------------------------------*/

      }
      /*-------------------------------------------------------------*/

    });
    /*-----------------------------------------------------------------*/

    return result;
  },

  /*---------------------------------------------------------------------*/
  reload: function reload() {
    var _this4 = this;

    var result = $.Deferred();
    /*-----------------------------------------------------------------*/

    amiCommand.execute('GetDashboardInfo').done(function (data) {
      /*-------------------------------------------------------------*/
      _this4.gridstack.removeAll();

      _this4.controls = [];
      _this4.lock = true;
      /*-------------------------------------------------------------*/

      _this4._reload($.Deferred(), amiWebApp.jspath('..row', data), 0).done(function () {
        _this4.refresh().done(function () {
          _this4.lock = false;
          result.resolve();
        });
      });
      /*-------------------------------------------------------------*/

    }).fail(function (data, message) {
      result.reject(message);
    });
    /*-----------------------------------------------------------------*/

    return result;
  },

  /*---------------------------------------------------------------------*/
  reload2: function reload2() {
    amiWebApp.lock();
    this.reload().done(function () {
      amiWebApp.unlock();
    }).fail(function (message) {
      amiWebApp.error(message);
    });
  },

  /*---------------------------------------------------------------------*/
  refresh: function refresh() {
    /*-----------------------------------------------------------------*/
    this.controls.forEach(function (control) {
      if (control.autoRefresh !== 0 && control.refresh) {
        control.refresh();
      }
    });
    /*-----------------------------------------------------------------*/

    return $.Deferred().resolve();
    /*-----------------------------------------------------------------*/
  },

  /*---------------------------------------------------------------------*/
  refresh2: function refresh2() {
    amiWebApp.lock();
    this.refresh().done(function () {
      amiWebApp.unlock();
    }).fail(function (message) {
      amiWebApp.error(message);
    });
  },

  /*---------------------------------------------------------------------*/
  updateWidget: function updateWidget(item) {
    amiWebApp.lock();
    return amiCommand.execute('UpdateWidget -id="' + amiWebApp.textToString(item.id) + '" -x="' + item.x + '" -y="' + item.y + '" -width="' + item.width + '" -height="' + item.height + '"').done(function () {
      amiWebApp.unlock();
    }).fail(function (data, message) {
      amiWebApp.error(message);
    });
  },

  /*---------------------------------------------------------------------*/
  removeWidget: function removeWidget(item) {
    amiWebApp.lock();
    return amiCommand.execute('RemoveWidget -id="' + amiWebApp.textToString(item.id) + '"').done(function () {
      amiWebApp.unlock();
    }).fail(function (data, message) {
      amiWebApp.error(message);
    });
  }
  /*---------------------------------------------------------------------*/

});
/*-------------------------------------------------------------------------*/

/* GLOBAL INSTANCE                                                         */

/*-------------------------------------------------------------------------*/

var userDashboardApp = new UserDashboardApp();
/*-------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVzZXJEYXNoYm9hcmRBcHAuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiU3ViQXBwIiwib25SZWFkeSIsInVzZXJkYXRhIiwicmVzdWx0IiwiJCIsIkRlZmVycmVkIiwiYW1pV2ViQXBwIiwibG9hZFJlc291cmNlcyIsIm9yaWdpblVSTCIsImRvbmUiLCJkYXRhIiwicmVwbGFjZUhUTUwiLCJlbCIsInNldHRpbmdzIiwiZmxvYXQiLCJjZWxsSGVpZ2h0IiwidmVydGljYWxNYXJnaW4iLCJ3aWR0aCIsImdyaWRzdGFjayIsIm9uIiwiZSIsIml0ZW1zIiwibG9jayIsImZvckVhY2giLCJpdGVtIiwidXBkYXRlV2lkZ2V0IiwicmVzb2x2ZSIsImZhaWwiLCJyZWplY3QiLCJvbkxvZ2luIiwiaHRtbCIsIndlYkFwcFVSTCIsInJlbG9hZCIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJyZWZyZXNoIiwib25Mb2dvdXQiLCJlbXB0eSIsImNsZWFySW50ZXJ2YWwiLCJjb250cm9scyIsIl9yZWxvYWQiLCJyb3dzIiwiaWR4IiwibGVuZ3RoIiwicm93IiwiaWQiLCJqc3BhdGgiLCJjb250cm9sIiwicGFyYW1zIiwiYXV0b1JlZnJlc2giLCJ4IiwieSIsImhlaWdodCIsImFkZFdpZGdldCIsInByb21pc2UiLCJjbGljayIsImN1cnJlbnRUYXJnZXQiLCJwYXJlbnQiLCJyZW1vdmVXaWRnZXQiLCJyZW1vdmUiLCJjcmVhdGVDb250cm9sIiwiY29uY2F0IiwiSlNPTiIsInBhcnNlIiwicGFyc2VJbnQiLCJwdXNoIiwibWVzc2FnZSIsImVycm9yIiwiYW1pQ29tbWFuZCIsImV4ZWN1dGUiLCJyZW1vdmVBbGwiLCJyZWxvYWQyIiwidW5sb2NrIiwicmVmcmVzaDIiLCJ0ZXh0VG9TdHJpbmciLCJ1c2VyRGFzaGJvYXJkQXBwIiwiVXNlckRhc2hib2FyZEFwcCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7O0FBV0E7QUFFQUEs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WSxFQUFFLHNCQUFTbEMsSUFBVCxFQUNkO0FBQ0NsQixJQUFBQSxTQUFTLENBQUNnQixJQUFWO0FBRUEsV0FBTzhDLFVBQVUsQ0FBQ0MsT0FBWCxDQUFtQix1QkFBdUIvRCxTQUFTLENBQUNvRSxZQUFWLENBQXVCbEQsSUFBSSxDQUFDcUIsRUFBNUIsQ0FBdkIsR0FBeUQsR0FBNUUsRUFBaUZwQyxJQUFqRixDQUFzRixZQUFNO0FBRWxHSCxNQUFBQSxTQUFTLENBQUNrRSxNQUFWO0FBRUEsS0FKTSxFQUlKN0MsSUFKSSxDQUlDLFVBQUNqQixJQUFELEVBQU93RCxPQUFQLEVBQW1CO0FBRTFCNUQsTUFBQUEsU0FBUyxDQUFDNkQsS0FBVixDQUFnQkQsT0FBaEI7QUFDQSxLQVBNLENBQVA7QUFRQTtBQUVEOztBQTlVNkIsQ0FBckIsQ0FBVDtBQWlWQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJUyxnQkFBZ0IsR0FBRyxJQUFJQyxnQkFBSixFQUF2QjtBQUVBIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBTUkgV2ViIEZyYW1ld29ya1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC1YWFhYIFRoZSBBTUkgVGVhbSAvIExQU0MgLyBDTlJTXG4gKlxuICogVGhpcyBmaWxlIG11c3QgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIENlQ0lMTC1DOlxuICogaHR0cDovL3d3dy5jZWNpbGwuaW5mby9saWNlbmNlcy9MaWNlbmNlX0NlQ0lMTC1DX1YxLWVuLmh0bWxcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1mci5odG1sXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiRBTUlDbGFzcygnVXNlckRhc2hib2FyZEFwcCcsIHtcblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCRleHRlbmRzOiBhbWkuU3ViQXBwLFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvblJlYWR5OiBmdW5jdGlvbih1c2VyZGF0YSlcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdGFtaVdlYkFwcC5sb2FkUmVzb3VyY2VzKFtcblx0XHRcdCdzdWJhcHBzL1VzZXJEYXNoYm9hcmQvY3NzL1VzZXJEYXNoYm9hcmRBcHAuY3NzJyxcblx0XHRcdCdzdWJhcHBzL1VzZXJEYXNoYm9hcmQvdHdpZy9Vc2VyRGFzaGJvYXJkQXBwLnR3aWcnLFxuXHRcdFx0LyoqL1xuXHRcdFx0J3N1YmFwcHMvVXNlckRhc2hib2FyZC9qcy9qcXVlcnktdWkubWluLmpzJyxcblx0XHRcdC8qKi9cblx0XHRcdGFtaVdlYkFwcC5vcmlnaW5VUkwgKyAnL3N1YmFwcHMvVXNlckRhc2hib2FyZC9qcy9ncmlkc3RhY2subWluLmNzcycsXG5cdFx0XHRhbWlXZWJBcHAub3JpZ2luVVJMICsgJy9zdWJhcHBzL1VzZXJEYXNoYm9hcmQvanMvZ3JpZHN0YWNrLmFsbC5qcycsXG5cdFx0XSkuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHRhbWlXZWJBcHAucmVwbGFjZUhUTUwoJyNhbWlfbWFpbl9jb250ZW50JywgZGF0YVsxXSkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdGNvbnN0IGVsID0gJCgnI0YyNTE2OTZGX0Q0MkVfRjdGRl84NkY3XzJFNkI0RjJFOEY3NCcpO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHRjb25zdCBzZXR0aW5ncyA9IHtcblx0XHRcdFx0XHRmbG9hdDogdHJ1ZSxcblx0XHRcdFx0XHRjZWxsSGVpZ2h0OiAzNixcblx0XHRcdFx0XHR2ZXJ0aWNhbE1hcmdpbjogMTIsXG5cdFx0XHRcdFx0d2lkdGg6IDEyLFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHRoaXMuZ3JpZHN0YWNrID0gZWwuZ3JpZHN0YWNrKHNldHRpbmdzKS5kYXRhKCdncmlkc3RhY2snKTtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0ZWwub24oJ2NoYW5nZScsIChlLCBpdGVtcykgPT4ge1xuXG5cdFx0XHRcdFx0aWYoaXRlbXMgJiYgIXRoaXMubG9jaylcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG5cblx0XHRcdFx0XHRcdFx0dGhpcy51cGRhdGVXaWRnZXQoaXRlbSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHR0aGlzLmxvY2sgPSBmYWxzZTtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0cmVzdWx0LnJlc29sdmUoKTtcblx0XHRcdH0pO1xuXG5cdFx0fSkuZmFpbCgoZGF0YSkgPT4ge1xuXG5cdFx0XHRyZXN1bHQucmVqZWN0KGRhdGEpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0b25Mb2dpbjogZnVuY3Rpb24oKVxuXHR7XG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHQkKCcjYW1pX3VzZXJfbWVudV9jb250ZW50JykuaHRtbChcblx0XHRcdCc8ZGl2IGNsYXNzPVwiZHJvcGRvd24tZGl2aWRlclwiPjwvZGl2Pidcblx0XHRcdCtcblx0XHRcdCc8YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiamF2YXNjcmlwdDp1c2VyRGFzaGJvYXJkQXBwLnJlbG9hZDIoKTtcIj5SZWxvYWQgRGFzaGJvYXJkPC9hPidcblx0XHRcdCtcblx0XHRcdCc8YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiamF2YXNjcmlwdDp1c2VyRGFzaGJvYXJkQXBwLnJlZnJlc2gyKCk7XCI+UmVmcmVzaCBEYXNoYm9hcmQ8L2E+J1xuXHRcdFx0K1xuXHRcdFx0JzxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCInICsgYW1pV2ViQXBwLndlYkFwcFVSTCArICc/c3ViYXBwPWRhc2hib2FyZEFkbWluXCIgdGFyZ2V0PVwiX2JsYW5rXCI+RWRpdCBEYXNoYm9hcmQ8L2E+J1xuXHRcdCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHJldHVybiB0aGlzLnJlbG9hZCgpLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHR0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuXG5cdFx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXG5cdFx0XHR9LCAxMDAwMCk7XG5cdFx0fSk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0b25Mb2dvdXQ6IGZ1bmN0aW9uKClcblx0e1xuXHRcdCQoJyNGMjUxNjk2Rl9ENDJFX0Y3RkZfODZGN18yRTZCNEYyRThGNzQnKS5lbXB0eSgpO1xuXG5cdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcblxuXHRcdHRoaXMuY29udHJvbHMgPSBbXTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0X3JlbG9hZDogZnVuY3Rpb24ocmVzdWx0LCByb3dzLCBpZHgpXG5cdHtcblx0XHRpZihpZHggPT09IHJvd3MubGVuZ3RoKVxuXHRcdHtcblx0XHRcdHJldHVybiByZXN1bHQucmVzb2x2ZSgpO1xuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0Y29uc3Qgcm93ID0gcm93c1tpZHhdO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRjb25zdCBpZCA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJpZFwifS4kJywgcm93KVswXSB8fCAnJztcblx0XHRjb25zdCBjb250cm9sID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cImNvbnRyb2xcIn0uJCcsIHJvdylbMF0gfHwgJyc7XG5cdFx0Y29uc3QgcGFyYW1zID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cInBhcmFtc1wifS4kJywgcm93KVswXSB8fCAnW10nO1xuXHRcdGNvbnN0IHNldHRpbmdzID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cInNldHRpbmdzXCJ9LiQnLCByb3cpWzBdIHx8ICd7fSc7XG5cdFx0Y29uc3QgYXV0b1JlZnJlc2ggPSBhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwiYXV0b1JlZnJlc2hcIn0uJCcsIHJvdylbMF0gfHwgJzEnO1xuXHRcdGNvbnN0IHggPSBhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwieFwifS4kJywgcm93KVswXSB8fCAnMCc7XG5cdFx0Y29uc3QgeSA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJ5XCJ9LiQnLCByb3cpWzBdIHx8ICcwJztcblx0XHRjb25zdCB3aWR0aCA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJ3aWR0aFwifS4kJywgcm93KVswXSB8fCAnMCc7XG5cdFx0Y29uc3QgaGVpZ2h0ID0gYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cImhlaWdodFwifS4kJywgcm93KVswXSB8fCAnMCc7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdHRoaXMuZ3JpZHN0YWNrLmFkZFdpZGdldCgkKFxuXHRcdFx0JzxkaXYgZGF0YS1ncy1pZD1cIicgKyBpZCArICdcIj4nICtcblx0XHRcdCcgIDxkaXYgY2xhc3M9XCJncmlkLXN0YWNrLWl0ZW0tY29udGVudFwiIGlkPVwiRUI0REY2NzFfMkMzMV9CRUQwXzZCRURfNDQ3OTA1MjVGMjhGXycgKyBpZHggKyAnXCI+PC9kaXY+JyArXG5cdFx0XHQnICA8ZGl2IGNsYXNzPVwiZ3JpZC1zdGFjay1pdGVtLWNsb3NlLWhhbmRsZVwiIGlkPVwiRDA4QjRGMzVfNDlEOF80ODQ0X0Q5RDJfRkI5NTE5NDhBRjE3XycgKyBpZHggKyAnXCI+PC9kaXY+JyArXG5cdFx0XHQnPC9kaXY+J1xuXHRcdCksIHgsIHksIHdpZHRoLCBoZWlnaHQpLnByb21pc2UoKS5kb25lKCgpID0+IHtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0JCgnI0QwOEI0RjM1XzQ5RDhfNDg0NF9EOUQyX0ZCOTUxOTQ4QUYxN18nICsgaWR4KS5jbGljaygoZSkgPT4ge1xuXG5cdFx0XHRcdGNvbnN0IGVsID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudCgpO1xuXG5cdFx0XHRcdHRoaXMucmVtb3ZlV2lkZ2V0KGVsLmRhdGEoJ19ncmlkc3RhY2tfbm9kZScpKS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHRcdGVsLnJlbW92ZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHR0cnlcblx0XHRcdHtcblx0XHRcdFx0YW1pV2ViQXBwLmNyZWF0ZUNvbnRyb2wodGhpcywgdGhpcywgY29udHJvbCwgWycjRUI0REY2NzFfMkMzMV9CRUQwXzZCRURfNDQ3OTA1MjVGMjhGXycgKyBpZHhdLmNvbmNhdChKU09OLnBhcnNlKHBhcmFtcykpLCBKU09OLnBhcnNlKHNldHRpbmdzKSkuZG9uZSgoY29udHJvbCkgPT4ge1xuXG5cdFx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0XHRjb250cm9sLmF1dG9SZWZyZXNoID0gcGFyc2VJbnQoYXV0b1JlZnJlc2gpO1xuXG5cdFx0XHRcdFx0dGhpcy5jb250cm9scy5wdXNoKGNvbnRyb2wpO1xuXG5cdFx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0XHR0aGlzLl9yZWxvYWQocmVzdWx0LCByb3dzLCBpZHggKyAxKTtcblxuXHRcdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdH0pLmZhaWwoKG1lc3NhZ2UpID0+IHtcblxuXHRcdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHRcdFx0YW1pV2ViQXBwLmVycm9yKCdGb3Igd2lkZ2V0IGAnICsgaWQgKyAnYDogJyArIG1lc3NhZ2UpO1xuXG5cdFx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0XHR0aGlzLl9yZWxvYWQocmVzdWx0LCByb3dzLCBpZHggKyAxKTtcblxuXHRcdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdGNhdGNoKGUpXG5cdFx0XHR7XG5cdFx0XHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdFx0XHRhbWlXZWJBcHAuZXJyb3IoJ0ZvciB3aWRnZXQgYCcgKyBpZCArICdgOiAnICsgZS5tZXNzYWdlKTtcblxuXHRcdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRcdFx0dGhpcy5fcmVsb2FkKHJlc3VsdCwgcm93cywgaWR4ICsgMSk7XG5cblx0XHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHRcdFx0fVxuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZWxvYWQ6IGZ1bmN0aW9uKClcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0YW1pQ29tbWFuZC5leGVjdXRlKCdHZXREYXNoYm9hcmRJbmZvJykuZG9uZSgoZGF0YSkgPT4ge1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHR0aGlzLmdyaWRzdGFjay5yZW1vdmVBbGwoKTtcblxuXHRcdFx0dGhpcy5jb250cm9scyA9IFtdO1xuXG5cdFx0XHR0aGlzLmxvY2sgPSB0cnVlO1xuXG5cdFx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0XHR0aGlzLl9yZWxvYWQoJC5EZWZlcnJlZCgpLCBhbWlXZWJBcHAuanNwYXRoKCcuLnJvdycsIGRhdGEpLCAwKS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHR0aGlzLnJlZnJlc2goKS5kb25lKCgpID0+IHtcblxuXHRcdFx0XHRcdHRoaXMubG9jayA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0cmVzdWx0LnJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdH0pLmZhaWwoKGRhdGEsIG1lc3NhZ2UpID0+IHtcblxuXHRcdFx0cmVzdWx0LnJlamVjdChtZXNzYWdlKTtcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVsb2FkMjogZnVuY3Rpb24oKVxuXHR7XG5cdFx0YW1pV2ViQXBwLmxvY2soKTtcblxuXHRcdHRoaXMucmVsb2FkKCkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdGFtaVdlYkFwcC51bmxvY2soLyotLS0qLyk7XG5cblx0XHR9KS5mYWlsKChtZXNzYWdlKSA9PiB7XG5cblx0XHRcdGFtaVdlYkFwcC5lcnJvcihtZXNzYWdlKTtcblx0XHR9KTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0cmVmcmVzaDogZnVuY3Rpb24oKVxuXHR7XG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHR0aGlzLmNvbnRyb2xzLmZvckVhY2goKGNvbnRyb2wpID0+IHtcblxuXHRcdFx0aWYoY29udHJvbC5hdXRvUmVmcmVzaCAhPT0gMCAmJiBjb250cm9sLnJlZnJlc2gpXG5cdFx0XHR7XG5cdFx0XHRcdGNvbnRyb2wucmVmcmVzaCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRyZXR1cm4gJC5EZWZlcnJlZCgpLnJlc29sdmUoKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZWZyZXNoMjogZnVuY3Rpb24oKVxuXHR7XG5cdFx0YW1pV2ViQXBwLmxvY2soKTtcblxuXHRcdHRoaXMucmVmcmVzaCgpLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHRhbWlXZWJBcHAudW5sb2NrKC8qLS0tKi8pO1xuXG5cdFx0fSkuZmFpbCgobWVzc2FnZSkgPT4ge1xuXG5cdFx0XHRhbWlXZWJBcHAuZXJyb3IobWVzc2FnZSk7XG5cdFx0fSk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdHVwZGF0ZVdpZGdldDogZnVuY3Rpb24oaXRlbSlcblx0e1xuXHRcdGFtaVdlYkFwcC5sb2NrKCk7XG5cblx0XHRyZXR1cm4gYW1pQ29tbWFuZC5leGVjdXRlKCdVcGRhdGVXaWRnZXQgLWlkPVwiJyArIGFtaVdlYkFwcC50ZXh0VG9TdHJpbmcoaXRlbS5pZCkgKyAnXCIgLXg9XCInICsgaXRlbS54ICsgJ1wiIC15PVwiJyArIGl0ZW0ueSArICdcIiAtd2lkdGg9XCInICsgaXRlbS53aWR0aCArICdcIiAtaGVpZ2h0PVwiJyArIGl0ZW0uaGVpZ2h0ICsgJ1wiJykuZG9uZSgoKSA9PiB7XG5cblx0XHRcdGFtaVdlYkFwcC51bmxvY2soKTtcblxuXHRcdH0pLmZhaWwoKGRhdGEsIG1lc3NhZ2UpID0+IHtcblxuXHRcdFx0YW1pV2ViQXBwLmVycm9yKG1lc3NhZ2UpO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRyZW1vdmVXaWRnZXQ6IGZ1bmN0aW9uKGl0ZW0pXG5cdHtcblx0XHRhbWlXZWJBcHAubG9jaygpO1xuXG5cdFx0cmV0dXJuIGFtaUNvbW1hbmQuZXhlY3V0ZSgnUmVtb3ZlV2lkZ2V0IC1pZD1cIicgKyBhbWlXZWJBcHAudGV4dFRvU3RyaW5nKGl0ZW0uaWQpICsgJ1wiJykuZG9uZSgoKSA9PiB7XG5cblx0XHRcdGFtaVdlYkFwcC51bmxvY2soKTtcblxuXHRcdH0pLmZhaWwoKGRhdGEsIG1lc3NhZ2UpID0+IHtcblxuXHRcdFx0YW1pV2ViQXBwLmVycm9yKG1lc3NhZ2UpO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuLyogR0xPQkFMIElOU1RBTkNFICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbnZhciB1c2VyRGFzaGJvYXJkQXBwID0gbmV3IFVzZXJEYXNoYm9hcmRBcHAoKTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbiJdfQ==
