/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-XXXX The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 * @global saveAs
 *
 */

/*--------------------------------------------------------------------------------------------------------------------*/
$AMIClass('CommandApp', {
  /*----------------------------------------------------------------------------------------------------------------*/
  $extends: ami.SubApp,

  /*----------------------------------------------------------------------------------------------------------------*/
  onReady: function onReady(userdata) {
    var _this = this;

    var result = $.Deferred();
    amiWebApp.loadResources(['subapps/Command/twig/CommandApp.twig', 'subapps/Command/twig/command.twig', 'subapps/Command/twig/result.twig', 'js/3rd-party/filesaver.min.js']).done(function (data) {
      amiWebApp.replaceHTML('#ami_main_content', data[0], {
        dict: {
          command: userdata
        }
      }).done(function () {
        _this.fragmentCommand = data[1];
        _this.fragmentResult = data[2];
        result.resolve();
      });
    }).fail(function (message) {
      result.reject(message);
    });
    return result;
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  onLogin: function onLogin() {
    return this.getCommands();
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  onLogout: function onLogout() {
    return this.getCommands();
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  getCommands: function getCommands() {
    var _this2 = this;

    var result = $.Deferred();
    amiCommand.execute('ListCommands').done(function (data) {
      var isAuthenticated = amiLogin.isAuthenticated();
      var rows = amiWebApp.jspath('..row', data);
      var dict = [];
      rows.forEach(function (row) {
        var command = amiWebApp.jspath('..field{.@name==="command"}.$', row)[0] || '';
        var visible = (amiWebApp.jspath('..field{.@name==="visible"}.$', row)[0] || 'true') !== 'false';
        var secured = (amiWebApp.jspath('..field{.@name==="secured"}.$', row)[0] || 'false') !== 'false';
        var help = amiWebApp.jspath('..field{.@name==="help"}.$', row)[0] || '';
        var usage = amiWebApp.jspath('..field{.@name==="usage"}.$', row)[0] || '';

        if (visible && isAuthenticated || amiLogin.hasRole('AMI_ADMIN') || command === 'GetSessionInfo' || command === 'ResetPassword' || command === 'AddUser') {
          var proto;

          if (!usage) {
            proto = command;
            help += '<br /><br />Usage:<br />' + command;
          } else {
            proto = command + ' ' + usage;
            help += '<br /><br />Usage:<br />' + command + ' ' + usage;
          }

          help = help.replace(new RegExp(command, 'g'), '<strong>' + command + '</strong>');
          dict.push({
            command: command,
            secured: secured,
            help: help,
            proto: proto
          });
        }
      });
      amiWebApp.replaceHTML('#D847C44B_D28F_49B3_AF79_7A68B3305ED2', _this2.fragmentCommand, {
        dict: dict
      }).done(function () {
        result.resolve();
      });
    }).fail(function (data, message) {
      result.reject(message);
    });
    return result;
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  execute: function execute(command, converter) {
    var _this3 = this;

    /*------------------------------------------------------------------------------------------------------------*/
    command = command.trim();
    converter = converter.trim();
    /*------------------------------------------------------------------------------------------------------------*/

    if (command) {
      amiWebApp.lock();
      amiCommand.execute(command, {
        converter: converter
      }).always(function (data, message, url) {
        var dict = {
          data: converter === 'AMIXmlToJson.xsl' ? JSON.stringify(data, undefined, 2) : data,
          url: url
        };
        amiWebApp.prependHTML('#AB4BA483_EE27_44D0_BB54_F5BFCFE4DA7E', _this3.fragmentResult, {
          dict: dict
        }).done(function () {
          amiWebApp.unlock();
        });
      });
    }
    /*------------------------------------------------------------------------------------------------------------*/

  },

  /*----------------------------------------------------------------------------------------------------------------*/
  select: function select(command) {
    $('#CE9A50CD_63CA_4A1E_B336_F45399BEC84D').val(command);
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  copy: function copy(text) {
    amiWebApp.createControl(null, this, 'textBox', [text], {});
  },

  /*----------------------------------------------------------------------------------------------------------------*/
  save: function save(data) {
    /*------------------------------------------------------------------------------------------------------------*/
    var converter = $('#C8D10895_E8A7_46A0_B638_C8DDDED8F91C').val().trim();
    /*------------------------------------------------------------------------------------------------------------*/

    var fileMime;
    var fileName;
    /**/

    if (converter === 'AMIXmlToXml.xsl') {
      fileMime = 'application/xml';
      fileName = 'result.xml';
    } else if (converter === 'AMIXmlToJson.xsl') {
      fileMime = 'application/json';
      fileName = 'result.json';
    } else if (converter === 'AMIXmlToCsv.xsl') {
      fileMime = 'text/csv';
      fileName = 'result.csv';
    } else {
      fileMime = 'text/plain';
      fileName = 'result.txt';
    }
    /*------------------------------------------------------------------------------------------------------------*/


    saveAs(new Blob([amiWebApp.htmlToText(data)], {
      type: fileMime
    }), fileName);
    /*------------------------------------------------------------------------------------------------------------*/
  }
  /*----------------------------------------------------------------------------------------------------------------*/

});
/*--------------------------------------------------------------------------------------------------------------------*/

/* GLOBAL INSTANCE                                                                                                    */

/*--------------------------------------------------------------------------------------------------------------------*/

var commandApp = new CommandApp();
/*--------------------------------------------------------------------------------------------------------------------*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbW1hbmRBcHAuZXM2LmpzIl0sIm5hbWVzIjpbIiRBTUlDbGFzcyIsIiRleHRlbmRzIiwiYW1pIiwiU3ViQXBwIiwib25SZWFkeSIsInVzZXJkYXRhIiwicmVzdWx0IiwiJCIsIkRlZmVycmVkIiwiYW1pV2ViQXBwIiwibG9hZFJlc291cmNlcyIsImRvbmUiLCJkYXRhIiwicmVwbGFjZUhUTUwiLCJkaWN0IiwiY29tbWFuZCIsImZyYWdtZW50Q29tbWFuZCIsImZyYWdtZW50UmVzdWx0IiwicmVzb2x2ZSIsImZhaWwiLCJtZXNzYWdlIiwicmVqZWN0Iiwib25Mb2dpbiIsImdldENvbW1hbmRzIiwib25Mb2dvdXQiLCJhbWlDb21tYW5kIiwiZXhlY3V0ZSIsImlzQXV0aGVudGljYXRlZCIsImFtaUxvZ2luIiwicm93cyIsImpzcGF0aCIsImZvckVhY2giLCJyb3ciLCJ2aXNpYmxlIiwic2VjdXJlZCIsImhlbHAiLCJ1c2FnZSIsImhhc1JvbGUiLCJwcm90byIsInJlcGxhY2UiLCJSZWdFeHAiLCJwdXNoIiwiY29udmVydGVyIiwidHJpbSIsImxvY2siLCJhbHdheXMiLCJ1cmwiLCJKU09OIiwic3RyaW5naWZ5IiwidW5kZWZpbmVkIiwicHJlcGVuZEhUTUwiLCJ1bmxvY2siLCJzZWxlY3QiLCJ2YWwiLCJjb3B5IiwidGV4dCIsImNyZWF0ZUNvbnRyb2wiLCJzYXZlIiwiZmlsZU1pbWUiLCJmaWxlTmFtZSIsInNhdmVBcyIsIkJsb2IiLCJodG1sVG9UZXh0IiwidHlwZSIsImNvbW1hbmRBcHAiLCJDb21tYW5kQXBwIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztBQWFBO0FBRUFBLFNBQVMsQ0FBQyxZQUFELEVBQWU7QUFDdkI7QUFFQUMsRUFBQUEsUUFBUSxFQUFFQyxHQUFHLENBQUNDLE1BSFM7O0FBS3ZCO0FBRUFDLEVBQUFBLE9BQU8sRUFBRSxpQkFBU0MsUUFBVCxFQUNUO0FBQUE7O0FBQ0MsUUFBTUMsTUFBTSxHQUFHQyxDQUFDLENBQUND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QVM3QyxJQUFULEVBQ047QUFDQztBQUVBLFFBQU04QixTQUFTLEdBQUduQyxDQUFDLENBQUMsdUNBQUQsQ0FBRCxDQUEyQzhDLEdBQTNDLEdBQWlEVixJQUFqRCxFQUFsQjtBQUVBOztBQUVBLFFBQUllLFFBQUo7QUFDQSxRQUFJQyxRQUFKO0FBRUE7O0FBQUssUUFBR2pCLFNBQVMsS0FBSyxpQkFBakIsRUFDTDtBQUNDZ0IsTUFBQUEsUUFBUSxHQUFHLGlCQUFYO0FBQ0FDLE1BQUFBLFFBQVEsR0FBRyxZQUFYO0FBQ0EsS0FKSSxNQUtBLElBQUdqQixTQUFTLEtBQUssa0JBQWpCLEVBQ0w7QUFDQ2dCLE1BQUFBLFFBQVEsR0FBRyxrQkFBWDtBQUNBQyxNQUFBQSxRQUFRLEdBQUcsYUFBWDtBQUNBLEtBSkksTUFLQSxJQUFHakIsU0FBUyxLQUFLLGlCQUFqQixFQUNMO0FBQ0NnQixNQUFBQSxRQUFRLEdBQUcsVUFBWDtBQUNBQyxNQUFBQSxRQUFRLEdBQUcsWUFBWDtBQUNBLEtBSkksTUFNTDtBQUNDRCxNQUFBQSxRQUFRLEdBQUcsWUFBWDtBQUNBQyxNQUFBQSxRQUFRLEdBQUcsWUFBWDtBQUNBO0FBRUQ7OztBQUVBQyxJQUFBQSxNQUFNLENBQUMsSUFBSUMsSUFBSixDQUFTLENBQUNwRCxTQUFTLENBQUNxRCxVQUFWLENBQXFCbEQsSUFBckIsQ0FBRCxDQUFULEVBQXVDO0FBQUNtRCxNQUFBQSxJQUFJLEVBQUVMO0FBQVAsS0FBdkMsQ0FBRCxFQUEyREMsUUFBM0QsQ0FBTjtBQUVBO0FBQ0E7QUFFRDs7QUFuTXVCLENBQWYsQ0FBVDtBQXNNQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFNSyxVQUFVLEdBQUcsSUFBSUMsVUFBSixFQUFuQjtBQUVBIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBTUkgV2ViIEZyYW1ld29ya1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC1YWFhYIFRoZSBBTUkgVGVhbSAvIExQU0MgLyBJTjJQM1xuICpcbiAqIFRoaXMgZmlsZSBtdXN0IGJlIHVzZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBDZUNJTEwtQzpcbiAqIGh0dHA6Ly93d3cuY2VjaWxsLmluZm8vbGljZW5jZXMvTGljZW5jZV9DZUNJTEwtQ19WMS1lbi5odG1sXG4gKiBodHRwOi8vd3d3LmNlY2lsbC5pbmZvL2xpY2VuY2VzL0xpY2VuY2VfQ2VDSUxMLUNfVjEtZnIuaHRtbFxuICpcbiAqIEBnbG9iYWwgc2F2ZUFzXG4gKlxuICovXG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4kQU1JQ2xhc3MoJ0NvbW1hbmRBcHAnLCB7XG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0JGV4dGVuZHM6IGFtaS5TdWJBcHAsXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvblJlYWR5OiBmdW5jdGlvbih1c2VyZGF0YSlcblx0e1xuXHRcdGNvbnN0IHJlc3VsdCA9ICQuRGVmZXJyZWQoKTtcblxuXHRcdGFtaVdlYkFwcC5sb2FkUmVzb3VyY2VzKFtcblx0XHRcdCdzdWJhcHBzL0NvbW1hbmQvdHdpZy9Db21tYW5kQXBwLnR3aWcnLFxuXHRcdFx0J3N1YmFwcHMvQ29tbWFuZC90d2lnL2NvbW1hbmQudHdpZycsXG5cdFx0XHQnc3ViYXBwcy9Db21tYW5kL3R3aWcvcmVzdWx0LnR3aWcnLFxuXHRcdFx0J2pzLzNyZC1wYXJ0eS9maWxlc2F2ZXIubWluLmpzJyxcblx0XHRdKS5kb25lKChkYXRhKSA9PiB7XG5cblx0XHRcdGFtaVdlYkFwcC5yZXBsYWNlSFRNTCgnI2FtaV9tYWluX2NvbnRlbnQnLCBkYXRhWzBdLCB7ZGljdDoge2NvbW1hbmQ6IHVzZXJkYXRhfX0pLmRvbmUoKCkgPT4ge1xuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb21tYW5kID0gZGF0YVsxXTtcblx0XHRcdFx0dGhpcy5mcmFnbWVudFJlc3VsdCA9IGRhdGFbMl07XG5cblx0XHRcdFx0cmVzdWx0LnJlc29sdmUoKTtcblx0XHRcdH0pO1xuXG5cdFx0fSkuZmFpbCgobWVzc2FnZSkgPT4ge1xuXG5cdFx0XHRyZXN1bHQucmVqZWN0KG1lc3NhZ2UpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdG9uTG9naW46IGZ1bmN0aW9uKClcblx0e1xuXHRcdHJldHVybiB0aGlzLmdldENvbW1hbmRzKCk7XG5cdH0sXG5cblx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRvbkxvZ291dDogZnVuY3Rpb24oKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0Q29tbWFuZHMoKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdGdldENvbW1hbmRzOiBmdW5jdGlvbigpXG5cdHtcblx0XHRjb25zdCByZXN1bHQgPSAkLkRlZmVycmVkKCk7XG5cblx0XHRhbWlDb21tYW5kLmV4ZWN1dGUoJ0xpc3RDb21tYW5kcycpLmRvbmUoKGRhdGEpID0+IHtcblxuXHRcdFx0Y29uc3QgaXNBdXRoZW50aWNhdGVkID0gYW1pTG9naW4uaXNBdXRoZW50aWNhdGVkKCk7XG5cblx0XHRcdGNvbnN0IHJvd3MgPSBhbWlXZWJBcHAuanNwYXRoKCcuLnJvdycsIGRhdGEpO1xuXG5cdFx0XHRjb25zdCBkaWN0ID0gW107XG5cblx0XHRcdHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cblx0XHRcdFx0Y29uc3QgY29tbWFuZCA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJjb21tYW5kXCJ9LiQnLCByb3cpWzBdIHx8ICcnO1xuXG5cdFx0XHRcdGNvbnN0IHZpc2libGUgPSAoYW1pV2ViQXBwLmpzcGF0aCgnLi5maWVsZHsuQG5hbWU9PT1cInZpc2libGVcIn0uJCcsIHJvdylbMF0gfHwgJ3RydWUnKSAhPT0gJ2ZhbHNlJztcblx0XHRcdFx0Y29uc3Qgc2VjdXJlZCA9IChhbWlXZWJBcHAuanNwYXRoKCcuLmZpZWxkey5AbmFtZT09PVwic2VjdXJlZFwifS4kJywgcm93KVswXSB8fCAnZmFsc2UnKSAhPT0gJ2ZhbHNlJztcblxuXHRcdFx0XHRsZXQgaGVscCA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJoZWxwXCJ9LiQnLCByb3cpWzBdIHx8ICcnO1xuXHRcdFx0XHRjb25zdCB1c2FnZSA9IGFtaVdlYkFwcC5qc3BhdGgoJy4uZmllbGR7LkBuYW1lPT09XCJ1c2FnZVwifS4kJywgcm93KVswXSB8fCAnJztcblxuXHRcdFx0XHRpZigodmlzaWJsZSAmJiBpc0F1dGhlbnRpY2F0ZWQpIHx8IGFtaUxvZ2luLmhhc1JvbGUoJ0FNSV9BRE1JTicpIHx8IGNvbW1hbmQgPT09ICdHZXRTZXNzaW9uSW5mbycgfHwgY29tbWFuZCA9PT0gJ1Jlc2V0UGFzc3dvcmQnIHx8IGNvbW1hbmQgPT09ICdBZGRVc2VyJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGxldCBwcm90bztcblxuXHRcdFx0XHRcdGlmKCF1c2FnZSkge1xuXHRcdFx0XHRcdFx0cHJvdG8gPSBjb21tYW5kO1xuXHRcdFx0XHRcdFx0aGVscCArPSAnPGJyIC8+PGJyIC8+VXNhZ2U6PGJyIC8+JyArIGNvbW1hbmQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHByb3RvID0gY29tbWFuZCArICcgJyArIHVzYWdlO1xuXHRcdFx0XHRcdFx0aGVscCArPSAnPGJyIC8+PGJyIC8+VXNhZ2U6PGJyIC8+JyArIGNvbW1hbmQgKyAnICcgKyB1c2FnZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRoZWxwID0gaGVscC5yZXBsYWNlKG5ldyBSZWdFeHAoY29tbWFuZCwgJ2cnKSwgJzxzdHJvbmc+JyArIGNvbW1hbmQgKyAnPC9zdHJvbmc+Jyk7XG5cblx0XHRcdFx0XHRkaWN0LnB1c2goe1xuXHRcdFx0XHRcdFx0Y29tbWFuZDogY29tbWFuZCxcblx0XHRcdFx0XHRcdHNlY3VyZWQ6IHNlY3VyZWQsXG5cdFx0XHRcdFx0XHRoZWxwOiBoZWxwLFxuXHRcdFx0XHRcdFx0cHJvdG86IHByb3RvLFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0YW1pV2ViQXBwLnJlcGxhY2VIVE1MKCcjRDg0N0M0NEJfRDI4Rl80OUIzX0FGNzlfN0E2OEIzMzA1RUQyJywgdGhpcy5mcmFnbWVudENvbW1hbmQsIHtkaWN0OiBkaWN0fSkuZG9uZSgoKSA9PiB7XG5cblx0XHRcdFx0cmVzdWx0LnJlc29sdmUoKTtcblx0XHRcdH0pO1xuXG5cdFx0fSkuZmFpbCgoZGF0YSwgbWVzc2FnZSkgPT4ge1xuXG5cdFx0XHRyZXN1bHQucmVqZWN0KG1lc3NhZ2UpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdGV4ZWN1dGU6IGZ1bmN0aW9uKGNvbW1hbmQsIGNvbnZlcnRlcilcblx0e1xuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbW1hbmQgPSBjb21tYW5kLnRyaW0oKTtcblx0XHRjb252ZXJ0ZXIgPSBjb252ZXJ0ZXIudHJpbSgpO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0aWYoY29tbWFuZClcblx0XHR7XG5cdFx0XHRhbWlXZWJBcHAubG9jaygpO1xuXG5cdFx0XHRhbWlDb21tYW5kLmV4ZWN1dGUoY29tbWFuZCwge2NvbnZlcnRlcjogY29udmVydGVyfSkuYWx3YXlzKChkYXRhLCBtZXNzYWdlLCB1cmwpID0+IHtcblxuXHRcdFx0XHRjb25zdCBkaWN0ID0ge1xuXHRcdFx0XHRcdGRhdGE6IChjb252ZXJ0ZXIgPT09ICdBTUlYbWxUb0pzb24ueHNsJykgPyBKU09OLnN0cmluZ2lmeShkYXRhLCB1bmRlZmluZWQsIDIpIDogZGF0YSxcblx0XHRcdFx0XHR1cmw6IHVybCxcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRhbWlXZWJBcHAucHJlcGVuZEhUTUwoJyNBQjRCQTQ4M19FRTI3XzQ0RDBfQkI1NF9GNUJGQ0ZFNERBN0UnLCB0aGlzLmZyYWdtZW50UmVzdWx0LCB7ZGljdDogZGljdH0pLmRvbmUoZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0XHRhbWlXZWJBcHAudW5sb2NrKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0c2VsZWN0OiBmdW5jdGlvbihjb21tYW5kKVxuXHR7XG5cdFx0JCgnI0NFOUE1MENEXzYzQ0FfNEExRV9CMzM2X0Y0NTM5OUJFQzg0RCcpLnZhbChjb21tYW5kKTtcblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdGNvcHk6IGZ1bmN0aW9uKHRleHQpXG5cdHtcblx0XHRhbWlXZWJBcHAuY3JlYXRlQ29udHJvbChudWxsLCB0aGlzLCAndGV4dEJveCcsIFt0ZXh0XSwge30pO1xuXHR9LFxuXG5cdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0c2F2ZTogZnVuY3Rpb24oZGF0YSlcblx0e1xuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdGNvbnN0IGNvbnZlcnRlciA9ICQoJyNDOEQxMDg5NV9FOEE3XzQ2QTBfQjYzOF9DOEREREVEOEY5MUMnKS52YWwoKS50cmltKCk7XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRsZXQgZmlsZU1pbWU7XG5cdFx0bGV0IGZpbGVOYW1lO1xuXG5cdFx0LyoqLyBpZihjb252ZXJ0ZXIgPT09ICdBTUlYbWxUb1htbC54c2wnKVxuXHRcdHtcblx0XHRcdGZpbGVNaW1lID0gJ2FwcGxpY2F0aW9uL3htbCc7XG5cdFx0XHRmaWxlTmFtZSA9ICdyZXN1bHQueG1sJztcblx0XHR9XG5cdFx0ZWxzZSBpZihjb252ZXJ0ZXIgPT09ICdBTUlYbWxUb0pzb24ueHNsJylcblx0XHR7XG5cdFx0XHRmaWxlTWltZSA9ICdhcHBsaWNhdGlvbi9qc29uJztcblx0XHRcdGZpbGVOYW1lID0gJ3Jlc3VsdC5qc29uJztcblx0XHR9XG5cdFx0ZWxzZSBpZihjb252ZXJ0ZXIgPT09ICdBTUlYbWxUb0Nzdi54c2wnKVxuXHRcdHtcblx0XHRcdGZpbGVNaW1lID0gJ3RleHQvY3N2Jztcblx0XHRcdGZpbGVOYW1lID0gJ3Jlc3VsdC5jc3YnO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0ZmlsZU1pbWUgPSAndGV4dC9wbGFpbic7XG5cdFx0XHRmaWxlTmFtZSA9ICdyZXN1bHQudHh0Jztcblx0XHR9XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHRzYXZlQXMobmV3IEJsb2IoW2FtaVdlYkFwcC5odG1sVG9UZXh0KGRhdGEpXSwge3R5cGU6IGZpbGVNaW1lfSksIGZpbGVOYW1lKTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0fSxcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuLyogR0xPQkFMIElOU1RBTkNFICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuY29uc3QgY29tbWFuZEFwcCA9IG5ldyBDb21tYW5kQXBwKCk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuIl19
