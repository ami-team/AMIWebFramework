<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<title>AMI</title>

		<script type="text/javascript" src="js/jquery.min.js"></script>
	</head>
	<body>

		<nav class="navbar navbar-expand-lg navbar-light bg-light">

			<ul class="navbar-nav ml-auto" id="ami_login_content"></ul>

		</nav>

		<br />

		<div id="ami_alert_content"></div>

		<div class="text-center">
			<a href="#" class="btn btn-sm btn-primary ami-glance" data-paper-type="paper" data-ref-code="EXOT-2016-13">Manage datasets</a>
		</div>

		<script type="text/javascript" src="js/ami.min.js?embedded"></script>

		<script type="text/javascript">
			/*-------------------------------------------------*/

			var amiIsAuth;

			/*-------------------------------------------------*/

			amiWebApp.onRefresh = function(isAuth) {

				amiIsAuth = isAuth;
			};

			/*-------------------------------------------------*/

			amiWebApp.onReady = function() {

				return amiWebApp.loadResources(['ctrl:glance', 'ctrl:messageBox']).done(function(controls) {

					var ctrl1 = new controls[0];
					var ctrl2 = new controls[1];

					$('.ami-glance').each(function() {

						var paperType = $(this).attr('data-paper-type');
						var  refCode  = $(this).attr( 'data-ref-code' );

						$(this).click(function(ctrl1, ctrl2, paperType, refCode) {

							return function(e) {

								if(!amiIsAuth)
								{
									ctrl2.show('You must have a valid AMI account!');
								}
								else
								{
									ctrl1.render(paperType, refCode);
								}

								e.preventDefault();
							};

						}(ctrl1, ctrl2, paperType, refCode));
					});
				});
			};

			/*-------------------------------------------------*/

			amiWebApp.start({
				endpoint_url: 'https://ami.in2p3.fr/AMI/servlet/net.hep.atlas.Database.Bookkeeping.AMI.Servlet.FrontEnd'
			});

			/*-------------------------------------------------*/
		</script>

	</body>
</html>
