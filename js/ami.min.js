/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-2020 The AMI Team / LPSC / CNRS
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

"use strict";function _createForOfIteratorHelperLoose(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var amiTwig={version:"1.1.0"};"undefined"!=typeof exports&&(amiTwig.fs=require("fs"),module.exports.amiTwig=amiTwig),amiTwig.tokenizer={tokenize:function(e,t,n,r,i,a){if(r.length!==i.length)throw"`tokenDefs.length != tokenTypes.length`";var o,s,l=[],c=[],u=[],p=0,d=e.length,h="";e:for(;p<d;)if("\n"===(s=e.charAt(0))&&t++,n.indexOf(s)>=0){if(h){if(a)throw"invalid token `"+h+"`";l.push(h),c.push(-1),u.push(t),h=""}e=e.substring(1),p+=1}else{for(var f in r)if(o=this._match(e,r[f])){if(h){if(a)throw"invalid token `"+h+"`";l.push(h),c.push(-1),u.push(t),h=""}l.push(o),c.push(i[f]),u.push(t),e=e.substring(o.length),p+=o.length;continue e}h+=s,e=e.substring(1),p+=1}if(h){if(a)throw"invalid token `"+h+"`";l.push(h),c.push(-1),u.push(t)}return{tokens:l,types:c,lines:u}},_match:function(e,t){var n;return t instanceof RegExp?null!==(n=e.match(t))&&this._checkNextChar(e,n[0])?n[0]:null:0===(n=e.indexOf(t))&&this._checkNextChar(e,t)?t:null},_alnum:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_checkNextChar:function(e,t){var n=t.length,r=e.charCodeAt(n-0),i=e.charCodeAt(n-1);return isNaN(r)||0===this._alnum[r]||0===this._alnum[i]}},amiTwig.expr={},amiTwig.expr.tokens={$init:function(){this.IS_XXX=[this.DEFINED,this.NULL,this.EMPTY,this.ITERABLE,this.EVEN,this.ODD],this.XXX_WITH=[this.STARTS_WITH,this.ENDS_WITH],this.PLUS_MINUS=[this.CONCAT,this.PLUS,this.MINUS],this.MUL_FLDIV_DIV_MOD=[this.MUL,this.FLDIV,this.DIV,this.MOD],this.RX=[this.RP,this.RB1]},LOGICAL_OR:100,LOGICAL_AND:101,BITWISE_OR:102,BITWISE_XOR:103,BITWISE_AND:104,NOT:105,IS:106,DEFINED:107,NULL:108,EMPTY:109,ITERABLE:110,EVEN:111,ODD:112,CMP_OP:113,STARTS_WITH:114,ENDS_WITH:115,MATCHES:116,IN:117,RANGE:118,CONCAT:119,PLUS:120,MINUS:121,POWER:122,MUL:123,FLDIV:124,DIV:125,MOD:126,DOUBLE_QUESTION:127,QUESTION:128,COLON:129,DOT:130,COMMA:131,PIPE:132,LP:133,RP:134,LB1:135,RB1:136,LB2:137,RB2:138,SID:139,TERMINAL:140,LST:200,DIC:201,FUN:202,VAR:203},amiTwig.expr.tokens.$init(),amiTwig.expr.Tokenizer=function(e,t){this._spaces=[" ","\t","\n","\r"],this._tokenDefs=["or","and","b-or","b-xor","b-and","not","is","defined","null","empty","iterable","even","odd","===","==","!==","!=","<=",">=","<",">",/^starts\s+with/,/^ends\s+with/,"matches","in","..","~","+","-","**","*","//","/","%","??","?",":",".",",","|","(",")","[","]","{","}","true","false",/^[0-9]+\.[0-9]+/,/^[0-9]+/,/^'(\\'|[^'])*'/,/^"(\\"|[^"])*"/,/^[a-zA-Z_$][a-zA-Z0-9_$]*/],this._tokenTypes=[amiTwig.expr.tokens.LOGICAL_OR,amiTwig.expr.tokens.LOGICAL_AND,amiTwig.expr.tokens.BITWISE_OR,amiTwig.expr.tokens.BITWISE_XOR,amiTwig.expr.tokens.BITWISE_AND,amiTwig.expr.tokens.NOT,amiTwig.expr.tokens.IS,amiTwig.expr.tokens.DEFINED,amiTwig.expr.tokens.NULL,amiTwig.expr.tokens.EMPTY,amiTwig.expr.tokens.ITERABLE,amiTwig.expr.tokens.EVEN,amiTwig.expr.tokens.ODD,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.STARTS_WITH,amiTwig.expr.tokens.ENDS_WITH,amiTwig.expr.tokens.MATCHES,amiTwig.expr.tokens.IN,amiTwig.expr.tokens.RANGE,amiTwig.expr.tokens.CONCAT,amiTwig.expr.tokens.PLUS,amiTwig.expr.tokens.MINUS,amiTwig.expr.tokens.POWER,amiTwig.expr.tokens.MUL,amiTwig.expr.tokens.FLDIV,amiTwig.expr.tokens.DIV,amiTwig.expr.tokens.MOD,amiTwig.expr.tokens.DOUBLE_QUESTION,amiTwig.expr.tokens.QUESTION,amiTwig.expr.tokens.COLON,amiTwig.expr.tokens.DOT,amiTwig.expr.tokens.COMMA,amiTwig.expr.tokens.PIPE,amiTwig.expr.tokens.LP,amiTwig.expr.tokens.RP,amiTwig.expr.tokens.LB1,amiTwig.expr.tokens.RB1,amiTwig.expr.tokens.LB2,amiTwig.expr.tokens.RB2,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.SID],this.$init=function(e,t){var n=amiTwig.tokenizer.tokenize(e,t,this._spaces,this._tokenDefs,this._tokenTypes,!0);this.tokens=n.tokens,this.types=n.types,this.i=0},this.next=function(e){void 0===e&&(e=1),this.i+=e},this.isEmpty=function(){return this.i>=this.tokens.length},this.peekToken=function(){return this.tokens[this.i]},this.peekType=function(){return this.types[this.i]},this.checkType=function(e){if(this.i<this.tokens.length){var t=this.types[this.i];return e instanceof Array?e.indexOf(t)>=0:e===t}return!1},this.$init(e,t)},amiTwig.expr.Compiler=function(e,t){this.$init(e,t)},amiTwig.expr.Compiler.prototype={$init:function(e,t){if(this.tokenizer=new amiTwig.expr.Tokenizer(this.code=e,this.line=t),this.rootNode=this.parseNullCoalescing(),!1===this.tokenizer.isEmpty())throw"syntax error, line `"+this.line+"`, unexpected token `"+this.tokenizer.peekToken()+"`"},dump:function(){return this.rootNode.dump()},parseNullCoalescing:function(){for(var e,t,n=this.parseLogicalOr();this.tokenizer.checkType(amiTwig.expr.tokens.DOUBLE_QUESTION);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseLogicalOr(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseLogicalOr:function(){for(var e,t,n=this.parseLogicalAnd();this.tokenizer.checkType(amiTwig.expr.tokens.LOGICAL_OR);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseLogicalAnd(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseLogicalAnd:function(){for(var e,t,n=this.parseBitwiseOr();this.tokenizer.checkType(amiTwig.expr.tokens.LOGICAL_AND);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseBitwiseOr(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseBitwiseOr:function(){for(var e,t,n=this.parseBitwiseXor();this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_OR);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseBitwiseXor(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseBitwiseXor:function(){for(var e,t,n=this.parseBitwiseAnd();this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_XOR);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseBitwiseAnd(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseBitwiseAnd:function(){for(var e,t,n=this.parseNot();this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_AND);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseNot(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseNot:function(){var e,t;return this.tokenizer.checkType(amiTwig.expr.tokens.NOT)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseComp(),t.nodeLeft=null,t.nodeRight=e,t):this.parseComp()},parseComp:function(){var e,t,n,r=this.parseAddSub();if(this.tokenizer.checkType(amiTwig.expr.tokens.IS)){if(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),n=t,this.tokenizer.checkType(amiTwig.expr.tokens.NOT)&&(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t.nodeLeft=null,t.nodeRight=n),!this.tokenizer.checkType(amiTwig.expr.tokens.IS_XXX))throw"syntax error, line `"+this.line+"`, keyword `defined`, `null`, `empty`, `iterable`, `even` or `odd` expected";e=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),n.nodeLeft=r,n.nodeRight=e,r=t}else this.tokenizer.checkType(amiTwig.expr.tokens.CMP_OP)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseAddSub(),t.nodeLeft=r,t.nodeRight=e,r=t):this.tokenizer.checkType(amiTwig.expr.tokens.XXX_WITH)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseAddSub(),t.nodeLeft=r,t.nodeRight=e,r=t):this.tokenizer.checkType(amiTwig.expr.tokens.MATCHES)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseAddSub(),t.nodeLeft=r,t.nodeRight=e,r=t):this.tokenizer.checkType(amiTwig.expr.tokens.IN)&&(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseAddSub(),t.nodeLeft=r,t.nodeRight=e,r=t);return r},parseAddSub:function(){for(var e,t,n=this.parseMulDiv();this.tokenizer.checkType(amiTwig.expr.tokens.PLUS_MINUS);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseMulDiv(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseMulDiv:function(){for(var e,t,n=this.parsePlusMinus();this.tokenizer.checkType(amiTwig.expr.tokens.MUL_FLDIV_DIV_MOD);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parsePlusMinus(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parsePlusMinus:function(){var e,t;return this.tokenizer.checkType(amiTwig.expr.tokens.PLUS_MINUS)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parsePower(),t.nodeLeft=null,t.nodeRight=e,t):this.parsePower()},parsePower:function(){for(var e,t,n=this.parseFilter();this.tokenizer.checkType(amiTwig.expr.tokens.POWER);)t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseFilter(),t.nodeLeft=n,t.nodeRight=e,n=t;return n},parseFilter:function(){for(var e,t,n=this.parseDot1();this.tokenizer.checkType(amiTwig.expr.tokens.PIPE);){for(this.tokenizer.next(),t=e=this.parseDot1(!0);t.nodeType===amiTwig.expr.tokens.DOT;t=t.nodeLeft);t.list.unshift(n),n=e}return n},parseDot1:function(e){var t=this.parseDot2(e);if(t){for(var n=t;n.nodeType===amiTwig.expr.tokens.DOT;n=n.nodeLeft);n.q&&(n.nodeType===amiTwig.expr.tokens.FUN?n.nodeValue in amiTwig.stdlib?n.nodeValue="amiTwig.stdlib."+n.nodeValue:n.nodeValue="_."+n.nodeValue:n.nodeType===amiTwig.expr.tokens.VAR&&(n.nodeValue="_."+n.nodeValue),n.q=!1)}return t},parseDot2:function(e){for(var t,n,r=this.parseDot3(e);this.tokenizer.checkType(amiTwig.expr.tokens.DOT);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),"."),this.tokenizer.next(),t=this.parseDot3(e),n.nodeLeft=r,n.nodeRight=t,r=n;return r},parseDot3:function(e){for(var t,n,r=this.parseX(e);this.tokenizer.checkType(amiTwig.expr.tokens.LB1);){if(this.tokenizer.next(),t=this.parseNullCoalescing(),!this.tokenizer.checkType(amiTwig.expr.tokens.RB1))throw"syntax error, line `"+this.line+"`, `]` expected";this.tokenizer.next(),(n=new amiTwig.expr.Node(amiTwig.expr.tokens.DOT,"[]")).nodeLeft=r,n.nodeRight=t,r=n}return r},parseX:function(e){var t;if(t=this.parseGroup())return t;if(t=this.parseArray())return t;if(t=this.parseObject())return t;if(t=this.parseFunVar(e))return t;if(t=this.parseTerminal())return t;throw"syntax error, line `"+this.line+"`, syntax error or tuncated expression"},parseGroup:function(){var e;if(this.tokenizer.checkType(amiTwig.expr.tokens.LP)){if(this.tokenizer.next(),e=this.parseNullCoalescing(),this.tokenizer.checkType(amiTwig.expr.tokens.RP))return this.tokenizer.next(),e;throw"syntax error, line `"+this.line+"`, `)` expected"}return null},parseArray:function(){var e,t;if(this.tokenizer.checkType(amiTwig.expr.tokens.LB1)){if(this.tokenizer.next(),t=this._parseSinglets(),this.tokenizer.checkType(amiTwig.expr.tokens.RB1))return this.tokenizer.next(),(e=new amiTwig.expr.Node(amiTwig.expr.tokens.LST,"Array")).list=t,e;throw"syntax error, line `"+this.line+"`, `]` expected"}return null},parseObject:function(){var e,t;if(this.tokenizer.checkType(amiTwig.expr.tokens.LB2)){if(this.tokenizer.next(),t=this._parseDoublets(),this.tokenizer.checkType(amiTwig.expr.tokens.RB2))return this.tokenizer.next(),(e=new amiTwig.expr.Node(amiTwig.expr.tokens.DIC,"Object")).dict=t,e;throw"syntax error, line `"+this.line+"`, `}` expected"}return null},parseFunVar:function(e){var t;if(this.tokenizer.checkType(amiTwig.expr.tokens.SID)){if((t=new amiTwig.expr.Node(0,e?"filter_"+this.tokenizer.peekToken():this.tokenizer.peekToken())).q=!0,this.tokenizer.next(),this.tokenizer.checkType(amiTwig.expr.tokens.LP)){if(this.tokenizer.next(),t.list=this._parseSinglets(),!this.tokenizer.checkType(amiTwig.expr.tokens.RP))throw"syntax error, line `"+this.line+"`, `)` expected";this.tokenizer.next(),t.nodeType=amiTwig.expr.tokens.FUN}else t.nodeType=e?amiTwig.expr.tokens.FUN:amiTwig.expr.tokens.VAR,t.list=[];return t}return null},_parseSinglets:function(){for(var e=[];!1===this.tokenizer.checkType(amiTwig.expr.tokens.RX)&&(this._parseSinglet(e),!0===this.tokenizer.checkType(amiTwig.expr.tokens.COMMA));)this.tokenizer.next();return e},_parseDoublets:function(){for(var e={};!1===this.tokenizer.checkType(amiTwig.expr.tokens.RB2)&&(this._parseDoublet(e),!0===this.tokenizer.checkType(amiTwig.expr.tokens.COMMA));)this.tokenizer.next();return e},_parseSinglet:function(e){e.push(this.parseNullCoalescing())},_parseDoublet:function(e){if(!this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL))throw"syntax error, line `"+this.line+"`, terminal expected";var t=this.tokenizer.peekToken();if(this.tokenizer.next(),!this.tokenizer.checkType(amiTwig.expr.tokens.COLON))throw"syntax error, line `"+this.line+"`, `:` expected";this.tokenizer.next(),e[t]=this.parseNullCoalescing()},parseTerminal:function(){var e,t,n;if(this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL)){if(e=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),!this.tokenizer.checkType(amiTwig.expr.tokens.RANGE))return e;if(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL))return t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),n.nodeLeft=e,n.nodeRight=t,n}return null}},amiTwig.expr.Node=function(e,t){this.$init(e,t)},amiTwig.expr.Node.prototype={$init:function(e,t){this.nodeType=e,this.nodeValue=t,this.nodeLeft=null,this.nodeRight=null,this.list=null,this.dict=null},_dump:function(e,t,n){var r,i=n[0];if(e.push("\tnode"+i+' [label="'+this.nodeValue.replace(/"/g,'\\"')+'"];'),this.nodeLeft&&(r=++n[0],t.push("\tnode"+i+" -> node"+r+";"),this.nodeLeft._dump(e,t,n)),this.nodeRight&&(r=++n[0],t.push("\tnode"+i+" -> node"+r+";"),this.nodeRight._dump(e,t,n)),this.list)for(var a in this.list)r=++n[0],t.push("\tnode"+i+" -> node"+r+' [label="['+a.replace(/"/g,'\\"')+']"];'),this.list[a]._dump(e,t,n);if(this.dict)for(var o in this.dict)r=++n[0],t.push("\tnode"+i+" -> node"+r+' [label="['+o.replace(/"/g,'\\"')+']"];'),this.dict[o]._dump(e,t,n)},dump:function(){var e=[],t=[];return this._dump(e,t,[0]),"digraph ast {\n\trankdir=TB;\n"+e.join("\n")+"\n"+t.join("\n")+"\n}"}},amiTwig.tmpl={},amiTwig.tmpl.Compiler=function(e){this.$init(e)},amiTwig.tmpl.Compiler.prototype={STATEMENT_RE:/\{%\s*([a-zA-Z]+)\s*((?:.|\n)*?)\s*%\}/,COMMENT_RE:/\{#\s*((?:.|\n)*?)\s*#\}/g,_count:function(e){for(var t=0,n=e.length,r=0;r<n;r++)"\n"===e[r]&&t++;return t},$init:function(e){var t,n,r=1;this.rootNode={line:r,keyword:"@root",expression:"",blocks:[{expression:"@true",list:[]}],value:""};var i,a=[this.rootNode],o=[0];for(e=e.replace(this.COMMENT_RE,"");;e=e.substr(n)){var s=a[a.length-1],l=o[o.length-1],c=e.match(this.STATEMENT_RE);if(null===c){r+=this._count(e),s.blocks[l].list.push({line:r,keyword:"@text",expression:"",blocks:[],value:e});for(var u=[],p=a.length-1;p>0;p--)"if"===a[p].keyword?u.push("missing keyword `endif`"):"for"===a[p].keyword&&u.push("missing keyword `endfor`");if(u.length>0)throw"syntax error, line `"+r+"`, "+u.join(", ");break}var d=c[0],h=c[1],f=c[2];t=c.index+0,n=c.index+d.length;var m=e.substr(0,t),g=e.substr(0,n);switch(r+=this._count(g),m&&(i={line:r,keyword:"@text",expression:"",blocks:[],value:m},s.blocks[l].list.push(i)),h){case"flush":case"autoescape":case"spaceless":case"verbatim":break;case"do":case"set":case"include":i={line:r,keyword:h,expression:f,blocks:[],value:""},s.blocks[l].list.push(i);break;case"if":case"for":i={line:r,keyword:h,blocks:[{expression:f,list:[]}],value:""},s.blocks[l].list.push(i),a.push(i),o.push(0);break;case"elseif":if("if"!==s.keyword)throw"syntax error, line `"+r+"`, unexpected keyword `elseif`";l=s.blocks.length,s.blocks.push({expression:f,list:[]}),o[o.length-1]=l;break;case"else":if("if"!==s.keyword&&"for"!==s.keyword)throw"syntax error, line `"+r+"`, unexpected keyword `else`";l=s.blocks.length,s.blocks.push({expression:"@true",list:[]}),o[o.length-1]=l;break;case"endif":if("if"!==s.keyword)throw"syntax error, line `"+r+"`, unexpected keyword `endif`";a.pop(),o.pop();break;case"endfor":if("for"!==s.keyword)throw"syntax error, line `"+r+"`, unexpected keyword `endfor`";a.pop(),o.pop();break;default:throw"syntax error, line `"+r+"`, unknown keyword `"+h+"`"}}},dump:function(){return JSON.stringify(this.rootNode,null,2)}},amiTwig.engine={VARIABLE_RE:/\{\{\s*(.*?)\s*\}\}/g,_render:function(e,t,n,r){var i,a,o=this;switch(void 0===n&&(n={}),void 0===r&&(r={}),this.dict=n,this.tmpls=r,t.keyword){case"do":amiTwig.expr.cache.eval(t.expression,t.line,n);break;case"set":if(!(i=t.expression.match(/([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*(.+)/)))throw"syntax error, line `"+t.line+"`, invalid `set` statement";n[i[1]]=amiTwig.expr.cache.eval(i[2],t.line,n);break;case"@text":e.push(t.value.replace(this.VARIABLE_RE,function(e,r){var i=amiTwig.expr.cache.eval(r,t.line,n);return null!==i&&void 0!==i?i:""}));break;case"if":case"@root":t.blocks.every(function(i){if("@true"===(a=i.expression)||amiTwig.expr.cache.eval(a,t.line,n)){for(var s in i.list)o._render(e,i.list[s],n,r);return!1}return!0});break;case"for":var s,l,c;if(i=t.blocks[0].expression.match(/([a-zA-Z_$][a-zA-Z0-9_$]*)\s*,\s*([a-zA-Z_$][a-zA-Z0-9_$]*)\s+in\s+(.+)/))s=i[1],l=i[2],c=i[3];else{if(!(i=t.blocks[0].expression.match(/([a-zA-Z_$][a-zA-Z0-9_$]*)\s+in\s+(.+)/)))throw"syntax error, line `"+t.line+"`, invalid `for` statement";s=i[1],l=null,c=i[2]}var u,p=amiTwig.expr.cache.eval(c,t.line,n),d=Object.prototype.toString.call(p);if("[object Object]"===d)u=l?Object.entries(p):Object.keys(p);else{if(u=p,"[object Array]"!==d&&"[object String]"!==d)throw"syntax error, line `"+t.line+"`, right operande not iterable";if(l)throw"syntax error, line `"+t.line+"`, right operande not an object"}var h=u.length;if(h>0){var f=0,m=t.blocks[0].list;if(l){var g=n[s],y=n[l],_=n.loop;n.loop={length:h,parent:n.loop};for(var b,T=_createForOfIteratorHelperLoose(u);!(b=T()).done;){var w=b.value,k=w[0],A=w[1];for(var x in n[s]=k,n[l]=A,n.loop.first=0===f,n.loop.last=f===h-1,n.loop.revindex0=h-f,n.loop.index0=f,f++,n.loop.revindex=h-f,n.loop.index=f,m)this._render(e,m[x],n,r)}n.loop=_,n[l]=y,n[s]=g}else{var v=n[s],S=n.loop;n.loop={length:h,parent:n.loop};for(var L,E=_createForOfIteratorHelperLoose(u);!(L=E()).done;){var I=L.value;for(var C in n[s]=I,n.loop.first=0===f,n.loop.last=f===h-1,n.loop.revindex0=h-f,n.loop.index0=f,f++,n.loop.revindex=h-f,n.loop.index=f,m)this._render(e,m[C],n,r)}n.loop=S,n[s]=v}}else if(t.blocks.length>1){var O=t.blocks[1].list;for(var j in O)this._render(e,O[j],n,r)}break;case"include":var D,R,$=t.expression;(i=$.match(/(.+)\s+with\s+(.+)\s+only$/))?(a=i[1],D=i[2],R=!1):(i=$.match(/(.+)\s+with\s+(.+)$/))?(a=i[1],D=i[2],R=!0):(i=$.match(/(.+)\s+only$/))?(a=i[1],D="{}",R=!1):(a=$,D="{}",R=!0);var N=amiTwig.expr.cache.eval(a,t.line,n)||"";if("[object String]"!==Object.prototype.toString.call(N))throw"runtime error, line `"+t.line+"`, string expected";var B=amiTwig.expr.cache.eval(D,t.line,n)||{};if("[object Object]"!==Object.prototype.toString.call(B))throw"runtime error, line `"+t.line+"`, object expected";e.push(amiTwig.stdlib.include(N,B,R,!1))}},render:function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=[];switch(Object.prototype.toString.call(e)){case"[object String]":this._render(r,new amiTwig.tmpl.Compiler(e).rootNode,t,n);break;case"[object Object]":this._render(r,e,t,n)}return r.join("")}},amiTwig.expr.cache={dict:{},eval:function _eval(expression,line,_){var f;return f=expression in this.dict?this.dict[expression]:this.dict[expression]=eval(amiTwig.expr.interpreter.getJS(new amiTwig.expr.Compiler(expression,line))),_||(_={}),f.call(_,_)}},amiTwig.stdlib={isUndefined:function(e){return void 0===e},isDefined:function(e){return void 0!==e},isNull:function(e){return null===e},isNotNull:function(e){return null!==e},isEmpty:function(e){if(null===e||!1===e||""===e)return!0;var t=Object.prototype.toString.call(e);return"[object Array]"===t&&0===e.length||"[object Object]"===t&&0===Object.keys(e).length},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isIterable:function(e){var t=Object.prototype.toString.call(e);return"[object String]"===t||"[object Array]"===t||"[object Object]"===t},isEven:function(e){return this.isNumber(e)&&0==(1&e)},isOdd:function(e){return this.isNumber(e)&&1==(1&e)},isInObject:function(e,t){return this.isArray(t)||this.isString(t)?t.indexOf(e)>=0:!!this.isObject(t)&&e in t},isInRange:function(e,t,n){return this.isNumber(t)&&this.isNumber(n)?e>=t&&e<=n:!(!this.isString(t)||1!==t.length||!this.isString(n)||1!==n.length)&&(e.charCodeAt(0)>=t.charCodeAt(0)&&e.charCodeAt(0)<=n.charCodeAt(0))},range:function(e,t,n){void 0===n&&(n=1);var r=[];if(this.isNumber(e)&&this.isNumber(t))for(var i=e;i<=t;i+=n)r.push(i);else if(this.isString(e)&&1===e.length&&this.isString(t)&&1===t.length)for(var a=e.charCodeAt(0);a<=t.charCodeAt(0);a+=n)r.push(String.fromCharCode(a));return r},filter_length:function(e){return this.isString(e)||this.isArray(e)?e.length:this.isObject(e)?Object.keys(e).length:0},filter_first:function(e){return(this.isString(e)||this.isArray(e))&&e.length>0?e[0]:""},filter_last:function(e){return(this.isString(e)||this.isArray(e))&&e.length>0?e[e.length-1]:""},filter_slice:function(e,t,n){return this.isString(e)||this.isArray(e)?e.slice(t,n):null},filter_merge:function(){if(arguments.length>1){if(this.isString(arguments[0])){var e=[];for(var t in arguments){var n=arguments[t];if(!this.isString(n))return null;e.push(arguments[t])}return e.join("")}if(this.isArray(arguments[0])){var r=[];for(var i in arguments){var a=arguments[i];if(!this.isArray(a))return null;for(var o in a)r.push(a[o])}return r}if(this.isObject(arguments[0])){var s={};for(var l in arguments){var c=arguments[l];if(!this.isObject(c))return null;for(var u in c)s[u]=c[u]}return s}}return null},filter_sort:function(e){return this.isArray(e)?e.sort():[]},filter_reverse:function(e){return this.isArray(e)?e.reverse():[]},filter_join:function(e,t){return this.isArray(e)?e.join(t):""},filter_keys:function(e){return this.isObject(e)?Object.keys(e):[]},filter_column:function(e,t){return this.isArray(e)?e.map(function(e){return e[t]}):[]},filter_batch:function(e,t,n){void 0===n&&(n="");var r=[];if(this.isArray(e)&&this.isNumber(t)){for(var i,a=e.length,o=Math.ceil(a/t)*t,s=0;s<a;s+=t)r.push(i=e.slice(s,s+t));for(var l=a;l<o;l+=1)i.push(n)}return r},startsWith:function(e,t){if(this.isString(e)&&this.isString(t)){return 0===e.indexOf(t,0)}return!1},endsWith:function(e,t){if(this.isString(e)&&this.isString(t)){var n=e.length-t.length;return e.indexOf(t,n)===n}return!1},match:function(e,t){if(this.isString(e)&&this.isString(t)){var n=t.indexOf("/"),r=t.lastIndexOf("/");if(0===n||n<r)try{return new RegExp(t.substring(n+1,r),t.substring(r+1)).test(e)}catch(e){}}return!1},filter_default:function(e,t){return e||t||""},filter_lower:function(e){return this.isString(e)?e.toLowerCase():""},filter_upper:function(e){return this.isString(e)?e.toUpperCase():""},filter_capitalize:function(e){return this.isString(e)?e.trim().toLowerCase().replace(/^\S/g,function(e){return e.toUpperCase()}):""},filter_title:function(e){return this.isString(e)?e.trim().toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}):""},filter_trim:function(e){return this.isString(e)?e.trim():""},_replace:function(e,t,n){var r=[],i=e.length,a=t.length;if(a!=n.length)throw"internal error";e:for(var o=0;o<i;o+=0){for(var s=e.substring(o),l=0;l<a;l+=1)if(0===s.indexOf(t[l])){r.push(n[l]),o+=t[l].length;continue e}r.push(e.charAt(o++))}return r.join("")},_textToHtmlX:["&",'"',"<",">"],_textToHtmlY:["&amp;","&quot;","&lt;","&gt;"],_textToStringX:["\\","\n",'"',"'"],_textToStringY:["\\\\","\\n",'\\"',"\\'"],_textToJsonStringX:["\\","\n",'"'],_textToJsonStringY:["\\\\","\\n",'\\"'],filter_escape:function(e,t){if(this.isString(e))switch(t||"html"){case"html":case"html_attr":return this._replace(e,this._textToHtmlX,this._textToHtmlY);case"js":case"string":return this._replace(e,this._textToStringX,this._textToStringY);case"json":return this._replace(e,this._textToJsonStringX,this._textToJsonStringY);case"url":return encodeURIComponent(e);default:return e}return""},filter_url_encode:function(e){return this.isString(e)?encodeURIComponent(e):""},filter_nl2br:function(e){return this.isString(e)?e.replace(/\n/g,"<br/>"):""},filter_raw:function(e){return this.isString(e)?e:""},filter_replace:function(e,t){return this.isString(e)&&this.isObject(t)?this._replace(e,Object.keys(t),Object.values(t)):""},filter_split:function(e,t,n){return this.isString(e)?e.split(t,n):[]},filter_abs:function(e){return Math.abs(e)},filter_round:function(e,t){switch(t){case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:return Math.round(e)}},min:function(){var e=1===arguments.length&&(this.isArray(arguments[0])||this.isObject(arguments[0]))?arguments[0]:arguments,t=Number.POSITIVE_INFINITY;for(var n in e){if(!this.isNumber(e[n]))return Number.NaN;t>e[n]&&(t=e[n])}return t},max:function(){var e=1===arguments.length&&(this.isArray(arguments[0])||this.isObject(arguments[0]))?arguments[0]:arguments,t=Number.NEGATIVE_INFINITY;for(var n in e){if(!this.isNumber(e[n]))return Number.NaN;t<e[n]&&(t=e[n])}return t},random:function(e){var t=Math.random();if(e){if(this.isArray(e)||this.isObject(e)){var n=Object.keys(e);return e[n[Math.floor(n.length*t)]]}if(this.isString(e))return e[Math.floor(e.length*t)];if(this.isNumber(e))return Math.floor(e*t)}return e=Number.MAX_SAFE_INTEGER,Math.floor(e*t)},filter_json_encode:function(e,t){return JSON.stringify(e,null,this.isNumber(t)?t:2)},filter_json_jspath:function(e,t){return"undefined"!=typeof JSPath?JSPath.apply(t,e):[]},include:function(e,t,n,r){if(void 0===t&&(t={}),void 0===n&&(n=!0),void 0===r&&(r=!1),e in amiTwig.engine.tmpls){var i={};if(n)for(var a in amiTwig.engine.dict)i[a]=amiTwig.engine.dict[a];if(t)for(var o in t)i[o]=t[o];return amiTwig.engine.render(amiTwig.engine.tmpls[e],i)}if(!r)throw"runtime error, could not open `"+e+"`";return""}},amiTwig.stdlib.filter_e=amiTwig.stdlib.filter_escape,amiTwig.expr.interpreter={_getJS:function(e){var t,n,r,i;switch(e.nodeType){case amiTwig.expr.tokens.LST:for(var a in t=[],e.list)t.push(this._getJS(e.list[a]));return"["+t.join(",")+"]";case amiTwig.expr.tokens.DIC:for(var o in t=[],e.dict)t.push(o+":"+this._getJS(e.dict[o]));return"{"+t.join(",")+"}";case amiTwig.expr.tokens.FUN:for(var s in t=[],e.list)t.push(this._getJS(e.list[s]));return e.nodeValue+"("+t.join(",")+")";case amiTwig.expr.tokens.VAR:for(var l in t=[],e.list)t.push("["+this._getJS(e.list[l])+"]");return t.length>0?e.nodeValue+t.join(""):e.nodeValue;case amiTwig.expr.tokens.TERMINAL:return e.nodeValue;case amiTwig.expr.tokens.IS:switch(n=this._getJS(e.nodeLeft),e.nodeRight.nodeType){case amiTwig.expr.tokens.DEFINED:return"amiTwig.stdlib.isDefined("+n+")";case amiTwig.expr.tokens.NULL:return"amiTwig.stdlib.isNull("+n+")";case amiTwig.expr.tokens.EMPTY:return"amiTwig.stdlib.isEmpty("+n+")";case amiTwig.expr.tokens.ITERABLE:return"amiTwig.stdlib.isIterable("+n+")";case amiTwig.expr.tokens.EVEN:return"amiTwig.stdlib.isEven("+n+")";case amiTwig.expr.tokens.ODD:return"amiTwig.stdlib.isOdd("+n+")";default:throw"internal error"}case amiTwig.expr.tokens.IN:return e.nodeRight.nodeType!==amiTwig.expr.tokens.RANGE?"amiTwig.stdlib.isInObject("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")":"amiTwig.stdlib.isInRange("+this._getJS(e.nodeLeft)+","+(n=e.nodeRight.nodeLeft.nodeValue)+","+(r=e.nodeRight.nodeRight.nodeValue)+")";case amiTwig.expr.tokens.STARTS_WITH:return"amiTwig.stdlib.startsWith("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.ENDS_WITH:return"amiTwig.stdlib.endsWith("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.MATCHES:return"amiTwig.stdlib.match("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.RANGE:return"amiTwig.stdlib.range("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.DOT:return n=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"."===e.nodeValue[0]?n+"."+r:n+"["+r+"]";case amiTwig.expr.tokens.FLDIV:return"Math.floor("+(n=this._getJS(e.nodeLeft))+"/"+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.POWER:return"Math.pow("+(n=this._getJS(e.nodeLeft))+","+(r=this._getJS(e.nodeRight))+")";case amiTwig.expr.tokens.DOUBLE_QUESTION:return"(("+(n=this._getJS(e.nodeLeft))+") || ("+(r=this._getJS(e.nodeRight))+"))";default:if(null===e.nodeLeft&&null!==e.nodeRight)return(i=e.nodeType!==amiTwig.expr.tokens.NOT?e.nodeValue:"!")+"("+this._getJS(e.nodeRight)+")";if(null!==e.nodeLeft&&null===e.nodeRight)return i=e.nodeType!==amiTwig.expr.tokens.NOT?e.nodeValue:"!","("+this._getJS(e.nodeLeft)+")"+i;if(null!==e.nodeLeft&&null!==e.nodeRight){switch(e.nodeType){case amiTwig.expr.tokens.LOGICAL_OR:i="||";break;case amiTwig.expr.tokens.LOGICAL_AND:i="&&";break;case amiTwig.expr.tokens.BITWISE_OR:i="|";break;case amiTwig.expr.tokens.BITWISE_XOR:i="^";break;case amiTwig.expr.tokens.BITWISE_AND:i="&";break;case amiTwig.expr.tokens.CONCAT:i="+";break;default:i=e.nodeValue}return"("+(n=this._getJS(e.nodeLeft))+i+(r=this._getJS(e.nodeRight))+")"}}},getJS:function(e){return"(function(_) { return "+this._getJS(e.rootNode)+"; })"},eval:function _eval(expr,_){return _||(_={}),eval(this.getJS(expr)).call(_,_)}},function(){var e={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11},t=function(){var t,n,r,i,a={ID:1,NUM:2,STR:3,BOOL:4,NULL:5,PUNCT:6,EOP:7},o={UNEXP_TOKEN:'Unexpected token "%0"',UNEXP_EOP:"Unexpected end of path"};function s(){for(var t,n=l();y("|");)x(),(t||(t=[n])).push(l());return t?{type:e.CONCAT_EXPR,args:t}:n}function l(){return y("(")?c():p()}function c(){w("(");var t=s();w(")");for(var n,r=[];n=u();)r.push(n);return r.length?t.type===e.PATH?(t.parts=t.parts.concat(r),t):(r.unshift(t),{type:e.PATH,parts:r}):t}function u(){return y("[")?function(){w("[");var t=function(){if(y(":"))return x(),{type:e.POS_EXPR,toIdx:g()};var t=g();if(y(":"))return x(),y("]")?{type:e.POS_EXPR,fromIdx:t}:{type:e.POS_EXPR,fromIdx:t,toIdx:g()};return{type:e.POS_EXPR,idx:t}}();return w("]"),{type:e.POS_PRED,arg:t}}():y("{")?function(){w("{");var t=d();return w("}"),{type:e.OBJ_PRED,arg:t}}():y("(")?c():void 0}function p(){_()||E(x());var t,n=!1;y("^")?(x(),n=!0):T()&&(t=x().val.substr(1));for(var r,i=[];r=b()?function(){var t,n=x().val,r=k();(y("*")||r.type===a.ID||r.type===a.STR)&&(t=x().val);return{type:e.SELECTOR,selector:n,prop:t}}():u();)i.push(r);return{type:e.PATH,fromRoot:n,subst:t,parts:i}}function d(){for(var t,n=h();y("||");)x(),(t||(t=[n])).push(h());return t?{type:e.LOGICAL_EXPR,op:"||",args:t}:n}function h(){for(var t,n=f();y("&&");)x(),(t||(t=[n])).push(f());return t?{type:e.LOGICAL_EXPR,op:"&&",args:t}:n}function f(){for(var t=function t(){var n=function(){var t=m();for(;y("+")||y("-");)t={type:e.MATH_EXPR,op:x().val,args:[t,m()]};return t}();for(;y("<")||y(">")||y("<=")||y(">=");)n={type:e.COMPARISON_EXPR,op:x().val,args:[n,t()]};return n}();y("==")||y("!=")||y("===")||y("!==")||y("^==")||y("==^")||y("^=")||y("=^")||y("$==")||y("==$")||y("$=")||y("=$")||y("*==")||y("==*")||y("*=")||y("=*");)t={type:e.COMPARISON_EXPR,op:x().val,args:[t,f()]};return t}function m(){for(var t=g();y("*")||y("/")||y("%");)t={type:e.MATH_EXPR,op:x().val,args:[t,m()]};return t}function g(){return y("!")||y("-")?{type:e.UNARY_EXPR,op:x().val,arg:g()}:function(){var t=k().type;if(t===a.STR||t===a.NUM||t===a.BOOL||t===a.NULL)return{type:e.LITERAL,val:x().val};if(_())return p();if(y("("))return function(){w("(");var e=d();return w(")"),e}();return E(x())}()}function y(e){var t=k();return t.type===a.PUNCT&&t.val===e}function _(){return b()||T()||y("^")}function b(){var e=k();if(e.type===a.PUNCT){var t=e.val;return"."===t||".."===t}return!1}function T(){var e=k();return e.type===a.ID&&"$"===e.val[0]}function w(e){var t=x();t.type===a.PUNCT&&t.val===e||E(t)}function k(){if(null!==r)return r;var e=n;return r=A(),n=e,r}function A(){for(;e=t[n]," \r\n\t".indexOf(e)>-1;)++n;var e;if(n>=i)return{type:a.EOP,range:[n,n]};var r=function(){var e=n,r=t[n],i=t[n+1];if("."===r){if(v(i))return;return"."===t[++n]?{type:a.PUNCT,val:"..",range:[e,++n]}:{type:a.PUNCT,val:".",range:[e,n]}}if("="===i){var o=t[n+2];if("="===o){if("=!^$*".indexOf(r)>=0)return{type:a.PUNCT,val:r+i+o,range:[e,n+=3]}}else if("^$*".indexOf(o)>=0){if("="===r)return{type:a.PUNCT,val:r+i+o,range:[e,n+=3]}}else if("=!^$*><".indexOf(r)>=0)return{type:a.PUNCT,val:r+i,range:[e,n+=2]}}else if("="===r&&"^$*".indexOf(i)>=0)return{type:a.PUNCT,val:r+i,range:[e,n+=2]};if(r===i&&("|"===r||"&"===r))return{type:a.PUNCT,val:r+i,range:[e,n+=2]};if(":{}()[]^+-*/%!><|".indexOf(r)>=0)return{type:a.PUNCT,val:r,range:[e,++n]}}();if(r||(r=function(){var e=t[n];if(!S(e))return;var r=n,o=e;for(;++n<i&&L(e=t[n]);)o+=e;switch(o){case"true":case"false":return{type:a.BOOL,val:"true"===o,range:[r,n]};case"null":return{type:a.NULL,val:null,range:[r,n]};default:return{type:a.ID,val:o,range:[r,n]}}}())||(r=function(){if('"'!==t[n]&&"'"!==t[n])return;var e,r=t[n],o=++n,s="",l=!1;for(;n<i;){if("\\"===(e=t[n++]))e=t[n++];else if(('"'===e||"'"===e)&&e===r){l=!0;break}s+=e}if(l)return{type:a.STR,val:s,range:[o,n]}}())||(r=function(){var e=n,r=t[n],o="."===r;if(o||v(r)){for(var s=r;++n<i;){if("."===(r=t[n])){if(o)return;o=!0}else if(!v(r))break;s+=r}return{type:a.NUM,val:o?parseFloat(s):parseInt(s,10),range:[e,n]}}}()))return r;r={range:[n,n]},n>=i?r.type=a.EOP:r.val=t[n],E(r)}function x(){var e;return r?(n=r.range[1],e=r,r=null,e):A()}function v(e){return"0123456789".indexOf(e)>=0}function S(e){return"$"===e||"@"===e||"_"===e||e>="a"&&e<="z"||e>="A"&&e<="Z"}function L(e){return S(e)||e>="0"&&e<="9"}function E(e){e.type===a.EOP&&I(e,o.UNEXP_EOP),I(e,o.UNEXP_TOKEN,e.val)}function I(e,t){var n=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,function(e,t){return n[t]||""}),i=new Error(r);throw i.column=e.range[0],i}return function(e){t=e.split(""),n=0,r=null,i=t.length;var o=s(),l=x();return l.type!==a.EOP&&E(l),o}}(),n=function(){var t,n,r,i;function a(){if(i.length)return i.shift();var e="v"+ ++r;return n.push(e),e}function o(){for(var e=arguments,t=e.length;t--;)i.push(e[t])}function s(e,n,r){if(e.prop){var i=f(e.prop),s=a(),l=a(),c=a(),u=a(),p=a(),d=a(),h=a();t.push(s,"= [];",l,"= 0;",c,"=",r,".length;",h,"= [];","while(",l,"<",c,") {",u,"=",r,"[",l,"++];","if(",u,"!= null) {"),"*"===e.prop?(t.push("if(typeof ",u,'=== "object") {',"if(isArr(",u,")) {",s,"=",s,".concat(",u,");","}","else {","for(",p," in ",u,") {","if(",u,".hasOwnProperty(",p,")) {",d,"=",u,"[",p,"];"),m(s,d),t.push("}","}","}","}")):(t.push(d,"=",u,"[",i,"];"),m(s,d,h,c)),t.push("}","}",n,"=",c,"> 1 &&",h,".length?",h,".length > 1?","concat.apply(",s,",",h,") :",s,".concat(",h,"[0]) :",s,";"),o(s,l,c,u,p,d,h)}}function l(e,n,r){var i=e.prop,s=a(),l=a(),c=a(),u=a(),p=a(),d=a(),h=a(),f=a();t.push(s,"=",r,".slice(),",f,"= [];","while(",s,".length) {",l,"=",s,".shift();"),i?t.push("if(typeof ",l,'=== "object" &&',l,") {"):t.push("if(typeof ",l,"!= null) {"),t.push(c,"= [];","if(isArr(",l,")) {",u,"= 0,",h,"=",l,".length;","while(",u,"<",h,") {",d,"=",l,"[",u,"++];"),i&&t.push("if(typeof ",d,'=== "object") {'),m(c,d),i&&t.push("}"),t.push("}","}","else {"),i?"*"!==i&&(t.push(d,"=",l,'["'+i+'"];'),m(f,d)):(m(f,l),t.push("if(typeof ",l,'=== "object") {')),t.push("for(",p," in ",l,") {","if(",l,".hasOwnProperty(",p,")) {",d,"=",l,"[",p,"];"),m(c,d),"*"===i&&m(f,d),t.push("}","}"),i||t.push("}"),t.push("}",c,".length &&",s,".unshift.apply(",s,",",c,");","}","}",n,"=",f,";"),o(s,l,c,u,p,d,h,f)}function c(e,n,r){var i=a(),s=a(),l=a(),c=a(),u=a();t.push(i,"= [];",s,"= 0;",l,"=",r,".length;","while(",s,"<",l,") {",u,"=",r,"[",s,"++];"),p(e.arg,c,u),t.push(y(e.arg,c),"&&",i,".push(",u,");","}",n,"=",i,";"),o(i,s,l,u,c)}function u(e,n,r){var i,s,l=e.arg;if(l.idx){var c=a();return p(l.idx,c,r),t.push(c,"< 0 && (",c,"=",r,".length +",c,");",n,"=",r,"[",c,"] == null? [] : [",r,"[",c,"]];"),o(c),!1}l.fromIdx?l.toIdx?(p(l.fromIdx,i=a(),r),p(l.toIdx,s=a(),r),t.push(n,"=",r,".slice(",i,",",s,");"),o(i,s)):(p(l.fromIdx,i=a(),r),t.push(n,"=",r,".slice(",i,");"),o(i)):(p(l.toIdx,s=a(),r),t.push(n,"=",r,".slice(0,",s,");"),o(s))}function p(n,r,i){switch(n.type){case e.PATH:!function(n,r,i){var a=n.parts,o=0,p=a.length;for(t.push(r,"=",n.fromRoot?"data":n.subst?"subst."+n.subst:i,";","isArr("+r+") || ("+r+" = ["+r+"]);");o<p;){var d=a[o++];switch(d.type){case e.SELECTOR:".."===d.selector?l(d,r,r):s(d,r,r);break;case e.OBJ_PRED:c(d,r,r);break;case e.POS_PRED:u(d,r,r);break;case e.CONCAT_EXPR:h(d,r,r)}}}(n,r,i);break;case e.CONCAT_EXPR:h(n,r,i);break;case e.COMPARISON_EXPR:!function(n,r,i){var s=a(),l=a(),c=a(),u=a(),h=a(),f=a(),m=a(),g=a(),y=n.args[0],_=n.args[1];t.push(r,"= false;"),p(y,s,i),p(_,l,i);var b=y.type===e.PATH,T=_.type===e.LITERAL;t.push(c,"="),b?t.push("true;"):t.push("isArr(",s,");"),t.push(u,"="),T?t.push("false;"):t.push("isArr(",l,");"),t.push("if("),b||t.push(c,"&&"),t.push(s,".length === 1) {",s,"=",s,"[0];",c,"= false;","}"),T||t.push("if(",u,"&&",l,".length === 1) {",l,"=",l,"[0];",u,"= false;","}"),t.push(h,"= 0;","if(",c,") {",m,"=",s,".length;"),T||(t.push("if(",u,") {",g,"=",l,".length;","while(",h,"<",m,"&& !",r,") {",f,"= 0;","while(",f,"<",g,") {"),d(n.op,[s,"[",h,"]"].join(""),[l,"[",f,"]"].join("")),t.push(r,"= true;","break;","}","++",f,";","}","++",h,";","}","}","else {"));t.push("while(",h,"<",m,") {"),d(n.op,[s,"[",h,"]"].join(""),l),t.push(r,"= true;","break;","}","++",h,";","}"),T||t.push("}"),t.push("}"),T||(t.push("else if(",u,") {",g,"=",l,".length;","while(",h,"<",g,") {"),d(n.op,s,[l,"[",h,"]"].join("")),t.push(r,"= true;","break;","}","++",h,";","}","}"));t.push("else {",r,"=",v[n.op](s,l),";","}"),o(s,l,c,u,h,f,m,g)}(n,r,i);break;case e.MATH_EXPR:!function(e,n,r){var i=a(),s=a(),l=e.args;p(l[0],i,r),p(l[1],s,r),t.push(n,"=",v[e.op](_(l[0],i),_(l[1],s)),";"),o(i,s)}(n,r,i);break;case e.LOGICAL_EXPR:!function(e,n,r){var i,s=[],l=e.args,c=l.length,u=0;switch(t.push(n,"= false;"),e.op){case"&&":for(;u<c;)s.push(i=a()),p(l[u],i,r),t.push("if(",y(l[u++],i),") {");t.push(n,"= true;");break;case"||":for(;u<c;)s.push(i=a()),p(l[u],i,r),t.push("if(",y(l[u],i),") {",n,"= true;","}"),1+u++<c&&t.push("else {");--c}for(;c--;)t.push("}");o.apply(null,s)}(n,r,i);break;case e.UNARY_EXPR:!function(e,n,r){var i=a(),s=e.arg;switch(p(s,i,r),e.op){case"!":t.push(n,"= !",y(s,i)+";");break;case"-":t.push(n,"= -",_(s,i)+";")}o(i)}(n,r,i);break;case e.LITERAL:t.push(r,"="),m=n.val,t.push("string"==typeof m?f(m):null===m?"null":m),t.push(";")}var m}function d(e,n,r){t.push("if(",v[e](n,r),") {")}function h(e,n,r){for(var i=[],s=e.args,l=s.length,c=0;c<l;)i.push(a()),p(s[c],i[c++],r);t.push(n,"= concat.call(",i.join(","),");"),o.apply(null,i)}function f(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function m(e,n,r,i){t.push("if(typeof ",n,'!== "undefined") {',"if(isArr(",n,")) {"),r&&(t.push(i,"> 1?"),g(r,n),t.push(":")),t.push(e,"=",e,".length?",e,".concat(",n,") :",n,".slice()",";","}","else {"),r&&t.push("if(",r,".length) {",e,"= concat.apply(",e,",",r,");",r,"= [];","}"),g(e,n),t.push(";","}","}")}function g(e,n){t.push(e,".length?",e,".push(",n,") :",e,"[0] =",n)}function y(t,n){switch(t.type){case e.LOGICAL_EXPR:return n;case e.LITERAL:return"!!"+n;case e.PATH:return n+".length > 0";default:return["(typeof ",n,'=== "boolean"?',n,":","isArr(",n,")?",n,".length > 0 : !!",n,")"].join("")}}function _(t,n){switch(t.type){case e.LITERAL:return n;case e.PATH:return n+"[0]";default:return["(isArr(",n,")?",n,"[0] : ",n,")"].join("")}}function b(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") === 0"].join("")}function T(e,t){return[e,"!= null &&",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) === 0"].join("")}function w(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".length >=",t,".length &&",e,".lastIndexOf(",t,") ===",e,".length -",t,".length"].join("")}function k(e,t){return[e,"!= null &&",t,"!= null &&","(",e,"=",e,".toString()).length >=","(",t,"=",t,".toString()).length &&","(",e,".toLowerCase()).lastIndexOf(","(",t,".toLowerCase())) ===",e,".length -",t,".length"].join("")}function A(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") > -1"].join("")}function x(e,t){return[e,"!= null && ",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) > -1"].join("")}var v={"===":function(e,t){return e+"==="+t},"==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string"?',e,".toLowerCase() ===",t,".toLowerCase() :"+e,"==",t].join("")},">=":function(e,t){return e+">="+t},">":function(e,t){return e+">"+t},"<=":function(e,t){return e+"<="+t},"<":function(e,t){return e+"<"+t},"!==":function(e,t){return e+"!=="+t},"!=":function(e,t){return e+"!="+t},"^==":b,"==^":function(e,t){return b(t,e)},"^=":T,"=^":function(e,t){return T(t,e)},"$==":w,"==$":function(e,t){return w(t,e)},"$=":k,"=$":function(e,t){return k(t,e)},"*==":A,"==*":function(e,t){return A(t,e)},"=*":function(e,t){return x(t,e)},"*=":x,"+":function(e,t){return e+"+"+t},"-":function(e,t){return e+"-"+t},"*":function(e,t){return e+"*"+t},"/":function(e,t){return e+"/"+t},"%":function(e,t){return e+"%"+t}};return function(a){if(t=[],n=["res"],r=0,i=[],p(a,"res","data"),t.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',", concat = Array.prototype.concat",",",n.join(","),";"),a.type===e.PATH){var o=a.parts[a.parts.length-1];o&&o.type===e.POS_PRED&&"idx"in o.arg&&t.push("res = res[0];")}return t.push("return res;"),t.join("")}}();function r(e){return Function("data,subst",n(t(e)))}var i={},a=[],o={cacheSize:100},s={cacheSize:function(e,t){if(t<e&&a.length>t)for(var n=a.splice(0,a.length-t),r=n.length;r--;)delete i[n[r]]}},l=function(e,t,n){return i[e]||(i[e]=r(e),a.push(e)>o.cacheSize&&delete i[a.shift()]),i[e](t,n||{})};l.version="0.4.0",l.params=function(e){if(!arguments.length)return o;for(var t in e)e.hasOwnProperty(t)&&(s[t]&&s[t](o[t],e[t]),o[t]=e[t])},l.compile=r,l.apply=l,"object"==typeof module&&"object"==typeof module.exports?module.exports=l:"object"==typeof modules?modules.define("jspath",function(e){e(l)}):"function"==typeof define?define(function(e,t,n){n.exports=l}):window.JSPath=l}(),String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0===this.indexOf(e,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(e){var t=this.length-e.length;return this.indexOf(e,t)===t}),String.prototype.hashCode||(String.prototype.hashCode=function(){for(var e=0,t=this.length,n=0;n<t;n++)e=(e<<5)-e+this.charCodeAt(n),e|=0;return e<0?-e:+e});var _ami_internal_jQueryAjax=jQuery.ajax;jQuery.ajax=function(e){if("object"==typeof e&&"sheet"===e.dataType){var t=$.Deferred(),n=amiWebApp.setup(["context","url"],[t,""],e),r=n[0],i=n[1];return i?$("head").append('<link rel="stylesheet" type="text/css" href="'+i+'"></link>').promise().done(function(){t.resolveWith(r)}):t.rejectWith(r),t.promise()}return _ami_internal_jQueryAjax.apply(this,arguments)};var _ami_internal_jQueryVal=jQuery.fn.val,_ami_internal_jQueryRemove=jQuery.fn.remove,_ami_internal_removeEvt=new $.Event("remove");jQuery.fn.extend({findWithSelf:function(e){return this.find(e).addBack(e)},serializeObject:function(){var e={};return this.serializeArray().forEach(function(t){t.name in e?("[object String]"===Object.prototype.toString.call(e[t.name])&&(e[t.name]=[e[t.name]]),e[t.name].push(t.value||"")):e[t.name]=t.value||""}),e},val:function(){if(0===arguments.length){if(this.hasClass("form-editor-hidden")){var e=this.data("session");return e?e.getValue():""}}else if(1===arguments.length&&this.hasClass("form-editor-hidden")){var t=this.data("session");return t&&t.setValue(arguments[0]),this}return _ami_internal_jQueryVal.apply(this,arguments)},remove:function(){return $(this).trigger(_ami_internal_removeEvt),_ami_internal_jQueryRemove.apply(this,arguments)}});var _ami_internal_modalZIndex=1050;function _$createNamespace(e,t){for(var n=window,r=e.split(/\s*\.\s*/g),i=r.length-1,a=0;a<i;a++)n=n[r[a]]?n[r[a]]:n[r[a]]={};n[r[a]]=t}function _$addToNamespace(e,t){for(var n=window,r=e.split(/\s*\.\s*/g),i=r.length-1,a=0;a<i;a++){if(!n[r[a]])throw"`"+e+"` (`"+r[a]+"`) not declared";n=n[r[a]]}n[r[a]]=t}function $AMINamespace(e,t){t||(t={}),t.$name=e,_$createNamespace(e,t),t.$&&t.$.apply(t)}function $AMIInterface(e,t){t||(t={});var n=function(){throw"could nor instantiate interface"};if(t.$extends)throw"`$extends` not allowed for interface";if(t.$implements)throw"`$implements` not allowed for interface";if(t.$)throw"`$` not allowed for interface";if(t.$init)throw"`$init` not allowed for interface";n.$name=e,n.$class=n,n.$members=t,_$addToNamespace(e,n)}function $AMIClass(e,t){t||(t={});var n=t.$extends instanceof Function?t.$extends.prototype:{},r=n.$implements instanceof Array?n.$implements:[],i=t.$implements instanceof Array?t.$implements:[],a=function(){for(var e in this.$implements)if(this.$implements.hasOwnProperty(e)){var t=this.$implements[e];for(var n in t.$members)if(t.$members.hasOwnProperty(n)){var r=t.$members[n];if(typeof this[n]!=typeof r)throw"class `"+this.$name+"` with must implement `"+t.$name+"."+n+"`"}}var i=this.$class._internal_super,a=this.$class._internal_added;for(var o in this.$super={},i)i.hasOwnProperty(o)&&(this.$super[o]=function(e,t,n){return function(){return e[t].apply(n,arguments)}}(i,o,this));for(var s in this.$added={},a)a.hasOwnProperty(s)&&(this.$added[s]=function(e,t,n){return function(){return e[t].apply(n,arguments)}}(a,s,this));this.$init&&this.$init.apply(this,arguments)};for(var o in a._internal_super={},a._internal_added={},n)("$init"===o||"$"!==o.charAt(0)||n.hasOwnProperty(o))&&(a._internal_super[o]=n[o],a.prototype[o]=n[o]);for(var s in t)("$init"===s||"$"!==s.charAt(0)||t.hasOwnProperty(s))&&(a._internal_added[s]=t[s],a.prototype[s]=t[s]);a.prototype.$name=e,a.prototype.$class=a,a.prototype.$implements=r.concat(i),_$addToNamespace(e,a),t.$&&t.$.apply(a)}function _ami_internal_then(e,t,n){e&&e.then?e.then(t,n):t()}function _ami_internal_always(e,t){e&&e.always?e.always(t):t()}$(document).on("show.bs.modal",".modal",function(e){var t=$(e.currentTarget);setTimeout(function(){$("body > .modal-backdrop:last").css("z-index",_ami_internal_modalZIndex++),t.css("z-index",_ami_internal_modalZIndex++)},10)}),"undefined"!=typeof exports&&(module.exports.Namespace=$AMINamespace,module.exports.Interface=$AMIInterface,module.exports.Class=$AMIClass),"undefined"!=typeof jQuery&&(jQuery.Namespace=$AMINamespace,jQuery.Interface=$AMIInterface,jQuery.Class=$AMIClass),$AMINamespace("amiRouter",{_scriptURL:"",_originURL:"",_webAppURL:"",_hash:"",_args:[],_routes:[],_eatSlashes:function(e){for(e=e.trim();"/"===e[e.length-1];)e=e.substring(0,e.length-1);return e},$:function(){var e=this;this._args.length=0,this._routes.length=0;for(var t,n=window.location.href.trim(),r=window.location.hash.trim(),i=window.location.search.trim(),a=document.getElementsByTagName("script"),o=0;o<a.length;o++)if((t=a[o].src.indexOf("js/ami."))>0){this._scriptURL=a[o].src,this._originURL=this._eatSlashes(this._scriptURL.substring(0,t));break}this._webAppURL=this._eatSlashes(n.replace(/(?:\#|\?).*$/,"")),this._hash=this._eatSlashes(r.substring(1).replace(/\?.*$/,"")),i&&i.substring(1).split("&").forEach(function(t){var n=t.split("=");1===n.length?e._args[decodeURIComponent(n[0])]="":2===n.length&&(e._args[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))})},getScriptURL:function(){return this._scriptURL},getOriginURL:function(){return this._originURL},getWebAppURL:function(){return this._webAppURL},getHash:function(){return this._hash},getArgs:function(){return this._args},append:function(e,t){return this._routes.unshift({regExp:e,handler:t}),this},remove:function(e){return this._routes=this._routes.filter(function(t){return t.regExp.toString()!==e.toString()}),this},check:function(){for(var e,t=0;t<this._routes.length;t++)if(e=this._hash.match(this._routes[t].regExp))return this._routes[t].handler.apply(amiRouter,e),!0;return!1},appendHistoryEntry:function(e,t){return void 0===t&&(t=null),!!history.pushState&&(history.pushState(t,null,this._webAppURL+this._eatSlashes(e)),!0)},replaceHistoryEntry:function(e,t){return void 0===t&&(t=null),!!history.replaceState&&(history.replaceState(t,null,this._webAppURL+this._eatSlashes(e)),!0)}}),$AMINamespace("ami",{version:"0.0.1",commit_id:"{{AMI_COMMIT_ID}}"}),$AMINamespace("amiWebApp",{_idRegExp:new RegExp("[a-zA-Z][a-zA-Z0-9]{7}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{12}","g"),_linkExp:new RegExp("\\[([^\\]]*)\\]\\(([^\\)]*)\\)","g"),_embedded:!1,_noBootstrap:!1,_noDateTimePicker:!1,_noSelect2:!1,_globalDeferred:$.Deferred(),_sheets:[],_scripts:[],_controls:{},_subapps:{},_isReady:!1,_canLeave:!0,_lockCnt:0,_currentSubAppInstance:new function(){this.onReady=function(){},this.onExit=function(){},this.onLogin=function(){},this.onLogout=function(){}},originURL:"/",webAppURL:"/",hash:"",args:{},$:function(){var e=this,t=amiRouter.getScriptURL(),n=t.indexOf("?");if(n>0){var r=t.substring(n).toLowerCase();this._embedded=r.indexOf("embedded")>=0,this._noBootstrap=r.indexOf("nobootstrap")>=0,this._noDateTimePicker=r.indexOf("nodatetimepicker")>=0,this._noSelect2=r.indexOf("noselect2")>=0}this.originURL=amiRouter.getOriginURL(),this.webAppURL=amiRouter.getWebAppURL(),this.hash=amiRouter.getHash(),this.args=amiRouter.getArgs();var i=[],a=[];window.Popper||a.push(this.originURL+"/js/popper.min.js"),window.moment||a.push(this.originURL+"/js/moment.min.js"),"function"!=typeof jQuery.fn.qrcode&&a.push(this.originURL+"/js/jquery-qrcode.min.js"),this._noBootstrap||"function"==typeof jQuery.fn.modal||(i.push(this.originURL+"/css/bootstrap.min.css"),a.push(this.originURL+"/js/bootstrap.min.js")),this._noDateTimePicker||"function"==typeof jQuery.fn.datetimepicker||(i.push(this.originURL+"/css/bootstrap-datetimepicker.min.css"),a.push(this.originURL+"/js/bootstrap-datetimepicker.min.js")),this._noSelect2||"function"==typeof jQuery.fn.select2||(i.push(this.originURL+"/css/select2.min.css"),a.push(this.originURL+"/js/select2.min.js")),this.loadResources([].concat(i,[this.originURL+"/css/font-awesome.min.css",this.originURL+"/css/ami.min.css"],a)).done(function(){e._globalDeferred.resolve()}).fail(function(t){e._globalDeferred.reject(t)})},isEmbedded:function(){return this._embedded},isLocal:function(){return"file:"===document.location.protocol||"localhost"===document.location.hostname||"127.0.0.1"===document.location.hostname||"::1"===document.location.hostname},typeOf:function(e){var t=Object.prototype.toString.call(e);return t.startsWith("[object ")?t.substring(8,t.length-1):""},asArray:function(e){return"Array"===this.typeOf(e)?e:[e]},setup:function(e,t,n){var r=[],i=e.length;if(i!==t.length)throw"internal error";if(n)for(var a=0;a<i;a++)r.push(e[a]in n?n[e[a]]:t[a]);else for(var o=0;o<i;o++)r.push(t[o]);return r},replace:amiTwig.stdlib._replace,_textToHtmlX:["&",'"',"<",">"],_textToHtmlY:["&amp;","&quot;","&lt;","&gt;"],textToHtml:function(e){return this.replace(e||"",this._textToHtmlX,this._textToHtmlY)},htmlToText:function(e){return this.replace(e||"",this._textToHtmlY,this._textToHtmlX)},_textToStringX:["\\","\n",'"',"'"],_textToStringY:["\\\\","\\n",'\\"',"\\'"],textToString:function(e){return this.replace(e||"",this._textToStringX,this._textToStringY)},stringToText:function(e){return this.replace(e||"",this._textToStringY,this._textToStringX)},_htmlToStringX:["\\","\n","&quot;","'"],_htmlToStringY:["\\\\","\\n","\\&quot;","\\'"],htmlToString:function(e){return this.replace(e||"",this._htmlToStringX,this._htmlToStringY)},stringToHtml:function(e){return this.replace(e||"",this._htmlToStringY,this._htmlToStringX)},_textToSQLX:["'"],_textToSQLY:["''"],textToSQL:function(e){return this.replace(e||"",this._textToSQLX,this._textToSQLY)},sqlToText:function(e){return this.replace(e||"",this._textToSQLY,this._textToSQLX)},_base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",base64Encode:function(e){for(var t,n=[],r=e.length,i=r%3,a=this._base64,o=0;o<r;)t=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++)<<0,n.push(a.charAt(t>>18&63)),n.push(a.charAt(t>>12&63)),n.push(a.charAt(t>>6&63)),n.push(a.charAt(t>>0&63));return 1===i?n.splice(-2,2):2===i&&n.splice(-1,1),n.join("")},base64Decode:function(e){for(var t,n=[],r=e.length,i=r%4,a=this._base64,o=0;o<r;)t=a.indexOf(e.charAt(o++))<<18|a.indexOf(e.charAt(o++))<<12|a.indexOf(e.charAt(o++))<<6|a.indexOf(e.charAt(o++))<<0,n.push(String.fromCharCode(t>>>16&255)),n.push(String.fromCharCode(t>>>8&255)),n.push(String.fromCharCode(t>>>0&255));return 2===i?n.splice(-2,2):3===i&&n.splice(-1,1),n.join("")},_getExtension:function(e){var t=e.lastIndexOf(".");return t>0?e.substring(t):""},_getDataType:function(e,t){var n;if("auto"===t)if(0===e.indexOf("ctrl:"))n="control";else if(0===e.indexOf("subapp:"))n="subapp";else switch(this._getExtension(e).toLowerCase()){case".css":n="sheet";break;case".js":n="script";break;case".json":n="json";break;case".xml":n="xml";break;default:n="text"}else n=t;return n},__loadXXX:function(e,t,n,r,i){var a=this;if(0===n.length)return e.resolveWith(i,[t]);var o=n.shift().trim(),s=this._getDataType(o,r);switch(s){case"control":this.loadControl(o).then(function(o){return t.push(o),a.__loadXXX(e,t,n,r,i)},function(t){return e.rejectWith(i,[t])});break;case"subapp":this.loadSubApp(o).then(function(o){return t.push(o),a.__loadXXX(e,t,n,r,i)},function(t){return e.rejectWith(i,[t])});break;case"sheet":if(this._sheets.indexOf(o)>=0)return t.push(!1),this.__loadXXX(e,t,n,r,i);$.ajax({url:o,async:!1,cache:!1,crossDomain:!0,dataType:s}).then(function(){return t.push(!0),a._sheets.push(o),a.__loadXXX(e,t,n,r,i)},function(){return e.rejectWith(i,["could not load `"+o+"`"])});break;case"script":if(this._scripts.indexOf(o)>=0)return t.push(!1),this.__loadXXX(e,t,n,r,i);$.ajax({url:o,async:!1,cache:!1,crossDomain:!0,dataType:s}).then(function(){return t.push(!0),a._scripts.push(o),a.__loadXXX(e,t,n,r,i)},function(){return e.rejectWith(i,["could not load `"+o+"`"])});break;default:$.ajax({url:o,async:!0,cache:!1,crossDomain:!0,dataType:s}).then(function(o){return t.push(o),a.__loadXXX(e,t,n,r,i)},function(){return e.rejectWith(i,["could not load `"+o+"`"])})}},_loadXXX:function(e,t,n){var r=$.Deferred(),i=this.setup(["context"],[r],n)[0];return this.__loadXXX(r,[],this.asArray(e),t,i),r.promise()},loadResources:function(e,t){return this._loadXXX(e,"auto",t)},loadSheets:function(e,t){return this._loadXXX(e,"sheet",t)},loadScripts:function(e,t){return this._loadXXX(e,"script",t)},loadJSONs:function(e,t){return this._loadXXX(e,"json",t)},loadXMLs:function(e,t){return this._loadXXX(e,"xml",t)},loadHTMLs:function(e,t){return this._loadXXX(e,"text",t)},loadTWIGs:function(e,t){return this._loadXXX(e,"text",t)},loadTexts:function(e,t){return this._loadXXX(e,"text",t)},_xxxHTML:function(e,t,n,r){var i=this,a=$.Deferred(),o=this.setup(["context","suffix","dict","twigs"],[a,null,null,null],r),s=o[0],l=o[1],c=o[2],u=o[3];l&&(t=t.replace(this._idRegExp,function(e){return e+"_instance"+l}));var p,d=this.formatTWIG(t,c,u),h=$(e);switch(n){case 0:p=h.html(d).promise();break;case 1:p=h.prepend(d).promise();break;case 2:p=h.append(d).promise();break;case 3:p=h.replaceWith(h.is("[id]")?d.replace(/^\s*(<[a-zA-Z_-]+)/,'$1 id="'+h.attr("id")+'"'):d).promise();break;default:throw"internal error"}return p.done(function(){var t=$(e),r=3===n?function(e){return t.findWithSelf(e)}:function(e){return t.find(e)};jQuery.fn.tooltip&&r('[data-toggle="tooltip"]').tooltip({html:!1,delay:{show:500,hide:100}}),jQuery.fn.popover&&r('[data-toggle="popover"]').popover({html:!0,delay:{show:500,hide:100}}),jQuery.fn.datetimepicker&&(r(".form-datetime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss.SSSSSS"}),r(".form-date").datetimepicker({format:"YYYY-MM-DD"}),r(".form-time").datetimepicker({format:"HH:mm:ss"}),r(".form-time-hm").datetimepicker({format:"HH:mm"})),window.ace&&r(".form-editor:not(.form-editor-hidden)").each(function(e,t){var n=$(t).addClass("form-editor-hidden"),r=$("<div>",{class:n.attr("class").replace("form-editor","").replace("form-editor-hidden",""),style:n.attr("style")}).insertBefore(n);r.promise().done(function(){var e=n.attr("data-mode")||"text",a=n.attr("data-theme")||"chrome",o=n.attr("data-wrap")||"false",s=n.attr("data-read-only")||"false",l=n.attr("data-show-gutter")||"true",c=n.attr("data-highlight-active-line")||"false";ace.config.set("suffix",".min.js"),ace.config.set("basePath",i.originURL+"/js/3rd-party/ace");var u=ace.edit(r[0],{mode:"ace/mode/"+e,theme:"ace/theme/"+a,wrap:"true"===o,readOnly:"true"===s,showGutter:"true"===l,highlightActiveLine:"true"===c,minLines:1,maxLines:1/0});u.renderer.setScrollMargin(0,2);var p=u.getSession();n.data("editor",u),n.data("session",p),p.on("change",function(){t.value=p.getValue()}),p.setValue(t.value)})}),a.resolveWith(s,[t])}),a.promise()},replaceHTML:function(e,t,n){return this._xxxHTML(e,t,0,n)},prependHTML:function(e,t,n){return this._xxxHTML(e,t,1,n)},appendHTML:function(e,t,n){return this._xxxHTML(e,t,2,n)},formatTWIG:function(e,t,n){var r=this;void 0===t&&(t={}),void 0===n&&(n={});var i=[],a=function(e,t){return"Object"!==r.typeOf(t)&&(t={}),"Object"!==r.typeOf(n)&&(n={}),t.ORIGIN_URL=r.originURL,t.WEBAPP_URL=r.webAppURL,amiTwig.engine.render(e,t,n)};try{"Array"===this.typeOf(t)?t.forEach(function(t){i.push(a(e,t))}):i.push(a(e,t))}catch(e){i.length=0,this.error("TWIG parsing error: "+e.message)}return i.join("")},jspath:function(e,t){return JSPath.apply(e,t)},getStack:function(){try{throw Error()}catch(e){try{return e.stack}catch(e){return""}}},lock:function(){var e=this.getStack().split("\n");e.length>2&&console.log("lock["+this._lockCnt+"] :: "+e[2]),this._lockCnt<=0?($("#ami_locker").css("display","flex"),this._lockCnt=1):this._lockCnt++},unlock:function(){this._lockCnt<=1?($("#ami_locker").css("display","none"),this._lockCnt=0):this._lockCnt--;var e=this.getStack().split("\n");e.length>2&&console.log("unlock["+this._lockCnt+"] :: "+e[2])},modalLeave:function(){var e=this.getStack().split("\n");e.length>2&&console.log("modalLock["+this._lockCnt+"] :: "+e[2]),this._lockCnt=this._tmpLockCnt,this._lockCnt>0&&$("#ami_locker").css("display","flex")},modalEnter:function(){this._tmpLockCnt=this._lockCnt,this._lockCnt>0&&$("#ami_locker").css("display","none");var e=this.getStack().split("\n");e.length>2&&console.log("modalUnlock["+this._lockCnt+"] :: "+e[2])},canLeave:function(){this._canLeave=!0},cannotLeave:function(){this._canLeave=!1},_publishAlert:function(e,t,n,r){var i=n.hashCode(),a=moment().format("DD MMM, HH:mm:ss"),o=$('#ami_alert_content > .toast[data-hash="'+i+'"]');if(0===o.length){var s=['<div class="toast" role="alert" '+(r?'data-delay="60000"':'data-autohide="false"')+' data-hash="'+i+'" data-cnt="1">','<div class="toast-header">','<strong class="mr-auto text-'+e+'">'+this.textToHtml(t)+"</strong>","<small>"+this.textToHtml(a)+"</small>",'<button class="ml-2 mb-1 close" type="button" data-dismiss="toast">',"&times;","</button>","</div>",'<div class="toast-body">',this.textToHtml(n),"</div>","</div>"];$("#ami_alert_content").append(s.join("").replace(this._messageLinkExp,'<a href="$1" target="_blank">$2</a>')).promise().done(function(){$('#ami_alert_content > .toast[data-hash="'+i+'"]').toast("show")})}else o.find(".toast-header > strong").html(this.textToHtml(t)+' <span class="badge badge-'+e+'">'+o.attr("data-cnt",parseInt(o.attr("data-cnt"))+1).attr("data-cnt")+"</span>"),o.find(".toast-header > small").html(this.textToHtml(a)),o.toast("show");console.log("AMI :: "+t.toUpperCase()+": "+n+"\n"+this.getStack()),$(document).scrollTop(0),this.unlock()},info:function(e,t){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert("info","Info",e,t)},success:function(e,t){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert("success","Success",e,t)},warning:function(e,t){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert("warning","Warning",e,t)},error:function(e,t){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert("danger","Error",e,t)},flush:function(){$("#ami_alert_content").empty()},fillBreadcrumb:function(e){var t=this,n="Array"===this.typeOf(e)?e.map(function(e){return'<li class="breadcrumb-item">'+e.replace(/{{WEBAPP_URL}}/g,t.webAppURL)+"</li>"}).join(""):"";$("#ami_breadcrumb_content").html(n)},onReady:function(){this._embedded||alert("error: `amiWebApp.onReady()` must be overloaded!")},onRefresh:function(){this._embedded||alert("error: `amiWebApp.onRefresh()` must be overloaded!")},start:function(e){var t=this;return this._globalDeferred.done(function(){var n=t.setup(["logo_url","home_url","contact_email","about_url","theme_url","locker_url","endpoint_url","password_authentication_allowed","certificate_authentication_allowed","create_account_allowed","change_info_allowed","change_password_allowed","change_certificate_allowed","bookmarksAllowed"],[t.originURL+"/images/logo.png",t.webAppURL,"ami@lpsc.in2p3.fr","http://cern.ch/ami/",t.originURL+"/twig/AMI/Theme/blue.twig",t.originURL+"/twig/AMI/Fragment/locker.twig",t.originURL+"/AMI/FrontEnd",!0,!0,!0,!0,!0,!0,!0],e),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],p=n[8],d=n[9],h=n[10],f=n[11],m=n[12],g=n[13];amiCommand.endpoint=c,window.onbeforeunload=function(e){if(!t._canLeave){var n=e||window.event;return n&&(n.returnValue="Confirm that you want to leave this page?"),"Confirm that you want to leave this page?"}};var y=t.originURL+"/controls/CONTROLS.json",_=t.originURL+"/subapps/SUBAPPS.json";$.ajax({url:y,cache:!1,crossDomain:!0,dataType:"json"}).then(function(e){$.ajax({url:_,cache:!1,crossDomain:!0,dataType:"json"}).then(function(n){for(var c in e)t._controls[c.toLowerCase()]=e[c];for(var y in n)t._subapps[y.toLowerCase()]=n[y];if(t._embedded){var _="";0===$("#ami_alert_content").length&&(_+='<div id="ami_alert_content"></div>'),0===$("#ami_login_menu_content").length&&(_+='<div id="ami_login_menu_content"></div>'),$.ajax({url:l,cache:!0,crossDomain:!0,dataType:"text"}).done(function(e){$("body").prepend(_+e).promise().done(function(){t.lock(),amiLogin._start(u,p,d,h,f,m,g).done(function(){t.unlock()}).fail(function(e){t.error(e)})})})}else{var b={LOGO_URL:r,HOME_URL:i,CONTACT_EMAIL:a,ABOUT_URL:o};$.ajax({url:s,cache:!0,crossDomain:!0,dataType:"text"}).then(function(e){$.ajax({url:l,cache:!0,crossDomain:!0,dataType:"text"}).then(function(n){$("body").append(t.formatTWIG(e,b)+n).promise().done(function(){t.lock(),amiLogin._start(u,p,d,h,f,m,g).done(function(){t.unlock()}).fail(function(e){t.error(e)})})},function(){alert("could not open `"+l+"`, please reload the page...")})},function(){alert("could not open `"+s+"`, please reload the page...")})}},function(){alert("could not open `"+_+"`, please reload the page...")})},function(){alert("could not open `"+y+"`, please reload the page...")})}).fail(function(e){alert(e)}),this},loadControl:function(e,t){var n=$.Deferred(),r=this.setup(["context"],[n],t)[0];0===e.indexOf("ctrl:")&&(e=e.substring(5));var i=this._controls[e.toLowerCase()];return i?this.loadScripts(this.originURL+"/"+i.file).then(function(t){try{var a=window[i.clazz];_ami_internal_then(t[0]?a.prototype.onReady.apply(a.prototype):null,function(){n.resolveWith(r,[a])},function(t){n.rejectWith(r,["could not load control `"+e+"`: "+t])})}catch(t){n.rejectWith(r,["could not load control `"+e+"`: "+t])}},function(t){n.rejectWith(r,["could not load control `"+e+"`: "+t])}):n.rejectWith(r,["could not find control `"+e+"`"]),n.promise()},createControl:function(e,t,n,r,i){var a=$.Deferred(),o=this.setup(["context"],[a],i)[0];return this.loadControl(n,i).done(function(n){var i=new n(e,t);_ami_internal_then(n.prototype.render.apply(i,r),function(){a.resolveWith(o,[i].concat(Array.prototype.slice.call(arguments)))},function(e){a.rejectWith(o,[e])})}).fail(function(e){a.rejectWith(o,[e])}),a.promise()},createControlInBody:function(e,t,n,r,i,a,o){var s=$.Deferred(),l=this.setup(["context"],[s],o)[0];try{var c=[],u={};for(var p in a)u[p]=a[p];for(var d in i)u[d]=i[d];Array.prototype.push.apply(c,r),c.push(u),this.createControl(e,t,n,c).done(function(){s.resolveWith(l,Array.prototype.slice.call(arguments))}).fail(function(e){s.rejectWith(l,[e])})}catch(e){s.rejectWith(l,[e])}return s.promise()},createControlInContainer:function(e,t,n,r,i,a,o,s,l){var c=this,u=$.Deferred(),p=this.setup(["context"],[u],l)[0];try{e.appendItem('<i class="fa fa-'+this.textToHtml(o)+'"></i> '+this.textToHtml(s)).done(function(o){var s=[],l={};for(var d in a)l[d]=a[d];for(var h in i)l[h]=i[h];s.push(o),Array.prototype.push.apply(s,r),s.push(l),c.createControl(e,t,n,s).done(function(){u.resolveWith(p,Array.prototype.slice.call(arguments))}).fail(function(e){u.rejectWith(p,[e])})})}catch(e){u.rejectWith(p,[e])}return u.promise()},createControlFromWebLink:function(e,t,n,r,i){var a=this,o=n.hasAttribute("data-ctrl")?n.getAttribute("data-ctrl"):"",s=n.hasAttribute("data-ctrl-location")?n.getAttribute("data-ctrl-location"):"",l=n.hasAttribute("data-params")?JSON.parse(n.getAttribute("data-params")):[],c=n.hasAttribute("data-settings")?JSON.parse(n.getAttribute("data-settings")):{},u=n.hasAttribute("data-icon")?n.getAttribute("data-icon"):"question",p=n.hasAttribute("data-title")?n.getAttribute("data-title"):"Unknown";return this.lock(),"body"===s?this.createControlInBody(e,t,o,l,c,r,i).done(function(){a.unlock()}).fail(function(e){a.error(e)}):this.createControlInContainer(e,t,o,l,c,r,u,p,i).done(function(){a.unlock()}).fail(function(e){a.error(e)})},triggerLogin:function(){var e=this,t=$.Deferred();return this._isReady?_ami_internal_then(this._currentSubAppInstance.onLogin(this.args.userdata),function(n){_ami_internal_always(e.onRefresh(!0),function(){t.resolve(n)})},function(n){_ami_internal_always(e.onRefresh(!0),function(){t.reject(n)})}):t.resolve(),t.promise()},triggerLogout:function(){var e=this,t=$.Deferred();return this._isReady?_ami_internal_then(this._currentSubAppInstance.onLogout(this.args.userdata),function(n){_ami_internal_always(e.onRefresh(!1),function(){t.resolve(n)})},function(n){_ami_internal_always(e.onRefresh(!1),function(){t.reject(n)})}):t.resolve(),t.promise()},loadSubApp:function(e,t,n){var r=this,i=$.Deferred(),a=this.setup(["context"],[i],n)[0];this.lock(),i.always(function(){r.unlock()}),0===e.indexOf("subapp:")&&(e=e.substring(7));var o=this._subapps[e.toLowerCase()];return o?this.loadScripts(this.originURL+"/"+o.file).then(function(n){try{r._currentSubAppInstance.onExit(t);var s=window[o.instance];r._currentSubAppInstance=s,r.fillBreadcrumb(o.breadcrumb),_ami_internal_then(n[0]?s.onReady(t):null,function(){(amiLogin.isAuthenticated()?r.triggerLogin():r.triggerLogout()).then(function(){i.resolveWith(a,[s])},function(t){i.rejectWith(a,["could not load subapp `"+e+"`: "+t])})},function(t){i.rejectWith(a,["could not load subapp `"+e+"`: "+t])})}catch(t){i.rejectWith(a,["could not load subapp `"+e+"`: "+t])}},function(t){i.rejectWith(a,["could not load subapp `"+e+"`: "+t])}):i.rejectWith(a,["could not find subapp `"+e+"`"]),i.promise()},loadSubAppByURL:function(e,t){var n=this,r=$.Deferred();if(this.args.v)amiCommand.execute('GetHashInfo -hash="'+this.textToString(this.args.v)+'"').fail(function(e,t){r.reject(t)}).done(function(i){var a;try{a=JSON.parse(n.jspath('..field{.@name==="json"}.$',i)[0]||"{}")}catch(e){a={}}var o=a.subapp||e,s=a.userdata||t;n.loadSubApp(o,s).then(function(){r.resolve()},function(e){r.reject(e)})});else if(!amiRouter.check()){var i=this.args.subapp||e,a=this.args.userdata||t;this.loadSubApp(i,a).then(function(){r.resolve()},function(e){r.reject(e)})}return r.promise()}}),$AMIInterface("ami.IControl",{patchId:function(){},replaceHTML:function(){},prependHTML:function(){},appendHTML:function(){},onReady:function(){},onRemove:function(){}}),$AMIInterface("ami.ISubApp",{onReady:function(){},onExit:function(){},onLogin:function(){},onLogout:function(){}}),$AMIClass("ami.Control",{$implements:[ami.IControl],$:function(){ami.Control.instanceCnt=1},$init:function(e,t){this._parent=e||this,this._owner=t||this,this.instanceSuffix=ami.Control.instanceCnt++},setParent:function(e){return this._parent=e||this},getParent:function(){return this._parent},setOwner:function(e){return this._owner=e||this},getOwner:function(){return this._owner},setSelector:function(e){var t=this;return void 0===e&&(e=""),e&&$(e).on("remove",function(){t.onRemove()}),this._selector=e},getSelector:function(){return this._selector},patchId:function(e){return e+"_instance"+this.instanceSuffix},replaceHTML:function(e,t,n){return void 0===n&&(n={}),n.suffix=this.instanceSuffix,amiWebApp.replaceHTML(e,t,n)},prependHTML:function(e,t,n){return void 0===n&&(n={}),n.suffix=this.instanceSuffix,amiWebApp.prependHTML(e,t,n)},appendHTML:function(e,t,n){return void 0===n&&(n={}),n.suffix=this.instanceSuffix,amiWebApp.appendHTML(e,t,n)},createControl:function(e,t,n,r){return amiWebApp.createControl(e,this,t,n,r)},createControlInBody:function(e,t,n,r,i,a){return amiWebApp.createControlInBody(e,this,t,n,r,i,a)},createControlInContainer:function(e,t,n,r,i,a,o,s){return amiWebApp.createControlInContainer(e,this,t,n,r,i,a,o,s)},createControlFromWebLink:function(e,t,n,r){return amiWebApp.createControlFromWebLink(e,this,t,n,r)},onRemove:function(){}}),$AMIClass("ami.SubApp",{$implements:[ami.ISubApp],onExit:function(){},onLogin:function(){},onLogout:function(){}}),$AMINamespace("amiCommand",{endpoint:"http://xxyy.zz",converter:"AMIXmlToJson.xsl",execute:function(e,t){var n=$.Deferred(),r=amiWebApp.setup(["endpoint","converter","context","timeout","extraParam","extraValue"],[this.endpoint,this.converter,n,12e4,null,null],t),i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=i.trim(),p=e.trim(),d=a.trim(),h={Command:p,Converter:d};l&&(h[l]=c||null);var f=u+"?"+$.param(h);return"AMIXmlToJson.xsl"===d?$.ajax({url:u,data:h,type:"POST",timeout:s,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){var t=JSPath.apply(".AMIMessage.info.$",e),r=JSPath.apply(".AMIMessage.error.$",e);0===r.length?n.resolveWith(o,[e,t.join(". "),f]):n.rejectWith(o,[e,r.join(". "),f])},error:function(e,t){"error"===t&&(t="service temporarily unreachable"),"parsererror"===t&&(t="resource temporarily unreachable");var r={AMIMessage:[{error:[{$:t}]}]};n.rejectWith(o,[r,t,f])}}):$.ajax({url:u,data:h,type:"POST",timeout:s,dataType:"text",xhrFields:{withCredentials:!0},success:function(e){n.resolveWith(o,[e,e,f])},error:function(e,t){"error"===t&&(t="service temporarily unreachable"),n.rejectWith(o,[t,t,f])}}),n.promise()},passLogin:function(e,t,n){var r=$.Deferred(),i=amiWebApp.setup(["context"],[r],n)[0];return this.execute('GetSessionInfo -AMIUser="'+amiWebApp.textToString(e)+'" -AMIPass="'+amiWebApp.textToString(t)+'"',{extraParam:"NoCert"}).then(function(e,t){var n={},a={},o={},s={},l={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){n[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="udp"}.row.field',e).forEach(function(e){s[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){l[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="bookmark"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"hash"===e["@name"]&&(t=e.$)}),o[t]=n}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),a[t]=n}),r.resolveWith(i,[e,t,n,a,o,s,l])},function(e,t){r.rejectWith(i,[e,t,{AMIUser:"guest",guestUser:"guest"},{},{},{},{}])}),r.promise()},certLogin:function(e){var t=$.Deferred(),n=amiWebApp.setup(["context"],[t],e)[0];return this.execute("GetSessionInfo").then(function(e,r){var i={},a={},o={},s={},l={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){i[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="udp"}.row.field',e).forEach(function(e){s[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){l[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="bookmark"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"hash"===e["@name"]&&(t=e.$)}),o[t]=n}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),a[t]=n}),t.resolveWith(n,[e,r,i,a,o,s,l])},function(e,r){t.rejectWith(n,[e,r,{AMIUser:"guest",guestUser:"guest"},{},{},{},{}])}),t.promise()},logout:function(e){var t=$.Deferred(),n=amiWebApp.setup(["context"],[t],e)[0];return this.execute('GetSessionInfo -AMIUser="" -AMIPass=""',{extraParam:"NoCert"}).then(function(e,r){var i={},a={},o={},s={},l={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){i[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="udp"}.row.field',e).forEach(function(e){s[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){l[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="bookmark"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"hash"===e["@name"]&&(t=e.$)}),o[t]=n}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),a[t]=n}),t.resolveWith(n,[e,r,i,a,o,s,l])},function(e,r){t.rejectWith(n,[e,r,{AMIUser:"guest",guestUser:"guest"},{},{},{},{}])}),t.promise()},attachCert:function(e,t,n){return this.execute('GetSessionInfo -attachCert -amiLogin="'+amiWebApp.textToString(e)+'" -amiPassword="'+amiWebApp.textToString(t)+'"',n)},detachCert:function(e,t,n){return this.execute('GetSessionInfo -detachCert -amiLogin="'+amiWebApp.textToString(e)+'" -amiPassword="'+amiWebApp.textToString(t)+'"',n)},addUser:function(e,t,n,r,i,a,o,s){return this.execute('AddUser -amiLogin="'+amiWebApp.textToString(e)+'" -amiPassword="'+amiWebApp.textToString(t)+'" -firstName="'+amiWebApp.textToString(n)+'" -lastName="'+amiWebApp.textToString(r)+'" -email="'+amiWebApp.textToString(i)+'"'+(a?" -attach":"")+(o?" -agree":""),s)},changeInfo:function(e,t,n,r){return this.execute('SetUserInfo -firstName="'+amiWebApp.textToString(e)+'" -lastName="'+amiWebApp.textToString(t)+'" -email="'+amiWebApp.textToString(n)+'"',r)},changePass:function(e,t,n,r){return this.execute('ChangePassword -amiLogin="'+amiWebApp.textToString(e)+'" -amiPasswordOld="'+amiWebApp.textToString(t)+'" -amiPasswordNew="'+amiWebApp.textToString(n)+'"',r)},resetPass:function(e,t){return this.execute('ResetPassword -amiLogin="'+amiWebApp.textToString(e)+'"',t)}}),$AMINamespace("amiLogin",{passwordAuthenticationAllowed:!0,certificateAuthenticationAllowed:!0,createAccountAllowed:!0,changeInfoAllowed:!0,changePasswordAllowed:!0,changeCertificateAllowed:!0,bookmarksAllowed:!0,user:"guest",guest:"guest",clientDN:"",issuerDN:"",notBefore:"",notAfter:"",userInfo:{},roleInfo:{},bookmarkInfo:{},udpInfo:{},ssoInfo:{},_start:function(e,t,n,r,i,a,o){var s=this,l=$.Deferred();return amiWebApp.loadTWIGs([amiWebApp.originURL+"/twig/AMI/Fragment/login_button.twig",amiWebApp.originURL+"/twig/AMI/Fragment/logout_button.twig",amiWebApp.originURL+"/twig/AMI/Modal/login.twig"]).done(function(c){s.fragmentLoginButton=c[0],s.fragmentLogoutButton=c[1];var u={passwordAuthenticationAllowed:s.passwordAuthenticationAllowed=e,certificateAuthenticationAllowed:s.certificateAuthenticationAllowed=t,createAccountAllowed:s.createAccountAllowed=n,changeInfoAllowed:s.changeInfoAllowed=r,changePasswordAllowed:s.changePasswordAllowed=i,changeCertificateAllowed:s.changeCertificateAllowed=a,bookmarksAllowed:s.bookmarksAllowed=o};amiWebApp.appendHTML("body",c[2],{dict:u}).done(function(){$("#B7894CC1_1DAA_4A7E_B7D1_DBDF6F06AC73").submit(function(e){s.form_login(e)}),$("#EE055CD4_E58F_4834_8020_986AE3F8D67D").submit(function(e){s.form_addUser(e)}),$("#DA2047A2_9E5D_420D_B6E7_FA261D2EF10F").submit(function(e){s.form_remindPass(e)}),$("#D9EAF998_ED8E_44D2_A0BE_8C5CF5E438BD").submit(function(e){s.form_changeInfo(e)}),$("#E92A1097_983B_4857_875F_07E4659B41B0").submit(function(e){s.form_changePass(e)}),$("#E6E30EEC_15EE_4FCF_9809_2B8EC2FEF388,#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").change(function(){var e=$("#E6E30EEC_15EE_4FCF_9809_2B8EC2FEF388").val(),t=$("#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").val();$("#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").get(0).setCustomValidity(e.length>0&&t.length>0&&e!==t?"Passwords don't match.":"")}),$("#D487FE72_8D95_4048_BEA3_252274862AF4,#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").change(function(){var e=$("#D487FE72_8D95_4048_BEA3_252274862AF4").val(),t=$("#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").val();$("#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").get(0).setCustomValidity(e.length>0&&t.length>0&&e!==t?"Passwords don't match.":"")})}),window.addEventListener("message",function(e){if(s.ssoInfo.url.startsWith(e.origin)){var t=e.data.user,n=e.data.pass;t&&n&&s.form_login2(t,n),e.source.close()}},!1);var p=amiWebApp.args.userdata||"";setInterval(function(){amiWebApp._isReady&&amiCommand.certLogin().fail(function(e,t){amiWebApp.lock(),amiWebApp.error(t,!0)}).done(function(e,t,n,r,i,a,o){(n.AMIUser||"")===(n.guestUser||"")&&s._update(n,r,i,a,o)})},3e4),amiCommand.certLogin().fail(function(e,t,n,r,i,a,o){s._update(n,r,i,a,o).always(function(){l.reject(t)})}).done(function(e,t,n,r,i,a,o){_ami_internal_then(amiWebApp.onReady(p),function(){amiWebApp._isReady=!0,s._update(n,r,i,a,o).then(function(e){l.resolve(e)},function(e){l.reject(e)})},function(e){amiWebApp._isReady=!0,l.reject(e)})})}).fail(function(e){l.reject(e)}),l.promise()},_success:function(e){amiWebApp.success(e,!0),this._clean()},_error:function(e){amiWebApp.error(e,!0),this._clean()},_unlock:function(){amiWebApp.unlock(),this._clean()},_clean:function(){$("#B7894CC1_1DAA_4A7E_B7D1_DBDF6F06AC73").trigger("reset"),$("#EE055CD4_E58F_4834_8020_986AE3F8D67D").trigger("reset"),$("#DA2047A2_9E5D_420D_B6E7_FA261D2EF10F").trigger("reset"),$("#E92A1097_983B_4857_875F_07E4659B41B0").trigger("reset")},_update:function(e,t,n,r,i){var a=$.Deferred(),o=this.user=e.AMIUser||"",s=this.guest=e.guestUser||"",l=this.notBefore=e.notBefore||"",c=this.notAfter=e.notAfter||"",u=this.clientDN=e.clientDNInSession||"",p=this.issuerDN=e.issuerDNInSession||"";$("#A09AE316_7068_4BC1_96A9_6B87D28863FE").prop("disabled",!u||!p),$("#C3E94F6D_48E0_86C0_3534_691728E492F4").attr("src",r.termsAndConditions||amiWebApp.originURL+"/docs/terms_and_conditions.html"),$("#E50FF8BD_B0F5_CD72_F9DC_FC2BFA5DBA27").attr("src",r.termsAndConditions||amiWebApp.originURL+"/docs/terms_and_conditions.html"),this.userInfo=e,this.roleInfo=t,this.bookmarkInfo=n,this.udpInfo=r,this.ssoInfo=i;var d={createAccountAllowed:this.createAccountAllowed,changeInfoAllowed:this.changeInfoAllowed,changePasswordAllowed:this.changePasswordAllowed,changeCertificateAllowed:this.changeCertificateAllowed,bookmarksAllowed:this.bookmarksAllowed,bookmarkInfo:this.bookmarkInfo,sso_label:i.label||"SSO",sso_url:i.url||"@NULL"};if(o!==s){var h=e.valid||"false",f=e.certEnabled||"false",m=e.vomsEnabled||"false",g=e.firstName||"",y=e.lastName||"",_=e.email||"",b=e.clientDNInAMI||"",T=e.issuerDNInAMI||"";$("#E513F27D_5521_4B08_BF61_52AFB81356F7").val(g),$("#AFF0B5C0_BEEC_4842_916D_DCBA7F589195").val(y),$("#C587486B_62C0_4B6E_9288_D8F9F89D157B").val(_),$("#ABEB0291_40B0_414A_A42B_E7EABB9B487E").val(g),$("#A5AFDB62_1034_4F66_A3E6_9341B31FA290").val(y),$("#D730A774_05EA_47AB_A0C8_D92753802E3E").val(_),$("#D1BEE3BF_9161_41DC_BC53_C44FFE4D2522").val(b),$("#C76805D7_1E86_4231_9071_1D04783423BB").val(u),$("#F42FAF6B_2C8D_4142_8BD9_E5BCDCAA05AA").val(T),$("#FE2F6232_C256_4B80_939C_EBEC90320308").val(p);var w=[];for(var k in t)w.push("<tr>"),w.push("<td>"+amiWebApp.textToHtml(t[k].name||"N/A")+"</td>"),w.push("<td>"+amiWebApp.textToHtml(t[k].description||"N/A")+"</td>"),w.push("</tr>");$("#BB07676B_EACA_9B42_ED51_477DB2976041").html(w.join(""));var A="",x="",v="",S="";"false"!==h?("false"!==f&&b&&T&&(u&&p?b===u&&T===p||(x="The X.509 certificate in the session differs from the one in AMI."):x="It is recommended to authenticate with a X.509 certificate."),x&&($("#D944B01D_2E8D_4EE9_9DCC_2691438BBA16").html('<i class="fa fa-info-circle text-warning"></i> '+x),A='<a class="nav-link text-warning" href="javascript:amiLogin.accountStatus();"><i class="fa fa-info-circle"></i></a>'),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").closest(".rounded").css("background",'#B8D49B url("'+amiWebApp.originURL+'/images/certificate-green.png") no-repeat center center').css("background-size","cover"),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").css("color","#28A745").html('<i class="fa fa-leaf"></i> valid <i class="fa fa-leaf"></i>'),$("#E91280F6_E7C6_3E53_A457_646995C99317").text(l+" - "+c),v="#B8D49B",S="#28A745"):((x="false"!==m?b&&T?"Check your virtual organization roles.":"Register a valid X.509 certificate.":"Unexpected issue, contact the AMI team.")&&($("#D944B01D_2E8D_4EE9_9DCC_2691438BBA16").html('<i class="fa fa-info-circle text-danger"></i> '+x),A='<a class="nav-link text-danger" href="javascript:amiLogin.accountStatus();"><i class="fa fa-info-circle"></i></a>'),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").closest(".rounded").css("background",'#E8C8CF url("'+amiWebApp.originURL+'/images/certificate-pink.png") no-repeat center center').css("background-size","cover"),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").css("color","#DC3545").html('<i class="fa fa-leaf"></i> invalid <i class="fa fa-leaf"></i>'),$("#E91280F6_E7C6_3E53_A457_646995C99317").text(l+" - "+c),v="#E8C8CF",S="#DC3545"),$("#EC948084_8C0A_CEBF_58C9_086046AB2456").qrcode({render:"canvas",ecLevel:"H",size:150,fill:S,background:v,text:o+"|"+g+" "+y+"|"+_+"|"+b+"|"+T,radius:0,quiet:1}),d.user=o,d.icon=A,amiWebApp.replaceHTML("#ami_login_menu_content",this.fragmentLogoutButton,{dict:d}).done(function(){amiWebApp.triggerLogin().then(function(){a.resolve()},function(e){a.reject(e)})})}else amiWebApp.replaceHTML("#ami_login_menu_content",this.fragmentLoginButton,{dict:d}).done(function(){amiWebApp.triggerLogout().then(function(){a.resolve()},function(e){a.reject(e)})});return a.promise()},getUserInfo:function(){return this.userInfo},getRoleInfo:function(){return this.roleInfo},getBookmarkInfo:function(){return this.bookmarkInfo},getUPDInfo:function(){return this.udpInfo},getSSOInfo:function(){return this.ssoInfo},getUser:function(){return this.user},getGuest:function(){return this.guest},getClientDN:function(){return this.clientDN},getIssuerDN:function(){return this.issuerDN},isAuthenticated:function(){return this.user!==this.guest},hasRole:function(e){return e in this.roleInfo},update:function(){var e=this;return amiWebApp.lock(),amiCommand.certLogin().done(function(t,n,r,i,a,o,s){e._update(r,i,a,o,s).always(function(){amiWebApp.unlock()})})},sso:function(){this._clean(),window.open(this.ssoInfo.url,"Single Sign-On","menubar=no, status=no, scrollbars=no, width=800, height=450")},signIn:function(){this._clean(),$("#D2B5FADE_97A3_4B8C_8561_7A9AEACDBE5B").modal("show")},changeInfo:function(){this._clean(),$("#D9EAF998_ED8E_44D2_A0BE_8C5CF5E438BD").modal("show")},changePass:function(){this._clean(),$("#E92A1097_983B_4857_875F_07E4659B41B0").modal("show")},accountStatus:function(){this._clean(),$("#AB1CB183_96EB_4116_8A9E_4409BE058F34").modal("show")},signOut:function(){var e=this;return amiWebApp.lock(),amiCommand.logout().always(function(t,n,r,i,a,o,s){e._update(r,i,a,o,s).then(function(){e._unlock()},function(t){e._error(t)})})},form_login:function(e){e.preventDefault();var t=$(e.target).serializeObject();return this.form_login2(t.user,t.pass)},form_login2:function(e,t){var n=this,r=e&&t?amiCommand.passLogin(e.trim(),t.trim()):amiCommand.certLogin();amiWebApp.lock(),r.then(function(e,t,r,i,a,o,s){if(n._update(r,i,a,o,s).then(function(){r.AMIUser!==r.guestUser&&($("#D2B5FADE_97A3_4B8C_8561_7A9AEACDBE5B").modal("hide"),n._unlock())},function(e){r.AMIUser!==r.guestUser&&($("#D2B5FADE_97A3_4B8C_8561_7A9AEACDBE5B").modal("hide"),n._error(e))}),r.AMIUser===r.guestUser){var l="Authentication failed.";(r.clientDNInSession||r.issuerDNInSession)&&(l+=" Client DN in session: "+amiWebApp.textToHtml(r.clientDNInSession)+". Issuer DN in session: "+amiWebApp.textToHtml(r.issuerDNInSession)+"."),n._error(l)}},function(e,t,r,i,a,o,s){n._update(r,i,a,o,s).always(function(){n._error(t)})})},form_attachCert:function(){var e=this,t=$("#E64F24B2_33E6_4DED_9B24_28BE04219613").val(),n=$("#A4DFD039_034F_4D10_9668_385AEF4FBBB9").val();t&&n?(amiWebApp.lock(),amiCommand.attachCert(t,n).then(function(t,n){e._success(n)},function(t,n){e._error(n)})):this._error("Please, fill all fields with a red star.")},form_detachCert:function(){var e=this,t=$("#E64F24B2_33E6_4DED_9B24_28BE04219613").val(),n=$("#A4DFD039_034F_4D10_9668_385AEF4FBBB9").val();t&&n?(amiWebApp.lock(),amiCommand.detachCert(t,n).then(function(t,n){e._success(n)},function(t,n){e._error(n)})):this._error("Please, fill all fields with a red star.")},form_addUser:function(e){var t=this;e.preventDefault();var n=$(e.target).serializeObject();amiWebApp.lock(),amiCommand.addUser(n.login,n.pass,n.first_name,n.last_name,n.email,"attach"in n,"agree"in n).then(function(e,n){t._success(n)},function(e,n){t._error(n)})},form_remindPass:function(e){var t=this;e.preventDefault();var n=$(e.target).serializeObject();amiWebApp.lock(),amiCommand.resetPass(n.user).then(function(e,n){t._success(n)},function(e,n){t._error(n)})},form_changeInfo:function(e){var t=this;e.preventDefault();var n=$(e.target).serializeObject();amiWebApp.lock(),amiCommand.changeInfo(n.first_name,n.last_name,n.email).then(function(e,n){t._success(n)},function(e,n){t._error(n)})},form_changePass:function(e){var t=this;e.preventDefault();var n=$(e.target).serializeObject();amiWebApp.lock(),amiCommand.changePass(this.user,n.old_pass,n.new_pass).then(function(e,n){t._success(n)},function(e,n){t._error(n)})}});var amiDoc={functions:[{name:"$AMINamespace",desc:"Create a new namespace",params:[{name:"$name",type:"String",desc:"the namespace name",default:"",optional:"",nullable:""},{name:"$descr",type:"Object",desc:"the namespace body",default:"",optional:!0,nullable:""}]},{name:"$AMIInterface",desc:"Create a new interface",params:[{name:"$name",type:"String",desc:"the interface name",default:"",optional:"",nullable:""},{name:"$descr",type:"Object",desc:"the interface body",default:"",optional:!0,nullable:""}]},{name:"$AMIClass",desc:"Create a new class",params:[{name:"$name",type:"String",desc:"the class name",default:"",optional:"",nullable:""},{name:"$descr",type:"Object",desc:"the class body",default:"",optional:!0,nullable:""}]}],namespaces:[{name:"amiRouter",desc:"The AMI url routing subsystem",functions:[{name:"getScriptURL",desc:"Gets the AWF's script URL",params:[],returns:[{type:"String",desc:"The AWF's script URL"}]},{name:"getOriginURL",desc:"Gets the origin URL",params:[],returns:[{type:"String",desc:"The origin URL"}]},{name:"getWebAppURL",desc:"Gets the webapp URL",params:[],returns:[{type:"String",desc:"The webapp URL"}]},{name:"getHash",desc:"Gets the anchor part of the webapp URL",params:[],returns:[{type:"String",desc:"The anchor part of the webapp URL"}]},{name:"getArgs",desc:"Gets the arguments extracted from the webapp URL",params:[],returns:[{type:"Array.<String>",desc:"The arguments extracted from the webapp URL"}]},{name:"append",desc:"Appends a routing rule",params:[{name:"regExp",type:"String",desc:"the regExp",default:"",optional:"",nullable:""},{name:"handler",type:"Object",desc:"the handler",default:"",optional:"",nullable:""}],returns:[{type:"Namespace",desc:"The amiRouter singleton"}]},{name:"remove",desc:"Removes some routing rules",params:[{name:"regExp",type:"String",desc:"the regExp",default:"",optional:"",nullable:""}],returns:[{type:"Namespace",desc:"The amiRouter singleton"}]},{name:"check",desc:"Checks whether the URL matches with a routing rule",params:[],returns:[{type:"Boolean",desc:""}]},{name:"appendHistoryEntry",desc:"Append a new history entry",params:[{name:"path",type:"String",desc:"the new path",default:"",optional:"",nullable:""},{name:"context",type:"Object",desc:"the new context",default:"",optional:!0,nullable:""}],returns:[{type:"Boolean",desc:""}]},{name:"replaceHistoryEntry",desc:"Replace the current history entry",params:[{name:"path",type:"String",desc:"the new path",default:"",optional:"",nullable:""},{name:"context",type:"Object",desc:"the new context",default:"",optional:!0,nullable:""}],returns:[{type:"Boolean",desc:""}]}]},{name:"amiWebApp",desc:"The AMI webapp subsystem",variables:[{name:"originURL",type:"String",desc:"The origin URL"},{name:"webAppURL",type:"String",desc:"The webapp URL"},{name:"hash",type:"String",desc:"The anchor part of the webapp URL"},{name:"args",type:"Array.<String>",desc:"The arguments extracted from the webapp URL"}],functions:[{name:"isEmbedded",desc:"Checks whether the WebApp is executed in embedded mode",params:[],returns:[{type:"Boolean",desc:""}]},{name:"isLocal",desc:"Checks whether the WebApp is executed locally (file://, localhost, 127.0.0.1 or ::1)",params:[],returns:[{type:"Boolean",desc:""}]},{name:"textToHtml",desc:"Escapes the given string from text to HTML",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"htmlToText",desc:"Unescapes the given string from HTML to text",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"textToString",desc:"Escapes the given string from text to JavaScript string",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"stringToText",desc:"Unescapes the given string from JavaScript string to text",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"htmlToString",desc:"Escapes the given string from HTML to JavaScript string",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"stringToHtml",desc:"Unescapes the given string from JavaScript string to HTML",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"textToSQL",desc:"Escapes the given string from text to SQL",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"sqlToText",desc:"Unescapes the given string from SQL to text",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"base64Encode",desc:"Encodes (RFC 4648) a string",params:[{name:"string",type:"String",desc:"the decoded string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The encoded string"}]},{name:"base64Decode",desc:"Decodes (RFC 4648) a string",params:[{name:"string",type:"String",desc:"the encoded string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The decoded string"}]},{name:"loadResources",desc:"Asynchronously loads resources by extension",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadSheets",desc:"Asynchronously loads CSS sheets",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadScripts",desc:"Asynchronously loads JS scripts",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadJSONs",desc:"Asynchronously loads JSON files",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadXMLs",desc:"Asynchronously loads XML files",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadHTMLs",desc:"Asynchronously loads HTML files",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadTWIGs",desc:"Asynchronously loads TWIG files",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadTexts",desc:"Asynchronously loads text files",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"replaceHTML",desc:"Puts a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, suffix, dict, twigs)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, suffix, dict, twigs)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, suffix, dict, twigs)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"formatTWIG",desc:"Interpretes the given TWIG string, see {@link http://twig.sensiolabs.org/documentation}",params:[{name:"twig",type:"String",desc:"the TWIG string",default:"",optional:"",nullable:""},{name:"dict",type:["Object","Array"],desc:"the dictionary",default:"",optional:!0,nullable:""},{name:"twigs",type:"Object",desc:"dictionary of fragments",default:"",optional:!0,nullable:""}],returns:[{type:"String",desc:"The Interpreted TWIG string"}]},{name:"jspath",desc:"Finds data within the given JSON, see {@link https://github.com/dfilatov/jspath}",params:[{name:"path",type:"String",desc:"the path",default:"",optional:"",nullable:""},{name:"json",type:"Object",desc:"the JSON",default:"",optional:"",nullable:""}],returns:[{type:"Array",desc:"The resulting array"}]},{name:"lock",desc:"Locks the Web application",params:[]},{name:"unlock",desc:"Unlocks the Web application",params:[]},{name:"modalLeave",desc:"Leave the modal window",params:[]},{name:"modalEnter",desc:"Enter the modal window",params:[]},{name:"canLeave",desc:"Enables the message in a confirmation dialog box to inform that the user is about to leave the current page.",params:[]},{name:"cannotLeave",desc:"Disables the message in a confirmation dialog box to inform that the user is about to leave the current page.",params:[]},{name:"info",desc:"Shows an 'info' message",params:[{name:"message",type:["String","Array"],desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""}]},{name:"success",desc:"Shows a 'success' message",params:[{name:"message",type:["String","Array"],desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""}]},{name:"warning",desc:"Shows a 'warning' message",params:[{name:"message",type:["String","Array"],desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""}]},{name:"error",desc:"Shows an 'error' message",params:[{name:"message",type:["String","Array"],desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""}]},{name:"flush",desc:"Flushes messages",params:[]},{name:"fillBreadcrumb",desc:"Fill the main breadcrumb",params:[{name:"items",type:"Array",desc:"the array of items (HTML format)",default:"",optional:"",nullable:""}]},{name:"start",desc:"Starts the Web application",params:[{name:"settings",type:"Object",desc:"dictionary of settings (logo_url, home_url, contact_email, about_url, theme_url, locker_url, password_authentication_allowed, certificate_authentication_allowed, create_account_allowed, change_info_allowed, change_password_allowed, change_certificate_allowed, bookmarksAllowed)",default:"",optional:!0,nullable:""}]},{name:"loadControl",desc:"Asynchronously loads a control",params:[{name:"control",type:"String",desc:"the array of control name",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"createControl",desc:"Asynchronously create a control",params:[{name:"parent",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"owner",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"control",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"params",type:"Array",desc:"???",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"createControlInBody",desc:"Asynchronously create a control in the body",params:[{name:"parent",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"owner",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"control",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"paramsWithoutSettings",type:"Array",desc:"???",default:"",optional:"",nullable:""},{name:"controlSettings",type:"Object",desc:"???",default:"",optional:"",nullable:""},{name:"parentSettings",type:"Object",desc:"???",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"createControlInContainer",desc:"Asynchronously create a control in a container",params:[{name:"parent",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"owner",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"control",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"paramsWithoutSettings",type:"Array",desc:"???",default:"",optional:"",nullable:""},{name:"controlSettings",type:"Object",desc:"???",default:"",optional:"",nullable:""},{name:"parentSettings",type:"Object",desc:"???",default:"",optional:"",nullable:""},{name:"icon",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"title",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"createControlFromWebLink",desc:"Asynchronously create a control in a container from a WEB link",params:[{name:"parent",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"owner",type:"Object",desc:"???",default:"",optional:!0,nullable:""},{name:"el",type:"String",desc:"???",default:"",optional:"",nullable:""},{name:"parentSettings",type:"Object",desc:"???",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadSubApp",desc:"Asynchronously loads a subapp",params:[{name:"subapp",type:"String",desc:"the subapp",default:"",optional:"",nullable:""},{name:"userdata",type:"?",desc:"the user data",default:"",optional:!0,nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadSubAppByURL",desc:"Loads a subapp by URL",params:[{name:"defaultSubApp",type:"String",desc:"if 'amiWebApp.args[\"subapp\"]' is null, the default subapp",default:"",optional:"",nullable:""},{name:"defaultUserData",type:"?",desc:"if 'amiWebApp.args[\"userdata\"]' is null, the default user data",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]}],events:[{name:"onReady",desc:"This method must be overloaded and is called when the Web application starts",params:[{name:"userData",type:"String",desc:"",default:"",optional:"",nullable:""}]},{name:"onRefresh",desc:"This method must be overloaded and is called when the toolbar needs to be updated",params:[{name:"isAuth",type:"Boolean",desc:"",default:"",optional:"",nullable:""}]}]},{name:"amiCommand",desc:"The AMI command subsystem",variables:[{name:"endpoint",type:"String",desc:"Default endpoint"},{name:"converter",type:"String",desc:"Default converter"}],functions:[{name:"execute",desc:"Executes an AMI command",params:[{name:"command",type:"String",desc:"the command",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, endpoint, converter, timeout, extraParam, extraValue)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"passLogin",desc:"Logs in by login/password",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"certLogin",desc:"Logs in by certificate",params:[{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"logout",desc:"Logs out",params:[{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"attachCert",desc:"Attaches a certificate",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"detachCert",desc:"Detaches a certificate",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"addUser",desc:"Adds a new user",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"firstName",type:"String",desc:"the first name",default:"",optional:"",nullable:""},{name:"lastName",type:"String",desc:"the last name",default:"",optional:"",nullable:""},{name:"email",type:"String",desc:"the email",default:"",optional:"",nullable:""},{name:"attach",type:"Boolean",desc:"attach the current certificate",default:"",optional:"",nullable:""},{name:"agree",type:"Boolean",desc:"agree with the terms and conditions",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"changeInfo",desc:"Changes the account information",params:[{name:"firstName",type:"String",desc:"the first name",default:"",optional:"",nullable:""},{name:"lastName",type:"String",desc:"the last name",default:"",optional:"",nullable:""},{name:"email",type:"String",desc:"the email",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"changePass",desc:"Changes the account password",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"oldPass",type:"String",desc:"the old password",default:"",optional:"",nullable:""},{name:"newPass",type:"String",desc:"the new password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"resetPass",desc:"Resets the account password",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]}]},{name:"amiLogin",desc:"The AMI authentication subsystem",functions:[{name:"getUserInfo",desc:"Gets the user information",params:[],returns:[{type:"String",desc:"The current user information"}]},{name:"getRoleInfo",desc:"Gets the user role information",params:[],returns:[{type:"String",desc:"The current role information"}]},{name:"getBookmarkInfo",desc:"Gets the user bookmark information",params:[],returns:[{type:"String",desc:"The current user data protection information"}]},{name:"getUPDInfo",desc:"Gets the user data protection information",params:[],returns:[{type:"String",desc:"The current user data protection information"}]},{name:"getSSOInfo",desc:"Gets the single sign on information",params:[],returns:[{type:"String",desc:"The current single sign on information"}]},{name:"getUser",desc:"Gets the current user",params:[],returns:[{type:"String",desc:"The current user"}]},{name:"getGuest",desc:"Gets the guest user",params:[],returns:[{type:"String",desc:"The guest user"}]},{name:"getClientDN",desc:"Gets the client DN",params:[],returns:[{type:"String",desc:"The client DN"}]},{name:"getIssuerDN",desc:"Gets the issuer DN",params:[],returns:[{type:"String",desc:"The issuer DN"}]},{name:"isAuthenticated",desc:"Checks whether the user is authenticated",params:[],returns:[{type:"Boolean",desc:""}]},{name:"hasRole",desc:"Checks whether the user has the given role",params:[{name:"role",type:"String",desc:"the role",default:"",optional:"",nullable:""}],returns:[{type:"Boolean",desc:""}]},{name:"update",desc:"Update the user information",params:[],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"sso",desc:"Opens the 'SSO' modal window",params:[]},{name:"signIn",desc:"Opens the 'SignIn' modal window",params:[]},{name:"changeInfo",desc:"Opens the 'Change Info' modal window",params:[]},{name:"changePass",desc:"Opens the 'Change Password' modal window",params:[]},{name:"accountStatus",desc:"Opens the 'Account Status' modal window",params:[]},{name:"signOut",desc:"Signs out",params:[]}]}],interfaces:[{name:"ami.IControl",desc:"The AMI control interface",implements:[],inherits:[],functions:[{name:"patchId",desc:"Patches an HTML identifier",params:[{name:"id",type:"String",desc:"the unpatched HTML identifier",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The patched HTML identifier"}]},{name:"replaceHTML",desc:"Puts a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"onReady",desc:"Called when the control is ready to run",params:[]},{name:"onRemove",desc:"Called when the control is removed",params:[]}]},{name:"ami.ISubApp",desc:"The AMI sub-application interface",implements:[],inherits:[],functions:[{name:"onReady",desc:"Called when the sub-application is ready to run",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onExit",desc:"Called when the sub-application is about to exit",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogin",desc:"Called when logging in",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogout",desc:"Called when logging out",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]}]}],classes:[{name:"ami.Control",desc:"The basic AMI control",implements:["ami.IControl"],inherits:[],konstructor:{name:"Control",params:[]},functions:[{name:"patchId",desc:"Patches an HTML identifier",params:[{name:"id",type:"String",desc:"the unpatched HTML identifier",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The patched HTML identifier"}]},{name:"replaceHTML",desc:"Puts a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"onReady",desc:"Called when the control is ready to run",params:[]},{name:"onRemove",desc:"Called when the control is removed",params:[]}]},{name:"ami.SubApp",desc:"The basic AMI sub-application",implements:["ami.ISubApp"],inherits:[],konstructor:{name:"SubApp",params:[]},functions:[{name:"onReady",desc:"Called when the sub-application is ready to run",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onExit",desc:"Called when the sub-application is about to exit",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogin",desc:"Called when logging in",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogout",desc:"Called when logging out",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]}]}]};