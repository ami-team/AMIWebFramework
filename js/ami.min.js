/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-2017 The AMI Team / LPSC / IN2P3
 *
 * This file must be used under the terms of the CeCILL-C:
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html
 *
 */

"use strict";function _$createNamespace(e,t){for(var n=window,i=e.split(/\s*\.\s*/g),r=i.length-1,a=0;a<r;a++)n=n[i[a]]?n[i[a]]:n[i[a]]={};n[i[a]]=t}function _$addToNamespace(e,t){for(var n=window,i=e.split(/\s*\.\s*/g),r=i.length-1,a=0;a<r;a++){if(!n[i[a]])throw"`"+e+"` (`"+i[a]+"`) not declared";n=n[i[a]]}n[i[a]]=t}function $AMINamespace(e,t){t||(t={}),t.$name=e,_$createNamespace(e,t),t.$&&t.$.apply(t)}function $AMIInterface(e,t){t||(t={});var n=function(){throw"could nor instantiate interface"};if(t.$extends)throw"`$extends` not allowed for interface";if(t.$implements)throw"`$implements` not allowed for interface";if(t.$)throw"`$` not allowed for interface";if(t.$init)throw"`$init` not allowed for interface";n.$name=e,n.$class=n,n.$members=t,_$addToNamespace(e,n)}function $AMIClass(e,t){t||(t={});var n=t.$extends instanceof Function?t.$extends.prototype:{},i=n.$implements instanceof Array?n.$implements:[],r=t.$implements instanceof Array?t.$implements:[],a=function(){for(var e in this.$implements){var t=this.$implements[e];for(var n in t.$members){var i=t.$members[n];if(_typeof(this[n])!==(void 0===i?"undefined":_typeof(i)))throw"class `"+this.$name+"` with must implement `"+t.$name+"."+n+"`"}}this.$super={};for(var r in this.$class._internal_super)this.$super[r]=function(e,t){return function(){return t.$class._internal_super[e].apply(t,arguments)}}(r,this);this.$added={};for(var a in this.$class._internal_added)this.$added[a]=function(e,t){return function(){return t.$class._internal_added[e].apply(t,arguments)}}(a,this);this.$init&&this.$init.apply(this,arguments)};a._internal_super={},a._internal_added={};for(var s in n)("$init"===s||"$"!==s.charAt(0)||n.hasOwnProperty(s))&&(a._internal_super[s]=n[s],a.prototype[s]=n[s]);for(var o in t)("$init"===o||"$"!==o.charAt(0)||t.hasOwnProperty(o))&&(a._internal_added[o]=t[o],a.prototype[o]=t[o]);a.prototype.$name=e,a.prototype.$class=a,a.prototype.$implements=i.concat(r),_$addToNamespace(e,a),t.$&&t.$.apply(a)}function _ami_internal_then(e,t,n){e&&e.then?e.then(t,n):t()}function _ami_internal_always(e,t){e&&e.always?e.always(t):t()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},amiTwig={};"undefined"!=typeof exports&&(amiTwig.fs=require("fs"),module.exports.amiTwig=amiTwig),amiTwig.tokenizer={tokenize:function(e,t,n,i,r,a){if(i.length!==r.length)throw"`tokenDefs.length != tokenTypes.length`";var s=[],o=[],l=[],c=0,u=e.length,p="",d=void 0,h=void 0;e:for(;c<u;)if("\n"===(h=e.charAt(0))&&t++,n.indexOf(h)>=0){if(p){if(a)throw"invalid token `"+p+"`";s.push(p),o.push(-1),l.push(t),p=""}e=e.substring(1),c+=1}else{for(var f in i)if(d=this._match(e,i[f])){if(p){if(a)throw"invalid token `"+p+"`";s.push(p),o.push(-1),l.push(t),p=""}s.push(d),o.push(r[f]),l.push(t),e=e.substring(d.length),c+=d.length;continue e}p+=h,e=e.substring(1),c+=1}if(p){if(a)throw"invalid token `"+p+"`";s.push(p),o.push(-1),l.push(t),p=""}return{tokens:s,types:o,lines:l}},_match:function(e,t){var n=void 0;return t instanceof RegExp?null!==(n=e.match(t))&&this._checkNextChar(e,n[0])?n[0]:null:0===(n=e.indexOf(t))&&this._checkNextChar(e,t)?t:null},_alnum:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_checkNextChar:function(e,t){var n=t.length,i=e.charCodeAt(n-0),r=e.charCodeAt(n-1);return isNaN(i)||0===this._alnum[i]||0===this._alnum[r]}},amiTwig.expr={},amiTwig.expr.tokens={$init:function(){this.IS_XXX=[this.DEFINED,this.NULL,this.EMPTY,this.ITERABLE,this.EVEN,this.ODD],this.XXX_WITH=[this.STARTS_WITH,this.ENDS_WITH],this.PLUS_MINUS=[this.CONCAT,this.PLUS,this.MINUS],this.MUL_FLDIV_DIV_MOD=[this.MUL,this.FLDIV,this.DIV,this.MOD],this.RX=[this.RP,this.RB1]},LOGICAL_OR:100,LOGICAL_AND:101,BITWISE_OR:102,BITWISE_XOR:103,BITWISE_AND:104,NOT:105,IS:106,DEFINED:107,NULL:108,EMPTY:109,ITERABLE:110,EVEN:111,ODD:112,CMP_OP:113,STARTS_WITH:114,ENDS_WITH:115,MATCHES:116,IN:117,RANGE:118,CONCAT:119,PLUS:120,MINUS:121,POWER:122,MUL:123,FLDIV:124,DIV:125,MOD:126,COLON:127,DOT:128,COMMA:129,PIPE:130,LP:131,RP:132,LB1:133,RB1:134,LB2:135,RB2:136,SID:137,TERMINAL:138,LST:200,DIC:201,FUN:202,VAR:203},amiTwig.expr.tokens.$init(),amiTwig.expr.Tokenizer=function(e,t){this._spaces=[" ","\t","\n","\r"],this._tokenDefs=["or","and","b-or","b-xor","b-and","not","is","defined","null","empty","iterable","even","odd","===","==","!==","!=","<=",">=","<",">",/^starts\s+with/,/^ends\s+with/,"matches","in","..","~","+","-","**","*","//","/","%",":",".",",","|","(",")","[","]","{","}","true","false",/^[0-9]+\.[0-9]+/,/^[0-9]+/,/^'(\\'|[^'])*'/,/^"(\\"|[^"])*"/,/^[a-zA-Z_$][a-zA-Z0-9_$]*/],this._tokenTypes=[amiTwig.expr.tokens.LOGICAL_OR,amiTwig.expr.tokens.LOGICAL_AND,amiTwig.expr.tokens.BITWISE_OR,amiTwig.expr.tokens.BITWISE_XOR,amiTwig.expr.tokens.BITWISE_AND,amiTwig.expr.tokens.NOT,amiTwig.expr.tokens.IS,amiTwig.expr.tokens.DEFINED,amiTwig.expr.tokens.NULL,amiTwig.expr.tokens.EMPTY,amiTwig.expr.tokens.ITERABLE,amiTwig.expr.tokens.EVEN,amiTwig.expr.tokens.ODD,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.CMP_OP,amiTwig.expr.tokens.STARTS_WITH,amiTwig.expr.tokens.ENDS_WITH,amiTwig.expr.tokens.MATCHES,amiTwig.expr.tokens.IN,amiTwig.expr.tokens.RANGE,amiTwig.expr.tokens.CONCAT,amiTwig.expr.tokens.PLUS,amiTwig.expr.tokens.MINUS,amiTwig.expr.tokens.POWER,amiTwig.expr.tokens.MUL,amiTwig.expr.tokens.FLDIV,amiTwig.expr.tokens.DIV,amiTwig.expr.tokens.MOD,amiTwig.expr.tokens.COLON,amiTwig.expr.tokens.DOT,amiTwig.expr.tokens.COMMA,amiTwig.expr.tokens.PIPE,amiTwig.expr.tokens.LP,amiTwig.expr.tokens.RP,amiTwig.expr.tokens.LB1,amiTwig.expr.tokens.RB1,amiTwig.expr.tokens.LB2,amiTwig.expr.tokens.RB2,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.TERMINAL,amiTwig.expr.tokens.SID],this.$init=function(e,t){var n=amiTwig.tokenizer.tokenize(e,t,this._spaces,this._tokenDefs,this._tokenTypes,!0);this.tokens=n.tokens,this.types=n.types,this.i=0},this.next=function(e){this.i+=e||1},this.isEmpty=function(){return this.i>=this.tokens.length},this.peekToken=function(){return this.tokens[this.i]},this.peekType=function(){return this.types[this.i]},this.checkType=function(e){if(this.i<this.tokens.length){var t=this.types[this.i];return e instanceof Array?e.indexOf(t)>=0:e===t}return!1},this.$init(e,t)},amiTwig.expr.Compiler=function(e,t){this.$init(e,t)},amiTwig.expr.Compiler.prototype={$init:function(e,t){if(this.tokenizer=new amiTwig.expr.Tokenizer(this.code=e,this.line=t),this.rootNode=this.parseFilter(),!1===this.tokenizer.isEmpty())throw"syntax error, line `"+this.line+"`, unexpected token `"+this.tokenizer.peekToken()+"`"},dump:function(){return this.rootNode.dump()},parseFilter:function(){for(var e=this.parseLogicalOr(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.PIPE);){for(this.tokenizer.next(),n=t=this.parseDot1(!0);n.nodeType===amiTwig.expr.tokens.DOT;n=n.nodeLeft);n.list.unshift(e),e=t}return e},parseLogicalOr:function(){for(var e=this.parseLogicalAnd(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.LOGICAL_OR);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseLogicalAnd(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseLogicalAnd:function(){for(var e=this.parseBitwiseOr(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.LOGICAL_AND);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseBitwiseOr(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseBitwiseOr:function(){for(var e=this.parseBitwiseXor(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_OR);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseBitwiseXor(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseBitwiseXor:function(){for(var e=this.parseBitwiseAnd(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_XOR);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseBitwiseAnd(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseBitwiseAnd:function(){for(var e=this.parseNot(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.BITWISE_AND);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseNot(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseNot:function(){var e=void 0,t=void 0;return this.tokenizer.checkType(amiTwig.expr.tokens.NOT)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parseComp(),t.nodeLeft=e,t.nodeRight=null,t):this.parseComp()},parseComp:function(){var e=this.parseAddSub(),t=void 0,n=void 0,i=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.IS)){if(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),i=n,this.tokenizer.checkType(amiTwig.expr.tokens.NOT)&&(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),n.nodeLeft=i,n.nodeRight=null),!this.tokenizer.checkType(amiTwig.expr.tokens.IS_XXX))throw"syntax error, line `"+this.line+"`, keyword `defined`, `null`, `empty`, `iterable`, `even` or `odd` expected";t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),i.nodeLeft=e,i.nodeRight=t,e=n}else this.tokenizer.checkType(amiTwig.expr.tokens.CMP_OP)?(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseAddSub(),n.nodeLeft=e,n.nodeRight=t,e=n):this.tokenizer.checkType(amiTwig.expr.tokens.XXX_WITH)?(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseAddSub(),n.nodeLeft=e,n.nodeRight=t,e=n):this.tokenizer.checkType(amiTwig.expr.tokens.MATCHES)?(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseAddSub(),n.nodeLeft=e,n.nodeRight=t,e=n):this.tokenizer.checkType(amiTwig.expr.tokens.IN)&&(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseAddSub(),n.nodeLeft=e,n.nodeRight=t,e=n);return e},parseAddSub:function(){for(var e=this.parseMulDiv(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.PLUS_MINUS);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseMulDiv(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseMulDiv:function(){for(var e=this.parsePlusMinus(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.MUL_FLDIV_DIV_MOD);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parsePlusMinus(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parsePlusMinus:function(){var e=void 0,t=void 0;return this.tokenizer.checkType(amiTwig.expr.tokens.PLUS_MINUS)?(t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),e=this.parsePower(),t.nodeLeft=e,t.nodeRight=null,t):this.parsePower()},parsePower:function(){for(var e=this.parseDot1(),t=void 0,n=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.POWER);)n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),t=this.parseDot1(),n.nodeLeft=e,n.nodeRight=t,e=n;return e},parseDot1:function(e){var t=this.parseDot2(e);if(t){for(var n=t;n.nodeType===amiTwig.expr.tokens.DOT;n=n.nodeLeft);n.q&&(n.nodeType===amiTwig.expr.tokens.FUN?n.nodeValue in amiTwig.stdlib?n.nodeValue="amiTwig.stdlib."+n.nodeValue:n.nodeValue="_."+n.nodeValue:n.nodeType===amiTwig.expr.tokens.VAR&&(n.nodeValue="_."+n.nodeValue),n.q=!1)}return t},parseDot2:function(e){for(var t=this.parseDot3(e),n=void 0,i=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.DOT);)i=new amiTwig.expr.Node(this.tokenizer.peekType(),"."),this.tokenizer.next(),n=this.parseDot3(e),i.nodeLeft=t,i.nodeRight=n,t=i;return t},parseDot3:function(e){for(var t=this.parseX(e),n=void 0,i=void 0;this.tokenizer.checkType(amiTwig.expr.tokens.LB1);){if(this.tokenizer.next(),n=this.parseFilter(),!this.tokenizer.checkType(amiTwig.expr.tokens.RB1))throw"syntax error, line `"+this.line+"`, `]` expected";this.tokenizer.next(),(i=new amiTwig.expr.Node(amiTwig.expr.tokens.DOT,"[]")).nodeLeft=t,i.nodeRight=n,t=i}return t},parseX:function(e){var t=void 0;if(t=this.parseGroup())return t;if(t=this.parseArray())return t;if(t=this.parseObject())return t;if(t=this.parseFunVar(e))return t;if(t=this.parseTerminal())return t;throw"syntax error, line `"+this.line+"`, syntax error or tuncated expression"},parseGroup:function(){var e=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.LP)){if(this.tokenizer.next(),e=this.parseFilter(),this.tokenizer.checkType(amiTwig.expr.tokens.RP))return this.tokenizer.next(),e;throw"syntax error, line `"+this.line+"`, `)` expected"}return null},parseArray:function(){var e=void 0,t=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.LB1)){if(this.tokenizer.next(),t=this._parseSinglets(),this.tokenizer.checkType(amiTwig.expr.tokens.RB1))return this.tokenizer.next(),e=new amiTwig.expr.Node(amiTwig.expr.tokens.LST,"Array"),e.list=t,e;throw"syntax error, line `"+this.line+"`, `]` expected"}return null},parseObject:function(){var e=void 0,t=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.LB2)){if(this.tokenizer.next(),t=this._parseDoublets(),this.tokenizer.checkType(amiTwig.expr.tokens.RB2))return this.tokenizer.next(),e=new amiTwig.expr.Node(amiTwig.expr.tokens.DIC,"Object"),e.dict=t,e;throw"syntax error, line `"+this.line+"`, `}` expected"}return null},parseFunVar:function(e){var t=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.SID)){if(t=new amiTwig.expr.Node(0,e?"filter_"+this.tokenizer.peekToken():this.tokenizer.peekToken()),t.q=!0,this.tokenizer.next(),this.tokenizer.checkType(amiTwig.expr.tokens.LP)){if(this.tokenizer.next(),t.list=this._parseSinglets(),!this.tokenizer.checkType(amiTwig.expr.tokens.RP))throw"syntax error, line `"+this.line+"`, `)` expected";this.tokenizer.next(),t.nodeType=amiTwig.expr.tokens.FUN}else t.nodeType=e?amiTwig.expr.tokens.FUN:amiTwig.expr.tokens.VAR,t.list=[];return t}return null},_parseSinglets:function(){for(var e=[];!1===this.tokenizer.checkType(amiTwig.expr.tokens.RX)&&(this._parseSinglet(e),!0===this.tokenizer.checkType(amiTwig.expr.tokens.COMMA));)this.tokenizer.next();return e},_parseDoublets:function(){for(var e={};!1===this.tokenizer.checkType(amiTwig.expr.tokens.RB2)&&(this._parseDoublet(e),!0===this.tokenizer.checkType(amiTwig.expr.tokens.COMMA));)this.tokenizer.next();return e},_parseSinglet:function(e){e.push(this.parseFilter())},_parseDoublet:function(e){if(!this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL))throw"syntax error, line `"+this.line+"`, terminal expected";var t=this.tokenizer.peekToken();if(this.tokenizer.next(),!this.tokenizer.checkType(amiTwig.expr.tokens.COLON))throw"syntax error, line `"+this.line+"`, `:` expected";this.tokenizer.next(),e[t]=this.parseFilter()},parseTerminal:function(){var e=void 0,t=void 0,n=void 0;if(this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL)){if(e=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),!this.tokenizer.checkType(amiTwig.expr.tokens.RANGE))return e;if(n=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),this.tokenizer.checkType(amiTwig.expr.tokens.TERMINAL))return t=new amiTwig.expr.Node(this.tokenizer.peekType(),this.tokenizer.peekToken()),this.tokenizer.next(),n.nodeLeft=e,n.nodeRight=t,n}return null}},amiTwig.expr.Node=function(e,t){this.$init(e,t)},amiTwig.expr.Node.prototype={$init:function(e,t){this.nodeType=e,this.nodeValue=t,this.nodeLeft=null,this.nodeRight=null,this.list=null,this.dict=null},_dump:function(e,t,n){var i=void 0,r=n[0];if(e.push("\tnode"+r+' [label="'+this.nodeValue.replace(/"/g,'\\"')+'"];'),this.nodeLeft&&(i=++n[0],t.push("\tnode"+r+" -> node"+i+";"),this.nodeLeft._dump(e,t,n)),this.nodeRight&&(i=++n[0],t.push("\tnode"+r+" -> node"+i+";"),this.nodeRight._dump(e,t,n)),this.list)for(var a in this.list)i=++n[0],t.push("\tnode"+r+" -> node"+i+' [label="['+a.replace(/"/g,'\\"')+']"];'),this.list[a]._dump(e,t,n);if(this.dict)for(var s in this.dict)i=++n[0],t.push("\tnode"+r+" -> node"+i+' [label="['+s.replace(/"/g,'\\"')+']"];'),this.dict[s]._dump(e,t,n)},dump:function(){var e=[],t=[];return this._dump(e,t,[0]),"digraph ast {\n\trankdir=TB;\n"+e.join("\n")+"\n"+t.join("\n")+"\n}"}},amiTwig.tmpl={},amiTwig.tmpl.Compiler=function(e){this.$init(e)},amiTwig.tmpl.Compiler.prototype={STATEMENT_RE:/\{%\s*([a-zA-Z]+)\s+(.*?)\s*%\}/m,COMMENT_RE:/\{#\s*(.*?)\s*#\}/g,$init:function(e){var t=1,n=0,i=0;this.rootNode={line:t,keyword:"@root",expression:"",blocks:[{expression:"@root",list:[]}],value:""};var r=[this.rootNode],a=[0],s=void 0;for(e=e.replace(this.COMMENT_RE,"");;e=e.substr(i)){var o=r[r.length-1],l=a[a.length-1],c=e.match(this.STATEMENT_RE);if(null===c){var u=!0,p=!1,d=void 0;try{for(var h,f=e[Symbol.iterator]();!(u=(h=f.next()).done);u=!0)"\n"===h.value&&t++}catch(e){p=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(p)throw d}}o.blocks[l].list.push({line:t,keyword:"@text",expression:"",blocks:[],value:e});for(var m=[],g=r.length-1;g>0;g--)"if"===r[g].keyword?m.push("missing keyword `endif`"):"for"===r[g].keyword&&m.push("missing keyword `endfor`");if(m.length>0)throw"syntax error, line `"+t+"`, "+m.join(", ");return}var _=c[0],y=c[1],T=c[2];n=c.index+0,i=c.index+_.length;var b=e.substr(0,n),x=e.substr(0,i);for(var k in x)"\n"===k&&t++;switch(b&&(s={line:t,keyword:"@text",expression:"",blocks:[],value:b},o.blocks[l].list.push(s)),y){case"flush":case"autoescape":case"spaceless":case"verbatim":break;case"do":case"set":case"include":s={line:t,keyword:y,expression:T,blocks:[],value:""},o.blocks[l].list.push(s);break;case"if":case"for":s={line:t,keyword:y,blocks:[{expression:T,list:[]}],value:""},o.blocks[l].list.push(s),r.push(s),a.push(0);break;case"elseif":if("if"!==o.keyword)throw"syntax error, line `"+t+"`, unexpected keyword `elseif`";l=o.blocks.length,o.blocks.push({expression:T,list:[]}),a[a.length-1]=l;break;case"else":if("if"!==o.keyword)throw"syntax error, line `"+t+"`, unexpected keyword `else`";l=o.blocks.length,o.blocks.push({expression:"@else",list:[]}),a[a.length-1]=l;break;case"endif":if("if"!==o.keyword)throw"syntax error, line `"+t+"`, unexpected keyword `endif`";r.pop(),a.pop();break;case"endfor":if("for"!==o.keyword)throw"syntax error, line `"+t+"`, unexpected keyword `endfor`";r.pop(),a.pop();break;default:throw"syntax error, line `"+t+"`, unknown keyword `"+y+"`"}}},dump:function(){return JSON.stringify(this.rootNode,null,2)}},amiTwig.engine={VARIABLE_RE:/\{\{\s*(.*?)\s*\}\}/g,_render:function(e,t,n){var i=void 0,r=void 0,a=void 0,s=void 0,o=void 0,l=void 0,c=void 0,u=void 0;switch(this.dict=n||{},t.keyword){case"do":amiTwig.expr.cache.eval(t.expression,t.line,n);break;case"set":if(!(o=t.expression.match(/([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*(.+)/)))throw"syntax error, line `"+t.line+"`, invalid `set` statement";n[o[1]]=amiTwig.expr.cache.eval(o[2],t.line,n);break;case"@text":e.push(t.value.replace(this.VARIABLE_RE,function(e,i){return void 0!==(u=amiTwig.expr.cache.eval(i,t.line,n))&&null!==u?u:""}));break;case"if":case"@root":for(var p in t.blocks)if("@root"===(a=t.blocks[p].expression)||"@else"===a||amiTwig.expr.cache.eval(a,t.line,n)){s=t.blocks[p].list;for(var d in s)this._render(e,s[d],n);break}break;case"for":if(!(o=t.blocks[0].expression.match(/([a-zA-Z_$][a-zA-Z0-9_$]*)\s+in\s+(.+)/)))throw"syntax error, line `"+t.line+"`, invalid `for` statement";l=o[1],c=o[2],u=amiTwig.expr.cache.eval(c,t.line,n);var h=Object.prototype.toString.call(u);if("[object Array]"!==h&&"[object Object]"!==h&&"[object String]"!==h)throw"syntax error, line `"+t.line+"`, right operande not iterable";"[object Object]"===h&&(u=Object.keys(u));var f=n[l],m=n.loop;i=0,r=u.length,n.loop={length:r},s=t.blocks[0].list;for(var g in u){n[l]=u[g],n.loop.first=0===i,n.loop.last=i===r-1,n.loop.index0=i,i++,n.loop.index=i;for(var _ in s)this._render(e,s[_],n)}m&&(n.loop=m),f&&(n[l]=f);break;case"include":var y=!0;(o=(a=(a=t.expression).trim()).match(/only$/))&&(a=a.substr(a,a.length-o[0].length-1),y=!1);var T="{}";(o=(a=a.trim()).match(/with\s+(.+)$/))&&(a=a.substr(a,a.length-o[0].length-1),T=o[1]);var b=amiTwig.expr.cache.eval(a,t.line,n)||"";if("[object String]"!==Object.prototype.toString.call(b))throw"runtime error, line `"+t.line+"`, string expected";var x=amiTwig.expr.cache.eval(T,t.line,n)||{};if("[object Object]"!==Object.prototype.toString.call(x))throw"runtime error, line `"+t.line+"`, object expected";e.push(amiTwig.stdlib.include(b,x,y,!1))}},render:function(e,t){var n=[];return this._render(n,"[object String]"===Object.prototype.toString.call(e)?new amiTwig.tmpl.Compiler(e).rootNode:e,t||{}),n.join("")}},amiTwig.expr.cache={dict:{},eval:function _eval(expression,line,_){var f=void 0;return f=expression in this.dict?this.dict[expression]:this.dict[expression]=eval(amiTwig.expr.interpreter.getJS(new amiTwig.expr.Compiler(expression,line))),_||(_={}),f.call(_,_)}},amiTwig.ajax={dict:{},get:function(e,t,n){var i=void 0;if(e in this.dict)t&&t(this.dict[e]);else if(amiTwig.fs)try{i=this.dict[e]=amiTwig.fs.readFileSync(e,"utf8"),t&&t(i)}catch(e){n&&n(e)}else{var r=new XMLHttpRequest;r.open("GET",e,!1),r.send(),200===r.status?(i=this.dict[e]=r.responseText,t&&t(i)):(i=r.responseText,n&&n(i))}}},amiTwig.stdlib={isUndefined:function(e){return void 0===e},isDefined:function(e){return void 0!==e},isNull:function(e){return null===e},isNotNull:function(e){return null!==e},isEmpty:function(e){if(null===e||!1===e||""===e)return!0;var t=Object.prototype.toString.call(e);return"[object Array]"===t&&0===e.length||"[object Object]"===t&&0===Object.keys(e).length},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isIterable:function(e){var t=Object.prototype.toString.call(e);return"[object String]"===t||"[object Array]"===t||"[object Object]"===t},isEven:function(e){return this.isNumber(e)&&0==(1&e)},isOdd:function(e){return this.isNumber(e)&&1==(1&e)},isInObject:function(e,t){return this.isArray(t)||this.isString(t)?t.indexOf(e)>=0:!!this.isObject(t)&&e in t},isInRange:function(e,t,n){return this.isNumber(t)&&this.isNumber(n)?e>=t&&e<=n:!(!this.isString(t)||1!==t.length||!this.isString(n)||1!==n.length)&&(e.charCodeAt(0)>=t.charCodeAt(0)&&e.charCodeAt(0)<=n.charCodeAt(0))},range:function(e,t,n){n||(n=1);var i=[];if(this.isNumber(e)&&this.isNumber(t))for(var r=e;r<=t;r+=n)i.push(r);else if(this.isString(e)&&1===e.length&&this.isString(t)&&1===t.length)for(var a=e.charCodeAt(0);a<=t.charCodeAt(0);a+=n)i.push(String.fromCharCode(a));return i},filter_length:function(e){return this.isString(e)||this.isArray(e)?e.length:this.isObject(e)?Object.keys(e).length:0},filter_first:function(e){return(this.isString(e)||this.isArray(e))&&e.length>0?e[0]:""},filter_last:function(e){return(this.isString(e)||this.isArray(e))&&e.length>0?e[e.length-1]:""},filter_slice:function(e,t,n){return this.isString(e)||this.isArray(e)?e.slice(t,n):null},filter_merge:function(){if(arguments.length>1){if(this.isString(arguments[0])){var e=[];for(var t in arguments){var n=arguments[t];if(!this.isString(n))return null;e.push(arguments[t])}return e.join("")}if(this.isArray(arguments[0])){var i=[];for(var r in arguments){var a=arguments[r];if(!this.isArray(a))return null;for(var s in a)i.push(a[s])}return i}if(this.isObject(arguments[0])){var o={};for(var l in arguments){var c=arguments[l];if(!this.isObject(c))return null;for(var u in c)o[u]=c[u]}return o}}return null},filter_sort:function(e){return this.isArray(e)?e.sort():[]},filter_reverse:function(e){return this.isArray(e)?e.reverse():[]},filter_join:function(e,t){return this.isArray(e)?e.join(t):""},filter_keys:function(e){return this.isObject(e)?Object.keys(e):[]},startsWith:function(e,t){if(this.isString(e)&&this.isString(t)){return 0===e.indexOf(t,0)}return!1},endsWith:function(e,t){if(this.isString(e)&&this.isString(t)){var n=e.length-t.length;return e.indexOf(t,n)===n}return!1},match:function(e,t){if(this.isString(e)&&this.isString(t)){var n=t.indexOf("/"),i=t.lastIndexOf("/");if(0===n||n<i)try{return new RegExp(t.substring(n+1,i),t.substring(i+1)).test(e)}catch(e){}}return!1},filter_default:function(e,t){return e||t||""},filter_lower:function(e){return this.isString(e)?e.toLowerCase():""},filter_upper:function(e){return this.isString(e)?e.toUpperCase():""},filter_capitalize:function(e){return this.isString(e)?e.trim().toLowerCase().replace(/^\S/g,function(e){return e.toUpperCase()}):""},filter_title:function(e){return this.isString(e)?e.trim().toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}):""},filter_trim:function(e){return this.isString(e)?e.trim():""},_replace:function(e,t,n){var i=[],r=e.length;e:for(var a=0;a<r;){for(var s in t)if(0===e.substring(a).indexOf(t[s])){i.push(n[s]),a+=t[s].length;continue e}i.push(e.charAt(a++))}return i.join("")},_textToHtmlX:["&",'"',"<",">"],_textToHtmlY:["&amp;","&quot;","&lt;","&gt;"],_textToStringX:["\\","\n",'"',"'"],_textToStringY:["\\\\","\\n",'\\"',"\\'"],filter_escape:function(e,t){if(this.isString(e))switch(t||"html"){case"html":case"html_attr":return this._replace(e,this._textToHtmlX,this._textToHtmlY);case"js":case"string":return this._replace(e,this._textToStringX,this._textToStringY);case"url":return encodeURIComponent(e);default:return e}return""},filter_url_encode:function(e){return this.isString(e)?encodeURIComponent(e):""},filter_nl2br:function(e){return this.isString(e)?e.replace(/\n/g,"<br/>"):""},filter_raw:function(e){return this.isString(e)?e:""},filter_replace:function(e,t){var n=[];if(this.isString(e)&&this.isObject(t)){var i=0,r=e.length;e:for(;i<r;){for(var a in t)if(0===e.substring(i).indexOf(a)){n.push(t[a]),i+=a.length;continue e}n.push(e.charAt(i++))}}return n.join("")},filter_split:function(e,t,n){return this.isString(e)?e.split(t,n):[]},filter_abs:function(e){return Math.abs(e)},filter_round:function(e,t){switch(t){case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:return Math.round(e)}},min:function(){var e=1===arguments.length&&(this.isArray(arguments[0])||this.isObject(arguments[0]))?arguments[0]:arguments,t=Number.POSITIVE_INFINITY;for(var n in e){if(!this.isNumber(e[n]))return Number.NaN;t>e[n]&&(t=e[n])}return t},max:function(){var e=1===arguments.length&&(this.isArray(arguments[0])||this.isObject(arguments[0]))?arguments[0]:arguments,t=Number.NEGATIVE_INFINITY;for(var n in e){if(!this.isNumber(e[n]))return Number.NaN;t<e[n]&&(t=e[n])}return t},random:function(e){var t=Math.random();if(e){if(this.isArray(e)||this.isObject(e)){var n=Object.keys(e);return e[n[Math.floor(n.length*t)]]}if(this.isString(e))return e[Math.floor(e.length*t)];if(this.isNumber(e))return Math.floor(e*t)}return e=Number.MAX_SAFE_INTEGER,Math.floor(e*t)},filter_json_encode:function(e){return JSON.stringify(e,null,2)},filter_json_jspath:function(e,t){return"undefined"!=typeof JSPath?JSPath.apply(t,e):[]},include:function(e,t,n,i){var r={};if(n)for(var a in amiTwig.engine.dict)r[a]=amiTwig.engine.dict[a];if(t)for(var s in t)r[s]=t[s];var o="";return amiTwig.ajax.get(e,function(e){o=amiTwig.engine.render(e,r)},function(){if(!i)throw"runtime error, could not open `"+e+"`"}),o}},amiTwig.stdlib.filter_e=amiTwig.stdlib.filter_escape,amiTwig.expr.interpreter={_getJS:function(e){var t=void 0,n=void 0,i=void 0,r=void 0,a=void 0;switch(e.nodeType){case amiTwig.expr.tokens.LST:t=[];for(var s in e.list)t.push(this._getJS(e.list[s]));return"["+t.join(",")+"]";case amiTwig.expr.tokens.DIC:t=[];for(var o in e.dict)t.push(o+":"+this._getJS(e.dict[o]));return"{"+t.join(",")+"}";case amiTwig.expr.tokens.FUN:t=[];for(var l in e.list)t.push(this._getJS(e.list[l]));return e.nodeValue+"("+t.join(",")+")";case amiTwig.expr.tokens.VAR:t=[];for(var c in e.list)t.push("["+this._getJS(e.list[c])+"]");return t.length>0?e.nodeValue+t.join(""):e.nodeValue;case amiTwig.expr.tokens.TERMINAL:return e.nodeValue;case amiTwig.expr.tokens.IS:switch(i=this._getJS(e.nodeLeft),e.nodeRight.nodeType){case amiTwig.expr.tokens.DEFINED:return"amiTwig.stdlib.isDefined("+i+")";case amiTwig.expr.tokens.NULL:return"amiTwig.stdlib.isNull("+i+")";case amiTwig.expr.tokens.EMPTY:return"amiTwig.stdlib.isEmpty("+i+")";case amiTwig.expr.tokens.ITERABLE:return"amiTwig.stdlib.isIterable("+i+")";case amiTwig.expr.tokens.EVEN:return"amiTwig.stdlib.isEven("+i+")";case amiTwig.expr.tokens.ODD:return"amiTwig.stdlib.isOdd("+i+")";default:throw"internal error"}case amiTwig.expr.tokens.IN:return e.nodeRight.nodeType!==amiTwig.expr.tokens.RANGE?(i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"amiTwig.stdlib.isInObject("+i+","+r+")"):(n=this._getJS(e.nodeLeft),i=e.nodeRight.nodeLeft.nodeValue,r=e.nodeRight.nodeRight.nodeValue,"amiTwig.stdlib.isInRange("+n+","+i+","+r+")");case amiTwig.expr.tokens.STARTS_WITH:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"amiTwig.stdlib.startsWith("+i+","+r+")";case amiTwig.expr.tokens.ENDS_WITH:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"amiTwig.stdlib.endsWith("+i+","+r+")";case amiTwig.expr.tokens.MATCHES:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"amiTwig.stdlib.match("+i+","+r+")";case amiTwig.expr.tokens.RANGE:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"amiTwig.stdlib.range("+i+","+r+")";case amiTwig.expr.tokens.DOT:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"."===e.nodeValue[0]?i+"."+r:i+"["+r+"]";case amiTwig.expr.tokens.FLDIV:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"Math.floor("+i+"/"+r+")";case amiTwig.expr.tokens.POWER:return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"Math.pow("+i+","+r+")";default:if(null!==e.nodeLeft&&null===e.nodeRight)return(a=e.nodeType!==amiTwig.expr.tokens.NOT?e.nodeValue:"!")+"("+this._getJS(e.nodeLeft)+")";if(null===e.nodeLeft&&null!==e.nodeRight)return a=e.nodeType!==amiTwig.expr.tokens.NOT?e.nodeValue:"!","("+this._getJS(e.nodeRight)+")"+a;if(null!==e.nodeLeft&&null!==e.nodeRight){switch(e.nodeType){case amiTwig.expr.tokens.LOGICAL_OR:a="||";break;case amiTwig.expr.tokens.LOGICAL_AND:a="&&";break;case amiTwig.expr.tokens.BITWISE_OR:a="|";break;case amiTwig.expr.tokens.BITWISE_XOR:a="^";break;case amiTwig.expr.tokens.BITWISE_AND:a="&";break;case amiTwig.expr.tokens.CONCAT:a="+";break;default:a=e.nodeValue}return i=this._getJS(e.nodeLeft),r=this._getJS(e.nodeRight),"("+i+a+r+")"}}},getJS:function(e){return"(function(_) { return "+this._getJS(e.rootNode)+"; })"},eval:function _eval(expr,_){return _||(_={}),eval(this.getJS(expr)).call(_,_)}},function(){function e(e){return Function("data,subst",i(n(e)))}var t={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11},n=function(){function e(){for(var e,i=n();b("|");)E(),(e||(e=[i])).push(n());return e?{type:t.CONCAT_EXPR,args:e}:i}function n(){return b("(")?i():a()}function i(){v("(");var n=e();v(")");for(var i,a=[];i=r();)a.push(i);return a.length?n.type===t.PATH?(n.parts=n.parts.concat(a),n):(a.unshift(n),{type:t.PATH,parts:a}):n}function r(){return b("[")?l():b("{")?c():b("(")?i():void 0}function a(){x()||N(E());var e,n=!1;b("^")?(E(),n=!0):w()&&(e=E().val.substr(1));for(var i,r=[];i=s();)r.push(i);return{type:t.PATH,fromRoot:n,subst:e,parts:r}}function s(){return k()?o():r()}function o(){var e,n=E().val,i=A();return(b("*")||i.type===z.ID||i.type===z.STR)&&(e=E().val),{type:t.SELECTOR,selector:n,prop:e}}function l(){v("[");var e=g();return v("]"),{type:t.POS_PRED,arg:e}}function c(){v("{");var e=u();return v("}"),{type:t.OBJ_PRED,arg:e}}function u(){for(var e,n=p();b("||");)E(),(e||(e=[n])).push(p());return e?{type:t.LOGICAL_EXPR,op:"||",args:e}:n}function p(){for(var e,n=d();b("&&");)E(),(e||(e=[n])).push(d());return e?{type:t.LOGICAL_EXPR,op:"&&",args:e}:n}function d(){for(var e=h();b("==")||b("!=")||b("===")||b("!==")||b("^=")||b("^==")||b("$==")||b("$=")||b("*==")||b("*=");)e={type:t.COMPARISON_EXPR,op:E().val,args:[e,d()]};return e}function h(){for(var e=f();b("<")||b(">")||b("<=")||b(">=");)e={type:t.COMPARISON_EXPR,op:E().val,args:[e,h()]};return e}function f(){for(var e=m();b("+")||b("-");)e={type:t.MATH_EXPR,op:E().val,args:[e,m()]};return e}function m(){for(var e=_();b("*")||b("/")||b("%");)e={type:t.MATH_EXPR,op:E().val,args:[e,m()]};return e}function g(){if(b(":"))return E(),{type:t.POS_EXPR,toIdx:_()};var e=_();return b(":")?(E(),b("]")?{type:t.POS_EXPR,fromIdx:e}:{type:t.POS_EXPR,fromIdx:e,toIdx:_()}):{type:t.POS_EXPR,idx:e}}function _(){return b("!")||b("-")?{type:t.UNARY_EXPR,op:E().val,arg:_()}:y()}function y(){var e=A().type;return e===z.STR||e===z.NUM||e===z.BOOL?{type:t.LITERAL,val:E().val}:x()?a():b("(")?T():N(E())}function T(){v("(");var e=u();return v(")"),e}function b(e){var t=A();return t.type===z.PUNCT&&t.val===e}function x(){return k()||w()||b("^")}function k(){var e=A();if(e.type===z.PUNCT){var t=e.val;return"."===t||".."===t}return!1}function w(){var e=A();return e.type===z.ID&&"$"===e.val[0]}function v(e){var t=E();t.type===z.PUNCT&&t.val===e||N(t)}function A(){if(null!==F)return F;var e=P;return F=S(),P=e,F}function S(){for(;L(B[P]);)++P;if(P>=W)return{type:z.EOP,range:[P,P]};var e=$();if(e||(e=O())||(e=j())||(e=R()))return e;e={range:[P,P]},P>=W?e.type=z.EOP:e.val=B[P],N(e)}function E(){var e;return F?(P=F.range[1],e=F,F=null,e):S()}function C(e){return"0123456789".indexOf(e)>=0}function L(e){return" "===e}function I(e){return"$"===e||"@"===e||"_"===e||e>="a"&&e<="z"||e>="A"&&e<="Z"}function D(e){return I(e)||e>="0"&&e<="9"}function O(){var e=B[P];if(I(e)){for(var t=P,n=e;++P<W&&(e=B[P],D(e));)n+=e;return"true"===n||"false"===n?{type:z.BOOL,val:"true"===n,range:[t,P]}:{type:z.ID,val:n,range:[t,P]}}}function j(){if('"'===B[P]||"'"===B[P]){for(var e,t=B[P],n=++P,i="",r=!1;P<W;){if("\\"===(e=B[P++]))e=B[P++];else if(('"'===e||"'"===e)&&e===t){r=!0;break}i+=e}return r?{type:z.STR,val:i,range:[n,P]}:void 0}}function R(){var e=P,t=B[P],n="."===t;if(n||C(t)){for(var i=t;++P<W;){if("."===(t=B[P])){if(n)return;n=!0}else if(!C(t))break;i+=t}return{type:z.NUM,val:n?parseFloat(i):parseInt(i,10),range:[e,P]}}}function $(){var e=P,t=B[P],n=B[P+1];if("."===t){if(C(n))return;return"."===B[++P]?{type:z.PUNCT,val:"..",range:[e,++P]}:{type:z.PUNCT,val:".",range:[e,P]}}if("="===n){var i=B[P+2];if("="===i){if("=!^$*".indexOf(t)>=0)return{type:z.PUNCT,val:t+n+i,range:[e,P+=3]}}else if("=!^$*><".indexOf(t)>=0)return{type:z.PUNCT,val:t+n,range:[e,P+=2]}}return t!==n||"|"!==t&&"&"!==t?":{}()[]^+-*/%!><|".indexOf(t)>=0?{type:z.PUNCT,val:t,range:[e,++P]}:void 0:{type:z.PUNCT,val:t+n,range:[e,P+=2]}}function N(e){e.type===z.EOP&&M(e,U.UNEXP_EOP),M(e,U.UNEXP_TOKEN,e.val)}function M(e,t){var n=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(e,t){return n[t]||""}),r=new Error(i);throw r.column=e.range[0],r}var B,P,F,W,z={ID:1,NUM:2,STR:3,BOOL:4,PUNCT:5,EOP:6},U={UNEXP_TOKEN:'Unexpected token "%0"',UNEXP_EOP:"Unexpected end of path"};return function(t){B=t.split(""),P=0,F=null,W=B.length;var n=e(),i=E();return i.type!==z.EOP&&N(i),n}}(),i=function(){function e(){if(w.length)return w.shift();var e="v"+ ++k;return x.push(e),e}function n(){for(var e=arguments,t=e.length;t--;)w.push(e[t])}function i(e,n,i){var l=e.parts,c=0,u=l.length;for(b.push(n,"=",e.fromRoot?"data":e.subst?"subst."+e.subst:i,";","isArr("+n+") || ("+n+" = ["+n+"]);");c<u;){var p=l[c++];switch(p.type){case t.SELECTOR:".."===p.selector?a(p,n,n):r(p,n,n);break;case t.OBJ_PRED:s(p,n,n);break;case t.POS_PRED:o(p,n,n);break;case t.CONCAT_EXPR:f(p,n,n)}}}function r(t,i,r){if(t.prop){var a=m(t.prop),s=e(),o=e(),l=e(),c=e(),u=e(),p=e(),d=e();b.push(s,"= [];",o,"= 0;",l,"=",r,".length;",d,"= [];","while(",o,"<",l,") {",c,"=",r,"[",o,"++];","if(",c,"!= null) {"),"*"===t.prop?(b.push("if(typeof ",c,'=== "object") {',"if(isArr(",c,")) {",s,"=",s,".concat(",c,");","}","else {","for(",u," in ",c,") {","if(",c,".hasOwnProperty(",u,")) {",p,"=",c,"[",u,"];"),g(s,p),b.push("}","}","}","}")):(b.push(p,"=",c,"[",a,"];"),g(s,p,d,l)),b.push("}","}",i,"=",l,"> 1 &&",d,".length?",d,".length > 1?","concat.apply(",s,",",d,") :",s,".concat(",d,"[0]) :",s,";"),n(s,o,l,c,u,p,d)}}function a(t,i,r){var a=t.prop,s=e(),o=e(),l=e(),c=e(),u=e(),p=e(),d=e(),h=e();b.push(s,"=",r,".slice(),",h,"= [];","while(",s,".length) {",o,"=",s,".shift();"),a?b.push("if(typeof ",o,'=== "object" &&',o,") {"):b.push("if(typeof ",o,"!= null) {"),b.push(l,"= [];","if(isArr(",o,")) {",c,"= 0,",d,"=",o,".length;","while(",c,"<",d,") {",p,"=",o,"[",c,"++];"),a&&b.push("if(typeof ",p,'=== "object") {'),g(l,p),a&&b.push("}"),b.push("}","}","else {"),a?"*"!==a&&(b.push(p,"=",o,'["'+a+'"];'),g(h,p)):(g(h,o),b.push("if(typeof ",o,'=== "object") {')),b.push("for(",u," in ",o,") {","if(",o,".hasOwnProperty(",u,")) {",p,"=",o,"[",u,"];"),g(l,p),"*"===a&&g(h,p),b.push("}","}"),a||b.push("}"),b.push("}",l,".length &&",s,".unshift.apply(",s,",",l,");","}","}",i,"=",h,";"),n(s,o,l,c,u,p,d,h)}function s(t,i,r){var a=e(),s=e(),o=e(),c=e(),u=e();b.push(a,"= [];",s,"= 0;",o,"=",r,".length;","while(",s,"<",o,") {",u,"=",r,"[",s,"++];"),l(t.arg,c,u),b.push(y(t.arg,c),"&&",a,".push(",u,");","}",i,"=",a,";"),n(a,s,o,u,c)}function o(t,i,r){var a,s,o=t.arg;if(o.idx){var c=e();return l(o.idx,c,r),b.push(c,"< 0 && (",c,"=",r,".length +",c,");",i,"=",r,"[",c,"] == null? [] : [",r,"[",c,"]];"),n(c),!1}o.fromIdx?o.toIdx?(l(o.fromIdx,a=e(),r),l(o.toIdx,s=e(),r),b.push(i,"=",r,".slice(",a,",",s,");"),n(a,s)):(l(o.fromIdx,a=e(),r),b.push(i,"=",r,".slice(",a,");"),n(a)):(l(o.toIdx,s=e(),r),b.push(i,"=",r,".slice(0,",s,");"),n(s))}function l(e,n,r){switch(e.type){case t.PATH:i(e,n,r);break;case t.CONCAT_EXPR:f(e,n,r);break;case t.COMPARISON_EXPR:c(e,n,r);break;case t.MATH_EXPR:d(e,n,r);break;case t.LOGICAL_EXPR:p(e,n,r);break;case t.UNARY_EXPR:h(e,n,r);break;case t.LITERAL:var a=e.val;b.push(n,"=","string"==typeof a?m(a):a,";")}}function c(i,r,a){var s=e(),o=e(),c=e(),p=e(),d=e(),h=e(),f=e(),m=e(),g=i.args[0],_=i.args[1];b.push(r,"= false;"),l(g,s,a),l(_,o,a);var y=g.type===t.PATH,T=_.type===t.LITERAL;b.push(c,"="),y?b.push("true;"):b.push("isArr(",s,");"),b.push(p,"="),T?b.push("false;"):b.push("isArr(",o,");"),b.push("if("),y||b.push(c,"&&"),b.push(s,".length === 1) {",s,"=",s,"[0];",c,"= false;","}"),T||b.push("if(",p,"&&",o,".length === 1) {",o,"=",o,"[0];",p,"= false;","}"),b.push(d,"= 0;","if(",c,") {",f,"=",s,".length;"),T||(b.push("if(",p,") {",m,"=",o,".length;","while(",d,"<",f,"&& !",r,") {",h,"= 0;","while(",h,"<",m,") {"),u(i.op,[s,"[",d,"]"].join(""),[o,"[",h,"]"].join("")),b.push(r,"= true;","break;","}","++",h,";","}","++",d,";","}","}","else {")),b.push("while(",d,"<",f,") {"),u(i.op,[s,"[",d,"]"].join(""),o),b.push(r,"= true;","break;","}","++",d,";","}"),T||b.push("}"),b.push("}"),T||(b.push("else if(",p,") {",m,"=",o,".length;","while(",d,"<",m,") {"),u(i.op,s,[o,"[",d,"]"].join("")),b.push(r,"= true;","break;","}","++",d,";","}","}")),b.push("else {",r,"=",v[i.op](s,o),";","}"),n(s,o,c,p,d,h,f,m)}function u(e,t,n){b.push("if(",v[e](t,n),") {")}function p(t,i,r){var a,s=[],o=t.args,c=o.length,u=0;switch(b.push(i,"= false;"),t.op){case"&&":for(;u<c;)s.push(a=e()),l(o[u],a,r),b.push("if(",y(o[u++],a),") {");b.push(i,"= true;");break;case"||":for(;u<c;)s.push(a=e()),l(o[u],a,r),b.push("if(",y(o[u],a),") {",i,"= true;","}"),1+u++<c&&b.push("else {");--c}for(;c--;)b.push("}");n.apply(null,s)}function d(t,i,r){var a=e(),s=e(),o=t.args;l(o[0],a,r),l(o[1],s,r),b.push(i,"=",v[t.op](T(o[0],a),T(o[1],s)),";"),n(a,s)}function h(t,i,r){var a=e(),s=t.arg;switch(l(s,a,r),t.op){case"!":b.push(i,"= !",y(s,a)+";");break;case"-":b.push(i,"= -",T(s,a)+";")}n(a)}function f(t,i,r){for(var a=[],s=t.args,o=s.length,c=0;c<o;)a.push(e()),l(s[c],a[c++],r);b.push(i,"= concat.call(",a.join(","),");"),n.apply(null,a)}function m(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function g(e,t,n,i){b.push("if(",t,"!= null) {","if(isArr(",t,")) {"),n&&(b.push(i,"> 1?"),_(n,t),b.push(":")),b.push(e,"=",e,".length?",e,".concat(",t,") :",t,".slice()",";","}","else {"),n&&b.push("if(",n,".length) {",e,"= concat.apply(",e,",",n,");",n,"= [];","}"),_(e,t),b.push(";","}","}")}function _(e,t){b.push(e,".length?",e,".push(",t,") :",e,"[0] =",t)}function y(e,n){switch(e.type){case t.LOGICAL_EXPR:return n;case t.LITERAL:return"!!"+n;case t.PATH:return n+".length > 0";default:return["(typeof ",n,'=== "boolean"?',n,":","isArr(",n,")?",n,".length > 0 : !!",n,")"].join("")}}function T(e,n){switch(e.type){case t.LITERAL:return n;case t.PATH:return n+"[0]";default:return["(isArr(",n,")?",n,"[0] : ",n,")"].join("")}}var b,x,k,w,v={"===":function(e,t){return e+"==="+t},"==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string"?',e,".toLowerCase() ===",t,".toLowerCase() :"+e,"==",t].join("")},">=":function(e,t){return e+">="+t},">":function(e,t){return e+">"+t},"<=":function(e,t){return e+"<="+t},"<":function(e,t){return e+"<"+t},"!==":function(e,t){return e+"!=="+t},"!=":function(e,t){return e+"!="+t},"^==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") === 0"].join("")},"^=":function(e,t){return[e,"!= null &&",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) === 0"].join("")},"$==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".length >=",t,".length &&",e,".lastIndexOf(",t,") ===",e,".length -",t,".length"].join("")},"$=":function(e,t){return[e,"!= null &&",t,"!= null &&","(",e,"=",e,".toString()).length >=","(",t,"=",t,".toString()).length &&","(",e,".toLowerCase()).lastIndexOf(","(",t,".toLowerCase())) ===",e,".length -",t,".length"].join("")},"*==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") > -1"].join("")},"*=":function(e,t){return[e,"!= null && ",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) > -1"].join("")},"+":function(e,t){return e+"+"+t},"-":function(e,t){return e+"-"+t},"*":function(e,t){return e+"*"+t},"/":function(e,t){return e+"/"+t},"%":function(e,t){return e+"%"+t}};return function(e){if(b=[],x=["res"],k=0,w=[],l(e,"res","data"),b.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',", concat = Array.prototype.concat",",",x.join(","),";"),e.type===t.PATH){var n=e.parts[e.parts.length-1];n&&n.type===t.POS_PRED&&"idx"in n.arg&&b.push("res = res[0];")}return b.push("return res;"),b.join("")}}(),r={},a=[],s={cacheSize:100},o={cacheSize:function(e,t){if(t<e&&a.length>t)for(var n=a.splice(0,a.length-t),i=n.length;i--;)delete r[n[i]]}},l=function(t,n,i){return r[t]||(r[t]=e(t),a.push(t)>s.cacheSize&&delete r[a.shift()]),r[t](n,i||{})};l.version="0.3.4",l.params=function(e){if(!arguments.length)return s;for(var t in e)e.hasOwnProperty(t)&&(o[t]&&o[t](s[t],e[t]),s[t]=e[t])},l.compile=e,l.apply=l,"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=l:"object"===("undefined"==typeof modules?"undefined":_typeof(modules))?modules.define("jspath",function(e){e(l)}):"function"==typeof define?define(function(e,t,n){n.exports=l}):window.JSPath=l}(),"undefined"!=typeof exports&&(module.exports.Namespace=$AMINamespace,module.exports.Interface=$AMIInterface,module.exports.Class=$AMIClass),jQuery&&(jQuery.Namespace=$AMINamespace,jQuery.Interface=$AMIInterface,jQuery.Class=$AMIClass),String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0===this.indexOf(e,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(e){var t=this.length-e.length;return this.indexOf(e,t)===t});var _ami_internal_jQueryEach=jQuery.each;jQuery.each=function(e,t,n){return n?_ami_internal_jQueryEach(e,function(){t.apply(n,arguments)}):_ami_internal_jQueryEach(e,t),e};var _ami_internal_jQueryAjax=jQuery.ajax;jQuery.ajax=function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&"sheet"===e.dataType){var t="",n=null;"url"in e&&(t=e.url),"context"in e&&(n=e.context);var i=$.Deferred();return $("head").append('<link rel="stylesheet" type="text/css" href="'+t+'"></link>').promise().done(function(){i.resolveWith(n||i)}),i.promise()}return _ami_internal_jQueryAjax.apply(this,arguments)};var _ami_internal_modalZIndex=1050;$(document).on("show.bs.modal",".modal",function(){var e=$(this);setTimeout(function(){$("body > .modal-backdrop:last").css("z-index",_ami_internal_modalZIndex++),e.css("z-index",_ami_internal_modalZIndex++)},10)}),$AMINamespace("ami"),$AMINamespace("amiWebApp",{_idRegExp:new RegExp("[a-zA-Z][a-zA-Z0-9]{7}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{4}_[a-zA-Z0-9]{12}","g"),_embedded:!1,_noBootstrap:!1,_sheets:[],_scripts:[],_controls:{},_subapps:{},_canLeave:!0,_currentSubAppInstance:new function(){this.onReady=function(){},this.onExit=function(){},this.onLogin=function(){},this.onLogout=function(){}},originURL:"/",webAppURL:"/",args:{},$:function(){function e(e){for(e=e.trim();"/"===e[e.length-1];)e=e.substring(0,e.length-1);return e}var t=this,n=window.location.href.trim(),i=window.location.search.trim(),r=document.getElementsByTagName("script"),a=r[r.length-1].src.trim(),s=a.indexOf("js/ami.");this.originURL=e(s>0?a.substring(0,s):"/");var o=n.indexOf("?");if(this.webAppURL=e(o>0?n.substring(0,o):n),s>0){var l=a.substring(s).toLowerCase();this._embedded=l.indexOf("embedded")>=0,this._noBootstrap=l.indexOf("nobootstrap")>=0}i&&i.substring(1).split("&").forEach(function(e){var n=e.split("=");1===n.length?t.args[decodeURIComponent(n[0])]="":2===n.length&&(t.args[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}),!1===this._noBootstrap&&"function"!=typeof jQuery.fn.modal&&(this.loadSheets([this.originURL+"/css/bootstrap.min.css",this.originURL+"/css/bootstrap-toggle.min.css",this.originURL+"/css/bootstrap-vertical-tabs.min.css"]),this.loadScripts([this.originURL+"/js/bootstrap.min.js",this.originURL+"/js/bootstrap-toggle.min.js",this.originURL+"/js/bootstrap-typeahead.min.js"])),this.loadSheets([this.originURL+"/css/font-awesome.min.css",this.originURL+"/css/ami.min.css"])},isEmbedded:function(){return this._embedded},isLocal:function(){return"file:"===document.location.protocol||"localhost"===document.location.hostname||"127.0.0.1"===document.location.hostname},typeOf:function(e){var t=Object.prototype.toString.call(e);return t.startsWith("[object ")?t.substring(8,t.length-1):""},asArray:function(e){return"Array"===this.typeOf(e)?e:[e]},_replace:function(e,t,n){var i=[],r=e.length;e:for(var a=0;a<r;){for(var s in t)if(0===e.substring(a).indexOf(t[s])){i.push(n[s]),a+=t[s].length;continue e}i.push(e.charAt(a++))}return i.join("")},_textToHtmlX:["&",'"',"<",">"],_textToHtmlY:["&amp;","&quot;","&lt;","&gt;"],textToHtml:function(e){return this._replace(e||"",this._textToHtmlX,this._textToHtmlY)},htmlToText:function(e){return this._replace(e||"",this._textToHtmlY,this._textToHtmlX)},_textToStringX:["\\","\n",'"',"'"],_textToStringY:["\\\\","\\n",'\\"',"\\'"],textToString:function(e){return this._replace(e||"",this._textToStringX,this._textToStringY)},stringToText:function(e){return this._replace(e||"",this._textToStringY,this._textToStringX)},_htmlToStringX:["\\","\n","&quot;","'"],_htmlToStringY:["\\\\","\\n","\\&quot;","\\'"],htmlToString:function(e){return this._replace(e||"",this._htmlToStringX,this._htmlToStringY)},stringToHtml:function(e){return this._replace(e||"",this._htmlToStringY,this._htmlToStringX)},_base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",base64Encode:function(e){for(var t=void 0,n=[],i=e.length,r=i%3,a=this._base64,s=0;s<i;)t=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++)<<0,n.push(a.charAt(t>>18&63)),n.push(a.charAt(t>>12&63)),n.push(a.charAt(t>>6&63)),n.push(a.charAt(t>>0&63));return 1===r?n.splice(-2,2):2===r&&n.splice(-1,1),n.join("")},base64Decode:function(e){for(var t=void 0,n=[],i=e.length,r=i%4,a=this._base64,s=0;s<i;)t=a.indexOf(e.charAt(s++))<<18|a.indexOf(e.charAt(s++))<<12|a.indexOf(e.charAt(s++))<<6|a.indexOf(e.charAt(s++))<<0,n.push(String.fromCharCode(t>>>16&255)),n.push(String.fromCharCode(t>>>8&255)),n.push(String.fromCharCode(t>>>0&255));return 2===r?n.splice(-2,2):3===r&&n.splice(-1,1),n.join("")},_getExtension:function(e){var t=e.lastIndexOf(".");return t>0?e.substring(t):""},_getDataType:function(e,t){var n=void 0;if("auto"===t)if(0!==e.indexOf("ctrl:"))switch(this._getExtension(e).toLowerCase()){case".css":n="sheet";break;case".js":n="script";break;case".json":n="json";break;case".xml":n="xml";break;default:n="text"}else n="control";else n=t;return n},__loadXXX:function(e,t,n,i,r){var a=this;if(0===n.length)return e.resolveWith(r||e,[t]);var s=n.shift(),o=this._getDataType(s,i);switch(o){case"control":this._loadControls($.Deferred(),t,[s]).then(function(){a.__loadXXX(e,t,n,i,r)},function(t){e.rejectWith(r||e,[t])});break;case"sheet":this._sheets.indexOf(s)>=0?(t.push(!1),this.__loadXXX(e,t,n,i,r)):$.ajax({url:s,async:!1,cache:!1,crossDomain:!0,dataType:o}).then(function(){t.push(!0),a.__loadXXX(e,t,n,i,r)},function(){e.rejectWith(r||e,["could not load `"+s+"`"])});break;case"script":this._scripts.indexOf(s)>=0?(t.push(!1),this.__loadXXX(e,t,n,i,r)):$.ajax({url:s,async:!1,cache:!1,crossDomain:!0,dataType:o}).then(function(){t.push(!0),a.__loadXXX(e,t,n,i,r)},function(){e.rejectWith(r||e,["could not load `"+s+"`"])});break;default:$.ajax({url:s,async:!0,cache:!1,crossDomain:!0,dataType:o}).then(function(s){t.push(s),a.__loadXXX(e,t,n,i,r)},function(){e.rejectWith(r||e,["could not load `"+s+"`"])})}return e},_loadXXX:function(e,t,n){var i=null;return n&&"context"in n&&(i=n.context),this.__loadXXX($.Deferred(),[],this.asArray(e),t,i).promise()},loadResources:function(e,t){return this._loadXXX(e,"auto",t)},loadSheets:function(e,t){return this._loadXXX(e,"sheet",t)},loadScripts:function(e,t){return this._loadXXX(e,"script",t)},loadJSONs:function(e,t){return this._loadXXX(e,"json",t)},loadXMLs:function(e,t){return this._loadXXX(e,"xml",t)},loadHTMLs:function(e,t){return this._loadXXX(e,"text",t)},loadTWIGs:function(e,t){return this._loadXXX(e,"text",t)},loadTexts:function(e,t){return this._loadXXX(e,"text",t)},_xxxHTML:function(e,t,n,i){var r=null,a=null,s=null;i&&("context"in i&&(r=i.context),"suffix"in i&&(a=i.suffix),"dict"in i&&(s=i.dict));var o=this.formatTWIG(t,s);a&&(o=o.replace(this._idRegExp,function(e){return e+"_instance"+a}));var l=$(e),c=$.Deferred(),u=void 0;switch(n){case 0:u=l.html(o).promise();break;case 1:u=l.prepend(o).promise();break;case 2:u=l.append(o).promise();break;default:throw"internal error"}return u.done(function(){jQuery.fn.tooltip&&l.find('[data-toggle="tooltip"]').tooltip({container:"body",delay:{show:500,hide:100}}),jQuery.fn.popover&&(l.find('[data-toggle="popover"][tabindex="0"]').popover({container:"body",html:!0,trigger:"focus"}),l.find('[data-toggle="popover"][tabindex!="0"]').popover({container:"body",html:!0,trigger:"click"})),jQuery.fn.bootstrapToggle&&l.find('input[type="checkbox"][data-toggle="toggle"]').bootstrapToggle(),c.resolveWith(r||c,[o])}),c.promise()},replaceHTML:function(e,t,n){return this._xxxHTML(e,t,0,n)},prependHTML:function(e,t,n){return this._xxxHTML(e,t,1,n)},appendHTML:function(e,t,n){return this._xxxHTML(e,t,2,n)},formatTWIG:function(e,t){var n=this,i=[],r=function(e,t){return"Object"!==n.typeOf(t)&&(t={}),t.ORIGIN_URL=n.originURL,t.WEBAPP_URL=n.webAppURL,amiTwig.engine.render(e,t)};if("Array"===this.typeOf(t)){var a=!0,s=!1,o=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;i.push(r(e,u))}}catch(e){s=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw o}}}else i.push(r(e,t));return i.join("")},jspath:function(e,t){return JSPath.apply(e,t)},lock:function(){$("#ami_locker").css("display","block")},unlock:function(){$("#ami_locker").css("display","none")},canLeave:function(){this._canLeave=!0},cannotLeave:function(){this._canLeave=!1},_publishAlert:function(e,t,n){var i=this,r=$(n||"#ami_alert_content");r.html(e).promise().done(function(){$(document).scrollTop(0),i.unlock(),t&&r.find(".alert").fadeOut(6e4)})},info:function(e,t,n){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert('<div class="alert alert-info alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span>&times;</span><span class="sr-only">Close</span></button><strong>Info!</strong> '+this.textToHtml(e)+"</div>",t,n)},success:function(e,t,n){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span>&times;</span><span class="sr-only">Close</span></button><strong>Success!</strong> '+this.textToHtml(e)+"</div>",t,n)},warning:function(e,t,n){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert('<div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span>&times;</span><span class="sr-only">Close</span></button><strong>Warning!</strong> '+this.textToHtml(e)+"</div>",t,n)},error:function(e,t,n){"Array"===this.typeOf(e)&&(e=e.join(". ")),this._publishAlert('<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span>&times;</span><span class="sr-only">Close</span></button><strong>Error!</strong> '+this.textToHtml(e)+"</div>",t,n)},flush:function(){$("#ami_alert_content").empty()},onReady:function(){this._embedded||alert("error: `amiWebApp.onReady()` must be overloaded!")},onRefresh:function(){this._embedded||alert("error: `amiWebApp.onRefresh()` must be overloaded!")},start:function(e){var t=this,n=this.originURL+"/images/logo.png",i=this.webAppURL,r="ami@lpsc.in2p3.fr",a="http://cern.ch/ami/",s=this.originURL+"/twig/AMI/Theme/blue.twig",o=this.originURL+"/twig/AMI/Fragment/locker.twig",l=this.originURL+"/AMI/FrontEnd";e&&("logo_url"in e&&(n=e.logo_url),"home_url"in e&&(i=e.home_url),"contact_email"in e&&(r=e.contact_email),"about_url"in e&&(a=e.about_url),"theme_url"in e&&(s=e.theme_url),"locker_url"in e&&(o=e.locker_url),"endpoint_url"in e&&(l=e.endpoint_url)),amiCommand.endpoint=l,window.onbeforeunload=function(e){if(!t._canLeave){var n=e||window.event;return n&&(n.returnValue="Confirm that you want to leave this page?"),"Confirm that you want to leave this page?"}};var c=this.originURL+"/controls/CONTROLS.json",u=this.originURL+"/subapps/SUBAPPS.json";$.ajax({url:c,cache:!1,crossDomain:!0,dataType:"json"}).then(function(e){$.ajax({url:u,cache:!1,crossDomain:!0,dataType:"json"}).then(function(l){for(var c in e)t._controls[c.toLowerCase()]=e[c];for(var u in l)t._subapps[u.toLowerCase()]=l[u];if(t._embedded)$.ajax({url:o,cache:!0,crossDomain:!0,dataType:"text"}).done(function(e){$("body").append(e).promise().done(function(){amiLogin._init().fail(function(e){t.error(e)})})});else{var p={LOGO_URL:n,HOME_URL:i,CONTACT_EMAIL:r,ABOUT_URL:a};$.ajax({url:s,cache:!0,crossDomain:!0,dataType:"text"}).then(function(e){$.ajax({url:o,cache:!0,crossDomain:!0,dataType:"text"}).then(function(n){$("body").append(t.formatTWIG(e,p)+n).promise().done(function(){amiLogin._init().fail(function(e){t.error(e)})})},function(){alert("could not open `"+o+"`, please reload the page...")})},function(){alert("could not open `"+s+"`, please reload the page...")})}},function(){alert("could not open `"+u+"`, please reload the page...")})},function(){alert("could not open `"+c+"`, please reload the page...")})},_loadControls:function(e,t,n,i){var r=this;if(0===n.length)return e.resolveWith(i||e,[t]);var a=n.shift();0===a.indexOf("ctrl:")&&(a=a.substring(5));var s=this._controls[a.toLowerCase()];return s?this.loadScripts(this.originURL+"/"+s.file).then(function(o){try{var l=window[s.clazz];_ami_internal_then(o[0]?l.prototype.onReady.apply(l.prototype):null,function(){t.push(l),r._loadControls(e,t,n,i)},function(t){e.rejectWith(i||e,["could not load control `"+a+"`: "+t])})}catch(t){e.rejectWith(i||e,["could not load control `"+a+"`: "+t])}},function(t){e.rejectWith(i||e,["could not load control `"+a+"`: "+t])}):e.rejectWith(i||e,["could not find control `"+a+"`"]),e},loadControls:function(e,t){var n=null;return t&&"context"in t&&(n=t.context),this._loadControls($.Deferred(),[],this.asArray(e),n).promise()},triggerLogin:function(){var e=this._currentSubAppInstance.onLogin(this.args.userdata);return this.onRefresh(!0),e},triggerLogout:function(){var e=this._currentSubAppInstance.onLogout(this.args.userdata);return this.onRefresh(!1),e},loadSubApp:function(e,t){var n=this,i=this.args.subapp||e,r=this.args.userdata||t,a=this._subapps[i.toLowerCase()];a?this.loadScripts(this.originURL+"/"+a.file).then(function(e){try{var t=window[a.instance];n._currentSubAppInstance.onExit(r),n._currentSubAppInstance=t,n.lock(),_ami_internal_then(e[0]?t.onReady(r):null,function(){_ami_internal_then(amiLogin.isAuthenticated()?n.triggerLogin():n.triggerLogout(),function(){n.unlock()},function(e){n.error("could not load sub-application `"+i+"`: "+e)})},function(e){n.error("could not load sub-application `"+i+"`: "+e)})}catch(e){n.error("could not load sub-application `"+i+"`: "+e)}},function(e){n.error("could not load sub-application `"+i+"`: "+e)}):this.error("could not find sub-application `"+i+"`")}}),$AMIInterface("ami.IControl",{patchId:function(){},replaceHTML:function(){},prependHTML:function(){},appendHTML:function(){},onReady:function(){}}),$AMIInterface("ami.ISubApp",{onReady:function(){},onExit:function(){},onLogin:function(){},onLogout:function(){}}),$AMIClass("ami.Control",{$implements:[ami.IControl],$:function(){ami.Control.instanceCnt=1},$init:function(){this.instanceSuffix=ami.Control.instanceCnt++},patchId:function(e){return e+"_instance"+this.instanceSuffix},replaceHTML:function(e,t,n){return n||(n={}),n.suffix=this.instanceSuffix,amiWebApp.replaceHTML(e,t,n)},prependHTML:function(e,t,n){return n||(n={}),n.suffix=this.instanceSuffix,amiWebApp.prependHTML(e,t,n)},appendHTML:function(e,t,n){return n||(n={}),n.suffix=this.instanceSuffix,amiWebApp.appendHTML(e,t,n)}}),$AMIClass("ami.SubApp",{$implements:[ami.ISubApp],onExit:function(){},onLogin:function(){},onLogout:function(){}}),$AMINamespace("amiCommand",{endpoint:"http://xxyy.zz",converter:"AMIXmlToJson.xsl",_textToString:function(e){return(e||"").replace(/[\\'"]/g,function(e){return"\\"+e})},execute:function(e,t){var n=this.endpoint,i=this.converter,r=null,a=0,s=null,o=null;t&&("endpoint"in t&&(n=t.endpoint),"converter"in t&&(i=t.converter),"context"in t&&(r=t.context),"timeout"in t&&(a=t.timeout),"extraParam"in t&&(s=t.extraParam),"extraValue"in t&&(o=t.extraValue));var l=n.trim(),c=e.trim(),u=i.trim(),p={Command:c,Converter:u};s&&(p[s]=o||null);var d=l+"?"+$.param(p),h=$.Deferred();return"AMIXmlToJson.xsl"===u?$.ajax({url:l,data:p,type:"POST",timeout:a,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){0===JSPath.apply(".AMIMessage.error",e).length?h.resolveWith(r||h,[e,d]):h.rejectWith(r||h,[e,d])},error:function(e,t){"error"===t&&(t="service temporarily unreachable");var n={AMIMessage:[{error:[{$:t}]}]};h.rejectWith(r||h,[n,d])}}):$.ajax({url:l,data:p,type:"POST",timeout:a,dataType:"text",xhrFields:{withCredentials:!0},success:function(e){h.resolveWith(r||h,[e,d])},error:function(e,t){"error"===t&&(t="service temporarily unreachable"),h.rejectWith(r||h,[t,d])}}),h.promise()},passLogin:function(e,t,n){var i=null;n&&"context"in n&&(i=n.context);var r=$.Deferred();return this.execute('GetSessionInfo -AMIUser="'+this._textToString(e)+'" -AMIPass="'+this._textToString(t)+'"',{extraParam:"NoCert"}).then(function(e){var t={},n={},a={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){t[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){a[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",i={};e.field.forEach(function(e){i[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),n[t]=i}),r.resolveWith(i||r,[e,t,n,a])},function(e){r.rejectWith(i||r,[e,{AMIUser:"guest",guestUser:"guest"},{},""])}),r},certLogin:function(e){var t=null;e&&"context"in e&&(t=e.context);var n=$.Deferred();return this.execute("GetSessionInfo").then(function(e){var i={},r={},a={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){i[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){a[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),r[t]=n}),n.resolveWith(t||n,[e,i,r,a])},function(e){n.rejectWith(t||n,[e,{AMIUser:"guest",guestUser:"guest"},{},""])}),n},logout:function(e){var t=null;e&&"context"in e&&(t=e.context);var n=$.Deferred();return this.execute('GetSessionInfo -AMIUser="" -AMIPass=""',{extraParam:"NoCert"}).then(function(e){var i={},r={},a={};JSPath.apply('..rowset{.@type==="user"}.row.field',e).forEach(function(e){i[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="sso"}.row.field',e).forEach(function(e){a[e["@name"]]=e.$}),JSPath.apply('..rowset{.@type==="role"}.row',e).forEach(function(e){var t="",n={};e.field.forEach(function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)}),r[t]=n}),n.resolveWith(t||n,[e,i,r,a])},function(e){n.rejectWith(t||n,[e,{AMIUser:"guest",guestUser:"guest"},{},""])}),n},attachCert:function(e,t,n){return this.execute('GetSessionInfo -attachCert -amiLogin="'+this._textToString(e)+'" -amiPassword="'+this._textToString(t)+'"',n)},detachCert:function(e,t,n){return this.execute('GetSessionInfo -detachCert -amiLogin="'+this._textToString(e)+'" -amiPassword="'+this._textToString(t)+'"',n)},addUser:function(e,t,n,i,r,a,s){return this.execute('AddUser -amiLogin="'+this._textToString(e)+'" -amiPassword="'+this._textToString(t)+'" -firstName="'+this._textToString(n)+'" -lastName="'+this._textToString(i)+'" -email="'+this._textToString(r)+'"'+(a?" -attach":""),s)},changeInfo:function(e,t,n,i){return this.execute('SetUserInfo -firstName="'+this._textToString(e)+'" -lastName="'+this._textToString(t)+'" -email="'+this._textToString(n)+'"',i)},changePass:function(e,t,n){return this.execute('ChangePassword -amiPasswordOld="'+this._textToString(e)+'" -amiPasswordNew="'+this._textToString(t)+'"',n)},resetPass:function(e,t){return this.execute('ResetPassword -amiLogin="'+this._textToString(e)+'"',t)}}),$AMINamespace("amiLogin",{user:"guest",guest:"guest",clientDN:"",issuerDN:"",roleInfo:{},ssoInfo:{},_init:function(){var e=this;return amiWebApp.lock(),amiWebApp.loadHTMLs([amiWebApp.originURL+"/twig/AMI/Fragment/login_button.twig",amiWebApp.originURL+"/twig/AMI/Fragment/logout_button.twig",amiWebApp.originURL+"/twig/AMI/Modal/login.twig"]).done(function(t){e.fragmentLoginButton=t[0],e.fragmentLogoutButton=t[1],amiWebApp.appendHTML("body",t[2]),$("#B7894CC1_1DAA_4A7E_B7D1_DBDF6F06AC73").submit(function(t){e.form_login(t)}),$("#EE055CD4_E58F_4834_8020_986AE3F8D67D").submit(function(t){e.form_addUser(t)}),$("#DA2047A2_9E5D_420D_B6E7_FA261D2EF10F").submit(function(t){e.form_remindPass(t)}),$("#D9EAF998_ED8E_44D2_A0BE_8C5CF5E438BD").submit(function(t){e.form_changeInfo(t)}),$("#E92A1097_983B_4857_875F_07E4659B41B0").submit(function(t){e.form_changePass(t)}),$("#E6E30EEC_15EE_4FCF_9809_2B8EC2FEF388,#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").change(function(){var e=$("#E6E30EEC_15EE_4FCF_9809_2B8EC2FEF388").val(),t=$("#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").val();$("#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").get(0).setCustomValidity(e.length>0&&t.length>0&&e!==t?"Passwords don't match.":"")}),$("#D487FE72_8D95_4048_BEA3_252274862AF4,#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").change(function(){var e=$("#D487FE72_8D95_4048_BEA3_252274862AF4").val(),t=$("#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").val();$("#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").get(0).setCustomValidity(e.length>0&&t.length>0&&e!==t?"Passwords don't match.":"")}),$(window).on("message",function(t){var n=t.originalEvent.data.user,i=t.originalEvent.data.pass;n&&i&&(e.form_login2(n,i),t.originalEvent.source.close())});var n=amiWebApp.args.userdata||"";amiCommand.certLogin().always(function(t,i,r,a){_ami_internal_then(amiWebApp.onReady(n),function(){e._update(i,r,a).always(function(){amiWebApp.unlock()})},function(e){amiWebApp.error(e)})})})},_showSuccessMessage1:function(e){amiWebApp.success(e,!0,"#C0D13C0C_BA64_4A79_BF48_1A35F26D19AC"),this._clean()},_showErrorMessage1:function(e){amiWebApp.error(e,!0,"#C0D13C0C_BA64_4A79_BF48_1A35F26D19AC"),this._clean()},_showSuccessMessage2:function(e){amiWebApp.success(e,!0,"#C76F40DA_0480_4D3F_A74B_65735465EA25"),this._clean()},_showErrorMessage2:function(e){amiWebApp.error(e,!0,"#C76F40DA_0480_4D3F_A74B_65735465EA25"),this._clean()},_showSuccessMessage3:function(e){amiWebApp.success(e,!0,"#F14D98EC_5751_4C15_B4A1_927BA76AFCA6"),this._clean()},_showErrorMessage3:function(e){amiWebApp.error(e,!0,"#F14D98EC_5751_4C15_B4A1_927BA76AFCA6"),this._clean()},_flush:function(){$("#C0D13C0C_BA64_4A79_BF48_1A35F26D19AC").empty(),$("#C76F40DA_0480_4D3F_A74B_65735465EA25").empty(),$("#F14D98EC_5751_4C15_B4A1_927BA76AFCA6").empty()},_clean:function(){$("#A4DFD039_034F_4D10_9668_385AEF4FBBB9").val(""),$("#E6E30EEC_15EE_4FCF_9809_2B8EC2FEF388").val(""),$("#CCD8E6F1_6DF8_4BDD_A0EC_C3C380830187").val(""),$("#F238E6EE_44BD_486A_B85D_C927A4D045D3").val(""),$("#D487FE72_8D95_4048_BEA3_252274862AF4").val(""),$("#EE1DA58C_3761_4734_A9C2_E808CDD7EE77").val("")},_update:function(e,t,n){var i=this,r=$.Deferred(),a=this.user=e.AMIUser||"",s=this.guest=e.guestUser||"",o=this.clientDN=e.clientDNInSession||"",l=this.issuerDN=e.issuerDNInSession||"";$("#A09AE316_7068_4BC1_96A9_6B87D28863FE").prop("disabled",!o||!l),this.roleInfo=t,this.ssoInfo=n;var c={sso_name:n.name||"SSO",sso_url:n.url||"N/A"};if(a!==s){var u=e.valid||"false",p=e.certEnabled||"false",d=e.vomsEnabled||"false",h=e.firstName||"",f=e.lastName||"",m=e.email||"",g=e.clientDNInAMI||"",_=e.issuerDNInAMI||"";$("#E513F27D_5521_4B08_BF61_52AFB81356F7").val(h),$("#AFF0B5C0_BEEC_4842_916D_DCBA7F589195").val(f),$("#C587486B_62C0_4B6E_9288_D8F9F89D157B").val(m),$("#ABEB0291_40B0_414A_A42B_E7EABB9B487E").val(h),$("#A5AFDB62_1034_4F66_A3E6_9341B31FA290").val(f),$("#D730A774_05EA_47AB_A0C8_D92753802E3E").val(m),$("#D1BEE3BF_9161_41DC_BC53_C44FFE4D2522").val(g),$("#C76805D7_1E86_4231_9071_1D04783423BB").val(o),$("#F42FAF6B_2C8D_4142_8BD9_E5BCDCAA05AA").val(_),$("#FE2F6232_C256_4B80_939C_EBEC90320308").val(l),$("#C587486B_62C0_4B6E_9288_D8F9F89D157B").prop("disabled","false"!==d);var y="",T="";"false"!==u?("false"!==p&&g&&_&&(o&&l?g===o&&_===l||(T="The certificate in your session is not the one registered in AMI."):T="You should provide a certificate to use this AMI web application."),$("#D944B01D_2E8D_4EE9_9DCC_2691438BBA16").html(T?'<span class="fa fa-exclamation-triangle" style="color: orange;"></span> '+T:""),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").parent().css("background",'url("images/account-green.png") center center'),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").css("color","#006400"),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").text("❧ valid ❧"),y="orange"):(T="false"!==d?g&&_?"Check your VOMS roles.":"Register a valid GRID certificate.":"Contact the AMI team.",$("#D944B01D_2E8D_4EE9_9DCC_2691438BBA16").html(T?'<span class="fa fa-exclamation-triangle" style="color: red;"></span> '+T:""),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").parent().css("background",'url("images/account-pink.png") center center'),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").css("color","#8B0000"),$("#F3FF9F43_DE72_40BB_B1BA_B7B3C9002671").text("❧ invalid ❧"),y="red");var b=T?'<a href="javascript:amiLogin.accountStatus();" style="color: '+y+';"><i class="fa fa-exclamation-triangle"></i></a>':"";c.user=a,c.icon=b,_ami_internal_always(amiWebApp.triggerLogin(),function(){amiWebApp.replaceHTML("#ami_login_content",i.fragmentLogoutButton,{dict:c}),r.resolve()})}else _ami_internal_always(amiWebApp.triggerLogout(),function(){r.resolve(),amiWebApp.replaceHTML("#ami_login_content",i.fragmentLoginButton,{dict:c})});return r.promise()},getUser:function(){return this.user},getGuest:function(){return this.guest},getClientDN:function(){return this.clientDN},getIssuerDN:function(){return this.issuerDN},isAuthenticated:function(){return this.user!==this.guest},sso:function(){this._flush(),this._clean(),window.open(this.ssoInfo.url+"?originURL="+encodeURIComponent(amiWebApp.originURL),"Single Sign-On","menubar=no, status=no, scrollbars=no, width=800, height=450")},signIn:function(){this._flush(),this._clean(),$("#D2B5FADE_97A3_4B8C_8561_7A9AEACDBE5B").modal("show")},changeInfo:function(){this._flush(),this._clean(),$("#D9EAF998_ED8E_44D2_A0BE_8C5CF5E438BD").modal("show")},changePass:function(){this._flush(),this._clean(),$("#E92A1097_983B_4857_875F_07E4659B41B0").modal("show")},accountStatus:function(){this._flush(),this._clean(),$("#AB1CB183_96EB_4116_8A9E_4409BE058F34").modal("show")},signOut:function(){var e=this;return amiWebApp.lock(),amiCommand.logout().always(function(t,n,i,r){e._update(n,i,r).done(function(){e._clean(),amiWebApp.unlock()})})},hasRole:function(e){return e in this.roleInfo},_serializeForm:function(e){var t={};return e.serializeArray().forEach(function(e){t[e.name.trim()]=e.value.trim()}),t},form_login:function(e){e.preventDefault();var t=this._serializeForm($(e.target));return this.form_login2(t.user,t.pass)},form_login2:function(e,t){var n=this,i=e&&t?amiCommand.passLogin(e,t):amiCommand.certLogin();amiWebApp.lock(),i.then(function(e,t,i,r){n._update(t,i,r).done(function(){if(t.AMIUser!==t.guestUser)$("#D2B5FADE_97A3_4B8C_8561_7A9AEACDBE5B").modal("hide"),n._clean(),amiWebApp.unlock();else{var e="Authentication failed.";(t.clientDNInSession||t.issuerDNInSession)&&(e+=" Client DN in session: "+amiWebApp.textToHtml(t.clientDNInSession)+". Issuer DN in session: "+amiWebApp.textToHtml(t.issuerDNInSession)+"."),n._showErrorMessage1(e)}})},function(e,t,i,r){n._update(t,i,r).done(function(){n._showErrorMessage1(amiWebApp.jspath("..error.$",e))})})},form_attachCert:function(){var e=this,t=$("#E64F24B2_33E6_4DED_9B24_28BE04219613").val(),n=$("#A4DFD039_034F_4D10_9668_385AEF4FBBB9").val();t&&n?(amiWebApp.lock(),amiCommand.attachCert(t,n).then(function(t){e._showSuccessMessage1(amiWebApp.jspath("..info.$",t))},function(t){e._showErrorMessage1(amiWebApp.jspath("..error.$",t))})):this._showErrorMessage1("Please, fill all fields with a red star.")},form_detachCert:function(){var e=this,t=$("#E64F24B2_33E6_4DED_9B24_28BE04219613").val(),n=$("#A4DFD039_034F_4D10_9668_385AEF4FBBB9").val();t&&n?(amiWebApp.lock(),amiCommand.detachCert(t,n).then(function(t){e._showSuccessMessage1(amiWebApp.jspath("..info.$",t))},function(t){e._showErrorMessage1(amiWebApp.jspath("..error.$",t))})):this._showErrorMessage1("Please, fill all fields with a red star.")},form_addUser:function(e){var t=this;e.preventDefault();var n=this._serializeForm($(e.target));amiWebApp.lock(),amiCommand.addUser(n.login,n.pass,n.first_name,n.last_name,n.email,"attach"in n).then(function(e){t._showSuccessMessage1(amiWebApp.jspath("..info.$",e))},function(e){t._showErrorMessage1(amiWebApp.jspath("..error.$",e))})},form_remindPass:function(e){var t=this;e.preventDefault();var n=this._serializeForm($(e.target));amiWebApp.lock(),amiCommand.resetPass(n.user).then(function(e){t._showSuccessMessage1(amiWebApp.jspath("..info.$",e))},function(e){t._showErrorMessage1(amiWebApp.jspath("..error.$",e))})},form_changeInfo:function(e){var t=this;e.preventDefault();var n=this._serializeForm($(e.target));amiWebApp.lock(),amiCommand.changeInfo(n.first_name,n.last_name,n.email).then(function(e){t._showSuccessMessage2(amiWebApp.jspath("..info.$",e))},function(e){t._showErrorMessage2(amiWebApp.jspath("..error.$",e))})},form_changePass:function(e){var t=this;e.preventDefault();var n=this._serializeForm($(e.target));amiWebApp.lock(),amiCommand.changePass(n.old_pass,n.new_pass).then(function(e){t._showSuccessMessage3(amiWebApp.jspath("..info.$",e))},function(e){t._showErrorMessage3(amiWebApp.jspath("..error.$",e))})}});var amiDoc={namespaces:[{name:"amiWebApp",desc:"The AMI webapp subsystem",variables:[{name:"originURL",type:"String",desc:"Origin URL"},{name:"webAppURL",type:"String",desc:"WebApp URL"},{name:"args",type:"Array.<String>",desc:"URL arguments"}],functions:[{name:"isEmbedded",desc:"Check whether the WebApp is executed in embedded mode",params:[],returns:[{type:"Boolean",desc:""}]},{name:"isLocal",desc:"Check whether the WebApp is executed locally (file://, localhost or 127.0.0.1)",params:[],returns:[{type:"Boolean",desc:""}]},{name:"textToHtml",desc:"Escapes the given string from text to HTML",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"htmlToText",desc:"Unescapes the given string from HTML to text",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"textToString",desc:"Escapes the given string from text to JavaScript string",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"stringToText",desc:"Unescapes the given string from JavaScript string to text",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"htmlToString",desc:"Escapes the given string from HTML to JavaScript string",params:[{name:"string",type:"String",desc:"the unescaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The escaped string"}]},{name:"stringToHtml",desc:"Unescapes the given string from JavaScript string to HTML",params:[{name:"string",type:"String",desc:"the escaped string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The unescaped string"}]},{name:"base64Encode",desc:"Encodes (RFC 4648) a string",params:[{name:"string",type:"String",desc:"the decoded string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The encoded string"}]},{name:"base64Decode",desc:"Decodes (RFC 4648) a string",params:[{name:"string",type:"String",desc:"the encoded string",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The decoded string"}]},{name:"loadResources",desc:"Loads resources asynchronously by extension",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadSheets",desc:"Loads CSS sheets asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadScripts",desc:"Loads JS scripts asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadJSONs",desc:"Loads JSON files asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadXMLs",desc:"Loads XML files asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadHTMLs",desc:"Loads HTML files asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadTWIGs",desc:"Loads TWIG files asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadTexts",desc:"Loads text files asynchronously",params:[{name:"urls",type:["Array","String"],desc:"the array of urls",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"replaceHTML",desc:"Put a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"formatTWIG",desc:"Interpretes the given TWIG string, see {@link http://twig.sensiolabs.org/documentation}",params:[{name:"twig",type:"String",desc:"the TWIG string",default:"",optional:"",nullable:""},{name:"dict",type:["Object","Array"],desc:"the dictionary",default:"",optional:!0,nullable:""}],returns:[{type:"String",desc:"The Interpreted TWIG string"}]},{name:"jspath",desc:"Finds data within the given JSON, see {@link https://github.com/dfilatov/jspath}",params:[{name:"path",type:"String",desc:"the path",default:"",optional:"",nullable:""},{name:"json",type:"Object",desc:"the JSON",default:"",optional:"",nullable:""}],returns:[{type:"Array",desc:"The resulting array"}]},{name:"lock",desc:"Locks the web application",params:[]},{name:"unlock",desc:"Unlocks the web application",params:[]},{name:"canLeave",desc:"Enable the message in a confirmation dialog box to inform that the user is about to leave the current page.",params:[]},{name:"cannotLeave",desc:"Disable the message in a confirmation dialog box to inform that the user is about to leave the current page.",params:[]},{name:"info",desc:"Show an 'info' message",params:[{name:"message",type:"String",desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""},{name:"id",type:"String",desc:"the target id",default:"",optional:!0,nullable:""}]},{name:"success",desc:"Show a 'success' message",params:[{name:"message",type:"String",desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""},{name:"id",type:"String",desc:"the target id",default:"",optional:!0,nullable:""}]},{name:"warning",desc:"Show a 'warning' message",params:[{name:"message",type:"String",desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""},{name:"id",type:"String",desc:"the target id",default:"",optional:!0,nullable:""}]},{name:"error",desc:"Show an 'error' message",params:[{name:"message",type:"String",desc:"the message",default:"",optional:"",nullable:""},{name:"fadeOut",type:"Boolean",desc:"if True, the message disappears after 60s",default:"",optional:!0,nullable:""},{name:"id",type:"String",desc:"the target id",default:"",optional:!0,nullable:""}]},{name:"flush",desc:"Flush messages",params:[]},{name:"start",desc:"Starts the web application",params:[{name:"settings",type:"Object",desc:"dictionary of settings (logo_url, home_url, contact_email, about_url, theme_url, locker_url)",default:"",optional:!0,nullable:""}]},{name:"loadControls",desc:"Loads controls asynchronously",params:[{name:"controls",type:["Array","String"],desc:"the array of control names",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"loadSubApp",desc:"Loads a sub-application",params:[{name:"defaultSubApp",type:"String",desc:"the default sub-application name, if null, 'amiWebApp.args[\"subapp\"]'",default:"",optional:"",nullable:""},{name:"defaultUserData",type:"?",desc:"the default user data, if null, 'amiWebApp.args[\"userdata\"]'",default:"",optional:!0,nullable:""}]}],events:[{name:"onReady",desc:"This method must be overloaded and is called when the web application starts",params:[{name:"userData",type:"String",desc:"",default:"",optional:"",nullable:""}]},{name:"onRefresh",desc:"This method must be overloaded and is called when the toolbar needs to be updated",params:[{name:"isAuth",type:"Boolean",desc:"",default:"",optional:"",nullable:""}]}]},{name:"amiCommand",desc:"The AMI command subsystem",variables:[{name:"endpoint",type:"String",desc:"Default endpoint"},{name:"converter",type:"String",desc:"Default converter"}],functions:[{name:"execute",desc:"Execute an AMI command",params:[{name:"command",type:"String",desc:"the command",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, endpoint, converter, extraParam, extraValue)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"passLogin",desc:"Login by login/password",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"certLogin",desc:"Login by certificate",params:[{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"logout",desc:"Logout",params:[{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"attachCert",desc:"Attach a certificate",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"detachCert",desc:"Detach a certificate",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"addUser",desc:"Add a new user",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"pass",type:"String",desc:"the password",default:"",optional:"",nullable:""},{name:"firstName",type:"String",desc:"the first name",default:"",optional:"",nullable:""},{name:"lastName",type:"String",desc:"the last name",default:"",optional:"",nullable:""},{name:"email",type:"String",desc:"the email",default:"",optional:"",nullable:""},{name:"attach",type:"Boolean",desc:"attach the current certificate",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"changeInfo",desc:"Change the account information",params:[{name:"firstName",type:"String",desc:"the first name",default:"",optional:"",nullable:""},{name:"lastName",type:"String",desc:"the last name",default:"",optional:"",nullable:""},{name:"email",type:"String",desc:"the email",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"changePass",desc:"Change the account password",params:[{name:"oldPass",type:"String",desc:"the old password",default:"",optional:"",nullable:""},{name:"newPass",type:"String",desc:"the new password",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"resetPass",desc:"Reset the account password",params:[{name:"user",type:"String",desc:"the user",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]}]},{name:"amiLogin",desc:"The AMI authentication subsystem",functions:[{name:"getUser",desc:"The current user",params:[],returns:[{type:"String",desc:"The current user"}]},{name:"getGuest",desc:"The guest user",params:[],returns:[{type:"String",desc:"The guest user"}]},{name:"getClientDN",desc:"The client DN",params:[],returns:[{type:"String",desc:"The client DN"}]},{name:"getIssuerDN",desc:"The issuer DN",params:[],returns:[{type:"String",desc:"The issuer DN"}]},{name:"isAuthenticated",desc:"Check whether the user is authenticated",params:[],returns:[{type:"Boolean",desc:""}]},{name:"sso",desc:"Open the 'SSO' modal form",params:[]},{name:"signIn",desc:"Open the 'SignIn' modal form",params:[]},{name:"changeInfo",desc:"Open the 'Change Info' modal form",params:[]},{name:"changePass",desc:"Open the 'Change Password' modal form",params:[]},{name:"accountStatus",desc:"Open the 'Account Status' modal form",params:[]},{name:"signOut",desc:"Sign out",params:[]},{name:"hasRole",desc:"Check if the user has the given role",params:[{name:"role",type:"String",desc:"the role",default:"",optional:"",nullable:""}],returns:[{type:"Boolean",desc:""}]}]}],interfaces:[{name:"ami.IControl",desc:"The AMI control interface",implements:[],inherits:[],functions:[{name:"patchId",desc:"Patch an HTML identifier",params:[{name:"id",type:"String",desc:"the unpatched HTML identifier",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The patched HTML identifier"}]},{name:"replaceHTML",desc:"Put a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"onReady",desc:"Called when the control is ready to run",params:[]}]},{name:"ami.ISubApp",desc:"The AMI sub-application interface",implements:[],inherits:[],functions:[{name:"onReady",desc:"Called when the sub-application is ready to run",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onExit",desc:"Called when the sub-application is about to exit",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogin",desc:"Called when logging in",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogout",desc:"Called when logging out",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]}]}],classes:[{name:"ami.Control",desc:"The basic AMI control",implements:["ami.IControl"],inherits:[],konstructor:{name:"Control",params:[]},functions:[{name:"patchId",desc:"Patch an HTML identifier",params:[{name:"id",type:"String",desc:"the unpatched HTML identifier",default:"",optional:"",nullable:""}],returns:[{type:"String",desc:"The patched HTML identifier"}]},{name:"replaceHTML",desc:"Put a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"prependHTML",desc:"Prepends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"appendHTML",desc:"Appends a HTML or TWIG fragment to the given target, see method [formatTWIG]{@link #jsdoc_method_formatTWIG}",params:[{name:"selector",type:"String",desc:"the target selector",default:"",optional:"",nullable:""},{name:"twig",type:"String",desc:"the TWIG fragment",default:"",optional:"",nullable:""},{name:"settings",type:"Object",desc:"dictionary of settings (context, dict)",default:"",optional:!0,nullable:""}],returns:[{type:"$.Deferred",desc:"A JQuery deferred object"}]},{name:"onReady",desc:"Called when the control is ready to run",params:[]}]},{name:"ami.SubApp",desc:"The basic AMI sub-application",implements:["ami.ISubApp"],inherits:[],konstructor:{name:"SubApp",params:[]},functions:[{name:"onReady",desc:"Called when the sub-application is ready to run",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onExit",desc:"Called when the sub-application is about to exit",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogin",desc:"Called when logging in",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]},{name:"onLogout",desc:"Called when logging out",params:[{name:"userdata",type:"?",desc:"userdata",default:"",optional:"",nullable:""}]}]}]};