/*!
 * AMITwigExprParser class
 *
 * Copyright (c) 2014-2015 The AMI Team
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 *
 */
;function _isNumber(a){return isNaN(a)===false}function _isString(a){var b=a.length-1;return b>=2&&((a[0]==="'"&&a[a.length-1]==="'")||(a[0]==='"'&&a[a.length-1]==='"'))}function _isIdent(a){return a.match(/^[a-zA-Z_]\w*$/)!==null}function AMITwigExprTokenizer(d,a){this.LP=4;this.RP=5;this.i=0;this.tokens=d;this.types=[];for(var c=0;c<d.length;c++){var b=d[c];if(b==="or"){this.types.push(TWIG_EXPR_NODE_TYPE_OR)}else{if(b==="and"){this.types.push(TWIG_EXPR_NODE_TYPE_AND)}else{if(b==="=="){this.types.push(TWIG_EXPR_NODE_TYPE_EQ)}else{if(b==="!="){this.types.push(TWIG_EXPR_NODE_TYPE_NE)}else{if(b==="<"){this.types.push(TWIG_EXPR_NODE_TYPE_GT)}else{if(b===">"){this.types.push(TWIG_EXPR_NODE_TYPE_LT)}else{if(b==="<="){this.types.push(TWIG_EXPR_NODE_TYPE_GTE)}else{if(b===">="){this.types.push(TWIG_EXPR_NODE_TYPE_LTE)}else{if(b==="is"){this.types.push(TWIG_EXPR_NODE_TYPE_IS)}else{if(b==="defined"){this.types.push(TWIG_EXPR_NODE_TYPE_DEFINED)}else{if(b==="empty"){this.types.push(TWIG_EXPR_NODE_TYPE_EMPTY)}else{if(b==="in"){this.types.push(TWIG_EXPR_NODE_TYPE_IN)}else{if(b===".."){this.types.push(TWIG_EXPR_NODE_TYPE_RANGE)}else{if(b==="+"){this.types.push(TWIG_EXPR_NODE_TYPE_PLUS)}else{if(b==="-"){this.types.push(TWIG_EXPR_NODE_TYPE_MINUS)}else{if(b==="*"){this.types.push(TWIG_EXPR_NODE_TYPE_MUL)}else{if(b==="/"){this.types.push(TWIG_EXPR_NODE_TYPE_DIV)}else{if(b==="%"){this.types.push(TWIG_EXPR_NODE_TYPE_MOD)}else{if(b==="not"){this.types.push(TWIG_EXPR_NODE_TYPE_NOT)}else{if(b==="("){this.types.push(this.LP)}else{if(b===")"){this.types.push(this.RP)}else{if(b==="."){this.types.push(TWIG_EXPR_NODE_TYPE_DOT)}else{if(b==="true"){this.types.push(TWIG_EXPR_NODE_TYPE_BOOL)}else{if(b==="false"){this.types.push(TWIG_EXPR_NODE_TYPE_BOOL)}else{if(_isNumber(b)){this.types.push(TWIG_EXPR_NODE_TYPE_NUM)}else{if(_isString(b)){this.types.push(TWIG_EXPR_NODE_TYPE_STR)}else{if(_isIdent(b)){this.types.push(TWIG_EXPR_NODE_TYPE_ID)}else{throw"error, line `"+a+"`, unknown token `"+b+"`"}}}}}}}}}}}}}}}}}}}}}}}}}}}}this.hasNext=function(){return this.i<this.tokens.length};this.next=function(){this.i++};this.peekToken=function(){return this.tokens[this.i]};this.peekType=function(){return this.types[this.i]};this.checkType=function(e){return(e instanceof Array)?e.indexOf(this.types[this.i])>=0:e===this.types[this.i]}}function AMITwigExprParser(){this.parse=function(b,a){this.tokenizer=new AMITwigExprTokenizer(b,this.line=a);this.rootElement=this.parseOr()};this.parseOr=function(){var c=this.parseAnd();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_OR)){var b=new AMITwigExprNode(TWIG_EXPR_NODE_TYPE_OR);this.tokenizer.next();var a=this.parseOr();b.nodeLeft=c;b.nodeRight=a;c=b}return c};this.parseAnd=function(){var c=this.parseComp();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_AND)){var b=new AMITwigExprNode(TWIG_EXPR_NODE_TYPE_AND);this.tokenizer.next();var a=this.parseAnd();b.nodeLeft=c;b.nodeRight=a;c=b}return c};this.parseComp=function(){var c=this.parseAddSub();if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_EQ,TWIG_EXPR_NODE_TYPE_NE,TWIG_EXPR_NODE_TYPE_GT,TWIG_EXPR_NODE_TYPE_LT,TWIG_EXPR_NODE_TYPE_GTE,TWIG_EXPR_NODE_TYPE_LTE])){var b=new AMITwigExprNode(this.tokenizer.peekType());this.tokenizer.next();var a=this.parseAddSub();b.nodeLeft=c;b.nodeRight=a;c=b}return c};this.parseAddSub=function(){var c=this.parseMulDiv();if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_PLUS,TWIG_EXPR_NODE_TYPE_MINUS])){var b=new AMITwigExprNode(this.tokenizer.peekType());this.tokenizer.next();var a=this.parseAddSub();b.nodeLeft=c;b.nodeRight=a;c=b}return c};this.parseMulDiv=function(){var c=this.parseNotPlusMinus();if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_MUL,TWIG_EXPR_NODE_TYPE_DIV,TWIG_EXPR_NODE_TYPE_MOD])){var b=new AMITwigExprNode(this.tokenizer.peekType());this.tokenizer.next();var a=this.parseMulDiv();b.nodeLeft=c;b.nodeRight=a;c=b}return c};this.parseNotPlusMinus=function(){if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_NOT,TWIG_EXPR_NODE_TYPE_PLUS,TWIG_EXPR_NODE_TYPE_MINUS])){var b=new AMITwigExprNode(this.tokenizer.peekType());this.tokenizer.next();var a=this.parseX();b.nodeLeft=a;b.nodeRight=a;return b}return this.parseX()};this.parseX=function(){var a;if((a=this.parseGroup())!==null){return a}if((a=this.parseQId())!==null){return a}if((a=this.parseTerminal())!==null){return a}throw"error, line `"+this.line+"`, syntax error or tuncated expression"};this.parseGroup=function(){if(this.tokenizer.hasNext()&&this.tokenizer.checkType(this.tokenizer.LP)){this.tokenizer.next();var a=this.parseOr();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(this.tokenizer.RP)){this.tokenizer.next();return a}throw"error, line `"+this.line+"`, `)` expected"}return null};this.parseQId=function(){var a="";if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_ID)){a+=this.tokenizer.peekToken();this.tokenizer.next();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_DOT)){a+=this.tokenizer.peekToken();this.tokenizer.next();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_ID)){a+=this.tokenizer.peekToken();this.tokenizer.next()}}return new AMITwigExprNode(TWIG_EXPR_NODE_TYPE_ID,a)}return null};this.parseTerminal=function(){if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_NUM,TWIG_EXPR_NODE_TYPE_STR])){var a=new AMITwigExprNode(this.tokenizer.peekType(),this.tokenizer.peekToken());this.tokenizer.next();return a}return null};this.parseRange=function(d){if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_NUM,TWIG_EXPR_NODE_TYPE_STR])){var c=new AMITwigExprNode(this.tokenizer.peekType(),this.tokenizer.peekToken());this.tokenizer.next();if(this.tokenizer.hasNext()&&this.tokenizer.checkType(TWIG_EXPR_NODE_TYPE_RANGE)){var b=new AMITwigExprNode(TWIG_EXPR_NODE_TYPE_RANGE,this.tokenizer.peekToken());this.tokenizer.next();if(this.tokenizer.hasNext()&&this.tokenizer.checkType([TWIG_EXPR_NODE_TYPE_NUM,TWIG_EXPR_NODE_TYPE_STR])){var a=new AMITwigExprNode(this.tokenizer.peekType(),this.tokenizer.peekToken());this.tokenizer.next();b.nodeLeft=c;b.nodeRight=a;return b}}}throw"error, line `"+this.line+"`, invalid range"}}TWIG_EXPR_NODE_TYPE_OR=100;TWIG_EXPR_NODE_TYPE_AND=101;TWIG_EXPR_NODE_TYPE_EQ=102;TWIG_EXPR_NODE_TYPE_NE=103;TWIG_EXPR_NODE_TYPE_GT=104;TWIG_EXPR_NODE_TYPE_LT=105;TWIG_EXPR_NODE_TYPE_GTE=106;TWIG_EXPR_NODE_TYPE_LTE=107;TWIG_EXPR_NODE_TYPE_IS=108;TWIG_EXPR_NODE_TYPE_DEFINED=109;TWIG_EXPR_NODE_TYPE_EMPTY=110;TWIG_EXPR_NODE_TYPE_IN=111;TWIG_EXPR_NODE_TYPE_RANGE=112;TWIG_EXPR_NODE_TYPE_PLUS=113;TWIG_EXPR_NODE_TYPE_MINUS=114;TWIG_EXPR_NODE_TYPE_MUL=115;TWIG_EXPR_NODE_TYPE_DIV=116;TWIG_EXPR_NODE_TYPE_MOD=117;TWIG_EXPR_NODE_TYPE_NOT=118;TWIG_EXPR_NODE_TYPE_ID=119;TWIG_EXPR_NODE_TYPE_DOT=120;TWIG_EXPR_NODE_TYPE_BOOL=121;TWIG_EXPR_NODE_TYPE_NUM=122;TWIG_EXPR_NODE_TYPE_STR=123;function AMITwigExprNode(a,b){this.nodeType=a;this.nodeValue=b;this.nodeLeft=null;this.nodeRight=null}amiTwigExprParser=new AMITwigExprParser();