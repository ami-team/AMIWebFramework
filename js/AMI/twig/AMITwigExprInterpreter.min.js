/*!
 * AMI Web Framework
 *
 * Copyright (c) 2014-2015 The AMI Team
 * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html
 *
 */
;$AMINamespace("ami.twig.expr.interpreter",{_unstring:function(a){if(_ami_internal_isStr(a)){return a.substring(1,a.length-1)}return a},_getJS:function(f){if(f.nodeLeft===null&&f.nodeRight===null){if(f.list.length>0){var b=[];for(var e in f.list){b.push(this._getJS(f.list[e]))}if(f.nodeType===ami.twig.expr.tokens.FUN){return"ami.twig.stdlib."+f.nodeValue+"("+b.join(",")+")"}else{if(f.nodeType===ami.twig.expr.tokens.VAR){return f.nodeValue+"["+b.join(",")+"]"}}throw"internal error"}return f.nodeValue}if(f.nodeLeft!==null&&f.nodeRight===null){var c=(f.nodeType!==ami.twig.expr.tokens.NOT)?f.nodeValue:"!";return c+"("+this._getJS(f.nodeLeft)+")"}if(f.nodeLeft!==null&&f.nodeRight!==null){var g;var d;var c;switch(f.nodeType){case ami.twig.expr.tokens.IS:g=this._getJS(f.nodeLeft);switch(f.nodeRight.nodeType){case ami.twig.expr.tokens.DEFINED:return"(("+g+")!==undefined)";case ami.twig.expr.tokens.NULL:return"(("+g+")===null)";case ami.twig.expr.tokens.EMPTY:return"(("+g+")==='')";case ami.twig.expr.tokens.ITERABLE:return"ami.twig.stdlib.isIterable("+g+")";case ami.twig.expr.tokens.EVEN:return"(("+g+")&1 === 0)";case ami.twig.expr.tokens.ODD:return"(("+g+")&1 === 1)"}throw"internal error";case ami.twig.expr.tokens.IN:if(f.nodeRight.nodeType!==ami.twig.expr.tokens.RANGE){g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"ami.twig.stdlib.isInObject("+g+","+d+")"}if(f.nodeRight.nodeLeft.nodeType===ami.twig.expr.tokens.NUM&&f.nodeRight.nodeRight.nodeType===ami.twig.expr.tokens.NUM){var a=this._getJS(f.nodeLeft);g=f.nodeRight.nodeLeft.nodeValue;d=f.nodeRight.nodeRight.nodeValue;return"ami.twig.stdlib.isInNumRange("+a+","+g+","+d+")"}if(f.nodeRight.nodeLeft.nodeType===ami.twig.expr.tokens.STR&&f.nodeRight.nodeRight.nodeType===ami.twig.expr.tokens.STR){var a=this._getJS(f.nodeLeft);g=f.nodeRight.nodeLeft.nodeValue;d=f.nodeRight.nodeRight.nodeValue;return"ami.twig.stdlib.isInCharRange("+a+","+g+","+d+")"}throw"internal error";case ami.twig.expr.tokens.STARTS:g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"ami.twig.stdlib.startsWith("+g+","+d+")";case ami.twig.expr.tokens.ENDS:g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"ami.twig.stdlib.endsWith("+g+","+d+")";case ami.twig.expr.tokens.MATCHES:g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"("+g+".match("+this._unstring(d)+")!==null)";case ami.twig.expr.tokens.POWER:g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"Math.pow("+g+","+d+")";case ami.twig.expr.tokens.FLOORDIV:g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"Math.floor("+g+"/"+d+")";case ami.twig.expr.tokens.LOGICAL_OR:c="||";break;case ami.twig.expr.tokens.LOGICAL_AND:c="&&";break;case ami.twig.expr.tokens.BITWISE_OR:c="|";break;case ami.twig.expr.tokens.BITWISE_XOR:c="^";break;case ami.twig.expr.tokens.BITWISE_AND:c="&";break;default:c=f.nodeValue;break}g=this._getJS(f.nodeLeft);d=this._getJS(f.nodeRight);return"("+g+c+d+")"}},getJS:function(a){return this._getJS(a.rootNode)},eval:function(expr,_){if(!_){_={}}return eval(this._getJS(expr.rootNode))}});